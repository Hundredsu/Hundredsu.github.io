<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>5、并发编程 | Hundredsu'Blog</title><meta name="author" content="Hundredsu"><meta name="copyright" content="Hundredsu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="什么是进程、线程、协程？？？？？？？？ 进程概念： 进程（Process）是操作系统中运⾏中的程序，它是程序执⾏的⼀个实例。当你运⾏⼀个应⽤程  序时，⽐如打开浏览器、启动游戏，操作系统会为这个程序创建⼀个进程。进程包含了程序执⾏的所有必要信息，例如代码、数据、资源和内存。  线程： 概念  线程是⽐进程更轻量的执⾏单元，是进程的⼀部分。⼀个进程可以包含多个线程，每个线程  可以独⽴执⾏任务，但">
<meta property="og:type" content="article">
<meta property="og:title" content="5、并发编程">
<meta property="og:url" content="https://hundredsu.github.io/post/b6e82410.html">
<meta property="og:site_name" content="Hundredsu&#39;Blog">
<meta property="og:description" content="什么是进程、线程、协程？？？？？？？？ 进程概念： 进程（Process）是操作系统中运⾏中的程序，它是程序执⾏的⼀个实例。当你运⾏⼀个应⽤程  序时，⽐如打开浏览器、启动游戏，操作系统会为这个程序创建⼀个进程。进程包含了程序执⾏的所有必要信息，例如代码、数据、资源和内存。  线程： 概念  线程是⽐进程更轻量的执⾏单元，是进程的⼀部分。⼀个进程可以包含多个线程，每个线程  可以独⽴执⾏任务，但">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hundredsu.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-08-07T13:57:12.000Z">
<meta property="article:modified_time" content="2025-08-07T13:58:56.037Z">
<meta property="article:author" content="Hundredsu">
<meta property="article:tag" content="安全开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hundredsu.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "5、并发编程",
  "url": "https://hundredsu.github.io/post/b6e82410.html",
  "image": "https://hundredsu.github.io/img/avatar.jpg",
  "datePublished": "2025-08-07T13:57:12.000Z",
  "dateModified": "2025-08-07T13:58:56.037Z",
  "author": [
    {
      "@type": "Person",
      "name": "Hundredsu",
      "url": "https://hundredsu.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="https://hundredsu.github.io/post/b6e82410.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.3.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '5、并发编程',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/avatar.jpg" alt="Logo"><span class="site-name">Hundredsu'Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">5、并发编程</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">5、并发编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-07T13:57:12.000Z" title="发表于 2025-08-07 21:57:12">2025-08-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-07T13:58:56.037Z" title="更新于 2025-08-07 21:58:56">2025-08-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><img src="/img/5%E3%80%81%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/1.jpeg"></p>
<h2 id="什么是进程、线程、协程？？？？？？？？"><a href="#什么是进程、线程、协程？？？？？？？？" class="headerlink" title="什么是进程、线程、协程？？？？？？？？ "></a><font style="color:rgb(0,0,0);">什么是进程、线程、协程？？？？？？？？ </font></h2><h3 id="进程概念："><a href="#进程概念：" class="headerlink" title="进程概念： "></a><font style="color:rgb(0,0,0);">进程概念： </font></h3><p><font style="color:rgb(0,0,0);">进程（</font><font style="color:rgb(0,0,0);">Process</font><font style="color:rgb(0,0,0);">）是操作系统中运⾏中的程序，它是程序执⾏的⼀个实例。当你运⾏⼀个应⽤程 </font></p>
<p><font style="color:rgb(0,0,0);">序时，⽐如打开浏览器、启动游戏，操作系统会为这个程序创建⼀个进程。进程包含了程序执⾏的所有必要信息，例如代码、数据、资源和内存。 </font></p>
<h3 id="线程："><a href="#线程：" class="headerlink" title="线程： "></a><font style="color:rgb(0,0,0);">线程： </font></h3><p><font style="color:rgb(0,0,0);">概念 </font></p>
<p><font style="color:rgb(0,0,0);">线程是⽐进程更轻量的执⾏单元，是进程的⼀部分。⼀个进程可以包含多个线程，每个线程 </font></p>
<p><font style="color:rgb(0,0,0);">可以独⽴执⾏任务，但它们共享相同的内存空间和资源。 </font></p>
<p><font style="color:rgb(0,0,0);">举例： </font></p>
<p><font style="color:rgb(0,0,0);">进程就像⼀个厨房，⾥⾯有完整的设备、材料和⻝谱，允许你做饭。⽽线程则是厨房⾥的厨 </font></p>
<p><font style="color:rgb(0,0,0);">师。⼀个厨房可以有多个厨师（线程），每个厨师可以同时进⾏不同的任务（切菜、炒菜、 </font></p>
<p><font style="color:rgb(0,0,0);">煮汤等），并且他们共享同样的厨房资源，⽐如锅、灶台和⻝材。 </font></p>
<h4 id="单线程"><a href="#单线程" class="headerlink" title="单线程 "></a><font style="color:rgb(0,0,0);">单线程 </font></h4><p><font style="color:rgb(0,0,0);">如果是单线程的状态下，⼀个厨师(线程)就需要处理⼀整个厨房的事情(进程)，有⼀个大菜，厨师只能⼀个⼀个来弄，效率低下 </font></p>
<h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程 "></a><font style="color:rgb(0,0,0);">多线程 </font></h4><p><font style="color:rgb(0,0,0);">⼀个厨房有多个厨师，他们的效率就会更⾼，每个厨师可以同时进⾏不同的任务，并且因为他们是在⼀个厨房⾥(进程），他们可以直接沟通，(共享的数据结构进⾏通信),⽽进程是独⽴的厨房，两个厨房(进程)之间的通信，相对于来说要复杂很多。 </font></p>
<h3 id="协程"><a href="#协程" class="headerlink" title="协程 "></a><font style="color:rgb(0,0,0);">协程 </font></h3><p><font style="color:rgb(0,0,0);">协程概念： </font></p>
<p><font style="color:rgb(0,0,0);">协程 Coroutines 是⼀种⽐线程更加轻量级的微线程。⼀个进程可以拥有多个线程，⼀个线程也可以拥有多个协程，因此协程⼜称微线程和纤程。 可以粗略的把协程理解成⼦程序调⽤，每个⼦程序都可以在⼀个单独的协程内执⾏。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">Go协程⽐传统的操作系统线程更轻量级。它们的启动和销毁开销⾮常⼩，并且允许并发地执⾏代码，这意味着多个协程可以在同⼀时间段内运⾏,协程相当于是⼀个⼦程序，他属于⽤户态，也就是由语⾔来操作，线程与进程，都是属于内核态，由操作系统来操作，⽆法⼲预，但是协程，我们可以控制它 </font></p>
<h3 id="调度器"><a href="#调度器" class="headerlink" title="调度器 "></a><font style="color:rgb(0,0,0);">调度器 </font></h3><h4 id="线程调度"><a href="#线程调度" class="headerlink" title="线程调度 "></a><font style="color:rgb(0,0,0);">线程调度 </font></h4><p><font style="color:rgb(0,0,0);">线程调度通常由操作系统的内核负责，是⼀种抢占式调度机制。抢占式调度意味着操作系统会强制地决定何时停⽌⼀个线程的执⾏，并切换到另⼀个线程。这种调度机制称为抢占式多任务，由于抢占式多任务，操作系统会根据线程的优先级、状态（如阻塞、就绪、运⾏）以及可⽤资源来决定哪个线程获得CPU时间⽚。每个线程在操作系统中都会分配⼀个时间⽚，当时间⽚⽤完时，操作系统会切换到另⼀个线程，在⼀个CPU时间⽚⽤完时，需要进⾏上下⽂切换，操作系统在线程之间切换时，需要保存和恢复线程的上下⽂（包括寄存器状态、程序计数器、内存⻚表等）。这种上下⽂切换发⽣在内核态和⽤户态之间，开销较⼤。但由于抢占式调度，操作系统会随时中断正在运⾏的线程，以便处理其他线程的任务，线程本身对调度过程没有控制权。 </font></p>
<h4 id="Go-Goroutines-调度器"><a href="#Go-Goroutines-调度器" class="headerlink" title="Go Goroutines 调度器 "></a><font style="color:rgb(0,0,0);">Go Goroutines 调度器 </font></h4><p><font style="color:rgb(0,0,0);">协程调度通常是由编程语⾔的运⾏时（⽤户态）来负责，在</font><font style="color:rgb(0,0,0);">go</font><font style="color:rgb(0,0,0);">中，由</font><font style="color:rgb(0,0,0);">Goroutines</font><font style="color:rgb(0,0,0);">负责， </font></p>
<p><font style="color:rgb(0,0,0);">Goroutines 的调度由 Go 的运⾏时系统（runtime）管理，通过协作式调度和抢占式调度结合的⽅式，来保证 Goroutines 在多核 CPU 上⾼效执⾏。 </font></p>
<h4 id="Go调度的优势"><a href="#Go调度的优势" class="headerlink" title="Go调度的优势 "></a><font style="color:rgb(0,0,0);">Go调度的优势 </font></h4><h5 id="轻量性"><a href="#轻量性" class="headerlink" title="轻量性 "></a><font style="color:rgb(0,0,0);">轻量性 </font></h5><p><font style="color:rgb(0,0,0);">相⽐于传统的操作系统线程，Goroutines 是⾮常轻量的。操作系统线程通常需要消耗⼤量内存 （每个线程的栈⼤⼩默认⼏乎占 1-2 MB），⽽Goroutine 的初始栈⼤⼩只有 2 KB，并且可以按需动态增⻓，这使得在同样的资源下，Go 程序可以轻松创建成千上万的 Goroutines ⽽不会占⽤过多系统资源。 </font></p>
<h5 id="⾃动调度"><a href="#⾃动调度" class="headerlink" title="⾃动调度 "></a><font style="color:rgb(0,0,0);">⾃动调度 </font></h5><p><font style="color:rgb(0,0,0);">Goroutines 不需要程序员⼿动管理。Go 的调度器会根据负载和系统资源⾃动进⾏调度，使得程序员能够专注于业务逻辑，⽽⽆需担⼼如何调度Goroutines。 </font></p>
<h5 id="多核优化"><a href="#多核优化" class="headerlink" title="多核优化 "></a><font style="color:rgb(0,0,0);">多核优化 </font></h5><p><font style="color:rgb(0,0,0);">Goroutines 的调度器充分利⽤了多核 CPU。Go 的运⾏时调度器通过逻辑处理器 P 和操作系统线程 M 的绑定机制，能够在多核 CPU 上⾃动并⾏执⾏Goroutines，最⼤化性能。 </font></p>
<h1 id="协程-1"><a href="#协程-1" class="headerlink" title="协程"></a><font style="color:rgb(0,0,0);">协程</font></h1><h3 id="协程创建"><a href="#协程创建" class="headerlink" title="协程创建 "></a><font style="color:rgb(0,0,0);">协程创建 </font></h3><p><font style="color:rgb(0,0,0);">Golang</font><font style="color:rgb(0,0,0);">中的并发是函数相互独⽴运⾏的能⼒， </font></p>
<p><font style="color:rgb(0,0,0);">创建协程在任务函数前⾯加上</font><font style="color:rgb(0,0,0);">go</font><font style="color:rgb(0,0,0);">关键字： </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> test() </span><br></pre></td></tr></table></figure>



<p>实例代码 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Show</span><span class="params">(msg <span class="type">string</span>)</span></span> &#123; </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123; </span><br><span class="line">        fmt.Println(msg) </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    Show(<span class="string">&quot;Java&quot;</span>) </span><br><span class="line">    <span class="keyword">go</span> Show(<span class="string">&quot;Go&quot;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是以上仍有可能会出现，看不到协程go show的内容，因为会优先执行main主线程的内容，而打印一下就结束了，导致整个main直接结束了，并不会等待go show的运行结束，但是如果给main加上一些延迟，那么协程就会被调度器穿插于其中执行，这个问题可以利用同步机制去解决</p>
<h1 id="通道（Channels）"><a href="#通道（Channels）" class="headerlink" title="通道（Channels） "></a><font style="color:rgb(0,0,0);">通道（Channels） </font></h1><p>使用这个就可以使主线程等子线程</p>
<p><font style="color:rgb(0,0,0);">Go 提供了⼀种称为通道的机制，⽤于在 goroutine 之间共享数据。当 goroutine 执⾏并发活动时，需要在goroutine 之间共享资源或数据，通道充当 goroutine 之间的管道（管道）并提供⼀种机制来保证同步交换。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><strong><font style="color:rgb(0,0,0);">Channels </font></strong><font style="color:rgb(0,0,0);">需要在声明通道时指定数据类型。我们可以共享内置、命名、结构和引⽤类型的值和指针。数据在通道上传递：在任何给定时间只有⼀个 goroutine 可以访问数据项：因此按照设计不会发⽣数据竞争。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">根据数据交换的⾏为，有两种类型的通道：</font><strong><font style="color:rgb(0,0,0);">无缓冲通道和缓冲通道</font></strong><font style="color:rgb(0,0,0);">。⽆缓冲通道⽤于执⾏goroutine 之间的同步通信，⽽缓冲通道⽤于执⾏异步通信。⽆缓冲通道保证在</font><strong><font style="color:rgb(0,0,0);">发送和接收</font></strong><font style="color:rgb(0,0,0);">发⽣的瞬间执⾏</font><strong><font style="color:rgb(0,0,0);">两个 goroutine 之间的交换</font></strong><font style="color:rgb(0,0,0);">。缓冲通道没有这样的保证。 </font></p>
<p><font style="color:rgb(0,0,0);">协程之间⽆法直接通信，但可以使⽤通道来使协程之间互相通信 </font></p>
<p><font style="color:rgb(0,0,0);">通道分为有缓冲和⽆缓冲，有缓冲，容量设置后，可以异步读取数据，不会堵塞，⽆缓冲的话，放⼀个数据就必须取出来，否则就会阻塞 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<h3 id="创建无缓冲和缓冲通道"><a href="#创建无缓冲和缓冲通道" class="headerlink" title="创建无缓冲和缓冲通道 "></a><font style="color:rgb(0,0,0);">创建无缓冲和缓冲通道 </font></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) <span class="comment">//整型⽆缓冲通道 </span></span><br><span class="line"><span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span> ,<span class="number">10</span>) <span class="comment">//整型有缓冲通道，10是容量</span></span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0,0,0);">使⽤内置函数</font><strong><font style="color:rgb(0,0,0);">make</font></strong><font style="color:rgb(0,0,0);">创建⽆缓冲、缓冲通道，make第⼀个参数需要是关键字</font><strong><font style="color:rgb(0,0,0);">chan</font></strong><font style="color:rgb(0,0,0);">，也就是通道Channels的缩写，然后是通道交换的数据类型 </font></p>
<h3 id="通道使用"><a href="#通道使用" class="headerlink" title="通道使用 "></a><font style="color:rgb(0,0,0);">通道使用 </font></h3><p><font style="color:rgb(0,0,0);">管道在左边，则说明是往管道中传输数据，管道在右边，则说明要取出数据 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">5</span>) <span class="comment">//整型缓冲通道 </span></span><br><span class="line">ch &lt;- <span class="number">5</span> <span class="comment">//通过管道发送值 </span></span><br><span class="line">data := &lt;-ch</span><br></pre></td></tr></table></figure>

<h3 id="无缓冲区实例"><a href="#无缓冲区实例" class="headerlink" title="无缓冲区实例 "></a><font style="color:rgb(0,0,0);">无缓冲区实例 </font></h3><p>证明只能写一个读一个，否则会堵塞</p>
<p>无缓冲通道是一种在数据发送和接收操作上会阻塞的通道。这意味着，只有在有协程准备好从通道接收数据时，数据发送操作才能完成</p>
<p><font style="color:rgb(0,0,0);">阻塞</font><font style="color:rgb(0,0,0);">+</font><font style="color:rgb(0,0,0);">主协程结束 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span> </span><br><span class="line">    <span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">        fmt.Println(<span class="string">&quot;准备向⽆缓冲通道发送数据&quot;</span>) </span><br><span class="line">        ch &lt;- <span class="number">111</span> </span><br><span class="line">        fmt.Println(<span class="string">&quot;向⽆缓冲通道发送数据完毕&quot;</span>) </span><br><span class="line">        <span class="comment">//还没轮到这句打印，主协程就已经结束了</span></span><br><span class="line">    &#125;() </span><br><span class="line">    time.Sleep(<span class="number">1</span> * time.Second) </span><br><span class="line">    <span class="comment">//这里睡眠导致主协程还在进行，堵塞了管道，无法写入数据</span></span><br><span class="line">    <span class="comment">//前面的goroutine写入管道已经准备好了</span></span><br><span class="line">    <span class="comment">//下面goroutine接收一好就立马执行完了，导致协程内的打印还没触发</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;准备从⽆缓冲通道接收数据&quot;</span>) </span><br><span class="line">    data := &lt;-ch </span><br><span class="line">    fmt.Println(<span class="string">&quot;从⽆缓冲通道接收到数据：&quot;</span>, data) </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备向⽆缓冲通道发送数据</span></span><br><span class="line"><span class="comment">// 准备从⽆缓冲通道接收数据</span></span><br><span class="line"><span class="comment">// 从⽆缓冲通道接收到数据： 111</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>下面的代码就让协程中的最后的发送完毕的打印能够成功执行完</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;准备向⽆缓冲通道发送数据&quot;</span>)</span><br><span class="line">		ch &lt;- <span class="number">111</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;向⽆缓冲通道发送数据完毕&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">//time.Sleep(1 * time.Second)</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;准备从⽆缓冲通道接收数据&quot;</span>)</span><br><span class="line">	data := &lt;-ch</span><br><span class="line">	time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">	fmt.Println(<span class="string">&quot;从⽆缓冲通道接收到数据：&quot;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备从⽆缓冲通道接收数据</span></span><br><span class="line"><span class="comment">// 准备向⽆缓冲通道发送数据</span></span><br><span class="line"><span class="comment">// 向⽆缓冲通道发送数据完毕</span></span><br><span class="line"><span class="comment">// 从⽆缓冲通道接收到数据： 111</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>这下面的代码没有造成阻塞，通道保证了主协程会保证协程的运行结束</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span> </span><br><span class="line">    <span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">        fmt.Println(<span class="string">&quot;准备向⽆缓冲通道发送数据&quot;</span>) </span><br><span class="line">        ch &lt;- <span class="number">111</span> </span><br><span class="line">        fmt.Println(<span class="string">&quot;向⽆缓冲通道发送数据完毕&quot;</span>) </span><br><span class="line">    &#125;() </span><br><span class="line">    <span class="comment">// time.Sleep(1 * time.Second) </span></span><br><span class="line">    fmt.Println(<span class="string">&quot;准备从⽆缓冲通道接收数据&quot;</span>) </span><br><span class="line">    data := &lt;-ch </span><br><span class="line">    fmt.Println(<span class="string">&quot;从⽆缓冲通道接收到数据：&quot;</span>, data) </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备从⽆缓冲通道接收数据</span></span><br><span class="line"><span class="comment">// 准备向⽆缓冲通道发送数据</span></span><br><span class="line"><span class="comment">// 向⽆缓冲通道发送数据完毕</span></span><br><span class="line"><span class="comment">// 从⽆缓冲通道接收到数据： 111</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲区实例"><a href="#缓冲区实例" class="headerlink" title="缓冲区实例 "></a><font style="color:rgb(0,0,0);">缓冲区实例 </font></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span> </span><br><span class="line">    <span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>) </span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">        fmt.Println(<span class="string">&quot;准备向⽆缓冲通道发送数据&quot;</span>) </span><br><span class="line">        ch &lt;- <span class="number">111</span> </span><br><span class="line">        fmt.Println(<span class="string">&quot;向⽆缓冲通道发送数据完毕&quot;</span>) </span><br><span class="line">    &#125;() </span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">    fmt.Println(<span class="string">&quot;准备从⽆缓冲通道接收数据&quot;</span>) </span><br><span class="line">    data := &lt;-ch </span><br><span class="line">    fmt.Println(<span class="string">&quot;从⽆缓冲通道接收到数据：\n&quot;</span>, data) </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备向⽆缓冲通道发送数据</span></span><br><span class="line"><span class="comment">// 向⽆缓冲通道发送数据完毕</span></span><br><span class="line"><span class="comment">// 准备从⽆缓冲通道接收数据</span></span><br><span class="line"><span class="comment">// 从⽆缓冲通道接收到数据：</span></span><br><span class="line"><span class="comment">//  111</span></span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0,0,0);">实例</font><strong><font style="color:rgb(0,0,0);">1 </font></strong></p>
<p><font style="color:rgb(0,0,0);">这个实例代码创建了⼀个通道 ch，在 main 函数中启动⼀个 goroutine 执⾏ Ion 函数，Ion 函数⽣成⼀个随机数并发送到通道，main 函数等待接收通道中的数据并打印，最后关闭通道。 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span> </span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span> </span><br><span class="line">    <span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Ion</span><span class="params">()</span></span> &#123; </span><br><span class="line">    rand.Seed(time.Now().UnixNano()) </span><br><span class="line">    intn := rand.Intn(<span class="number">100</span>) </span><br><span class="line">    fmt.Println(<span class="string">&quot;随机数为：&quot;</span>, intn) </span><br><span class="line">    time.Sleep(<span class="number">5</span> * time.Second) </span><br><span class="line">    ch &lt;- intn </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">defer</span> <span class="built_in">close</span>(ch) <span class="comment">//main关闭后，关闭通道 </span></span><br><span class="line">    <span class="keyword">go</span> Ion() </span><br><span class="line">    fmt.Println(<span class="string">&quot;Wait...&quot;</span>) </span><br><span class="line">    data := &lt;-ch </span><br><span class="line">    fmt.Println(<span class="string">&quot;值为：&quot;</span>, data) </span><br><span class="line">    fmt.Println(<span class="string">&quot;Done&quot;</span>) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0,0,0);">实例</font><strong><font style="color:rgb(0,0,0);">2 </font></strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> (<span class="string">&quot;fmt&quot;</span> </span><br><span class="line">        <span class="string">&quot;time&quot;</span> </span><br><span class="line">       ) </span><br><span class="line"><span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123; </span><br><span class="line">            ch &lt;- i </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="built_in">close</span>(ch) </span><br><span class="line">    &#125;() </span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">        <span class="keyword">for</span> &#123; </span><br><span class="line">            v, ok := &lt;-ch </span><br><span class="line">            <span class="keyword">if</span> !ok &#123; </span><br><span class="line">                fmt.Println(<span class="string">&quot;通道的值已经取完了&quot;</span>) </span><br><span class="line">                <span class="keyword">break</span> </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                fmt.Println(v) </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;() </span><br><span class="line">    time.Sleep(<span class="number">1</span> * time.Second) </span><br><span class="line">    fmt.Println(<span class="string">&quot;main End &quot;</span>) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0,0,0);">说明 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">使⽤变量来接收通道的值，⼀次只能打印⼀个，需要⼀直赋值，⼀个接⼀个的打印，所以尽量还是使⽤循环的⽅式来取出值 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)ch &lt;- <span class="number">5</span> </span><br><span class="line">    ch &lt;- <span class="number">10</span> </span><br><span class="line">    <span class="built_in">close</span>(ch) </span><br><span class="line">    data := &lt;-ch </span><br><span class="line">    fmt.Println(<span class="string">&quot;Data:&quot;</span>, data) </span><br><span class="line">    data = &lt;-ch </span><br><span class="line">    fmt.Println(<span class="string">&quot;Data:&quot;</span>, data) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="通道遍历"><a href="#通道遍历" class="headerlink" title="通道遍历 "></a><font style="color:rgb(0,0,0);">通道遍历 </font></h3><p><font style="color:rgb(0,0,0);">我们在没有接收者的情况下，使⽤通道，就会引发死锁，可以使⽤缓冲区通道，或者⽤接受者，也就是go func，在读取过程中，读取完之后，需要close(ch)来关闭通道，否则就会报错，引发死锁 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123; </span><br><span class="line">ch &lt;- i </span><br><span class="line">&#125; </span><br><span class="line">&#125;() </span><br><span class="line">data := &lt;-ch </span><br><span class="line">fmt.Println(<span class="string">&quot;data:&quot;</span>, data) </span><br><span class="line">data = &lt;-ch </span><br><span class="line">fmt.Println(<span class="string">&quot;data:&quot;</span>, data) </span><br><span class="line">data = &lt;-ch </span><br><span class="line">fmt.Println(<span class="string">&quot;data:&quot;</span>, data) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="for遍历"><a href="#for遍历" class="headerlink" title="for遍历 "></a><font style="color:rgb(0,0,0);">for遍历 </font></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123; </span><br><span class="line">v, ok := &lt;-chif ok &#123; </span><br><span class="line">fmt.Println(<span class="string">&quot;ok&quot;</span>, v) </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">fmt.Println(<span class="string">&quot;channel closed&quot;</span>) </span><br><span class="line"><span class="keyword">break</span> </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="for-range遍历"><a href="#for-range遍历" class="headerlink" title="for range遍历 "></a><font style="color:rgb(0,0,0);">for range遍历 </font></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> c := <span class="keyword">range</span> ch &#123; </span><br><span class="line">fmt.Println(<span class="string">&quot;Received&quot;</span>, c) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="for-i遍历"><a href="#for-i遍历" class="headerlink" title="for i遍历 "></a><font style="color:rgb(0,0,0);">for i遍历 </font></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123; </span><br><span class="line">data := &lt;-ch </span><br><span class="line">fmt.Println(data) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="WaitGroup同步"><a href="#WaitGroup同步" class="headerlink" title="WaitGroup同步 "></a><font style="color:rgb(0,0,0);">WaitGroup同步 </font></h1><p><strong><font style="color:rgb(0,0,0);">WaitGroup</font></strong><font style="color:rgb(0,0,0);">（同步） </font></p>
<p><font style="color:rgb(0,0,0);">上⾯的实例，如果我们使⽤ time.Sleep 来使主函数睡眠等待时间，则有可能Goroutines还没有执⾏完毕，睡眠时间结束，主函数就停⽌程序运⾏了，为了解决这个问题，就有了WaitGroup同步 </font></p>
<p><font style="color:rgb(0,0,0);">机制。 </font></p>
<h2 id="声明WaitGroup"><a href="#声明WaitGroup" class="headerlink" title="声明WaitGroup "></a><font style="color:rgb(0,0,0);">声明WaitGroup </font></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明 </span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup </span><br></pre></td></tr></table></figure>

<h2 id="使⽤WaitGroup"><a href="#使⽤WaitGroup" class="headerlink" title="使⽤WaitGroup "></a><font style="color:rgb(0,0,0);">使⽤WaitGroup </font></h2><p><font style="color:rgb(92,92,92);">wg.</font><font style="color:rgb(224,172,0);">Add</font><font style="color:rgb(92,92,92);">(</font><font style="color:rgb(120,82,238);">1</font><font style="color:rgb(92,92,92);">)</font><font style="color:rgb(92,92,92);">：每次启动⼀个新的协程时，调⽤ </font><font style="color:rgb(224,172,0);">Add</font><font style="color:rgb(92,92,92);">(</font><font style="color:rgb(120,82,238);">1</font><font style="color:rgb(92,92,92);">) </font><font style="color:rgb(92,92,92);">将计数器加</font><font style="color:rgb(120,82,238);">1</font><font style="color:rgb(92,92,92);">，表示有⼀个新的协程在运⾏。 </font></p>
<p><font style="color:rgb(92,92,92);">wg.</font><font style="color:rgb(224,172,0);">Done</font><font style="color:rgb(92,92,92);">()</font><font style="color:rgb(92,92,92);">：在协程执⾏完毕时，调⽤ </font><font style="color:rgb(224,172,0);">Done</font><font style="color:rgb(92,92,92);">() </font><font style="color:rgb(92,92,92);">将计数器减</font><font style="color:rgb(120,82,238);">1</font><font style="color:rgb(92,92,92);">，表示该协程已完成。 </font></p>
<p><font style="color:rgb(92,92,92);">wg.</font><font style="color:rgb(224,172,0);">Wait</font><font style="color:rgb(92,92,92);">()</font><font style="color:rgb(92,92,92);">：在主协程中调⽤ </font><font style="color:rgb(224,172,0);">Wait</font><font style="color:rgb(92,92,92);">()</font><font style="color:rgb(92,92,92);">，它会阻塞，直到计数器变为</font><font style="color:rgb(120,82,238);">0</font><font style="color:rgb(92,92,92);">，表示所有协程都已完成执⾏。 </font></p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码 "></a><font style="color:rgb(0,0,0);">示例代码 </font></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line">    <span class="string">&quot;fmt&quot;</span> </span><br><span class="line">    <span class="string">&quot;sync&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(msg <span class="type">string</span>)</span></span> &#123; </span><br><span class="line">    <span class="keyword">defer</span> wg.Done() </span><br><span class="line">    fmt.Println(msg) </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123; </span><br><span class="line">        wg.Add(<span class="number">1</span>) </span><br><span class="line">        <span class="keyword">go</span> show(<span class="string">&quot;Go&quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait() </span><br><span class="line">    fmt.Println(<span class="string">&quot;main End&quot;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="Runtime包"><a href="#Runtime包" class="headerlink" title="Runtime包 "></a><font style="color:rgb(0,0,0);">Runtime包 </font></h1><p><font style="color:rgb(0,0,0);">Runtime</font><font style="color:rgb(0,0,0);">包中定义了⼀些关于协程的</font><font style="color:rgb(0,0,0);">API </font></p>
<h2 id="runtime-Gosched"><a href="#runtime-Gosched" class="headerlink" title="runtime.Gosched() "></a><font style="color:rgb(0,0,0);">runtime.Gosched() </font></h2><p><font style="color:rgb(0,0,0);">让出 CPU 时间⽚，以便其他 goroutine 运⾏ </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;runtime&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(msg <span class="type">string</span>)</span></span> &#123; </span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123; </span><br><span class="line">fmt.Println(msg) </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">go</span> show(<span class="string">&quot;Go&quot;</span>) </span><br><span class="line">runtime.Gosched() </span><br><span class="line">fmt.Println(<span class="string">&quot;Main-End...&quot;</span>) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="runtime-Goexit"><a href="#runtime-Goexit" class="headerlink" title="runtime.Goexit() "></a><font style="color:rgb(0,0,0);">runtime.Goexit() </font></h2><p><font style="color:rgb(0,0,0);">runtime.Goexit() ⽤于⽴即终⽌当前正在执⾏的 goroutine。它不会影响其他正在运⾏的goroutine，也不会终⽌整个程序。调⽤ Goexit 后，当前 goroutine 会执⾏所有的延迟函数 （defer 语句），然后退出。 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;runtime&quot;</span> </span><br><span class="line">)<span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(m <span class="type">string</span>)</span></span> &#123; </span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123; </span><br><span class="line">fmt.Println(m) </span><br><span class="line"><span class="keyword">if</span> i &gt;= <span class="number">5</span> &#123; </span><br><span class="line">runtime.Goexit() </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">go</span> show(<span class="string">&quot;Go&quot;</span>) </span><br><span class="line">runtime.Gosched() </span><br><span class="line">fmt.Println(<span class="string">&quot;End&quot;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="Mutex互斥锁"><a href="#Mutex互斥锁" class="headerlink" title="Mutex互斥锁 "></a><font style="color:rgb(0,0,0);">Mutex互斥锁 </font></h1><p><font style="color:rgb(0,0,0);">除了可以使⽤管道进⾏同步，还可以使⽤互斥锁来实现,虽然 WaitGroup 确保所有 goroutine 都完成了执⾏，但由于 x 的读写操作没有同步，导致数据竞争问题。多个 goroutine 同时访问和修改x，会导致最终结果不确定。 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;sync&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> ( </span><br><span class="line">x <span class="type">int</span> = <span class="number">100</span> </span><br><span class="line">wg sync.WaitGroup </span><br><span class="line">Lock sync.Mutex </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">defer</span> wg.Done() </span><br><span class="line">Lock.Lock() </span><br><span class="line">x += <span class="number">1</span> </span><br><span class="line">fmt.Println(<span class="string">&quot;x++:&quot;</span>, x) </span><br><span class="line">Lock.Unlock() </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sub</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">defer</span> wg.Done() </span><br><span class="line">Lock.Lock() </span><br><span class="line">x -= <span class="number">1</span> </span><br><span class="line">fmt.Println(<span class="string">&quot;x--:&quot;</span>, x) </span><br><span class="line">Lock.Unlock() </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123; </span><br><span class="line">wg.Add(<span class="number">1</span>) </span><br><span class="line"><span class="keyword">go</span> Add() </span><br><span class="line">wg.Add(<span class="number">1</span>) </span><br><span class="line"><span class="keyword">go</span> Sub() </span><br><span class="line">&#125;wg.Wait() </span><br><span class="line">fmt.Println(<span class="string">&quot;End-----:&quot;</span>, x) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="Select"><a href="#Select" class="headerlink" title="Select "></a><font style="color:rgb(0,0,0);">Select </font></h1><p><font style="color:rgb(171,171,171);">1. </font><font style="color:rgb(0,0,0);">selsct是Go中的⼀个控制结构，类似于</font><strong><font style="color:rgb(0,0,0);">switch</font></strong><font style="color:rgb(0,0,0);">语句，⽤于处理异步IO操作，</font><strong><font style="color:rgb(0,0,0);">select</font></strong><font style="color:rgb(0,0,0);">会监听case语句中channel的读写操作，当case中channel读写状态位⾮阻塞状态（能读能写）的时候，将会触发对应的动作，也就是说，是⽤来判断channel的⼀个状态，是否可以读写 </font></p>
<p><strong><font style="color:rgb(68,138,255);">Note </font></strong></p>
<blockquote>
<p><font style="color:rgb(0,0,0);">select中的case语句必须是⼀个channel操作 </font></p>
<p><font style="color:rgb(0,0,0);">select中的default字句总是可运⾏的 </font></p>
</blockquote>
<p><font style="color:rgb(171,171,171);">2. </font><font style="color:rgb(0,0,0);">如果有多个</font><strong><font style="color:rgb(0,0,0);">case</font></strong><font style="color:rgb(0,0,0);">都可以运⾏，</font><strong><font style="color:rgb(0,0,0);">select</font></strong><font style="color:rgb(0,0,0);">则会随机选出⼀个执⾏，其他不会执⾏ </font></p>
<p><font style="color:rgb(171,171,171);">3. </font><font style="color:rgb(0,0,0);">如果没有可运⾏的</font><strong><font style="color:rgb(0,0,0);">case</font></strong><font style="color:rgb(0,0,0);">语句，且存在</font><strong><font style="color:rgb(0,0,0);">default</font></strong><font style="color:rgb(0,0,0);">语句，就会执⾏</font><font style="color:rgb(0,0,0);">default</font><font style="color:rgb(0,0,0);">的语句。 </font></p>
<p><font style="color:rgb(171,171,171);">4. </font><font style="color:rgb(0,0,0);">如果没有可运⾏的</font><strong><font style="color:rgb(0,0,0);">case</font></strong><font style="color:rgb(0,0,0);">语句，且没有</font><strong><font style="color:rgb(0,0,0);">default</font></strong><font style="color:rgb(0,0,0);">语句，select将会阻塞，直到某个case通信可以运⾏</font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">实例代码 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> ( </span><br><span class="line">chanStr = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>) </span><br><span class="line">chanInt = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">chanStr &lt;- <span class="string">&quot;Hello&quot;</span> </span><br><span class="line">chanInt &lt;- <span class="number">1</span> </span><br><span class="line"><span class="built_in">close</span>(chanStr) </span><br><span class="line"><span class="built_in">close</span>(chanInt) </span><br><span class="line">&#125;()<span class="keyword">for</span> &#123; </span><br><span class="line"><span class="keyword">select</span> &#123; </span><br><span class="line"><span class="keyword">case</span> r := &lt;-chanStr: </span><br><span class="line">fmt.Println(<span class="string">&quot;String:&quot;</span>, r) </span><br><span class="line"><span class="keyword">case</span> r := &lt;-chanInt: </span><br><span class="line">fmt.Println(<span class="string">&quot;Int:&quot;</span>, r) </span><br><span class="line"><span class="keyword">default</span>: </span><br><span class="line">fmt.Println(<span class="string">&quot;Default&quot;</span>) </span><br><span class="line">&#125; </span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Second) </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Ticker"><a href="#Ticker" class="headerlink" title="Ticker"></a><font style="color:rgb(0,0,0);">Ticker</font></h1><p><font style="color:rgb(0,0,0);">timer</font><font style="color:rgb(0,0,0);">只执⾏⼀次，</font><font style="color:rgb(0,0,0);">ticker</font><font style="color:rgb(0,0,0);">可以周期执⾏ </font></p>
<p><font style="color:rgb(0,0,0);">创建</font><strong><font style="color:rgb(0,0,0);">Ticker </font></strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ticker := time.NewTicker(<span class="number">1</span> * time.Second) </span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0,0,0);">示例代码 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">ticker := time.NewTicker(<span class="number">1</span> * time.Second) </span><br><span class="line">cont := <span class="number">1</span> </span><br><span class="line"><span class="keyword">for</span> _ = <span class="keyword">range</span> ticker.C &#123; </span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>) </span><br><span class="line">cont++ </span><br><span class="line"><span class="keyword">if</span> cont &gt;= <span class="number">10</span> &#123; </span><br><span class="line">ticker.Stop() </span><br><span class="line"><span class="keyword">break</span> </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">使⽤定时器来写数据 </span><br><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>) </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;ticker := time.NewTicker(<span class="number">1</span> * time.Second) </span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> ticker.C &#123; </span><br><span class="line">ch &lt;- <span class="number">1</span> </span><br><span class="line">&#125; </span><br><span class="line">&#125;() </span><br><span class="line">sum := <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> v := <span class="keyword">range</span> ch &#123; </span><br><span class="line">fmt.Println(<span class="string">&quot;收到&quot;</span>, v) </span><br><span class="line">sum += v </span><br><span class="line"><span class="keyword">if</span> sum &gt; <span class="number">10</span> &#123; </span><br><span class="line">fmt.Println(<span class="string">&quot;sum &gt; 10&quot;</span>) </span><br><span class="line"><span class="keyword">break</span> </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="原⼦变量"><a href="#原⼦变量" class="headerlink" title="原⼦变量 "></a><font style="color:rgb(0,0,0);">原⼦变量 </font></h1><blockquote>
<p>在对该原子操作时，会禁止其他协程对该原子变量进行操作，避免条件竞争<br>在Go语言中，为了避免多协程操作共享资源时出现的条件竞争问题，可以使用<code>sync/atomic</code>包提供的原子操作。原子操作可以确保在修改某个变量时，其他协程不会同时对这个变量进行操作，从而保证了操作的原子性和一致性。</p>
</blockquote>
<h2 id="CAS-⽐较并交换"><a href="#CAS-⽐较并交换" class="headerlink" title="CAS(⽐较并交换) "></a><font style="color:rgb(0,0,0);">CAS(⽐较并交换) </font></h2><p><font style="color:rgb(0,0,0);">CAS 是 Compare-And-Swap（⽐较并交换）的缩写。CAS 是⼀种原⼦操作，⽤于在多线程环境中实现⽆锁编程。它通过⽐较内存中的某个值是否等于预期值，如果相等则将其更新为新值，否则不做任何操作。这个过程是原⼦的，即在执⾏过程中不会被中断。 </font></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;sync/atomic&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> i <span class="type">int32</span> = <span class="number">100</span> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">atomic.CompareAndSwapInt32(&amp;i, <span class="number">100</span>, <span class="number">200</span>) </span><br><span class="line">fmt.Println(i) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="Load-读"><a href="#Load-读" class="headerlink" title="Load(读) "></a><font style="color:rgb(0,0,0);">Load(读) </font></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;sync/atomic&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> i <span class="type">int32</span> = <span class="number">100</span> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">atomic.LoadInt32(&amp;i) </span><br><span class="line">fmt.Println(<span class="string">&quot;i&quot;</span>, i) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Store-写"><a href="#Store-写" class="headerlink" title="Store(写) "></a><font style="color:rgb(0,0,0);">Store(写) </font></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;sync/atomic&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> i <span class="type">int32</span> = <span class="number">100</span> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">atomic.StoreInt32(&amp;i, <span class="number">200</span>) </span><br><span class="line">fmt.Println(atomic.LoadInt32(&amp;i)) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="Add"><a href="#Add" class="headerlink" title="Add "></a><font style="color:rgb(0,0,0);">Add </font></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line"><span class="string">&quot;fmt&quot;</span> </span><br><span class="line"><span class="string">&quot;sync&quot;</span> </span><br><span class="line"><span class="string">&quot;sync/atomic&quot;</span> </span><br><span class="line"><span class="string">&quot;time&quot;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">var</span> i <span class="type">int32</span> = <span class="number">100</span> </span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">()</span></span> &#123; </span><br><span class="line">atomic.AddInt32(&amp;i, <span class="number">1</span>) </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sub</span><span class="params">()</span></span> &#123; </span><br><span class="line">atomic.AddInt32(&amp;i, <span class="number">-1</span>) </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123; </span><br><span class="line"><span class="keyword">go</span> Add() </span><br><span class="line"><span class="keyword">go</span> Sub() </span><br><span class="line">&#125; </span><br><span class="line">time.Sleep(<span class="number">2</span> * time.Second)fmt.Println(<span class="string">&quot;End&quot;</span>, i) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Hundredsu.github.io">Hundredsu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://hundredsu.github.io/post/b6e82410.html">https://hundredsu.github.io/post/b6e82410.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Hundredsu.github.io" target="_blank">Hundredsu'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/">安全开发</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/post/5715da98.html" title="4、函数&amp;字符串格式化&amp;条件控制&amp;结构体"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">4、函数&字符串格式化&条件控制&结构体</div></div><div class="info-2"><div class="info-item-1">Fmt fmt.Printf 常⻅占位符 想打印百分号就需要输入两个%  %v：值的默认格式表示  12fmt.Printf(&quot;%%v: %v\n&quot;, 123) //%v: 123    %+v：类似%v，但会添加字段名（结构体）  12345fmt.Printf(&quot;%%+v: %+v\n&quot;, struct&#123; Name string &#125;&#123;&quot;Alice&quot;&#125;) //%+v: &#123;Name:Alice&#125;fmt.Printf(&quot;%%v: %v\n&quot;, struct&#123; Name string &#125;&#123;&quot;Alice&quot;&#125;)//%v: &#123;Alice&#125;  %#v：值的Go语法表示  1fmt.Printf(&quot;%%#v: %#v\n&quot;, struct&#123; Name string &#125;&#123;&quot;Alice&quot;&#125;)...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/post/8b3c7b5f.html" title="3、数组与切片、指针、类型转换、字符串常用函数"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-07</div><div class="info-item-2">3、数组与切片、指针、类型转换、字符串常用函数</div></div><div class="info-2"><div class="info-item-1">数组什么是数组在 Go 中，数组是具有固定⻓度且元素类型相同的集合。数组的定义语法如下：   12var arrayName [length]elementTypevar numbers [5]int      初始化数组数组可以在声明时进⾏初始化 1var numbers = [5]int&#123;1, 2, 3, 4, 5&#125;  简短声明⽅式： 1numbers := [5]int&#123;1, 2, 3, 4, 5&#125;  使⽤省略让编译器自动计算数组⻓度 1numbers := [...]int&#123;1, 2, 3, 4, 5&#125;  访问数组元素 12fmt.Println(numbers[0]) // 输出第⼀个元素numbers[1] = 10 // 修改第⼆个元素的值  数组⻓度1fmt.Println(len(numbers)) // 输出数组的⻓度  值类型数组是值类型，这意味着当数组被赋值给另⼀个数组或作为参数传递时，会进⾏值拷⻉   12345a := [3]int&#123;1, 2, 3&#125;b := ab[0]...</div></div></div></a><a class="pagination-related" href="/post/347fb1ae.html" title="1、环境配置和编辑器使用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-07</div><div class="info-item-2">1、环境配置和编辑器使用</div></div><div class="info-2"><div class="info-item-1">第⼀节-安装Go&amp;编辑器基础使⽤环境配置&amp;基础使⽤ 安装包https://golang.google.cn 添加环境变量windows直接点击msi安装即可，不需要配置环境变量 Linux 12345tar -zxvf xxx.xxx.xxx.tar.gzmv -r go /use/local/govim /etc/profileexport PATH=$PATH:/usr/local/go/binsource /etc/profile  Macos1.如果mac有Homebrew包管理⼯具，直接使⽤下⾯命令brew install go2.如果没有的话，官⽹下载默认安装到&#x2F;usr&#x2F;local&#x2F;go下，环境变量跟linux⼀样。   编辑器Vscode下载地址：https://code.visualstudio.com/安装go的插件包，fmt等go env -w GO111MODULE&#x3D;ongo env -w...</div></div></div></a><a class="pagination-related" href="/post/3beb5b8d.html" title="2、初始函数与基本类型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-07</div><div class="info-item-2">2、初始函数与基本类型</div></div><div class="info-2"><div class="info-item-1">1234567891011package mainimport (	&quot;fmt&quot;)func main() &#123;	fmt.Println(&quot;hello world&quot;)&#125;      Package package:LiPackage:  包是Go语言的基本组成单元，通常使用单个的小写单词命名，一个 Go 程序本质上就是一组包的集合。 所有Go代码都有自己隶属的包。 main 包在 Go 中是一个特殊的包，整个 Go程序中仅允许存在一个名为 main 的包  函数   Go语言中，函数名的首字母决定了其可见性。 如果函数名的首字母大写，那么该函数是导出的，可以在包外部使用； 如果首字母小写，那么该函数是未导出的，只能在包内部使用。  可以简单理解为一个目录下的go文件就为同一个包内 基本类型常量常量定义常量使⽤ const 关键字定义。  常量的值在编译时就确定了，不能在运⾏时改变。  不使用也不会报错 常量类型常量可以是布尔型、数字型（整数、浮点数、复数）、字符串型。...</div></div></div></a><a class="pagination-related" href="/post/5715da98.html" title="4、函数&amp;字符串格式化&amp;条件控制&amp;结构体"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-07</div><div class="info-item-2">4、函数&amp;字符串格式化&amp;条件控制&amp;结构体</div></div><div class="info-2"><div class="info-item-1">Fmt fmt.Printf 常⻅占位符 想打印百分号就需要输入两个%  %v：值的默认格式表示  12fmt.Printf(&quot;%%v: %v\n&quot;, 123) //%v: 123    %+v：类似%v，但会添加字段名（结构体）  12345fmt.Printf(&quot;%%+v: %+v\n&quot;, struct&#123; Name string &#125;&#123;&quot;Alice&quot;&#125;) //%+v: &#123;Name:Alice&#125;fmt.Printf(&quot;%%v: %v\n&quot;, struct&#123; Name string &#125;&#123;&quot;Alice&quot;&#125;)//%v: &#123;Alice&#125;  %#v：值的Go语法表示  1fmt.Printf(&quot;%%#v: %#v\n&quot;, struct&#123; Name string &#125;&#123;&quot;Alice&quot;&#125;)...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Hundredsu</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Hundredsu"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Hundredsu" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这是Hundredsu的博客,随缘更新</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B%EF%BC%9F%EF%BC%9F%EF%BC%9F%EF%BC%9F%EF%BC%9F%EF%BC%9F%EF%BC%9F%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">什么是进程、线程、协程？？？？？？？？ </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">进程概念： </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">线程： </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">单线程 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">多线程 </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">协程 </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">调度器 </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6"><span class="toc-number">1.4.1.</span> <span class="toc-text">线程调度 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Go-Goroutines-%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="toc-number">1.4.2.</span> <span class="toc-text">Go Goroutines 调度器 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Go%E8%B0%83%E5%BA%A6%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.4.3.</span> <span class="toc-text">Go调度的优势 </span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%BB%E9%87%8F%E6%80%A7"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">轻量性 </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%BE%83%E5%8A%A8%E8%B0%83%E5%BA%A6"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">⾃动调度 </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%A0%B8%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">多核优化 </span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B-1"><span class="toc-number"></span> <span class="toc-text">协程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B%E5%88%9B%E5%BB%BA"><span class="toc-number">0.1.</span> <span class="toc-text">协程创建 </span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E9%81%93%EF%BC%88Channels%EF%BC%89"><span class="toc-number"></span> <span class="toc-text">通道（Channels） </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%97%A0%E7%BC%93%E5%86%B2%E5%92%8C%E7%BC%93%E5%86%B2%E9%80%9A%E9%81%93"><span class="toc-number">0.1.</span> <span class="toc-text">创建无缓冲和缓冲通道 </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E4%BD%BF%E7%94%A8"><span class="toc-number">0.2.</span> <span class="toc-text">通道使用 </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%BC%93%E5%86%B2%E5%8C%BA%E5%AE%9E%E4%BE%8B"><span class="toc-number">0.3.</span> <span class="toc-text">无缓冲区实例 </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E5%AE%9E%E4%BE%8B"><span class="toc-number">0.4.</span> <span class="toc-text">缓冲区实例 </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E9%81%8D%E5%8E%86"><span class="toc-number">0.5.</span> <span class="toc-text">通道遍历 </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#for%E9%81%8D%E5%8E%86"><span class="toc-number">0.5.1.</span> <span class="toc-text">for遍历 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#for-range%E9%81%8D%E5%8E%86"><span class="toc-number">0.5.2.</span> <span class="toc-text">for range遍历 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#for-i%E9%81%8D%E5%8E%86"><span class="toc-number">0.5.3.</span> <span class="toc-text">for i遍历 </span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WaitGroup%E5%90%8C%E6%AD%A5"><span class="toc-number"></span> <span class="toc-text">WaitGroup同步 </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8EWaitGroup"><span class="toc-number">1.</span> <span class="toc-text">声明WaitGroup </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E2%BD%A4WaitGroup"><span class="toc-number">2.</span> <span class="toc-text">使⽤WaitGroup </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text">示例代码 </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Runtime%E5%8C%85"><span class="toc-number"></span> <span class="toc-text">Runtime包 </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#runtime-Gosched"><span class="toc-number">1.</span> <span class="toc-text">runtime.Gosched() </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#runtime-Goexit"><span class="toc-number">2.</span> <span class="toc-text">runtime.Goexit() </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mutex%E4%BA%92%E6%96%A5%E9%94%81"><span class="toc-number"></span> <span class="toc-text">Mutex互斥锁 </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Select"><span class="toc-number"></span> <span class="toc-text">Select </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ticker"><span class="toc-number"></span> <span class="toc-text">Ticker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E2%BC%A6%E5%8F%98%E9%87%8F"><span class="toc-number"></span> <span class="toc-text">原⼦变量 </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CAS-%E2%BD%90%E8%BE%83%E5%B9%B6%E4%BA%A4%E6%8D%A2"><span class="toc-number">1.</span> <span class="toc-text">CAS(⽐较并交换) </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Load-%E8%AF%BB"><span class="toc-number">2.</span> <span class="toc-text">Load(读) </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Store-%E5%86%99"><span class="toc-number">2.1.</span> <span class="toc-text">Store(写) </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Add"><span class="toc-number">3.</span> <span class="toc-text">Add </span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/b6e82410.html" title="5、并发编程">5、并发编程</a><time datetime="2025-08-07T13:57:12.000Z" title="发表于 2025-08-07 21:57:12">2025-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/8b3c7b5f.html" title="3、数组与切片、指针、类型转换、字符串常用函数">3、数组与切片、指针、类型转换、字符串常用函数</a><time datetime="2025-08-07T13:57:09.000Z" title="发表于 2025-08-07 21:57:09">2025-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/347fb1ae.html" title="1、环境配置和编辑器使用">1、环境配置和编辑器使用</a><time datetime="2025-08-07T13:57:09.000Z" title="发表于 2025-08-07 21:57:09">2025-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/3beb5b8d.html" title="2、初始函数与基本类型">2、初始函数与基本类型</a><time datetime="2025-08-07T13:57:09.000Z" title="发表于 2025-08-07 21:57:09">2025-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/5715da98.html" title="4、函数&amp;字符串格式化&amp;条件控制&amp;结构体">4、函数&amp;字符串格式化&amp;条件控制&amp;结构体</a><time datetime="2025-08-07T13:57:09.000Z" title="发表于 2025-08-07 21:57:09">2025-08-07</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2020 - 2025 By Hundredsu</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.3.4"></script><script src="/js/main.js?v=5.3.4"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.3.4"></script></div></div></body></html>